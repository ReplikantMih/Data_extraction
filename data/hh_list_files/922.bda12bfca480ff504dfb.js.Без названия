(window.webpackJsonp=window.webpackJsonp||[]).push([[922],{1031:function(e,t,r){"use strict";r.r(t);var n=r(57),o=r(3),a=r(651),c=r(680),i=r(92),u=r(39);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=[2,4,7],l=function(e){return n.default.postFormData("/push_subscribe",{token:e})},m=function(e,t){var r=t.apiHost;return e.params=JSON.parse(e.params),e.onOpenActions=JSON.parse(e.onOpenActions).filter(function(e){return"apiGetRequest"===e.type}).map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(r,!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e,{url:"".concat(r).concat(e.url)})}),e};t.default=o.default.build({create:function(e){if(a.default.messaging.isSupported()){var t=a.default.messaging();t.onMessage(function(e){var t=e.data,r=m(t,{apiHost:window.globalVars.apiHost});if("openLink"===r.params.action){var n=new Notification(r.title||"",{body:r.alert,data:r});n.onclick=function(e){var t=r.params,o=r.onOpenActions;e.preventDefault(),n.close(),function(e){var t=window.open(e);if(t)try{t.opener=null}catch(e){}}(t.linkUrl),o.forEach(function(e){var t=e.url;return fetch(t,{mode:"no-cors"})})}}});var r=function(){try{return JSON.parse(u.a.getItem("HH-WebPushSubscribe"))||{}}catch(e){return{}}}(),n=function(){var e,t=r.totalAttempts||0;r.totalAttempts=t+1,r.nextConfirmAttemptTime=(e=t,Date.now()+864e5*p[Math.min(e,p.length-1)]),u.a.setItem("HH-WebPushSubscribe",JSON.stringify(r))};t.getToken().then(function(a){a?l(a).catch(console.error):i.a.get("web_push_confirm_reason")&&(!function(){try{var e=r.nextConfirmAttemptTime;return!e||e<=Date.now()}catch(e){return!0}}()?i.a.remove("web_push_confirm_reason"):o.default.make(c.default,e,{actions:[{target:e.querySelector(".HH-WebPush-Hide"),result:"cancel"},{target:e.querySelector(".HH-WebPush-Accept"),result:"confirm"}]}).waitForUsersAction().then(function(e){return"confirm"===e?t.requestPermission():(n(),i.a.remove("web_push_confirm_reason"),Promise.reject())}).then(function(){return t.requestPermission()}).then(function(){return t.getToken()}).then(function(e){return l(e)}).catch(console.error))},function(){i.a.remove("web_push_confirm_reason")})}},componentName:"HH/WebPush/Subscribe"})}}]);
//# sourceMappingURL=922.bda12bfca480ff504dfb.js.map