webim=webim||{};webim.version='9.1.55';(function(window,undefined){var oldModernizr=window.Modernizr;var oldO=window.o;var define=null;
/*!
 * jQuery JavaScript Library v1.12.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-05-20T17:17Z
 */
(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document");}
return factory(w);};}else{factory(global);}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var deletedIds=[];var document=window.document;var slice=deletedIds.slice;var concat=deletedIds.concat;var push=deletedIds.push;var indexOf=deletedIds.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var
version="1.12.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context);},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase();};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this);},get:function(num){return num!=null?(num<0?this[num+this.length]:this[num]):slice.call(this);},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret;},each:function(callback){return jQuery.each(this,callback);},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},slice:function(){return this.pushStack(slice.apply(this,arguments));},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[]);},end:function(){return this.prevObject||this.constructor();},push:push,sort:deletedIds.sort,splice:deletedIds.splice};jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(i===length){target=this;i--;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg);},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj!=null&&obj==obj.window;},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&(realStringObj-parseFloat(realStringObj)+1)>=0;},isEmptyObject:function(obj){var name;for(name in obj){return false;}
return true;},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
if(!support.ownFirst){for(key in obj){return hasOwn.call(obj,key);}}
for(key in obj){}
return key===undefined||hasOwn.call(obj,key);},type:function(obj){if(obj==null){return obj+"";}
return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj;},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break;}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break;}}}
return obj;},trim:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr);}else{push.call(ret,arr);}}
return ret;},inArray:function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i);}
len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i;}}}
return-1;},merge:function(first,second){var len=+second.length,j=0,i=first.length;while(j<len){first[i++]=second[j++];}
if(len!==len){while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i]);}}
return matches;},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}
return concat.apply([],ret);},guid:1,proxy:function(fn,context){var args,proxy,tmp;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},now:function(){return+(new Date());},support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=deletedIds[Symbol.iterator];}
jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false;}
return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1)in obj;}
var Sizzle=
/*!
 * Sizzle CSS Selector Engine v2.2.1
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-10-17
 */
(function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true;}
return 0;},MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i;}}
return-1;},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={"ID":new RegExp("^#("+identifier+")"),"CLASS":new RegExp("^\\.("+identifier+")"),"TAG":new RegExp("^("+identifier+"|[*])"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"CHILD":new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"bool":new RegExp("^(?:"+booleans+")$","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+
whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-0x10000;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+0x10000):String.fromCharCode(high>>10|0xD800,high&0x3FF|0xDC00);},unloadHandler=function(){setDocument();};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType;}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els));}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}
target.length=j-1;}};}
function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results;}
if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context);}
context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){if((elem=context.getElementById(m))){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results;}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results;}}
if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;newSelector=selector;}else if(context.nodeName.toLowerCase()!=="object"){if((nid=context.getAttribute("id"))){nid=nid.replace(rescape,"\\$&");}else{context.setAttribute("id",(nid=expando));}
groups=tokenize(selector);i=groups.length;nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";while(i--){groups[i]=nidselect+" "+toSelector(groups[i]);}
newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;}
if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id");}}}}}}
return select(selector.replace(rtrim,"$1"),context,results,seed);}
function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()];}
return(cache[key+" "]=value);}
return cache;}
function markFunction(fn){fn[expando]=true;return fn;}
function assert(fn){var div=document.createElement("div");try{return!!fn(div);}catch(e){return false;}finally{if(div.parentNode){div.parentNode.removeChild(div);}
div=null;}}
function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler;}}
function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-
(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff;}
if(cur){while((cur=cur.nextSibling)){if(cur===b){return-1;}}}
return a?1:-1;}
function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}
function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}
function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}
function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context;}
support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document;}
document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if((parent=document.defaultView)&&parent.top!==parent){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false);}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler);}}
support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className");});support.getElementsByTagName=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length;});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!document.getElementsByName||!document.getElementsByName(expando).length;});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[];}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId;};};}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId;};};}
Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag);}else if(support.qsa){return context.querySelectorAll(tag);}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem);}}
return tmp;}
return results;};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className);}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(document.querySelectorAll))){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\r\\' msallowcapture=''>"+"<option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")");}
if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")");}
if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=");}
if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}
if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]");}});assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=");}
if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}
div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:");});}
if((support.matchesSelector=rnative.test((matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos);});}
rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16));}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true;}}}
return false;};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0;}
var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;}
compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1;}
if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1;}
return sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}
return compare&4?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}
var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}else if(aup===bup){return siblingCheck(a,b);}
cur=a;while((cur=cur.parentNode)){ap.unshift(cur);}
cur=b;while((cur=cur.parentNode)){bp.unshift(cur);}
while(ap[i]===bp[i]){i++;}
return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0;};return document;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem);}
expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}
return Sizzle(expr,document,null,[elem]).length>0;};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context);}
return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem);}
var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i);}}
while(j--){results.splice(duplicates[j],1);}}
sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while((node=elem[i++])){ret+=getText(node);}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}
return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" ";}
return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0]);}
match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd");}else if(match[3]){Sizzle.error(match[0]);}
return match;},"PSEUDO":function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null;}
if(match[3]){match[2]=match[4]||match[5]||"";}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess);}
return match.slice(0,3);}},filter:{"TAG":function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true;}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"");});},"ATTR":function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}
if(!operator){return true;}
result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false;};},"CHILD":function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode;}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false;}}
start=dir=type==="only"&&!start&&"nextSibling";}
return true;}
start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break;}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex;}
if(diff===false){while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff];}
if(node===elem){break;}}}}}
diff-=last;return diff===first||(diff%first===0&&diff/first>=0);}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}
if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}
return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"lang":markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang);}
lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0;}}while((elem=elem.parentNode)&&elem.nodeType===1);return false;};}),"target":function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id;},"root":function(elem){return elem===docElem;},"focus":function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},"empty":function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;}}
return true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"header":function(elem){return rheader.test(elem.nodeName);},"input":function(elem){return rinputs.test(elem.nodeName);},"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"text":function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text");},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i);}
return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i);}
return matchIndexes;})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i);}
for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i);}
function setFilters(){}
setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0);}
soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}
groups.push((tokens=[]));}
matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length);}
for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}
if(!matched){break;}}
return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value;}
return selector;}
function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);}}}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if((oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return(newCache[2]=oldCache[2]);}else{uniqueCache[dir]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true;}}}}}};}
function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}
return true;}:matchers[0];}
function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}
return results;}
function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}
return newUnmatched;}
function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}
if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}
return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}
if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}
if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}
postFinder(null,(matcherOut=[]),temp,xml);}
i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}
function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){var ret=(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret;}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}
return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens));}
matchers.push(matcher);}}
return elementMatcher(matchers);}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1),len=elems.length;if(outermost){outermostContext=context===document||context||outermost;}
for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML;}
while((matcher=elementMatchers[j++])){if(matcher(elem,context||document,xml)){results.push(elem);break;}}
if(outermost){dirruns=dirrunsUnique;}}
if(bySet){if((elem=!matcher&&elem)){matchedCount--;}
if(seed){unmatched.push(elem);}}}
matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml);}
if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}
setMatched=condense(setMatched);}
push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}
if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}
return unmatched;};return bySet?markFunction(superMatcher):superMatcher;}
compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector);}
i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}
cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector;}
return cached;};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize((selector=compiled.selector||selector));results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results;}else if(compiled){context=context.parentNode;}
selector=selector.slice(tokens.shift().value.length);}
i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}
if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results;}
break;}}}}
(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results;};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1;});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#";})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2);}});}
if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")==="";})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue;}});}
if(!assert(function(div){return div.getAttribute("disabled")==null;})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null;}});}
return Sizzle;})(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break;}
matched.push(elem);}}
return matched;};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n);}}
return matched;};var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=(/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/);var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not;});}
if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not;});}
if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not);}
qualifier=jQuery.filter(qualifier,elements);}
return jQuery.grep(elements,function(elem){return(jQuery.inArray(elem,qualifier)>-1)!==not;});}
jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")";}
return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1;}));};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true;}}}));}
for(i=0;i<len;i++){jQuery.find(selector,self[i],ret);}
ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret;},filter:function(selector){return this.pushStack(winnow(this,selector||[],false));},not:function(selector){return this.pushStack(winnow(this,selector||[],true));},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length;}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this;}
root=root||rootjQuery;if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match]);}else{this.attr(match,context[match]);}}}
return this;}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||root).find(selector);}else{return this.constructor(context).find(selector);}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}else if(jQuery.isFunction(selector)){return typeof root.ready!=="undefined"?root.ready(selector):selector(jQuery);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true;}}});},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break;}}}
return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});function sibling(cur,dir){do{cur=cur[dir];}while(cur&&cur.nodeType!==1);return cur;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return dir(elem,"nextSibling");},prevAll:function(elem){return dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until);},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem);},children:function(elem){return siblings(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.uniqueSort(ret);}
if(rparentsprev.test(name)){ret=ret.reverse();}}
return this.pushStack(ret);};});var rnotwhite=(/\S+/g);function createOptions(options){var object={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true;});return object;}
jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var
firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false;}}}
if(!options.memory){memory=false;}
firing=false;if(locked){if(memory){list=[];}else{list="";}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory);}
(function add(args){jQuery.each(args,function(_,arg){if(jQuery.isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg);}}else if(arg&&arg.length&&jQuery.type(arg)!=="string"){add(arg);}});})(arguments);if(memory&&!firing){fire();}}
return this;},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--;}}});return this;},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0;},empty:function(){if(list){list=[];}
return this;},disable:function(){locked=queue=[];list=memory="";return this;},disabled:function(){return!list;},lock:function(){locked=true;if(!memory){self.disable();}
return this;},locked:function(){return!!locked;},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire();}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject);}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments);}});});fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);}
deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this;};deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}
return deferred;},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);}else if(!(--remaining)){deferred.resolveWith(contexts,values);}};},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject);}else{--remaining;}}}
if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}
return deferred.promise();}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this;};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready");}}});function detach(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);}else{document.detachEvent("onreadystatechange",completed);window.detachEvent("onload",completed);}}
function completed(){if(document.addEventListener||window.event.type==="load"||document.readyState==="complete"){detach();jQuery.ready();}}
jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"||(document.readyState!=="loading"&&!document.documentElement.doScroll)){window.setTimeout(jQuery.ready);}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed);}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=false;try{top=window.frameElement==null&&document.documentElement;}catch(e){}
if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left");}catch(e){return window.setTimeout(doScrollCheck,50);}
detach();jQuery.ready();}})();}}}
return readyList.promise(obj);};jQuery.ready.promise();var i;for(i in jQuery(support)){break;}
support.ownFirst=i==="0";support.inlineBlockNeedsLayout=false;jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return;}
div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1";support.inlineBlockNeedsLayout=val=div.offsetWidth===3;if(val){body.style.zoom=1;}}
body.removeChild(container);});(function(){var div=document.createElement("div");support.deleteExpando=true;try{delete div.test;}catch(e){support.deleteExpando=false;}
div=null;})();var acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;return nodeType!==1&&nodeType!==9?false:!noData||noData!==true&&elem.getAttribute("classid")===noData;};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
function internalData(elem,name,data,pvt){if(!acceptData(elem)){return;}
var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&data===undefined&&typeof name==="string"){return;}
if(!id){if(isNode){id=elem[internalKey]=deletedIds.pop()||jQuery.guid++;}else{id=internalKey;}}
if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop};}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(typeof name==="string"){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;}
function internalRemoveData(elem,name,pvt){if(!acceptData(elem)){return;}
var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase));}
i=name.length;while(i--){delete thisCache[name[i]];}
if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(isNode){jQuery.cleanData([elem],true);}else if(support.deleteExpando||cache!=cache.window){delete cache[id];}else{cache[id]=undefined;}}
jQuery.extend({cache:{},noData:{"applet ":true,"embed ":true,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data){return internalData(elem,name,data);},removeData:function(elem,name){return internalRemoveData(elem,name);},_data:function(elem,name,data){return internalData(elem,name,data,true);},_removeData:function(elem,name){return internalRemoveData(elem,name,true);}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name]);}}}
jQuery._data(elem,"parsedAttrs",true);}}
return data;}
if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
return arguments.length>1?this.each(function(){jQuery.data(this,key,value);}):elem?dataAttr(elem,key,jQuery.data(elem,key)):undefined;},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}
return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
delete hooks.stop;fn.call(elem,next,hooks);}
if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");jQuery._removeData(elem,key);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}
if(arguments.length<setter){return jQuery.queue(this[0],type);}
return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}
type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}
resolve();return defer.promise(obj);}});(function(){var shrinkWrapBlocksVal;support.shrinkWrapBlocks=function(){if(shrinkWrapBlocksVal!=null){return shrinkWrapBlocksVal;}
shrinkWrapBlocksVal=false;var div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return;}
div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;"+"padding:1px;width:1px;zoom:1";div.appendChild(document.createElement("div")).style.width="5px";shrinkWrapBlocksVal=div.offsetWidth!==3;}
body.removeChild(container);return shrinkWrapBlocksVal;};})();var pnum=(/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur();}:function(){return jQuery.css(elem,prop,"");},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3];valueParts=valueParts||[];initialInUnit=+initial||1;do{scale=scale||".5";initialInUnit=initialInUnit/scale;jQuery.style(elem,prop,initialInUnit+unit);}while(scale!==(scale=currentValue()/initial)&&scale!==1&&--maxIterations);}
if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted;}}
return adjusted;}
var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw);}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true;}
if(bulk){if(raw){fn.call(elems,value);fn=null;}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value);};}}
if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));}}}
return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet;};var rcheckableType=(/^(?:checkbox|radio)$/i);var rtagName=(/<([\w:-]+)/);var rscriptType=(/^$|\/(?:java|ecma)script/i);var rleadingWhitespace=(/^\s+/);var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|"+"details|dialog|figcaption|figure|footer|header|hgroup|main|"+"mark|meter|nav|output|picture|progress|section|summary|template|time|video";function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
(function(){var div=document.createElement("div"),fragment=document.createDocumentFragment(),input=document.createElement("input");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";support.leadingWhitespace=div.firstChild.nodeType===3;support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;support.html5Clone=document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>";input.type="checkbox";input.checked=true;fragment.appendChild(input);support.appendChecked=input.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;fragment.appendChild(div);input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;support.noCloneEvent=!!div.addEventListener;div[jQuery.expando]=1;support.attributes=!div.getAttribute(jQuery.expando);})();var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!=="undefined"?context.querySelectorAll(tag||"*"):undefined;if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem);}else{jQuery.merge(found,getAll(elem,tag));}}}
return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found;}
function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"));}}
var rhtml=/<|&#?\w+;/,rtbody=/<tbody/i;function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked;}}
function buildFragment(elems,context,scripts,selection,ignored){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem);}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem));}else{tmp=tmp||safe.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild;}
if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]));}
if(!support.tbody){elem=tag==="table"&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==="<table>"&&!rtbody.test(elem)?tmp:0;j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName((tbody=elem.childNodes[j]),"tbody")&&!tbody.childNodes.length){elem.removeChild(tbody);}}}
jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";while(tmp.firstChild){tmp.removeChild(tmp.firstChild);}
tmp=safe.lastChild;}}}
if(tmp){safe.removeChild(tmp);}
if(!support.appendChecked){jQuery.grep(getAll(nodes,"input"),fixDefaultChecked);}
i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem);}
continue;}
contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");if(contains){setGlobalEval(tmp);}
if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem);}}}}
tmp=null;return safe;}
(function(){var i,eventName,div=document.createElement("div");for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;if(!(support[i]=eventName in window)){div.setAttribute(eventName,"t");support[i]=div.attributes[eventName].expando===false;}}
div=null;})();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true;}
function returnFalse(){return false;}
function safeActiveElement(){try{return document.activeElement;}catch(err){}}
function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}
for(type in types){on(elem,type,selector,data,types[type],one);}
return elem;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return elem;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return elem.each(function(){jQuery.event.add(this,types,fn,data,selector);});}
jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(!elemData){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}
if(!handler.guid){handler.guid=jQuery.guid++;}
if(!(events=elemData.events)){events=elemData.events={};}
if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return;}
types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events");}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return;}
if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem;}
data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return;}
if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode;}
for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur;}
if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window);}}
i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault();}}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null;}
jQuery.event.triggered=type;try{elem[type]();}catch(e){}
jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}
handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation();}}}}}
if(special.postDispatch){special.postDispatch.call(this,event);}
return event.result;},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(event.type!=="click"||isNaN(event.button)||event.button<1)){for(;cur!=this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length;}
if(matches[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,handlers:matches});}}}}
if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)});}
return handlerQueue;},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{};}
copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event;},props:("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase "+"metaKey relatedTarget shiftKey target timeStamp view which").split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:("button buttons clientX clientY fromElement offsetX offsetY "+"pageX pageY screenX screenY toElement").split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+
(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-
(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+
(doc&&doc.scrollTop||body&&body.scrollTop||0)-
(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();return false;}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false;}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();return false;}},_default:function(event){return jQuery.nodeName(event.target,"a");}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result;}}}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem);if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle);}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null;}
elem.detachEvent(name,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e||this.isSimulated){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation();}
this.stopPropagation();}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!support.submit){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?jQuery.prop(elem,"form"):undefined;if(form&&!jQuery._data(form,"submit")){jQuery.event.add(form,"submit._submit",function(event){event._submitBubble=true;});jQuery._data(form,"submit",true);}});},postDispatch:function(event){if(event._submitBubble){delete event._submitBubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event);}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!support.change){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._justChanged=true;}});jQuery.event.add(this,"click._change",function(event){if(this._justChanged&&!event.isTrigger){this._justChanged=false;}
jQuery.event.simulate("change",this,event);});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"change")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event);}});jQuery._data(elem,"change",true);}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName);}};}
if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event));};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true);}
jQuery._data(doc,fix,(attaches||0)+1);},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);jQuery._removeData(doc,fix);}else{jQuery._data(doc,fix,attaches);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn);},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true);}}});var rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem;}
function disableScript(elem){elem.type=(jQuery.find.attr(elem,"type")!==null)+"/"+elem.type;return elem;}
function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1];}else{elem.removeAttribute("type");}
return elem;}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(dest.nodeType!==1){return;}
nodeName=dest.nodeName.toLowerCase();if(!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events){jQuery.removeEvent(dest,e,data.handle);}
dest.removeAttribute(jQuery.expando);}
if(nodeName==="script"&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest);}else if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML;}
if(support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML;}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.defaultSelected=dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}}
function domManip(collection,args,callback,ignored){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||(l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value))){return collection.each(function(index){var self=collection.eq(index);if(isFunction){args[0]=value.call(this,index,self.html());}
domManip(self,args,callback,ignored);});}
if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}
if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"));}}
callback.call(collection[i],node,i);}
if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src);}}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,""));}}}}
fragment=first=null;}}
return collection;}
function remove(elem,selector,keepData){var node,elems=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=elems[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node));}
if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"));}
node.parentNode.removeChild(node);}}
return elem;}
jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>");},clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true);}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild);}
if((!support.noCloneEvent||!support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i]);}}}
if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i]);}}else{cloneCopyEvent(elem,clone);}}
destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"));}
destElements=srcElements=node=null;return clone;},cleanData:function(elems,forceAcceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,attributes=support.attributes,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(forceAcceptData||acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}
if(cache[id]){delete cache[id];if(!attributes&&typeof elem.removeAttribute!=="undefined"){elem.removeAttribute(internalKey);}else{elem[internalKey]=undefined;}
deletedIds.push(id);}}}}}});jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,true);},remove:function(selector){return remove(this,selector);},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value));},null,value,arguments.length);},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem);}});},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild);}});},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this);}});},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling);}});},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}
if(elem.options&&jQuery.nodeName(elem,"select")){elem.options.length=0;}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;}
if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value;}}
elem=0;}catch(e){}}
if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this);}}},ignored);}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get());}
return this.pushStack(ret);};});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.detach();return display;}
function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach();}
elemdisplay[nodeName]=display;}
return display;}
var rmargin=(/^margin/);var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name];}
return ret;};var documentElement=document.documentElement;(function(){var pixelPositionVal,pixelMarginRightVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return;}
div.style.cssText="float:left;opacity:.5";support.opacity=div.style.opacity==="0.5";support.cssFloat=!!div.style.cssFloat;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container=document.createElement("div");container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;"+"padding:0;margin-top:1px;position:absolute";div.innerHTML="";container.appendChild(div);support.boxSizing=div.style.boxSizing===""||div.style.MozBoxSizing===""||div.style.WebkitBoxSizing==="";jQuery.extend(support,{reliableHiddenOffsets:function(){if(pixelPositionVal==null){computeStyleTests();}
return reliableHiddenOffsetsVal;},boxSizingReliable:function(){if(pixelPositionVal==null){computeStyleTests();}
return boxSizingReliableVal;},pixelMarginRight:function(){if(pixelPositionVal==null){computeStyleTests();}
return pixelMarginRightVal;},pixelPosition:function(){if(pixelPositionVal==null){computeStyleTests();}
return pixelPositionVal;},reliableMarginRight:function(){if(pixelPositionVal==null){computeStyleTests();}
return reliableMarginRightVal;},reliableMarginLeft:function(){if(pixelPositionVal==null){computeStyleTests();}
return reliableMarginLeftVal;}});function computeStyleTests(){var contents,divStyle,documentElement=document.documentElement;documentElement.appendChild(container);div.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;"+"position:relative;display:block;"+"margin:auto;border:1px;padding:1px;"+"top:1%;width:50%";pixelPositionVal=boxSizingReliableVal=reliableMarginLeftVal=false;pixelMarginRightVal=reliableMarginRightVal=true;if(window.getComputedStyle){divStyle=window.getComputedStyle(div);pixelPositionVal=(divStyle||{}).top!=="1%";reliableMarginLeftVal=(divStyle||{}).marginLeft==="2px";boxSizingReliableVal=(divStyle||{width:"4px"}).width==="4px";div.style.marginRight="50%";pixelMarginRightVal=(divStyle||{marginRight:"4px"}).marginRight==="4px";contents=div.appendChild(document.createElement("div"));contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";contents.style.marginRight=contents.style.width="0";div.style.width="1px";reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents)||{}).marginRight);div.removeChild(contents);}
div.style.display="none";reliableHiddenOffsetsVal=div.getClientRects().length===0;if(reliableHiddenOffsetsVal){div.style.display="";div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";div.childNodes[0].style.borderCollapse="separate";contents=div.getElementsByTagName("td");contents[0].style.cssText="margin:0;border:0;padding:0;display:none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0;if(reliableHiddenOffsetsVal){contents[0].style.display="";contents[1].style.display="none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0;}}
documentElement.removeChild(container);}})();var getStyles,curCSS,rposition=/^(top|right|bottom|left)$/;if(window.getComputedStyle){getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window;}
return view.getComputedStyle(elem);};curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if((ret===""||ret===undefined)&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);}
if(computed){if(!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}
return ret===undefined?ret:ret+"";};}else if(documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle;};curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed[name]:undefined;if(ret==null&&style&&style[name]){ret=style[name];}
if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){rs.left=rsLeft;}}
return ret===undefined?ret:ret+""||"auto";};}
function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return;}
return(this.get=hookFn).apply(this,arguments);}};}
var
ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/i,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle){return name;}
var capName=name.charAt(0).toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name;}}}
function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}
values[index]=jQuery._data(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display="";}
if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName));}}else{hidden=isHidden(elem);if(display&&display!=="none"||!hidden){jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"));}}}
for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}
if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";}}
return elements;}
function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value;}
function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles);}
if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles);}
if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}}
return val;}
function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name];}
if(rnumnonpx.test(val)){return val;}
valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0;}
return(val+
augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px";}
jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"animationIterationCount":true,"columnCount":true,"fillOpacity":true,"flexGrow":true,"flexShrink":true,"fontWeight":true,"lineHeight":true,"opacity":true,"order":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number";}
if(value==null||value!==value){return;}
if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px");}
if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}
if(val===undefined){val=curCSS(elem,name,styles);}
if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}
if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val;}
return val;}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);}):getWidthOrHeight(elem,name,extra);}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0);}};});if(!support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if((value>=1||value==="")&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(value===""||currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return swap(elem,{"display":"inline-block"},curCSS,[elem,"marginRight"]);}});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||(jQuery.contains(elem.ownerDocument,elem)?elem.getBoundingClientRect().left-
swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left;}):0))+"px";}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}
return expanded;}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles);}
return map;}
return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide();}
return this.each(function(){if(isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}
jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}
this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}
if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}
return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop];}
result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var
fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function createFxNow(){window.setTimeout(function(){fxNow=undefined;});return(fxNow=jQuery.now());}
function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}
if(includeWidth){attrs.opacity=attrs.width=type;}
return attrs;}
function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween;}}}
function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}
hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}
if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){if(!support.inlineBlockNeedsLayout||defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block";}else{style.zoom=1;}}}
if(opts.overflow){style.overflow="hidden";if(!support.shrinkWrapBlocks()){anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}}
for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true;}else{continue;}}
orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop);}else{display=undefined;}}
if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden;}}else{dataShow=jQuery._data(elem,"fxshow",{});}
if(toggle){dataShow.hidden=!hidden;}
if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();});}
anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display;}}
function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];}
if(index!==name){props[name]=value;delete props[index];}
hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}
function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){if(stopped){return false;}
var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}
deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this;}
stopped=true;for(;index<length;index++){animation.tweens[index].run(1);}
if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}
return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(jQuery.isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result);}
return result;}}
jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}
jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);}
jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween;}]},tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"];}else{props=props.match(rnotwhite);}
var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback);}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback);}else{Animation.prefilters.push(callback);}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||jQuery._data(this,"finish")){anim.stop(true);}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}
if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});},finish:function(type){if(type!==false){type=type||"fx";}
return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true);}
for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1);}}
for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this);}}
delete data.finish;});}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.timers=[];jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}
fxNow=undefined;};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start();}else{jQuery.timers.pop();}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval);}};jQuery.fx.stop=function(){window.clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout);};});};(function(){var a,input=document.createElement("input"),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";a=div.getElementsByTagName("a")[0];input.setAttribute("type","checkbox");div.appendChild(input);a=div.getElementsByTagName("a")[0];a.style.cssText="top:1px";support.getSetAttribute=div.className!=="t";support.style=/top/.test(a.getAttribute("style"));support.hrefNormalized=a.getAttribute("href")==="/a";support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement("form").enctype;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.setAttribute("value","");support.input=input.getAttribute("value")==="";input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";})();var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,jQuery(this).val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ");}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
return values;},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){try{option.selected=optionSet=true;}catch(_){option.scrollHeight;}}else{option.selected=false;}}
if(!optionSet){elem.selectedIndex=-1;}
return options;}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1);}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value;};}});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}
if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}
elem.setAttribute(name,value+"");return value;}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}
ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret;},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false;}else{elem[jQuery.camelCase("default-"+name)]=elem[propName]=false;}}else{jQuery.attr(elem,name,"");}
elem.removeAttribute(getSetAttribute?name:propName);}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name);}else if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name);}else{elem[jQuery.camelCase("default-"+name)]=elem[name]=true;}
return name;}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle;}
return ret;};}else{attrHandle[name]=function(elem,name,isXML){if(!isXML){return elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null;}};}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,"input")){elem.defaultValue=value;}else{return nodeHook&&nodeHook.set(elem,value,name);}}};}
if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){elem.setAttributeNode((ret=elem.ownerDocument.createAttribute(name)));}
ret.value=value+="";if(name==="value"||value===elem.getAttribute(name)){return value;}}};attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML){return(ret=elem.getAttributeNode(name))&&ret.value!==""?ret.value:null;}};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified){return ret.value;}},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===""?false:value,name);}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}};});}
if(!support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined;},set:function(elem,value){return(elem.style.cssText=value+"");}};}
var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}
if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}
return(elem[name]=value);}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}
return elem[name];},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1;}}},propFix:{"for":"htmlFor","class":"className"}});if(!support.hrefNormalized){jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4);}};});}
if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}}};}
jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this;});if(!support.enctype){jQuery.propFix.enctype="encoding";}
var rclass=/[\t\r\n\f]/g;function getClass(elem){return jQuery.attr(elem,"class")||"";}
jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)));});}
if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" ";}}
finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue);}}}}
return this;},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)));});}
if(!arguments.length){return this.attr("class","");}
if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ");}}
finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue);}}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value);}
if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal);});}
return this.each(function(){var className,i,self,classNames;if(type==="string"){i=0;self=jQuery(this);classNames=value.match(rnotwhite)||[];while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className);}else{self.addClass(className);}}}else if(value===undefined||type==="boolean"){className=getClass(this);if(className){jQuery._data(this,"__className__",className);}
jQuery.attr(this,"class",className||value===false?"":jQuery._data(this,"__className__")||"");}});},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while((elem=this[i++])){if(elem.nodeType===1&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1){return true;}}
return false;}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});var location=window.location;var nonce=jQuery.now();var rquery=(/\?/);var rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data+"");}
var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){if(requireNonComma&&comma){depth=0;}
if(depth===0){return token;}
requireNonComma=open||comma;depth+=!close-!open;return"";}))?(Function("return "+str))():jQuery.error("Invalid JSON: "+data);};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null;}
try{if(window.DOMParser){tmp=new window.DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new window.ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;};var
rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType.charAt(0)==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func);}else{(structure[dataType]=structure[dataType]||[]).push(func);}}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false;}else if(seekingTransport){return!(selected=dataTypeOrTransport);}});return selected;}
return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*");}
function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}
return target;}
function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response;}
if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType);}
prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1]);}
break;}}}}
if(conv!==true){if(conv&&s["throws"]){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}}}
return{state:"success",data:response};}
jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target);},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match==null?null:match;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]];}}else{jqXHR.always(map[jqXHR.status]);}}
return this;},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText);}
done(0,finalText);return this;}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR;}
fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(rquery.test(cacheURL)?"&":"?")+s.data);delete s.data;}
if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++;}}
if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]);}
if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL]);}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+
(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();}
strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(state===2){return jqXHR;}
if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return;}
state=2;if(timeoutTimer){window.clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}
response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified;}
modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified;}}
if(status===204||s.type==="HEAD"){statusText="nocontent";}else if(status===304){statusText="notmodified";}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error;}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
return jqXHR;},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url));};});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:true,async:false,global:false,"throws":true});};jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();}});function getDisplay(elem){return elem.style&&elem.style.display||jQuery.css(elem,"display");}
function filterHidden(elem){if(!jQuery.contains(elem.ownerDocument||document,elem)){return true;}
while(elem&&elem.nodeType===1){if(getDisplay(elem)==="none"||elem.type==="hidden"){return true;}
elem=elem.parentNode;}
return false;}
jQuery.expr.filters.hidden=function(elem){return support.reliableHiddenOffsets()?(elem.offsetWidth<=0&&elem.offsetHeight<=0&&!elem.getClientRects().length):filterHidden(elem);};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add);}});}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this;}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){if(this.isLocal){return createActiveXHR();}
if(document.documentMode>8){return createStandardXHR();}
return /^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR();}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key](undefined,true);}});}
support.cors=!!xhrSupported&&("withCredentials"in xhrSupported);xhrSupported=support.ajax=!!xhrSupported;if(xhrSupported){jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i];}}
if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType);}
if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
for(i in headers){if(headers[i]!==undefined){xhr.setRequestHeader(i,headers[i]+"");}}
xhr.send((options.hasContent&&options.data)||null);callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||xhr.readyState===4)){delete xhrCallbacks[id];callback=undefined;xhr.onreadystatechange=jQuery.noop;if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{responses={};status=xhr.status;if(typeof xhr.responseText==="string"){responses.text=xhr.responseText;}
try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&options.isLocal&&!options.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}
if(responses){complete(status,statusText,responses,xhr.getAllResponseHeaders());}};if(!options.async){callback();}else if(xhr.readyState===4){window.setTimeout(callback);}else{xhr.onreadystatechange=xhrCallbacks[id]=callback;}},abort:function(){if(callback){callback(undefined,true);}}};}});}
function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script);}
script=null;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(undefined,true);}}};}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName);}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName;}
s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName);}else{window[callbackName]=overwritten;}
if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}
if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);}
responseContainer=overwritten=undefined;});return"script";}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null;}
if(typeof context==="boolean"){keepScripts=context;context=false;}
context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])];}
parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove();}
return jQuery.merge([],parsed.childNodes);};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}
var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=jQuery.trim(url.slice(off,url.length));url=url.slice(0,off);}
if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}
if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText);}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR]);});});}
return this;};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn);};});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative";}
curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset));}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return;}
docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box;}
if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();}
win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)};},position:function(){if(!this[0]){return;}
var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect();}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset();}
parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true);}
return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent||documentElement;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method];}
if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop());}else{elem[method]=val;}},method,val,arguments.length,null);};});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed;}});});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];}
if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}
return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);};});});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);}});jQuery.fn.size=function(){return this.length;};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery;});}
var
_jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;};if(!noGlobal){window.webimJQuery=window.jQuery=window.$=jQuery;}
return jQuery;}));
/*! jQuery UI - v1.12.1 - 2018-02-19
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, scroll-parent.js, widgets/draggable.js, widgets/resizable.js, widgets/mouse.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){$.ui=$.ui||{};var version=$.ui.version="1.12.1";
/*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetUuid=0;var widgetSlice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove");}}catch(e){}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype;var proxiedPrototype={};var namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
if($.isArray(prototype)){prototype=$.extend.apply(null,[{}].concat(prototype));}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){function _super(){return base.prototype[prop].apply(this,arguments);}
function _superApply(args){return base.prototype[prop].apply(this,args);}
return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string";var args=widgetSlice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==="instance"){returnValue=undefined;}else{this.each(function(){var methodValue;var instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;}
if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled);}
this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:function(){return{};},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key);});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace);},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key;var parts;var curOption;var i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){if(key==="classes"){this._setOptionClasses(value);}
this.options[key]=value;if(key==="disabled"){this._setOptionDisabled(value);}
return this;},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue;}
elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}));}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus");}},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_classes:function(options){var full=[];var that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add){current=$($.unique(current.get().concat(options.element.get())));}else{current=$(current.not(options.element).get());}
that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]]);}}}
this._on(options.element,{"remove":"_untrackClassesElement"});if(options.keys){processClassString(options.keys.match(/\S+/g)||[],true);}
if(options.extra){processClassString(options.extra.match(/\S+/g)||[]);}
return full.join(" ");},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1){that.classesElementLookup[key]=$(value.not(event.target).get());}});},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false);},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true);},_toggleClass:function(element,keys,extra,add){add=(typeof add==="boolean")?add:extra;var shift=(typeof element==="string"||element===null),options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.toggleClass(this._classes(options),add);return this;},_on:function(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy);}else{element.on(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+
this.eventNamespace;element.off(eventName).off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover");},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus");},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig;var callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions;var effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;
/*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(){var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div "+"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>"+"<div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9,hasOffset=!isWindow&&!isDocument;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+
scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+
scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-
withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-
withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-
outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+
atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-
outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+
offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};})();var position=$.ui.position;
/*!
 * jQuery UI :data 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var data=$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);}});
/*!
 * jQuery UI Disable Selection 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var disableSelection=$.fn.extend({disableSelection:(function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(eventType+".ui-disableSelection",function(event){event.preventDefault();});};})(),enableSelection:function(){return this.off(".ui-disableSelection");}});
/*!
 * jQuery UI Scroll Parent 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var scrollParent=$.fn.scrollParent=function(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false;}
return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+
parent.css("overflow-x"));}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent;};var ie=$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
/*!
 * jQuery UI Mouse 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var mouseHandled=false;$(document).on("mouseup",function(){mouseHandled=false;});var widgetsMouse=$.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.on("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).on("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.off("."+this.widgetName);if(this._mouseMoveDelegate){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
this._mouseMoved=false;(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}else if(!event.which){if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey){this.ignoreMissingWhich=true;}else if(!this.ignoreMissingWhich){return this._mouseUp(event);}}}
if(event.which||event.button){this._mouseMoved=true;}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}
this._mouseStop(event);}
if(this._mouseDelayTimer){clearTimeout(this._mouseDelayTimer);delete this._mouseDelayTimer;}
this.ignoreMissingWhich=false;mouseHandled=false;event.preventDefault();},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});var plugin=$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return;}
if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}};var safeActiveElement=$.ui.safeActiveElement=function(document){var activeElement;try{activeElement=document.activeElement;}catch(error){activeElement=document.body;}
if(!activeElement){activeElement=document.body;}
if(!activeElement.nodeName){activeElement=document.body;}
return activeElement;};var safeBlur=$.ui.safeBlur=function(element){if(element&&element.nodeName.toLowerCase()!=="body"){$(element).trigger("blur");}};
/*!
 * jQuery UI Draggable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget("ui.draggable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"){this._setPositionRelative();}
if(this.options.addClasses){this._addClass("ui-draggable");}
this._setHandleClassName();this._mouseInit();},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._removeHandleClassName();this._setHandleClassName();}},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return;}
this._removeHandleClassName();this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false;}
this.handle=this._getHandle(event);if(!this.handle){return false;}
this._blurActiveElement(event);this._blockFrames(o.iframeFix===true?"iframe":o.iframeFix);return true;},_blockFrames:function(selector){this.iframeBlocks=this.document.find(selector).map(function(){var iframe=$(this);return $("<div>").css("position","absolute").appendTo(iframe.parent()).outerWidth(iframe.outerWidth()).outerHeight(iframe.outerHeight()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_blurActiveElement:function(event){var activeElement=$.ui.safeActiveElement(this.document[0]),target=$(event.target);if(target.closest(activeElement).length){return;}
$.ui.safeBlur(activeElement);},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._addClass(this.helper,"ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this;}
this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.hasFixedAncestor=this.helper.parents().filter(function(){return $(this).css("position")==="fixed";}).length>0;this.positionAbs=this.element.offset();this._refreshOffsets(event);this.originalPosition=this.position=this._generatePosition(event,false);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event);}
return true;},_refreshOffsets:function(event){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:false,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:event.pageX-this.offset.left,top:event.pageY-this.offset.top};},_mouseDrag:function(event,noPropagation){if(this.hasFixedAncestor){this.offset.parent=this._getParentOffset();}
this.position=this._generatePosition(event,true);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp(new $.Event("mouseup",event));return false;}
this.position=ui.position;}
this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
return false;},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event);}
if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((this.options.revert==="invalid"&&!dropped)||(this.options.revert==="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){this._unblockFrames();if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event);}
if(this.handleElement.is(event.target)){this.element.trigger("focus");}
return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp(new $.Event("mouseup",{target:this.element[0]}));}else{this._clear();}
return this;},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true;},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this._addClass(this.handleElement,"ui-draggable-handle");},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle");},_createHelper:function(event){var o=this.options,helperIsFunction=$.isFunction(o.helper),helper=helperIsFunction?$(o.helper.apply(this.element[0],[event])):(o.helper==="clone"?this.element.clone().removeAttr("id"):this.element);if(!helper.parents("body").length){helper.appendTo((o.appendTo==="parent"?this.element[0].parentNode:o.appendTo));}
if(helperIsFunction&&helper[0]===this.element[0]){this._setPositionRelative();}
if(helper[0]!==this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position"))){helper.css("position","absolute");}
return helper;},_setPositionRelative:function(){if(!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative";}},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_isRootNode:function(element){return(/(html|body)/i).test(element.tagName)||element===this.document[0];},_getParentOffset:function(){var po=this.offsetParent.offset(),document=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this._isRootNode(this.offsetParent[0])){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition!=="relative"){return{top:0,left:0};}
var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollTop():0),left:p.left-(parseInt(this.helper.css("left"),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollLeft():0)};},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var isUserScrollable,c,ce,o=this.options,document=this.document[0];this.relativeContainer=null;if(!o.containment){this.containment=null;return;}
if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-
this.helperProportions.width-this.margins.left,$(window).scrollTop()+
($(window).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment.constructor===Array){this.containment=o.containment;return;}
if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
c=$(o.containment);ce=c[0];if(!ce){return;}
isUserScrollable=/(scroll|auto)/.test(c.css("overflow"));this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+
(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+
(parseInt(c.css("paddingTop"),10)||0),(isUserScrollable?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt(c.css("borderRightWidth"),10)||0)-
(parseInt(c.css("paddingRight"),10)||0)-
this.helperProportions.width-
this.margins.left-
this.margins.right,(isUserScrollable?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt(c.css("borderBottomWidth"),10)||0)-
(parseInt(c.css("paddingBottom"),10)||0)-
this.helperProportions.height-
this.margins.top-
this.margins.bottom];this.relativeContainer=c;},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left))*mod))};},_generatePosition:function(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;if(!scrollIsRootNode||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()};}
if(constrainPosition){if(this.containment){if(this.relativeContainer){co=this.relativeContainer.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top;}}
if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-
this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?((top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3])?top:((top-this.offset.click.top>=containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=o.grid[0]?this.originalPageX+
Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?((left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2])?left:((left-this.offset.click.left>=containment[0])?left-o.grid[0]:left+o.grid[0])):left;}
if(o.axis==="y"){pageX=this.originalPageX;}
if(o.axis==="x"){pageY=this.originalPageY;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
(this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
(this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left)))};},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove();}
this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy();}},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui,this],true);if(/^(drag|start|stop)/.test(type)){this.positionAbs=this._convertPositionTo("absolute");ui.offset=this.positionAbs;}
return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.sortables=[];$(draggable.options.connectToSortable).each(function(){var sortable=$(this).sortable("instance");if(sortable&&!sortable.options.disabled){draggable.sortables.push(sortable);sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.cancelHelperRemoval=false;$.each(draggable.sortables,function(){var sortable=this;if(sortable.isOver){sortable.isOver=0;draggable.cancelHelperRemoval=true;sortable.cancelHelperRemoval=false;sortable._storedCSS={position:sortable.placeholder.css("position"),top:sortable.placeholder.css("top"),left:sortable.placeholder.css("left")};sortable._mouseStop(event);sortable.options.helper=sortable.options._helper;}else{sortable.cancelHelperRemoval=true;sortable._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui,draggable){$.each(draggable.sortables,function(){var innermostIntersecting=false,sortable=this;sortable.positionAbs=draggable.positionAbs;sortable.helperProportions=draggable.helperProportions;sortable.offset.click=draggable.offset.click;if(sortable._intersectsWith(sortable.containerCache)){innermostIntersecting=true;$.each(draggable.sortables,function(){this.positionAbs=draggable.positionAbs;this.helperProportions=draggable.helperProportions;this.offset.click=draggable.offset.click;if(this!==sortable&&this._intersectsWith(this.containerCache)&&$.contains(sortable.element[0],this.element[0])){innermostIntersecting=false;}
return innermostIntersecting;});}
if(innermostIntersecting){if(!sortable.isOver){sortable.isOver=1;draggable._parent=ui.helper.parent();sortable.currentItem=ui.helper.appendTo(sortable.element).data("ui-sortable-item",true);sortable.options._helper=sortable.options.helper;sortable.options.helper=function(){return ui.helper[0];};event.target=sortable.currentItem[0];sortable._mouseCapture(event,true);sortable._mouseStart(event,true,true);sortable.offset.click.top=draggable.offset.click.top;sortable.offset.click.left=draggable.offset.click.left;sortable.offset.parent.left-=draggable.offset.parent.left-
sortable.offset.parent.left;sortable.offset.parent.top-=draggable.offset.parent.top-
sortable.offset.parent.top;draggable._trigger("toSortable",event);draggable.dropped=sortable.element;$.each(draggable.sortables,function(){this.refreshPositions();});draggable.currentItem=draggable.element;sortable.fromOutside=draggable;}
if(sortable.currentItem){sortable._mouseDrag(event);ui.position=sortable.position;}}else{if(sortable.isOver){sortable.isOver=0;sortable.cancelHelperRemoval=true;sortable.options._revert=sortable.options.revert;sortable.options.revert=false;sortable._trigger("out",event,sortable._uiHash(sortable));sortable._mouseStop(event,true);sortable.options.revert=sortable.options._revert;sortable.options.helper=sortable.options._helper;if(sortable.placeholder){sortable.placeholder.remove();}
ui.helper.appendTo(draggable._parent);draggable._refreshOffsets(event);ui.position=draggable._generatePosition(event,true);draggable._trigger("fromSortable",event);draggable.dropped=false;$.each(draggable.sortables,function(){this.refreshPositions();});}}});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui,instance){var t=$("body"),o=instance.options;if(t.css("cursor")){o._cursor=t.css("cursor");}
t.css("cursor",o.cursor);},stop:function(event,ui,instance){var o=instance.options;if(o._cursor){$("body").css("cursor",o._cursor);}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("opacity")){o._opacity=t.css("opacity");}
t.css("opacity",o.opacity);},stop:function(event,ui,instance){var o=instance.options;if(o._opacity){$(ui.helper).css("opacity",o._opacity);}}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui,i){if(!i.scrollParentNotHidden){i.scrollParentNotHidden=i.helper.scrollParent(false);}
if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML"){i.overflowOffset=i.scrollParentNotHidden.offset();}},drag:function(event,ui,i){var o=i.options,scrolled=false,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];if(scrollParent!==document&&scrollParent.tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if((i.overflowOffset.top+scrollParent.offsetHeight)-event.pageY<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed;}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed;}}
if(!o.axis||o.axis!=="y"){if((i.overflowOffset.left+scrollParent.offsetWidth)-event.pageX<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed;}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed;}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}}
if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event);}}});$.ui.plugin.add("draggable","snap",{start:function(event,ui,i){var o=i.options;i.snapElements=[];$(o.snap.constructor!==String?(o.snap.items||":data(ui-draggable)"):o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});}});},drag:function(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left-inst.margins.left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top-inst.margins.top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left;}}
first=(ts||bs||ls||rs);if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left;}}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=(ts||bs||ls||rs||first);}}});$.ui.plugin.add("draggable","stack",{start:function(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-
(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i);});this.css("zIndex",(min+group.length));}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("zIndex")){o._zIndex=t.css("zIndex");}
t.css("zIndex",o.zIndex);},stop:function(event,ui,instance){var o=instance.options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex);}}});var widgetsDraggable=$.ui.draggable;
/*!
 * jQuery UI Resizable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget("ui.resizable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(value){return parseFloat(value)||0;},_isNumber:function(value){return!isNaN(parseFloat(value));},_hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},_create:function(){var margins,o=this.options,that=this;this._addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap($("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance"));this.elementIsWrapper=true;margins={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")};this.element.css(margins);this.originalElement.css("margin",0);this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css(margins);this._proportionallyResize();}
this._setupHandles();if(o.autoHide){$(this.element).on("mouseenter",function(){if(o.disabled){return;}
that._removeClass("ui-resizable-autohide");that._handles.show();}).on("mouseleave",function(){if(o.disabled){return;}
if(!that.resizing){that._addClass("ui-resizable-autohide");that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();var wrapper,_destroy=function(exp){$(exp).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove();};if(this.elementIsWrapper){_destroy(this.element);wrapper=this.element;this.originalElement.css({position:wrapper.css("position"),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css("top"),left:wrapper.css("left")}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css("resize",this.originalResizeStyle);_destroy(this.originalElement);return this;},_setOption:function(key,value){this._super(key,value);switch(key){case"handles":this._removeHandles();this._setupHandles();break;default:break;}},_setupHandles:function(){var o=this.options,handle,i,n,hname,axis,that=this;this.handles=o.handles||(!$(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});this._handles=$();if(this.handles.constructor===String){if(this.handles==="all"){this.handles="n,e,s,w,se,sw,ne,nw";}
n=this.handles.split(",");this.handles={};for(i=0;i<n.length;i++){handle=$.trim(n[i]);hname="ui-resizable-"+handle;axis=$("<div>");this._addClass(axis,"ui-resizable-handle "+hname);axis.css({zIndex:o.zIndex});this.handles[handle]=".ui-resizable-"+handle;this.element.append(axis);}}
this._renderAxis=function(target){var i,axis,padPos,padWrapper;target=target||this.element;for(i in this.handles){if(this.handles[i].constructor===String){this.handles[i]=this.element.children(this.handles[i]).first().show();}else if(this.handles[i].jquery||this.handles[i].nodeType){this.handles[i]=$(this.handles[i]);this._on(this.handles[i],{"mousedown":that._mouseDown});}
if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){axis=$(this.handles[i],this.element);padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();padPos=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
this._handles=this._handles.add(this.handles[i]);}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.on("mouseover",function(){if(!that.resizing){if(this.className){axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);}
that.axis=axis&&axis[1]?axis[1]:"se";}});if(o.autoHide){this._handles.hide();this._addClass("ui-resizable-autohide");}},_removeHandles:function(){this._handles.remove();},_mouseCapture:function(event){var i,handle,capture=false;for(i in this.handles){handle=$(this.handles[i])[0];if(handle===event.target||$.contains(handle,event.target)){capture=true;}}
return!this.options.disabled&&capture;},_mouseStart:function(event){var curleft,curtop,cursor,o=this.options,el=this.element;this.resizing=true;this._renderProxy();curleft=this._num(this.helper.css("left"));curtop=this._num(this.helper.css("top"));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalPosition={left:curleft,top:curtop};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio==="number")?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);cursor=$(".ui-resizable-"+this.axis).css("cursor");$("body").css("cursor",cursor==="auto"?this.axis+"-resize":cursor);this._addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var data,props,smp=this.originalMousePosition,a=this.axis,dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0,trigger=this._change[a];this._updatePrevProperties();if(!trigger){return false;}
data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey){data=this._updateRatio(data,event);}
data=this._respectSize(data,event);this._updateCache(data);this._propagate("resize",event);props=this._applyChanges();if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize();}
if(!$.isEmptyObject(props)){this._updatePrevProperties();this._trigger("resize",event,this.ui());this._applyChanges();}
return false;},_mouseStop:function(event){this.resizing=false;var pr,ista,soffseth,soffsetw,s,left,top,o=this.options,that=this;if(this._helper){pr=this._proportionallyResizeElements;ista=pr.length&&(/textarea/i).test(pr[0].nodeName);soffseth=ista&&this._hasScroll(pr[0],"left")?0:that.sizeDiff.height;soffsetw=ista?0:that.sizeDiff.width;s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)};left=(parseFloat(that.element.css("left"))+
(that.position.left-that.originalPosition.left))||null;top=(parseFloat(that.element.css("top"))+
(that.position.top-that.originalPosition.top))||null;if(!o.animate){this.element.css($.extend(s,{top:top,left:left}));}
that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate){this._proportionallyResize();}}
$("body").css("cursor","auto");this._removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper){this.helper.remove();}
return false;},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height};},_applyChanges:function(){var props={};if(this.position.top!==this.prevPosition.top){props.top=this.position.top+"px";}
if(this.position.left!==this.prevPosition.left){props.left=this.position.left+"px";}
if(this.size.width!==this.prevSize.width){props.width=this.size.width+"px";}
if(this.size.height!==this.prevSize.height){props.height=this.size.height+"px";}
this.helper.css(props);return props;},_updateVirtualBoundaries:function(forceAspectRatio){var pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b,o=this.options;b={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth){b.minWidth=pMinWidth;}
if(pMinHeight>b.minHeight){b.minHeight=pMinHeight;}
if(pMaxWidth<b.maxWidth){b.maxWidth=pMaxWidth;}
if(pMaxHeight<b.maxHeight){b.maxHeight=pMaxHeight;}}
this._vBoundaries=b;},_updateCache:function(data){this.offset=this.helper.offset();if(this._isNumber(data.left)){this.position.left=data.left;}
if(this._isNumber(data.top)){this.position.top=data.top;}
if(this._isNumber(data.height)){this.size.height=data.height;}
if(this._isNumber(data.width)){this.size.width=data.width;}},_updateRatio:function(data){var cpos=this.position,csize=this.size,a=this.axis;if(this._isNumber(data.height)){data.width=(data.height*this.aspectRatio);}else if(this._isNumber(data.width)){data.height=(data.width/this.aspectRatio);}
if(a==="sw"){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a==="nw"){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data){var o=this._vBoundaries,a=this.axis,ismaxw=this._isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=this._isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=this._isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=this._isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height),dw=this.originalPosition.left+this.originalSize.width,dh=this.originalPosition.top+this.originalSize.height,cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw){data.width=o.minWidth;}
if(isminh){data.height=o.minHeight;}
if(ismaxw){data.width=o.maxWidth;}
if(ismaxh){data.height=o.maxHeight;}
if(isminw&&cw){data.left=dw-o.minWidth;}
if(ismaxw&&cw){data.left=dw-o.maxWidth;}
if(isminh&&ch){data.top=dh-o.minHeight;}
if(ismaxh&&ch){data.top=dh-o.maxHeight;}
if(!data.width&&!data.height&&!data.left&&data.top){data.top=null;}else if(!data.width&&!data.height&&!data.top&&data.left){data.left=null;}
return data;},_getPaddingPlusBorderDimensions:function(element){var i=0,widths=[],borders=[element.css("borderTopWidth"),element.css("borderRightWidth"),element.css("borderBottomWidth"),element.css("borderLeftWidth")],paddings=[element.css("paddingTop"),element.css("paddingRight"),element.css("paddingBottom"),element.css("paddingLeft")];for(;i<4;i++){widths[i]=(parseFloat(borders[i])||0);widths[i]+=(parseFloat(paddings[i])||0);}
return{height:widths[0]+widths[2],width:widths[1]+widths[3]};},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length){return;}
var prel,i=0,element=this.helper||this.element;for(;i<this._proportionallyResizeElements.length;i++){prel=this._proportionallyResizeElements[i];if(!this.outerDimensions){this.outerDimensions=this._getPaddingPlusBorderDimensions(prel);}
prel.css({height:(element.height()-this.outerDimensions.height)||0,width:(element.width()-this.outerDimensions.width)||0});}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$("<div style='overflow:hidden;'></div>");this._addClass(this.helper,this._helper);this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx){return{width:this.originalSize.width+dx};},w:function(event,dx){var cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!=="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","animate",{stop:function(event){var that=$(this).resizable("instance"),o=that.options,pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&that._hasScroll(pr[0],"left")?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width,style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseFloat(that.element.css("left"))+
(that.position.left-that.originalPosition.left))||null,top=(parseFloat(that.element.css("top"))+
(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseFloat(that.element.css("width")),height:parseFloat(that.element.css("height")),top:parseFloat(that.element.css("top")),left:parseFloat(that.element.css("left"))};if(pr&&pr.length){$(pr[0]).css({width:data.width,height:data.height});}
that._updateCache(data);that._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(){var element,p,co,ch,cw,width,height,that=$(this).resizable("instance"),o=that.options,el=that.element,oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce){return;}
that.containerElement=$(ce);if(/document/.test(oc)||oc===document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}else{element=$(ce);p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=that._num(element.css("padding"+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};co=that.containerOffset;ch=that.containerSize.height;cw=that.containerSize.width;width=(that._hasScroll(ce,"left")?ce.scrollWidth:cw);height=(that._hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event){var woset,hoset,isParent,isOffsetRelative,that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement,continueResize=true;if(ce[0]!==document&&(/static/).test(ce.css("position"))){cop=co;}
if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+
(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}
that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+
(that._helper?(that.position.top-co.top):that.position.top);if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}
that.position.top=that._helper?co.top:0;}
isParent=that.containerElement.get(0)===that.element.parent().get(0);isOffsetRelative=/relative|absolute/.test(that.containerElement.css("position"));if(isParent&&isOffsetRelative){that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;}else{that.offset.left=that.element.offset().left;that.offset.top=that.element.offset().top;}
woset=Math.abs(that.sizeDiff.width+
(that._helper?that.offset.left-cop.left:(that.offset.left-co.left)));hoset=Math.abs(that.sizeDiff.height+
(that._helper?that.offset.top-cop.top:(that.offset.top-co.top)));if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}}
if(!continueResize){that.position.left=that.prevPosition.left;that.position.top=that.prevPosition.top;that.size.width=that.prevSize.width;that.size.height=that.prevSize.height;}},stop:function(){var that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement,helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}
if(that._helper&&!o.animate&&(/static/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}}});$.ui.plugin.add("resizable","alsoResize",{start:function(){var that=$(this).resizable("instance"),o=that.options;$(o.alsoResize).each(function(){var el=$(this);el.data("ui-resizable-alsoresize",{width:parseFloat(el.width()),height:parseFloat(el.height()),left:parseFloat(el.css("left")),top:parseFloat(el.css("top"))});});},resize:function(event,ui){var that=$(this).resizable("instance"),o=that.options,os=that.originalSize,op=that.originalPosition,delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0};$(o.alsoResize).each(function(){var el=$(this),start=$(this).data("ui-resizable-alsoresize"),style={},css=el.parents(ui.originalElement[0]).length?["width","height"]:["width","height","top","left"];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0){style[prop]=sum||null;}});el.css(style);});},stop:function(){$(this).removeData("ui-resizable-alsoresize");}});$.ui.plugin.add("resizable","ghost",{start:function(){var that=$(this).resizable("instance"),cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:0.25,display:"block",position:"relative",height:cs.height,width:cs.width,margin:0,left:0,top:0});that._addClass(that.ghost,"ui-resizable-ghost");if($.uiBackCompat!==false&&typeof that.options.ghost==="string"){that.ghost.addClass(this.options.ghost);}
that.ghost.appendTo(that.helper);},resize:function(){var that=$(this).resizable("instance");if(that.ghost){that.ghost.css({position:"relative",height:that.size.height,width:that.size.width});}},stop:function(){var that=$(this).resizable("instance");if(that.ghost&&that.helper){that.helper.get(0).removeChild(that.ghost.get(0));}}});$.ui.plugin.add("resizable","grid",{resize:function(){var outerDimensions,that=$(this).resizable("instance"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,grid=typeof o.grid==="number"?[o.grid,o.grid]:o.grid,gridX=(grid[0]||1),gridY=(grid[1]||1),ox=Math.round((cs.width-os.width)/gridX)*gridX,oy=Math.round((cs.height-os.height)/gridY)*gridY,newWidth=os.width+ox,newHeight=os.height+oy,isMaxWidth=o.maxWidth&&(o.maxWidth<newWidth),isMaxHeight=o.maxHeight&&(o.maxHeight<newHeight),isMinWidth=o.minWidth&&(o.minWidth>newWidth),isMinHeight=o.minHeight&&(o.minHeight>newHeight);o.grid=grid;if(isMinWidth){newWidth+=gridX;}
if(isMinHeight){newHeight+=gridY;}
if(isMaxWidth){newWidth-=gridX;}
if(isMaxHeight){newHeight-=gridY;}
if(/^(se|s|e)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;}else if(/^(ne)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy;}else if(/^(sw)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.left=op.left-ox;}else{if(newHeight-gridY<=0||newWidth-gridX<=0){outerDimensions=that._getPaddingPlusBorderDimensions(this);}
if(newHeight-gridY>0){that.size.height=newHeight;that.position.top=op.top-oy;}else{newHeight=gridY-outerDimensions.height;that.size.height=newHeight;that.position.top=op.top+os.height-newHeight;}
if(newWidth-gridX>0){that.size.width=newWidth;that.position.left=op.left-ox;}else{newWidth=gridX-outerDimensions.width;that.size.width=newWidth;that.position.left=op.left+os.width-newWidth;}}}});var widgetsResizable=$.ui.resizable;}));
/*! jQuery JSON plugin 2.4.0 | code.google.com/p/jquery-json */
(function($){'use strict';var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},hasOwn=Object.prototype.hasOwnProperty;$.toJSON=typeof JSON==='object'&&JSON.stringify?JSON.stringify:function(o){if(o===null){return'null';}
var pairs,k,name,val,type=$.type(o);if(type==='undefined'){return undefined;}
if(type==='number'||type==='boolean'){return String(o);}
if(type==='string'){return $.quoteString(o);}
if(typeof o.toJSON==='function'){return $.toJSON(o.toJSON());}
if(type==='date'){var month=o.getUTCMonth()+1,day=o.getUTCDate(),year=o.getUTCFullYear(),hours=o.getUTCHours(),minutes=o.getUTCMinutes(),seconds=o.getUTCSeconds(),milli=o.getUTCMilliseconds();if(month<10){month='0'+month;}
if(day<10){day='0'+day;}
if(hours<10){hours='0'+hours;}
if(minutes<10){minutes='0'+minutes;}
if(seconds<10){seconds='0'+seconds;}
if(milli<100){milli='0'+milli;}
if(milli<10){milli='0'+milli;}
return'"'+year+'-'+month+'-'+day+'T'+
hours+':'+minutes+':'+seconds+'.'+milli+'Z"';}
pairs=[];if($.isArray(o)){for(k=0;k<o.length;k++){pairs.push($.toJSON(o[k])||'null');}
return'['+pairs.join(',')+']';}
if(typeof o==='object'){for(k in o){if(hasOwn.call(o,k)){type=typeof k;if(type==='number'){name='"'+k+'"';}else if(type==='string'){name=$.quoteString(k);}else{continue;}
type=typeof o[k];if(type!=='function'&&type!=='undefined'){val=$.toJSON(o[k]);pairs.push(name+':'+val);}}}
return'{'+pairs.join(',')+'}';}};$.evalJSON=typeof JSON==='object'&&JSON.parse?JSON.parse:function(str){return eval('('+str+')');};$.secureEvalJSON=typeof JSON==='object'&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'');if(/^[\],:{}\s]*$/.test(filtered)){return eval('('+str+')');}
throw new SyntaxError('Error parsing JSON, source is not valid.');};$.quoteString=function(str){if(str.match(escape)){return'"'+str.replace(escape,function(a){var c=meta[a];if(typeof c==='string'){return c;}
c=a.charCodeAt();return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}
return'"'+str+'"';};}(jQuery));
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(factory){factory(jQuery);}(function($){var pluses=/\+/g;function decode(s){if(config.raw){return s;}
return decodeURIComponent(s.replace(pluses,' '));}
function decodeAndParse(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}
s=decode(s);try{return config.json?JSON.parse(s):s;}catch(e){}}
var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=config.json?JSON.stringify(value):String(value);return(document.cookie=[config.raw?key:encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var cookies=document.cookie.split('; ');var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=parts.join('=');if(key&&key===name){result=decodeAndParse(cookie);break;}
if(!key){result[name]=decodeAndParse(cookie);}}
return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,'',$.extend({},options,{expires:-1}));return true;}
return false;};}));(function($){var emulationFixed={FIXED_CLASS:'webim-fixed',FIXED_DATA_KEY:'webimFixed',isNecessary:function(){if($.browser.msie){var engineVersion=5;if(document.documentMode){engineVersion=document.documentMode;}else{engineVersion=5;if(document.compatMode){if(document.compatMode=='CSS1Compat'){engineVersion=7;}}}
return engineVersion<=5;}
return false;},initScrollEvent:function(){var fixedData=this.getFixedData($(window));if(!fixedData){fixedData={emulationFixedInit:true};$(window).scroll(this.scrollEventHandler);var emulationFixed=this;$(document).ready(function(){$('.'+emulationFixed.FIXED_CLASS).each(function(){$(this).queue(function(next){emulationFixed.moveToFixed($(this));next();});});});this.setFixedData($(window),fixedData);}},prepareObjects:function(jObjects){jObjects=$(jObjects);jObjects.addClass(this.FIXED_CLASS).css('position','absolute');},moveTo:function(elementWrp,requiredPosition){this.updateFixedPosition(elementWrp,requiredPosition);this.moveToFixed(elementWrp);},animateMoveTo:function(elementWrp,requiredPosition,duration,easing,complete){elementWrp.queue(function(next){var animatePosition=emulationFixed.convertPositionForAnimate(requiredPosition);elementWrp.animate(animatePosition,duration,easing,complete).queue(function(postNext){emulationFixed.moveTo(elementWrp,requiredPosition);});next();});},updateFixedPosition:function(jObject,newFixedPosition){var fixedData=this.getFixedData(jObject);if(fixedData){fixedData.position=$.extend(fixedData.position,newFixedPosition);}else{fixedData={position:{top:'auto',right:'auto',left:'auto',bottom:'auto'}};fixedData.position=$.extend(fixedData.position,newFixedPosition);}
this.setFixedData(jObject,fixedData);},convertPositionForAnimate:function(requiredPosition){var absolutePosition=this.fixedToAbsolute(requiredPosition);var convertedPosition={};for(var coord in requiredPosition){convertedPosition[coord]=absolutePosition[coord];}
return convertedPosition;},scrollEventHandler:function(){$('.'+emulationFixed.FIXED_CLASS).not(':animated').each(function(){emulationFixed.moveToFixed($(this));});},moveToFixed:function(elementWrp){var fixedData=emulationFixed.getFixedData(elementWrp);if(fixedData){elementWrp.css(emulationFixed.fixedToAbsolute(fixedData.position));}},fixedToAbsolute:function(fixedPosition){var jWindow=$('body');var absolutePosition={top:'auto',right:'auto',bottom:'auto',left:'auto'};if(fixedPosition.top!=='auto'){absolutePosition.top=(this.convertCoordToPx(fixedPosition.top,'vertical')+jWindow.scrollTop())+'px'}
if(fixedPosition.right!=='auto'){absolutePosition.right=(this.convertCoordToPx(fixedPosition.right,'horizontal')-jWindow.scrollLeft())+'px'}
if(fixedPosition.bottom!=='auto'){absolutePosition.bottom=(this.convertCoordToPx(fixedPosition.bottom,'vertical')-jWindow.scrollTop())+'px'}
if(fixedPosition.left!=='auto'){absolutePosition.left=(this.convertCoordToPx(fixedPosition.left,'horizontal')+jWindow.scrollLeft())+'px'}
return absolutePosition;},absoluteToFixed:function(absolutePosition){var jWindow=$('body');var fixedPosition={top:'auto',right:'auto',bottom:'auto',left:'auto'};if(absolutePosition.top!=='auto'){fixedPosition.top=(this.convertCoordToPx(absolutePosition.top,'vertical')-jWindow.scrollTop())+'px'}
if(absolutePosition.right!=='auto'){fixedPosition.right=(this.convertCoordToPx(absolutePosition.right,'horizontal')+jWindow.scrollLeft())+'px'}
if(absolutePosition.bottom!=='auto'){fixedPosition.bottom=(this.convertCoordToPx(absolutePosition.bottom,'vertical')+jWindow.scrollTop())+'px'}
if(absolutePosition.left!=='auto'){fixedPosition.left=(this.convertCoordToPx(absolutePosition.left,'horizontal')-jWindow.scrollLeft())+'px'}
return fixedPosition;},convertCoordToPx:function(coord,direction){var convertedCoord=0;if(coord){var lastChar=coord.toString().charAt(coord.length-1);switch(lastChar){case'%':var directionSize=0;switch(direction){case'horizontal':directionSize=$('body').width();break;case'vertical':directionSize=$('body').height();}
convertedCoord=parseFloat(coord)*directionSize/100;break;default:convertedCoord=parseFloat(coord);}}
return convertedCoord;},getFixedData:function(jObject){var fixedData=jObject.data(this.FIXED_DATA_KEY);return fixedData;},setFixedData:function(jObject,fixedData){jObject.data(this.FIXED_DATA_KEY,fixedData);}};$.fn.setFixedPosition=function(position){if(emulationFixed.isNecessary()){emulationFixed.initScrollEvent();}
return this.each(function(){var elementWrp=$(this);var defaultPosition={'top':elementWrp.css('top'),'bottom':elementWrp.css('bottom'),'left':elementWrp.css('left'),'right':elementWrp.css('right')};if(emulationFixed.isNecessary()){emulationFixed.prepareObjects(elementWrp);emulationFixed.moveTo(elementWrp,position||defaultPosition);}else if(position){elementWrp.css(position);}});};$.fn.fixedAnimate=function(properties,duration,easing,complete){return this.each(function(){var elementWrp=$(this);if(emulationFixed.isNecessary()){var propertiesWithoutCoords={};var coords={};for(var propertyName in properties){switch(propertyName){case'top':case'bottom':case'left':case'right':coords[propertyName]=properties[propertyName];break;default:propertiesWithoutCoords[propertyName]=properties[propertyName];}}
emulationFixed.animateMoveTo(elementWrp,coords,duration,easing);elementWrp.animate(propertiesWithoutCoords,duration,easing,complete);}else{elementWrp.animate(properties,duration,easing,complete);}});};})(jQuery);jQuery(function($,undefined){function isRGBACapable(){var $script=$('script:first'),color=$script.css('color'),result=false;if(/^rgba/.test(color)){result=true;}else{try{result=(color!==$script.css('color','rgba(0, 0, 0, 0.5)').css('color'));$script.css('color',color);}catch(e){}}
$script.removeAttr('style');return result;}
$.extend(true,$,{support:{'rgba':isRGBACapable()}});var styles=$('html').prop('style');var boxShadowProperty;$.each(['boxShadow','MozBoxShadow','WebkitBoxShadow'],function(i,property){var val=styles[property];if(typeof val!=='undefined'){boxShadowProperty=property;return false;}});if(boxShadowProperty){$['Tween']['propHooks']['boxShadow']={get:function(tween){return $(tween.elem).css(boxShadowProperty);},set:function(tween){var style=tween.elem.style;var p_begin=parseShadows($(tween.elem)[0].style[boxShadowProperty]||$(tween.elem).css(boxShadowProperty));var p_end=parseShadows(tween.end);var maxShadowCount=Math.max(p_begin.length,p_end.length);var i;for(i=0;i<maxShadowCount;i++){p_end[i]=$.extend({},p_begin[i],p_end[i]);if(p_begin[i]){if(!('color'in p_begin[i])||$.isArray(p_begin[i].color)===false){p_begin[i].color=p_end[i].color||[0,0,0,0];}}else{p_begin[i]=parseShadows('0 0 0 0 rgba(0,0,0,0)')[0];}}
tween['run']=function(progress){var rs=calculateShadows(p_begin,p_end,progress);style[boxShadowProperty]=rs;};}};}
function calculateShadows(beginList,endList,pos){var shadows=[];$.each(beginList,function(i){var parts=[],begin=beginList[i],end=endList[i];if(begin.inset){parts.push('inset');}
if(typeof end.left!=='undefined'){parts.push(parseFloat(begin.left+pos*(end.left-begin.left))+'px '
+parseFloat(begin.top+pos*(end.top-begin.top))+'px');}
if(typeof end.blur!=='undefined'){parts.push(parseFloat(begin.blur+pos*(end.blur-begin.blur))+'px');}
if(typeof end.spread!=='undefined'){parts.push(parseFloat(begin.spread+pos*(end.spread-begin.spread))+'px');}
if(typeof end.color!=='undefined'){var color='rgb'+($.support['rgba']?'a':'')+'('
+parseInt((begin.color[0]+pos*(end.color[0]-begin.color[0])),10)+','
+parseInt((begin.color[1]+pos*(end.color[1]-begin.color[1])),10)+','
+parseInt((begin.color[2]+pos*(end.color[2]-begin.color[2])),10);if($.support['rgba']){color+=','+parseFloat(begin.color[3]+pos*(end.color[3]-begin.color[3]));}
color+=')';parts.push(color);}
shadows.push(parts.join(' '));});return shadows.join(', ');}
function parseShadows(shadow){var parsedShadows=[];var parsePosition=0;var parseLength=shadow.length;function findInset(){var m=/^inset\b/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.inset=true;parsePosition+=m[0].length;return true;}
return false;}
function findOffsets(){var m=/^(-?[0-9\.]+)(?:px)?\s+(-?[0-9\.]+)(?:px)?(?:\s+(-?[0-9\.]+)(?:px)?)?(?:\s+(-?[0-9\.]+)(?:px)?)?/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.left=parseInt(m[1],10);parsedShadow.top=parseInt(m[2],10);parsedShadow.blur=(m[3]?parseInt(m[3],10):0);parsedShadow.spread=(m[4]?parseInt(m[4],10):0);parsePosition+=m[0].length;return true;}
return false;}
function findColor(){var m=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.color=[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16),1];parsePosition+=m[0].length;return true;}
m=/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.color=[parseInt(m[1],16)*17,parseInt(m[2],16)*17,parseInt(m[3],16)*17,1];parsePosition+=m[0].length;return true;}
m=/^rgb\(\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*\)/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.color=[parseInt(m[1],10),parseInt(m[2],10),parseInt(m[3],10),1];parsePosition+=m[0].length;return true;}
m=/^rgba\(\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*,\s*([0-9\.]+)\s*\)/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsedShadow.color=[parseInt(m[1],10),parseInt(m[2],10),parseInt(m[3],10),parseFloat(m[4])];parsePosition+=m[0].length;return true;}
return false;}
function findWhiteSpace(){var m=/^\s+/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsePosition+=m[0].length;return true;}
return false;}
function findComma(){var m=/^\s*,\s*/.exec(shadow.substring(parsePosition));if(m!==null&&m.length>0){parsePosition+=m[0].length;return true;}
return false;}
function normalizeShadow(shadow){if($.isPlainObject(shadow)){var i,sColor,cLength=0,color=[];if($.isArray(shadow.color)){sColor=shadow.color;cLength=sColor.length;}
for(i=0;i<4;i++){if(i<cLength){color.push(sColor[i]);}else if(i===3){color.push(1);}else{color.push(0);}}}
return $.extend({'left':0,'top':0,'blur':0,'spread':0},shadow);}
var parsedShadow=normalizeShadow();while(parsePosition<parseLength){if(findInset()){findWhiteSpace();}else if(findOffsets()){findWhiteSpace();}else if(findColor()){findWhiteSpace();}else if(findComma()){parsedShadows.push(normalizeShadow(parsedShadow));parsedShadow={};}else{break;}}
parsedShadows.push(normalizeShadow(parsedShadow));return parsedShadows;}});(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);
/*!
 * The Final Countdown for jQuery v2.0.4 (http://hilios.github.io/jQuery.countdown/)
 * Copyright (c) 2014 Edson Hilios
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function($){"use strict";var PRECISION=100;var instances=[],matchers=[];matchers.push(/^[0-9]*$/.source);matchers.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);matchers.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);matchers=new RegExp(matchers.join("|"));function parseDateString(dateString){if(dateString instanceof Date){return dateString;}
if(String(dateString).match(matchers)){if(String(dateString).match(/^[0-9]*$/)){dateString=Number(dateString);}
if(String(dateString).match(/\-/)){dateString=String(dateString).replace(/\-/g,"/");}
return new Date(dateString);}else{throw new Error("Couldn't cast `"+dateString+"` to a date object.");}}
var DIRECTIVE_KEY_MAP={Y:"years",m:"months",w:"weeks",d:"days",D:"totalDays",H:"hours",M:"minutes",S:"seconds"};function strftime(offsetObject){return function(format){var directives=format.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);if(directives){for(var i=0,len=directives.length;i<len;++i){var directive=directives[i].match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/),regexp=new RegExp(directive[0]),modifier=directive[1]||"",plural=directive[3]||"",value=null;directive=directive[2];if(DIRECTIVE_KEY_MAP.hasOwnProperty(directive)){value=DIRECTIVE_KEY_MAP[directive];value=Number(offsetObject[value]);}
if(value!==null){if(modifier==="!"){value=pluralize(plural,value);}
if(modifier===""){if(value<10){value="0"+value.toString();}}
format=format.replace(regexp,value.toString());}}}
format=format.replace(/%%/,"%");return format;};}
function pluralize(format,count){var plural="s",singular="";if(format){format=format.replace(/(:|;|\s)/gi,"").split(/\,/);if(format.length===1){plural=format[0];}else{singular=format[0];plural=format[1];}}
if(Math.abs(count)===1){return singular;}else{return plural;}}
var Countdown=function(el,finalDate,callback){this.el=el;this.$el=$(el);this.interval=null;this.offset={};this.instanceNumber=instances.length;instances.push(this);this.$el.data("countdown-instance",this.instanceNumber);if(callback){this.$el.on("update.countdown",callback);this.$el.on("stoped.countdown",callback);this.$el.on("finish.countdown",callback);}
this.setFinalDate(finalDate);this.start();};$.extend(Countdown.prototype,{start:function(){if(this.interval!==null){clearInterval(this.interval);}
var self=this;this.update();this.interval=setInterval(function(){self.update.call(self);},PRECISION);},stop:function(){clearInterval(this.interval);this.interval=null;this.dispatchEvent("stoped");},pause:function(){this.stop.call(this);},resume:function(){this.start.call(this);},remove:function(){this.stop();instances[this.instanceNumber]=null;delete this.$el.data().countdownInstance;},setFinalDate:function(value){this.finalDate=parseDateString(value);},update:function(){if(this.$el.closest("html").length===0){this.remove();return;}
this.totalSecsLeft=this.finalDate.getTime()-new Date().getTime();this.totalSecsLeft=Math.ceil(this.totalSecsLeft/1e3);this.totalSecsLeft=this.totalSecsLeft<0?0:this.totalSecsLeft;this.offset={seconds:this.totalSecsLeft%60,minutes:Math.floor(this.totalSecsLeft/60)%60,hours:Math.floor(this.totalSecsLeft/60/60)%24,days:Math.floor(this.totalSecsLeft/60/60/24)%7,totalDays:Math.floor(this.totalSecsLeft/60/60/24),weeks:Math.floor(this.totalSecsLeft/60/60/24/7),months:Math.floor(this.totalSecsLeft/60/60/24/30),years:Math.floor(this.totalSecsLeft/60/60/24/365)};if(this.totalSecsLeft===0){this.stop();this.dispatchEvent("finish");}else{this.dispatchEvent("update");}},dispatchEvent:function(eventName){var event=$.Event(eventName+".countdown");event.finalDate=this.finalDate;event.offset=$.extend({},this.offset);event.strftime=strftime(this.offset);this.$el.trigger(event);}});$.fn.countdown=function(){var argumentsArray=Array.prototype.slice.call(arguments,0);return this.each(function(){var instanceNumber=$(this).data("countdown-instance");if(instanceNumber!==undefined){var instance=instances[instanceNumber],method=argumentsArray[0];if(Countdown.prototype.hasOwnProperty(method)){instance[method].apply(instance,argumentsArray.slice(1));}else if(String(method).match(/^[$A-Z_][0-9A-Z_$]*$/i)===null){instance.setFinalDate.call(instance,method);instance.start();}else{$.error("Method %s does not exist on jQuery.countdown".replace(/\%s/gi,method));}}else{new Countdown(this,argumentsArray[0],argumentsArray[1]);}});};})(jQuery);webimJQuery.jMaskGlobals={'watchInputs':false,'dataMask':false,'translation':{'X':{pattern:/\d/},'x':{pattern:/\d/,optional:true},'#':{pattern:/\d/,recursive:true},'A':{pattern:/[a-zA-Z0-9]/},'S':{pattern:/[a-zA-Z]/},'0':null,'9':null}};(function(factory,jQuery,Zepto){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){module.exports=factory(require('jquery'));}else{factory(jQuery||Zepto);}}(function($){'use strict';var Mask=function(el,mask,options){var p={invalid:[],getCaret:function(){try{var sel,pos=0,ctrl=el.get(0),dSel=document.selection,cSelStart=ctrl.selectionStart;if(dSel&&navigator.appVersion.indexOf('MSIE 10')===-1){sel=dSel.createRange();sel.moveStart('character',-p.val().length);pos=sel.text.length;}
else if(cSelStart||cSelStart==='0'){pos=cSelStart;}
return pos;}catch(e){}},setCaret:function(pos){try{if(el.is(':focus')){var range,ctrl=el.get(0);if(ctrl.setSelectionRange){ctrl.setSelectionRange(pos,pos);}else{range=ctrl.createTextRange();range.collapse(true);range.moveEnd('character',pos);range.moveStart('character',pos);range.select();}}}catch(e){}},events:function(){el.on('keydown.mask',function(e){el.data('mask-keycode',e.keyCode||e.which);el.data('mask-previus-value',el.val());el.data('mask-previus-caret-pos',p.getCaret());p.maskDigitPosMapOld=p.maskDigitPosMap;}).on($.jMaskGlobals.useInput?'input.mask':'keyup.mask',p.behaviour).on('paste.mask drop.mask',function(){setTimeout(function(){el.keydown().keyup();},100);}).on('change.mask',function(){el.data('changed',true);}).on('blur.mask',function(){if(oldValue!==p.val()&&!el.data('changed')){el.trigger('change');}
el.data('changed',false);}).on('blur.mask',function(){oldValue=p.val();}).on('focus.mask',function(e){if(options.selectOnFocus===true){$(e.target).select();}}).on('focusout.mask',function(){if(options.clearIfNotMatch&&!regexMask.test(p.val())){p.val('');}});},getRegexMask:function(){var maskChunks=[],translation,pattern,optional,recursive,oRecursive,r;for(var i=0;i<mask.length;i++){translation=jMask.translation[mask.charAt(i)];if(translation){pattern=translation.pattern.toString().replace(/.{1}$|^.{1}/g,'');optional=translation.optional;recursive=translation.recursive;if(recursive){maskChunks.push(mask.charAt(i));oRecursive={digit:mask.charAt(i),pattern:pattern};}else{maskChunks.push(!optional&&!recursive?pattern:(pattern+'?'));}}else{maskChunks.push(mask.charAt(i).replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'));}}
r=maskChunks.join('');if(oRecursive){r=r.replace(new RegExp('('+oRecursive.digit+'(.*'+oRecursive.digit+')?)'),'($1)?').replace(new RegExp(oRecursive.digit,'g'),oRecursive.pattern);}
return new RegExp(r);},destroyEvents:function(){el.off(['input','keydown','keyup','paste','drop','blur','focusout',''].join('.mask '));},val:function(v){var isInput=el.is('input'),method=isInput?'val':'text',r;if(arguments.length>0){if(el[method]()!==v){el[method](v);}
r=el;}else{r=el[method]();}
return r;},calculateCaretPosition:function(){var oldVal=el.data('mask-previus-value')||'',newVal=p.getMasked(),caretPosNew=p.getCaret();if(oldVal!==newVal){var caretPosOld=el.data('mask-previus-caret-pos')||0,newValL=newVal.length,oldValL=oldVal.length,maskDigitsBeforeCaret=0,maskDigitsAfterCaret=0,maskDigitsBeforeCaretAll=0,maskDigitsBeforeCaretAllOld=0,i=0;for(i=caretPosNew;i<newValL;i++){if(!p.maskDigitPosMap[i]){break;}
maskDigitsAfterCaret++;}
for(i=caretPosNew-1;i>=0;i--){if(!p.maskDigitPosMap[i]){break;}
maskDigitsBeforeCaret++;}
for(i=caretPosNew-1;i>=0;i--){if(p.maskDigitPosMap[i]){maskDigitsBeforeCaretAll++;}}
for(i=caretPosOld-1;i>=0;i--){if(p.maskDigitPosMapOld[i]){maskDigitsBeforeCaretAllOld++;}}
if(caretPosNew>oldValL){caretPosNew=newValL*10;}else if(caretPosOld>=caretPosNew&&caretPosOld!==oldValL){if(!p.maskDigitPosMapOld[caretPosNew]){var caretPos=caretPosNew;caretPosNew-=maskDigitsBeforeCaretAllOld-maskDigitsBeforeCaretAll;caretPosNew-=maskDigitsBeforeCaret;if(p.maskDigitPosMap[caretPosNew]){caretPosNew=caretPos;}}}
else if(caretPosNew>caretPosOld){caretPosNew+=maskDigitsBeforeCaretAll-maskDigitsBeforeCaretAllOld;caretPosNew+=maskDigitsAfterCaret;}}
return caretPosNew;},behaviour:function(e){e=e||window.event;p.invalid=[];var keyCode=el.data('mask-keycode');if($.inArray(keyCode,jMask.byPassKeys)===-1){var newVal=p.getMasked(),caretPos=p.getCaret();setTimeout(function(){p.setCaret(p.calculateCaretPosition());},$.jMaskGlobals.keyStrokeCompensation);p.val(newVal);p.setCaret(caretPos);return p.callbacks(e);}},getMasked:function(skipMaskChars,val){var buf=[],value=val===undefined?p.val():val+'',m=0,maskLen=mask.length,v=0,valLen=value.length,offset=1,addMethod='push',resetPos=-1,maskDigitCount=0,maskDigitPosArr=[],lastMaskChar,check;if(options.reverse){addMethod='unshift';offset=-1;lastMaskChar=0;m=maskLen-1;v=valLen-1;check=function(){return m>-1&&v>-1;};}else{lastMaskChar=maskLen-1;check=function(){return m<maskLen&&v<valLen;};}
var lastUntranslatedMaskChar;while(check()){var maskDigit=mask.charAt(m),valDigit=value.charAt(v),translation=jMask.translation[maskDigit];if(translation){if(valDigit.match(translation.pattern)){buf[addMethod](valDigit);if(translation.recursive){if(resetPos===-1){resetPos=m;}else if(m===lastMaskChar&&m!==resetPos){m=resetPos-offset;}
if(lastMaskChar===resetPos){m-=offset;}}
m+=offset;}else if(valDigit===lastUntranslatedMaskChar){maskDigitCount--;lastUntranslatedMaskChar=undefined;}else if(translation.optional){m+=offset;v-=offset;}else if(translation.fallback){buf[addMethod](translation.fallback);m+=offset;v-=offset;}else{p.invalid.push({p:v,v:valDigit,e:translation.pattern});}
v+=offset;}else{if(!skipMaskChars){buf[addMethod](maskDigit);}
if(valDigit===maskDigit){maskDigitPosArr.push(v);v+=offset;}else{lastUntranslatedMaskChar=maskDigit;maskDigitPosArr.push(v+maskDigitCount);maskDigitCount++;}
m+=offset;}}
var lastMaskCharDigit=mask.charAt(lastMaskChar);if(maskLen===valLen+1&&!jMask.translation[lastMaskCharDigit]){buf.push(lastMaskCharDigit);}
var newVal=buf.join('');p.mapMaskdigitPositions(newVal,maskDigitPosArr,valLen);return newVal;},mapMaskdigitPositions:function(newVal,maskDigitPosArr,valLen){var maskDiff=options.reverse?newVal.length-valLen:0;p.maskDigitPosMap={};for(var i=0;i<maskDigitPosArr.length;i++){p.maskDigitPosMap[maskDigitPosArr[i]+maskDiff]=1;}},callbacks:function(e){var val=p.val(),changed=val!==oldValue,defaultArgs=[val,e,el,options],callback=function(name,criteria,args){if(typeof options[name]==='function'&&criteria){options[name].apply(this,args);}};callback('onChange',changed===true,defaultArgs);callback('onKeyPress',changed===true,defaultArgs);callback('onComplete',val.length===mask.length,defaultArgs);callback('onInvalid',p.invalid.length>0,[val,e,el,p.invalid,options]);}};el=$(el);var jMask=this,oldValue=p.val(),regexMask;mask=typeof mask==='function'?mask(p.val(),undefined,el,options):mask;jMask.mask=mask;jMask.options=options;jMask.remove=function(){var caret=p.getCaret();if(jMask.options.placeholder){el.removeAttr('placeholder');}
if(el.data('mask-maxlength')){el.removeAttr('maxlength');}
p.destroyEvents();p.val(jMask.getCleanVal());p.setCaret(caret);return el;};jMask.getCleanVal=function(){return p.getMasked(true);};jMask.getMaskedVal=function(val){return p.getMasked(false,val);};jMask.init=function(onlyMask){onlyMask=onlyMask||false;options=options||{};jMask.clearIfNotMatch=$.jMaskGlobals.clearIfNotMatch;jMask.byPassKeys=$.jMaskGlobals.byPassKeys;jMask.translation=$.extend({},$.jMaskGlobals.translation,options.translation);jMask=$.extend(true,{},jMask,options);regexMask=p.getRegexMask();if(onlyMask){p.events();p.val(p.getMasked());}else{if(options.placeholder){el.attr('placeholder',options.placeholder);}
if(el.data('mask')){el.attr('autocomplete','off');}
for(var i=0,maxlength=true;i<mask.length;i++){var translation=jMask.translation[mask.charAt(i)];if(translation&&translation.recursive){maxlength=false;break;}}
if(maxlength){el.attr('maxlength',mask.length).data('mask-maxlength',true);}
p.destroyEvents();p.events();var caret=p.getCaret();p.val(p.getMasked());p.setCaret(caret);}};jMask.init(!el.is('input'));};$.maskWatchers={};var HTMLAttributes=function(){var input=$(this),options={},prefix='data-mask-',mask=input.attr('data-mask');if(input.attr(prefix+'reverse')){options.reverse=true;}
if(input.attr(prefix+'clearifnotmatch')){options.clearIfNotMatch=true;}
if(input.attr(prefix+'selectonfocus')==='true'){options.selectOnFocus=true;}
if(notSameMaskObject(input,mask,options)){return input.data('mask',new Mask(this,mask,options));}},notSameMaskObject=function(field,mask,options){options=options||{};var maskObject=$(field).data('mask'),stringify=JSON.stringify,value=$(field).val()||$(field).text();try{if(typeof mask==='function'){mask=mask(value);}
return typeof maskObject!=='object'||stringify(maskObject.options)!==stringify(options)||maskObject.mask!==mask;}catch(e){}},eventSupported=function(eventName){var el=document.createElement('div'),isSupported;eventName='on'+eventName;isSupported=(eventName in el);if(!isSupported){el.setAttribute(eventName,'return;');isSupported=typeof el[eventName]==='function';}
el=null;return isSupported;};$.fn.mask=function(mask,options){options=options||{};var selector=this.selector,globals=$.jMaskGlobals,interval=globals.watchInterval,watchInputs=options.watchInputs||globals.watchInputs,maskFunction=function(){if(notSameMaskObject(this,mask,options)){return $(this).data('mask',new Mask(this,mask,options));}};$(this).each(maskFunction);if(selector&&selector!==''&&watchInputs){clearInterval($.maskWatchers[selector]);$.maskWatchers[selector]=setInterval(function(){$(document).find(selector).each(maskFunction);},interval);}
return this;};$.fn.masked=function(val){return this.data('mask').getMaskedVal(val);};$.fn.unmask=function(){clearInterval($.maskWatchers[this.selector]);delete $.maskWatchers[this.selector];return this.each(function(){var dataMask=$(this).data('mask');if(dataMask){dataMask.remove().removeData('mask');}});};$.fn.cleanVal=function(){return this.data('mask').getCleanVal();};$.applyDataMask=function(selector){selector=selector||$.jMaskGlobals.maskElements;var $selector=(selector instanceof $)?selector:$(selector);$selector.filter($.jMaskGlobals.dataMaskAttr).each(HTMLAttributes);};var globals={maskElements:'input,td,span,div',dataMaskAttr:'*[data-mask]',dataMask:true,watchInterval:300,watchInputs:true,keyStrokeCompensation:10,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&eventSupported('input'),watchDataMask:false,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{'0':{pattern:/\d/},'9':{pattern:/\d/,optional:true},'#':{pattern:/\d/,recursive:true},'A':{pattern:/[a-zA-Z0-9]/},'S':{pattern:/[a-zA-Z]/}}};$.jMaskGlobals=$.jMaskGlobals||{};globals=$.jMaskGlobals=$.extend(true,{},globals,$.jMaskGlobals);if(globals.dataMask){$.applyDataMask();}
setInterval(function(){if($.jMaskGlobals.watchDataMask){$.applyDataMask();}},globals.watchInterval);},window.jQuery,window.Zepto));;(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery','jquery-ui/ui/widget'],factory);}else if(typeof exports==='object'){factory(require('jquery'),require('./vendor/jquery.ui.widget'));}else{factory(window.jQuery);}}(function($){'use strict';$.support.fileInput=!(new RegExp('(Android (1\\.[0156]|2\\.[01]))'+'|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)'+'|(w(eb)?OSBrowser)|(webOS)'+'|(Kindle/(1\\.0|2\\.[05]|3\\.0))').test(window.navigator.userAgent)||$('<input type="file">').prop('disabled'));$.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);$.support.xhrFormDataFileUpload=!!window.FormData;$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function getDragHandler(type){var isDragOver=type==='dragover';return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var dataTransfer=e.dataTransfer;if(dataTransfer&&$.inArray('Files',dataTransfer.types)!==-1&&this._trigger(type,$.Event(type,{delegatedEvent:e}))!==false){e.preventDefault();if(isDragOver){dataTransfer.dropEffect='copy';}}};}
$.widget('blueimp.fileupload',{options:{dropZone:$(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:'Uploaded bytes exceed file size'},i18n:function(message,context){message=this.messages[message]||message.toString();if(context){$.each(context,function(key,value){message=message.replace('{'+key+'}',value);});}
return message;},formData:function(form){return form.serializeArray();},add:function(e,data){if(e.isDefaultPrevented()){return false;}
if(data.autoUpload||(data.autoUpload!==false&&$(this).fileupload('option','autoUpload'))){data.process().done(function(){data.submit();});}},processData:false,contentType:false,cache:false,timeout:0},_specialOptions:['fileInput','dropZone','pasteZone','multipart','forceIframeTransport'],_blobSlice:$.support.blobSlice&&function(){var slice=this.slice||this.webkitSlice||this.mozSlice;return slice.apply(this,arguments);},_BitrateTimer:function(){this.timestamp=((Date.now)?Date.now():(new Date()).getTime());this.loaded=0;this.bitrate=0;this.getBitrate=function(now,loaded,interval){var timeDiff=now-this.timestamp;if(!this.bitrate||!interval||timeDiff>interval){this.bitrate=(loaded-this.loaded)*(1000/timeDiff)*8;this.loaded=loaded;this.timestamp=now;}
return this.bitrate;};},_isXHRUpload:function(options){return!options.forceIframeTransport&&((!options.multipart&&$.support.xhrFileUpload)||$.support.xhrFormDataFileUpload);},_getFormData:function(options){var formData;if($.type(options.formData)==='function'){return options.formData(options.form);}
if($.isArray(options.formData)){return options.formData;}
if($.type(options.formData)==='object'){formData=[];$.each(options.formData,function(name,value){formData.push({name:name,value:value});});return formData;}
return[];},_getTotal:function(files){var total=0;$.each(files,function(index,file){total+=file.size||1;});return total;},_initProgressObject:function(obj){var progress={loaded:0,total:0,bitrate:0};if(obj._progress){$.extend(obj._progress,progress);}else{obj._progress=progress;}},_initResponseObject:function(obj){var prop;if(obj._response){for(prop in obj._response){if(obj._response.hasOwnProperty(prop)){delete obj._response[prop];}}}else{obj._response={};}},_onProgress:function(e,data){if(e.lengthComputable){var now=((Date.now)?Date.now():(new Date()).getTime()),loaded;if(data._time&&data.progressInterval&&(now-data._time<data.progressInterval)&&e.loaded!==e.total){return;}
data._time=now;loaded=Math.floor(e.loaded/e.total*(data.chunkSize||data._progress.total))+(data.uploadedBytes||0);this._progress.loaded+=(loaded-data._progress.loaded);this._progress.bitrate=this._bitrateTimer.getBitrate(now,this._progress.loaded,data.bitrateInterval);data._progress.loaded=data.loaded=loaded;data._progress.bitrate=data.bitrate=data._bitrateTimer.getBitrate(now,loaded,data.bitrateInterval);this._trigger('progress',$.Event('progress',{delegatedEvent:e}),data);this._trigger('progressall',$.Event('progressall',{delegatedEvent:e}),this._progress);}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();if(xhr.upload){$(xhr.upload).bind('progress',function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable;e.loaded=oe.loaded;e.total=oe.total;that._onProgress(e,options);});options.xhr=function(){return xhr;};}},_isInstanceOf:function(type,obj){return Object.prototype.toString.call(obj)==='[object '+type+']';},_initXHRData:function(options){var that=this,formData,file=options.files[0],multipart=options.multipart||!$.support.xhrFileUpload,paramName=$.type(options.paramName)==='array'?options.paramName[0]:options.paramName;options.headers=$.extend({},options.headers);if(options.contentRange){options.headers['Content-Range']=options.contentRange;}
if(!multipart||options.blob||!this._isInstanceOf('File',file)){options.headers['Content-Disposition']='attachment; filename="'+
encodeURI(file.name)+'"';}
if(!multipart){options.contentType=file.type||'application/octet-stream';options.data=options.blob||file;}else if($.support.xhrFormDataFileUpload){if(options.postMessage){formData=this._getFormData(options);if(options.blob){formData.push({name:paramName,value:options.blob});}else{$.each(options.files,function(index,file){formData.push({name:($.type(options.paramName)==='array'&&options.paramName[index])||paramName,value:file});});}}else{if(that._isInstanceOf('FormData',options.formData)){formData=options.formData;}else{formData=new FormData();$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value);});}
if(options.blob){formData.append(paramName,options.blob,file.name);}else{$.each(options.files,function(index,file){if(that._isInstanceOf('File',file)||that._isInstanceOf('Blob',file)){formData.append(($.type(options.paramName)==='array'&&options.paramName[index])||paramName,file,file.uploadName||file.name);}});}}
options.data=formData;}
options.blob=null;},_initIframeSettings:function(options){var targetHost=$('<a></a>').prop('href',options.url).prop('host');options.dataType='iframe '+(options.dataType||'');options.formData=this._getFormData(options);if(options.redirect&&targetHost&&targetHost!==location.host){options.formData.push({name:options.redirectParamName||'redirect',value:options.redirect});}},_initDataSettings:function(options){if(this._isXHRUpload(options)){if(!this._chunkedUpload(options,true)){if(!options.data){this._initXHRData(options);}
this._initProgressListener(options);}
if(options.postMessage){options.dataType='postmessage '+(options.dataType||'');}}else{this._initIframeSettings(options);}},_getParamName:function(options){var fileInput=$(options.fileInput),paramName=options.paramName;if(!paramName){paramName=[];fileInput.each(function(){var input=$(this),name=input.prop('name')||'files[]',i=(input.prop('files')||[1]).length;while(i){paramName.push(name);i-=1;}});if(!paramName.length){paramName=[fileInput.prop('name')||'files[]'];}}else if(!$.isArray(paramName)){paramName=[paramName];}
return paramName;},_initFormSettings:function(options){if(!options.form||!options.form.length){options.form=$(options.fileInput.prop('form'));if(!options.form.length){options.form=$(this.options.fileInput.prop('form'));}}
options.paramName=this._getParamName(options);if(!options.url){options.url=options.form.prop('action')||location.href;}
options.type=(options.type||($.type(options.form.prop('method'))==='string'&&options.form.prop('method'))||'').toUpperCase();if(options.type!=='POST'&&options.type!=='PUT'&&options.type!=='PATCH'){options.type='POST';}
if(!options.formAcceptCharset){options.formAcceptCharset=options.form.attr('accept-charset');}},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);this._initFormSettings(options);this._initDataSettings(options);return options;},_getDeferredState:function(deferred){if(deferred.state){return deferred.state();}
if(deferred.isResolved()){return'resolved';}
if(deferred.isRejected()){return'rejected';}
return'pending';},_enhancePromise:function(promise){promise.success=promise.done;promise.error=promise.fail;promise.complete=promise.always;return promise;},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();context=context||this.options.context||promise;if(resolveOrReject===true){dfd.resolveWith(context,args);}else if(resolveOrReject===false){dfd.rejectWith(context,args);}
promise.abort=dfd.promise;return this._enhancePromise(promise);},_addConvenienceMethods:function(e,data){var that=this,getPromise=function(args){return $.Deferred().resolveWith(that,args).promise();};data.process=function(resolveFunc,rejectFunc){if(resolveFunc||rejectFunc){data._processQueue=this._processQueue=(this._processQueue||getPromise([this])).then(function(){if(data.errorThrown){return $.Deferred().rejectWith(that,[data]).promise();}
return getPromise(arguments);}).then(resolveFunc,rejectFunc);}
return this._processQueue||getPromise([this]);};data.submit=function(){if(this.state()!=='pending'){data.jqXHR=this.jqXHR=(that._trigger('submit',$.Event('submit',{delegatedEvent:e}),this)!==false)&&that._onSend(e,this);}
return this.jqXHR||that._getXHRPromise();};data.abort=function(){if(this.jqXHR){return this.jqXHR.abort();}
this.errorThrown='abort';that._trigger('fail',null,this);return that._getXHRPromise(false);};data.state=function(){if(this.jqXHR){return that._getDeferredState(this.jqXHR);}
if(this._processQueue){return that._getDeferredState(this._processQueue);}};data.processing=function(){return!this.jqXHR&&this._processQueue&&that._getDeferredState(this._processQueue)==='pending';};data.progress=function(){return this._progress;};data.response=function(){return this._response;};},_getUploadedBytes:function(jqXHR){var range=jqXHR.getResponseHeader('Range'),parts=range&&range.split('-'),upperBytesPos=parts&&parts.length>1&&parseInt(parts[1],10);return upperBytesPos&&upperBytesPos+1;},_chunkedUpload:function(options,testOnly){options.uploadedBytes=options.uploadedBytes||0;var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes,mcs=options.maxChunkSize||fs,slice=this._blobSlice,dfd=$.Deferred(),promise=dfd.promise(),jqXHR,upload;if(!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data){return false;}
if(testOnly){return true;}
if(ub>=fs){file.error=options.i18n('uploadedBytes');return this._getXHRPromise(false,options.context,[null,'error',file.error]);}
upload=function(){var o=$.extend({},options),currentLoaded=o._progress.loaded;o.blob=slice.call(file,ub,ub+mcs,file.type);o.chunkSize=o.blob.size;o.contentRange='bytes '+ub+'-'+
(ub+o.chunkSize-1)+'/'+fs;that._initXHRData(o);that._initProgressListener(o);jqXHR=((that._trigger('chunksend',null,o)!==false&&$.ajax(o))||that._getXHRPromise(false,o.context)).done(function(result,textStatus,jqXHR){ub=that._getUploadedBytes(jqXHR)||(ub+o.chunkSize);if(currentLoaded+o.chunkSize-o._progress.loaded){that._onProgress($.Event('progress',{lengthComputable:true,loaded:ub-o.uploadedBytes,total:ub-o.uploadedBytes}),o);}
options.uploadedBytes=o.uploadedBytes=ub;o.result=result;o.textStatus=textStatus;o.jqXHR=jqXHR;that._trigger('chunkdone',null,o);that._trigger('chunkalways',null,o);if(ub<fs){upload();}else{dfd.resolveWith(o.context,[result,textStatus,jqXHR]);}}).fail(function(jqXHR,textStatus,errorThrown){o.jqXHR=jqXHR;o.textStatus=textStatus;o.errorThrown=errorThrown;that._trigger('chunkfail',null,o);that._trigger('chunkalways',null,o);dfd.rejectWith(o.context,[jqXHR,textStatus,errorThrown]);});};this._enhancePromise(promise);promise.abort=function(){return jqXHR.abort();};upload();return promise;},_beforeSend:function(e,data){if(this._active===0){this._trigger('start');this._bitrateTimer=new this._BitrateTimer();this._progress.loaded=this._progress.total=0;this._progress.bitrate=0;}
this._initResponseObject(data);this._initProgressObject(data);data._progress.loaded=data.loaded=data.uploadedBytes||0;data._progress.total=data.total=this._getTotal(data.files)||1;data._progress.bitrate=data.bitrate=0;this._active+=1;this._progress.loaded+=data.loaded;this._progress.total+=data.total;},_onDone:function(result,textStatus,jqXHR,options){var total=options._progress.total,response=options._response;if(options._progress.loaded<total){this._onProgress($.Event('progress',{lengthComputable:true,loaded:total,total:total}),options);}
response.result=options.result=result;response.textStatus=options.textStatus=textStatus;response.jqXHR=options.jqXHR=jqXHR;this._trigger('done',null,options);},_onFail:function(jqXHR,textStatus,errorThrown,options){var response=options._response;if(options.recalculateProgress){this._progress.loaded-=options._progress.loaded;this._progress.total-=options._progress.total;}
response.jqXHR=options.jqXHR=jqXHR;response.textStatus=options.textStatus=textStatus;response.errorThrown=options.errorThrown=errorThrown;this._trigger('fail',null,options);},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._trigger('always',null,options);},_onSend:function(e,data){if(!data.submit){this._addConvenienceMethods(e,data);}
var that=this,jqXHR,aborted,slot,pipe,options=that._getAJAXSettings(data),send=function(){that._sending+=1;options._bitrateTimer=new that._BitrateTimer();jqXHR=jqXHR||(((aborted||that._trigger('send',$.Event('send',{delegatedEvent:e}),options)===false)&&that._getXHRPromise(false,options.context,aborted))||that._chunkedUpload(options)||$.ajax(options)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options);}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options);}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);that._sending-=1;that._active-=1;if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(that._getDeferredState(nextSlot)==='pending'){nextSlot.resolve();break;}
nextSlot=that._slots.shift();}}
if(that._active===0){that._trigger('stop');}});return jqXHR;};this._beforeSend(e,options);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){slot=$.Deferred();this._slots.push(slot);pipe=slot.then(send);}else{this._sequence=this._sequence.then(send,send);pipe=this._sequence;}
pipe.abort=function(){aborted=[undefined,'abort','abort'];if(!jqXHR){if(slot){slot.rejectWith(options.context,aborted);}
return send();}
return jqXHR.abort();};return this._enhancePromise(pipe);}
return send();},_onAdd:function(e,data){var that=this,result=true,options=$.extend({},this.options,data),files=data.files,filesLength=files.length,limit=options.limitMultiFileUploads,limitSize=options.limitMultiFileUploadSize,overhead=options.limitMultiFileUploadSizeOverhead,batchSize=0,paramName=this._getParamName(options),paramNameSet,paramNameSlice,fileSet,i,j=0;if(!filesLength){return false;}
if(limitSize&&files[0].size===undefined){limitSize=undefined;}
if(!(options.singleFileUploads||limit||limitSize)||!this._isXHRUpload(options)){fileSet=[files];paramNameSet=[paramName];}else if(!(options.singleFileUploads||limitSize)&&limit){fileSet=[];paramNameSet=[];for(i=0;i<filesLength;i+=limit){fileSet.push(files.slice(i,i+limit));paramNameSlice=paramName.slice(i,i+limit);if(!paramNameSlice.length){paramNameSlice=paramName;}
paramNameSet.push(paramNameSlice);}}else if(!options.singleFileUploads&&limitSize){fileSet=[];paramNameSet=[];for(i=0;i<filesLength;i=i+1){batchSize+=files[i].size+overhead;if(i+1===filesLength||((batchSize+files[i+1].size+overhead)>limitSize)||(limit&&i+1-j>=limit)){fileSet.push(files.slice(j,i+1));paramNameSlice=paramName.slice(j,i+1);if(!paramNameSlice.length){paramNameSlice=paramName;}
paramNameSet.push(paramNameSlice);j=i+1;batchSize=0;}}}else{paramNameSet=paramName;}
data.originalFiles=files;$.each(fileSet||files,function(index,element){var newData=$.extend({},data);newData.files=fileSet?element:[element];newData.paramName=paramNameSet[index];that._initResponseObject(newData);that._initProgressObject(newData);that._addConvenienceMethods(e,newData);result=that._trigger('add',$.Event('add',{delegatedEvent:e}),newData);return result;});return result;},_replaceFileInput:function(data){var input=data.fileInput,inputClone=input.clone(true),restoreFocus=input.is(document.activeElement);data.fileInputClone=inputClone;$('<form></form>').append(inputClone)[0].reset();input.after(inputClone).detach();if(restoreFocus){inputClone.focus();}
$.cleanData(input.unbind('remove'));this.options.fileInput=this.options.fileInput.map(function(i,el){if(el===input[0]){return inputClone[0];}
return el;});if(input[0]===this.element[0]){this.element=inputClone;}},_handleFileTreeEntry:function(entry,path){var that=this,dfd=$.Deferred(),entries=[],dirReader,errorHandler=function(e){if(e&&!e.entry){e.entry=entry;}
dfd.resolve([e]);},successHandler=function(entries){that._handleFileTreeEntries(entries,path+entry.name+'/').done(function(files){dfd.resolve(files);}).fail(errorHandler);},readEntries=function(){dirReader.readEntries(function(results){if(!results.length){successHandler(entries);}else{entries=entries.concat(results);readEntries();}},errorHandler);};path=path||'';if(entry.isFile){if(entry._file){entry._file.relativePath=path;dfd.resolve(entry._file);}else{entry.file(function(file){file.relativePath=path;dfd.resolve(file);},errorHandler);}}else if(entry.isDirectory){dirReader=entry.createReader();readEntries();}else{dfd.resolve([]);}
return dfd.promise();},_handleFileTreeEntries:function(entries,path){var that=this;return $.when.apply($,$.map(entries,function(entry){return that._handleFileTreeEntry(entry,path);})).then(function(){return Array.prototype.concat.apply([],arguments);});},_getDroppedFiles:function(dataTransfer){dataTransfer=dataTransfer||{};var items=dataTransfer.items;if(items&&items.length&&(items[0].webkitGetAsEntry||items[0].getAsEntry)){return this._handleFileTreeEntries($.map(items,function(item){var entry;if(item.webkitGetAsEntry){entry=item.webkitGetAsEntry();if(entry){entry._file=item.getAsFile();}
return entry;}
return item.getAsEntry();}));}
return $.Deferred().resolve($.makeArray(dataTransfer.files)).promise();},_getSingleFileInputFiles:function(fileInput){fileInput=$(fileInput);var entries=fileInput.prop('webkitEntries')||fileInput.prop('entries'),files,value;if(entries&&entries.length){return this._handleFileTreeEntries(entries);}
files=$.makeArray(fileInput.prop('files'));if(!files.length){value=fileInput.prop('value');if(!value){return $.Deferred().resolve([]).promise();}
files=[{name:value.replace(/^.*\\/,'')}];}else if(files[0].name===undefined&&files[0].fileName){$.each(files,function(index,file){file.name=file.fileName;file.size=file.fileSize;});}
return $.Deferred().resolve(files).promise();},_getFileInputFiles:function(fileInput){if(!(fileInput instanceof $)||fileInput.length===1){return this._getSingleFileInputFiles(fileInput);}
return $.when.apply($,$.map(fileInput,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments);});},_onChange:function(e){var that=this,data={fileInput:$(e.target),form:$(e.target.form)};this._getFileInputFiles(data.fileInput).always(function(files){data.files=files;if(that.options.replaceFileInput){that._replaceFileInput(data);}
if(that._trigger('change',$.Event('change',{delegatedEvent:e}),data)!==false){that._onAdd(e,data);}});},_onPaste:function(e){var items=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,data={files:[]};if(items&&items.length){$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();if(file){data.files.push(file);}});if(this._trigger('paste',$.Event('paste',{delegatedEvent:e}),data)!==false){this._onAdd(e,data);}}},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var that=this,dataTransfer=e.dataTransfer,data={};if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length){e.preventDefault();this._getDroppedFiles(dataTransfer).always(function(files){data.files=files;if(that._trigger('drop',$.Event('drop',{delegatedEvent:e}),data)!==false){that._onAdd(e,data);}});}},_onDragOver:getDragHandler('dragover'),_onDragEnter:getDragHandler('dragenter'),_onDragLeave:getDragHandler('dragleave'),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste});}
if($.support.fileInput){this._on(this.options.fileInput,{change:this._onChange});}},_destroyEventHandlers:function(){this._off(this.options.dropZone,'dragenter dragleave dragover drop');this._off(this.options.pasteZone,'paste');this._off(this.options.fileInput,'change');},_destroy:function(){this._destroyEventHandlers();},_setOption:function(key,value){var reinit=$.inArray(key,this._specialOptions)!==-1;if(reinit){this._destroyEventHandlers();}
this._super(key,value);if(reinit){this._initSpecialOptions();this._initEventHandlers();}},_initSpecialOptions:function(){var options=this.options;if(options.fileInput===undefined){options.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');}else if(!(options.fileInput instanceof $)){options.fileInput=$(options.fileInput);}
if(!(options.dropZone instanceof $)){options.dropZone=$(options.dropZone);}
if(!(options.pasteZone instanceof $)){options.pasteZone=$(options.pasteZone);}},_getRegExp:function(str){var parts=str.split('/'),modifiers=parts.pop();parts.shift();return new RegExp(parts.join('/'),modifiers);},_isRegExpOption:function(key,value){return key!=='url'&&$.type(value)==='string'&&/^\/.*\/[igm]{0,3}$/.test(value);},_initDataAttributes:function(){var that=this,options=this.options,data=this.element.data();$.each(this.element[0].attributes,function(index,attr){var key=attr.name.toLowerCase(),value;if(/^data-/.test(key)){key=key.slice(5).replace(/-[a-z]/g,function(str){return str.charAt(1).toUpperCase();});value=data[key];if(that._isRegExpOption(key,value)){value=that._getRegExp(value);}
options[key]=value;}});},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers();},active:function(){return this._active;},progress:function(){return this._progress;},add:function(data){var that=this;if(!data||this.options.disabled){return;}
if(data.fileInput&&!data.files){this._getFileInputFiles(data.fileInput).always(function(files){data.files=files;that._onAdd(null,data);});}else{data.files=$.makeArray(data.files);this._onAdd(null,data);}},send:function(data){if(data&&!this.options.disabled){if(data.fileInput&&!data.files){var that=this,dfd=$.Deferred(),promise=dfd.promise(),jqXHR,aborted;promise.abort=function(){aborted=true;if(jqXHR){return jqXHR.abort();}
dfd.reject(null,'abort','abort');return promise;};this._getFileInputFiles(data.fileInput).always(function(files){if(aborted){return;}
if(!files.length){dfd.reject();return;}
data.files=files;jqXHR=that._onSend(null,data);jqXHR.then(function(result,textStatus,jqXHR){dfd.resolve(result,textStatus,jqXHR);},function(jqXHR,textStatus,errorThrown){dfd.reject(jqXHR,textStatus,errorThrown);});});return this._enhancePromise(promise);}
data.files=$.makeArray(data.files);if(data.files.length){return this._onSend(null,data);}}
return this._getXHRPromise(false,data&&data.context);}});}));;(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery','./jquery.fileupload'],factory);}else if(typeof exports==='object'){factory(require('jquery'),require('./jquery.fileupload'));}else{factory(window.jQuery);}}(function($){'use strict';var originalAdd=$.blueimp.fileupload.prototype.options.add;$.widget('blueimp.fileupload',$.blueimp.fileupload,{options:{processQueue:[],add:function(e,data){var $this=$(this);data.process(function(){return $this.fileupload('process',data);});originalAdd.call(this,e,data);}},processActions:{},_processFile:function(data,originalData){var that=this,dfd=$.Deferred().resolveWith(that,[data]),chain=dfd.promise();this._trigger('process',null,data);$.each(data.processQueue,function(i,settings){var func=function(data){if(originalData.errorThrown){return $.Deferred().rejectWith(that,[originalData]).promise();}
return that.processActions[settings.action].call(that,data,settings);};chain=chain.then(func,settings.always&&func);});chain.done(function(){that._trigger('processdone',null,data);that._trigger('processalways',null,data);}).fail(function(){that._trigger('processfail',null,data);that._trigger('processalways',null,data);});return chain;},_transformProcessQueue:function(options){var processQueue=[];$.each(options.processQueue,function(){var settings={},action=this.action,prefix=this.prefix===true?action:this.prefix;$.each(this,function(key,value){if($.type(value)==='string'&&value.charAt(0)==='@'){settings[key]=options[value.slice(1)||(prefix?prefix+
key.charAt(0).toUpperCase()+key.slice(1):key)];}else{settings[key]=value;}});processQueue.push(settings);});options.processQueue=processQueue;},processing:function(){return this._processing;},process:function(data){var that=this,options=$.extend({},this.options,data);if(options.processQueue&&options.processQueue.length){this._transformProcessQueue(options);if(this._processing===0){this._trigger('processstart');}
$.each(data.files,function(index){var opts=index?$.extend({},options):options,func=function(){if(data.errorThrown){return $.Deferred().rejectWith(that,[data]).promise();}
return that._processFile(opts,data);};opts.index=index;that._processing+=1;that._processingQueue=that._processingQueue.then(func,func).always(function(){that._processing-=1;if(that._processing===0){that._trigger('processstop');}});});}
return this._processingQueue;},_create:function(){this._super();this._processing=0;this._processingQueue=$.Deferred().resolveWith(this).promise();}});}));;(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery','./jquery.fileupload-process'],factory);}else if(typeof exports==='object'){factory(require('jquery'),require('./jquery.fileupload-process'));}else{factory(window.jQuery);}}(function($){'use strict';$.blueimp.fileupload.prototype.options.processQueue.push({action:'validate',always:true,acceptFileTypes:'@',maxFileSize:'@',minFileSize:'@',maxNumberOfFiles:'@',disabled:'@disableValidation'});$.widget('blueimp.fileupload',$.blueimp.fileupload,{options:{getNumberOfFiles:$.noop,messages:{maxNumberOfFiles:'Maximum number of files exceeded',acceptFileTypes:'File type not allowed',maxFileSize:'File is too large',minFileSize:'File is too small'}},processActions:{validate:function(data,options){if(options.disabled){return data;}
var dfd=$.Deferred(),settings=this.options,file=data.files[data.index],fileSize;if(options.minFileSize||options.maxFileSize){fileSize=file.size;}
if($.type(options.maxNumberOfFiles)==='number'&&(settings.getNumberOfFiles()||0)+data.files.length>options.maxNumberOfFiles){file.error=settings.i18n('maxNumberOfFiles');}else if(options.acceptFileTypes&&!(options.acceptFileTypes.test(file.type)||options.acceptFileTypes.test(file.name))){file.error=settings.i18n('acceptFileTypes');}else if(fileSize>options.maxFileSize){file.error=settings.i18n('maxFileSize');}else if($.type(fileSize)==='number'&&fileSize<options.minFileSize){file.error=settings.i18n('minFileSize');}else{delete file.error;}
if(file.error||data.files.error){data.files.error=true;dfd.rejectWith(this,[data]);}else{dfd.resolveWith(this,[data]);}
return dfd.promise();}}});}));;(function(root,factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(root.jQuery);}}(this,function($){'use strict';var debug=false;var browser={data:{index:0,name:'scrollbar'},macosx:/mac/i.test(navigator.platform),mobile:/android|webos|iphone|ipad|ipod|blackberry/i.test(navigator.userAgent),overlay:null,scroll:null,scrolls:[],webkit:/webkit/i.test(navigator.userAgent)&&!/edge\/\d+/i.test(navigator.userAgent),mozilla:/mozilla/i.test(navigator.userAgent)};browser.scrolls.add=function(instance){this.remove(instance).push(instance);};browser.scrolls.remove=function(instance){while($.inArray(instance,this)>=0){this.splice($.inArray(instance,this),1);}
return this;};var defaults={'autoScrollSize':true,'autoUpdate':true,'debug':false,'disableBodyScroll':false,'duration':200,'ignoreMobile':false,'ignoreOverlay':false,'scrollStep':30,'showArrows':false,'stepScrolling':true,'scrollx':null,'scrolly':null,'onDestroy':null,'onInit':null,'onScroll':null,'onUpdate':null};var BaseScrollbar=function(container){if(!browser.scroll){browser.overlay=isScrollOverlaysContent();browser.scroll=getBrowserScrollSize();updateScrollbars();$(window).resize(function(){var forceUpdate=false;if(browser.scroll&&(browser.scroll.height||browser.scroll.width)){var scroll=getBrowserScrollSize();if(scroll.height!==browser.scroll.height||scroll.width!==browser.scroll.width){browser.scroll=scroll;forceUpdate=true;}}
updateScrollbars(forceUpdate);});}
this.container=container;this.namespace='.scrollbar_'+browser.data.index++;this.options=$.extend({},defaults,window.jQueryScrollbarOptions||{});this.scrollTo=null;this.scrollx={};this.scrolly={};container.data(browser.data.name,this);browser.scrolls.add(this);};BaseScrollbar.prototype={destroy:function(){if(!this.wrapper){return;}
this.container.removeData(browser.data.name);browser.scrolls.remove(this);var scrollLeft=this.container.scrollLeft();var scrollTop=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({'height':'','margin':'','max-height':''}).removeClass('scroll-content scroll-scrollx_visible scroll-scrolly_visible').off(this.namespace).scrollLeft(scrollLeft).scrollTop(scrollTop);this.scrollx.scroll.removeClass('scroll-scrollx_visible').find('div').andSelf().off(this.namespace);this.scrolly.scroll.removeClass('scroll-scrolly_visible').find('div').andSelf().off(this.namespace);this.wrapper.remove();$(document).add('body').off(this.namespace);if($.isFunction(this.options.onDestroy)){this.options.onDestroy.apply(this,[this.container]);}},init:function(options){var S=this,c=this.container,cw=this.containerWrapper||c,namespace=this.namespace,o=$.extend(this.options,options||{}),s={x:this.scrollx,y:this.scrolly},w=this.wrapper;var initScroll={'scrollLeft':c.scrollLeft(),'scrollTop':c.scrollTop()};if((browser.mobile&&o.ignoreMobile)||(browser.overlay&&o.ignoreOverlay)||(browser.macosx&&!browser.webkit)){return false;}
if(!w){this.wrapper=w=$('<div>').addClass('scroll-wrapper').addClass(c.attr('class')).css('position',c.css('position')=='absolute'?'absolute':'relative').insertBefore(c).append(c);if(c.is('textarea')){this.containerWrapper=cw=$('<div>').insertBefore(c).append(c);w.addClass('scroll-textarea');}
cw.addClass('scroll-content').css({'height':'auto','margin-bottom':browser.scroll.height*-1+'px','margin-right':browser.scroll.width*-1+'px','max-height':browser.mozilla?w.height()+browser.scroll.height:''});c.on('scroll'+namespace,function(event){if($.isFunction(o.onScroll)){o.onScroll.call(S,{'maxScroll':s.y.maxScrollOffset,'scroll':c.scrollTop(),'size':s.y.size,'visible':s.y.visible},{'maxScroll':s.x.maxScrollOffset,'scroll':c.scrollLeft(),'size':s.x.size,'visible':s.x.visible});}
s.x.isVisible&&s.x.scroll.bar.css('left',c.scrollLeft()*s.x.kx+'px');s.y.isVisible&&s.y.scroll.bar.css('top',c.scrollTop()*s.y.kx+'px');});w.on('scroll'+namespace,function(){w.scrollTop(0).scrollLeft(0);});if(o.disableBodyScroll){var handleMouseScroll=function(event){isVerticalScroll(event)?s.y.isVisible&&s.y.mousewheel(event):s.x.isVisible&&s.x.mousewheel(event);};w.on('MozMousePixelScroll'+namespace,handleMouseScroll);w.on('mousewheel'+namespace,handleMouseScroll);if(browser.mobile){w.on('touchstart'+namespace,function(event){var touch=event.originalEvent.touches&&event.originalEvent.touches[0]||event;var originalTouch={'pageX':touch.pageX,'pageY':touch.pageY};var originalScroll={'left':c.scrollLeft(),'top':c.scrollTop()};$(document).on('touchmove'+namespace,function(event){var touch=event.originalEvent.targetTouches&&event.originalEvent.targetTouches[0]||event;c.scrollLeft(originalScroll.left+originalTouch.pageX-touch.pageX);c.scrollTop(originalScroll.top+originalTouch.pageY-touch.pageY);event.preventDefault();});$(document).on('touchend'+namespace,function(){$(document).off(namespace);});});}}
if($.isFunction(o.onInit)){o.onInit.apply(this,[c]);}}else{cw.css({'height':'auto','margin-bottom':browser.scroll.height*-1+'px','margin-right':browser.scroll.width*-1+'px','max-height':browser.mozilla?w.height()+browser.scroll.height:''});}
if(c.is('textarea')){cw.css({'height':(w.height()+browser.scroll.height)+'px'});}
$.each(s,function(d,scrollx){var scrollCallback=null;var scrollForward=1;var scrollOffset=(d==='x')?'scrollLeft':'scrollTop';var scrollStep=o.scrollStep;var scrollTo=function(){var currentOffset=c[scrollOffset]();c[scrollOffset](currentOffset+scrollStep);if(scrollForward==1&&(currentOffset+scrollStep)>=scrollToValue)
currentOffset=c[scrollOffset]();if(scrollForward==-1&&(currentOffset+scrollStep)<=scrollToValue)
currentOffset=c[scrollOffset]();if(c[scrollOffset]()==currentOffset&&scrollCallback){scrollCallback();}};var scrollToValue=0;if(!scrollx.scroll){scrollx.scroll=S._getScroll(o['scroll'+d]).addClass('scroll-'+d);if(o.showArrows){scrollx.scroll.addClass('scroll-element_arrows_visible');}
scrollx.mousewheel=function(event){if(!scrollx.isVisible||(d==='x'&&isVerticalScroll(event))){return true;}
if(d==='y'&&!isVerticalScroll(event)){s.x.mousewheel(event);return true;}
var delta=event.originalEvent.wheelDelta*-1||event.originalEvent.detail;var maxScrollValue=scrollx.size-scrollx.visible-scrollx.offset;if((delta>0&&scrollToValue<maxScrollValue)||(delta<0&&scrollToValue>0)){scrollToValue=scrollToValue+delta;if(scrollToValue<0)
scrollToValue=0;if(scrollToValue>maxScrollValue)
scrollToValue=maxScrollValue;S.scrollTo=S.scrollTo||{};S.scrollTo[scrollOffset]=scrollToValue;setTimeout(function(){if(S.scrollTo){c.stop().animate(S.scrollTo,240,'linear',function(){scrollToValue=c[scrollOffset]();});S.scrollTo=null;}},1);}
event.preventDefault();return false;};scrollx.scroll.on('MozMousePixelScroll'+namespace,scrollx.mousewheel).on('mousewheel'+namespace,scrollx.mousewheel).on('mouseenter'+namespace,function(){scrollToValue=c[scrollOffset]();});scrollx.scroll.find('.scroll-arrow, .scroll-element_track').on('mousedown'+namespace,function(event){if(event.which!=1)
return true;scrollForward=1;var data={'eventOffset':event[(d==='x')?'pageX':'pageY'],'maxScrollValue':scrollx.size-scrollx.visible-scrollx.offset,'scrollbarOffset':scrollx.scroll.bar.offset()[(d==='x')?'left':'top'],'scrollbarSize':scrollx.scroll.bar[(d==='x')?'outerWidth':'outerHeight']()};var timeout=0,timer=0;if($(this).hasClass('scroll-arrow')){scrollForward=$(this).hasClass('scroll-arrow_more')?1:-1;scrollStep=o.scrollStep*scrollForward;scrollToValue=scrollForward>0?data.maxScrollValue:0;}else{scrollForward=(data.eventOffset>(data.scrollbarOffset+data.scrollbarSize)?1:(data.eventOffset<data.scrollbarOffset?-1:0));scrollStep=Math.round(scrollx.visible*0.75)*scrollForward;scrollToValue=(data.eventOffset-data.scrollbarOffset-
(o.stepScrolling?(scrollForward==1?data.scrollbarSize:0):Math.round(data.scrollbarSize/2)));scrollToValue=c[scrollOffset]()+(scrollToValue/scrollx.kx);}
S.scrollTo=S.scrollTo||{};S.scrollTo[scrollOffset]=o.stepScrolling?c[scrollOffset]()+scrollStep:scrollToValue;if(o.stepScrolling){scrollCallback=function(){scrollToValue=c[scrollOffset]();clearInterval(timer);clearTimeout(timeout);timeout=0;timer=0;};timeout=setTimeout(function(){timer=setInterval(scrollTo,40);},o.duration+100);}
setTimeout(function(){if(S.scrollTo){c.animate(S.scrollTo,o.duration);S.scrollTo=null;}},1);return S._handleMouseDown(scrollCallback,event);});scrollx.scroll.bar.on('mousedown'+namespace,function(event){if(event.which!=1)
return true;var eventPosition=event[(d==='x')?'pageX':'pageY'];var initOffset=c[scrollOffset]();scrollx.scroll.addClass('scroll-draggable');$(document).on('mousemove'+namespace,function(event){var diff=parseInt((event[(d==='x')?'pageX':'pageY']-eventPosition)/scrollx.kx,10);c[scrollOffset](initOffset+diff);});return S._handleMouseDown(function(){scrollx.scroll.removeClass('scroll-draggable');scrollToValue=c[scrollOffset]();},event);});}});$.each(s,function(d,scrollx){var scrollClass='scroll-scroll'+d+'_visible';var scrolly=(d=='x')?s.y:s.x;scrollx.scroll.removeClass(scrollClass);scrolly.scroll.removeClass(scrollClass);cw.removeClass(scrollClass);});$.each(s,function(d,scrollx){$.extend(scrollx,(d=='x')?{'offset':parseInt(c.css('left'),10)||0,'size':c.prop('scrollWidth'),'visible':w.width()}:{'offset':parseInt(c.css('top'),10)||0,'size':c.prop('scrollHeight'),'visible':w.height()});});this._updateScroll('x',this.scrollx);this._updateScroll('y',this.scrolly);if($.isFunction(o.onUpdate)){o.onUpdate.apply(this,[c]);}
$.each(s,function(d,scrollx){var cssOffset=(d==='x')?'left':'top';var cssFullSize=(d==='x')?'outerWidth':'outerHeight';var cssSize=(d==='x')?'width':'height';var offset=parseInt(c.css(cssOffset),10)||0;var AreaSize=scrollx.size;var AreaVisible=scrollx.visible+offset;var scrollSize=scrollx.scroll.size[cssFullSize]()+(parseInt(scrollx.scroll.size.css(cssOffset),10)||0);if(o.autoScrollSize){scrollx.scrollbarSize=parseInt(scrollSize*AreaVisible/AreaSize,10);scrollx.scroll.bar.css(cssSize,scrollx.scrollbarSize+'px');}
scrollx.scrollbarSize=scrollx.scroll.bar[cssFullSize]();scrollx.kx=((scrollSize-scrollx.scrollbarSize)/(AreaSize-AreaVisible))||1;scrollx.maxScrollOffset=AreaSize-AreaVisible;});c.scrollLeft(initScroll.scrollLeft).scrollTop(initScroll.scrollTop).trigger('scroll');},_getScroll:function(scroll){var types={advanced:['<div class="scroll-element">','<div class="scroll-element_corner"></div>','<div class="scroll-arrow scroll-arrow_less"></div>','<div class="scroll-arrow scroll-arrow_more"></div>','<div class="scroll-element_outer">','<div class="scroll-element_size"></div>','<div class="scroll-element_inner-wrapper">','<div class="scroll-element_inner scroll-element_track">','<div class="scroll-element_inner-bottom"></div>','</div>','</div>','<div class="scroll-bar">','<div class="scroll-bar_body">','<div class="scroll-bar_body-inner"></div>','</div>','<div class="scroll-bar_bottom"></div>','<div class="scroll-bar_center"></div>','</div>','</div>','</div>'].join(''),simple:['<div class="scroll-element">','<div class="scroll-element_outer">','<div class="scroll-element_size"></div>','<div class="scroll-element_track"></div>','<div class="scroll-bar"></div>','</div>','</div>'].join('')};if(types[scroll]){scroll=types[scroll];}
if(!scroll){scroll=types['simple'];}
if(typeof(scroll)=='string'){scroll=$(scroll).appendTo(this.wrapper);}else{scroll=$(scroll);}
$.extend(scroll,{bar:scroll.find('.scroll-bar'),size:scroll.find('.scroll-element_size'),track:scroll.find('.scroll-element_track')});return scroll;},_handleMouseDown:function(callback,event){var namespace=this.namespace;$(document).on('blur'+namespace,function(){$(document).add('body').off(namespace);callback&&callback();});$(document).on('dragstart'+namespace,function(event){event.preventDefault();return false;});$(document).on('mouseup'+namespace,function(){$(document).add('body').off(namespace);callback&&callback();});$('body').on('selectstart'+namespace,function(event){event.preventDefault();return false;});event&&event.preventDefault();return false;},_updateScroll:function(d,scrollx){var container=this.container,containerWrapper=this.containerWrapper||container,scrollClass='scroll-scroll'+d+'_visible',scrolly=(d==='x')?this.scrolly:this.scrollx,offset=parseInt(this.container.css((d==='x')?'left':'top'),10)||0,wrapper=this.wrapper;var AreaSize=scrollx.size
-((browser.mozilla&&d==='x'&&container.prop('scrollHeight')<72)?browser.scroll.width:0);var AreaVisible=scrollx.visible+offset;scrollx.isVisible=(AreaSize-AreaVisible)>2;if(scrollx.isVisible){scrollx.scroll.addClass(scrollClass);scrolly.scroll.addClass(scrollClass);containerWrapper.addClass(scrollClass);}else{scrollx.scroll.removeClass(scrollClass);scrolly.scroll.removeClass(scrollClass);containerWrapper.removeClass(scrollClass);}
if(d==='y'){if(container.is('textarea')||AreaSize<AreaVisible){containerWrapper.css({'height':(AreaVisible+browser.scroll.height)+'px','max-height':'none'});}else{containerWrapper.css({'max-height':(AreaVisible+browser.scroll.height)+'px'});}}
if(scrollx.size!=container.prop('scrollWidth')||scrolly.size!=container.prop('scrollHeight')||scrollx.visible!=wrapper.width()||scrolly.visible!=wrapper.height()||scrollx.offset!=(parseInt(container.css('left'),10)||0)||scrolly.offset!=(parseInt(container.css('top'),10)||0)){$.extend(this.scrollx,{'offset':parseInt(container.css('left'),10)||0,'size':container.prop('scrollWidth'),'visible':wrapper.width()});$.extend(this.scrolly,{'offset':parseInt(container.css('top'),10)||0,'size':this.container.prop('scrollHeight'),'visible':wrapper.height()});this._updateScroll(d==='x'?'y':'x',scrolly);}}};var CustomScrollbar=BaseScrollbar;$.fn.scrollbar=function(command,args){if(typeof command!=='string'){args=command;command='init';}
if(typeof args==='undefined'){args=[];}
if(!$.isArray(args)){args=[args];}
this.not('body, .scroll-wrapper').each(function(){var element=$(this),instance=element.data(browser.data.name);if(instance||command==='init'){if(!instance){instance=new CustomScrollbar(element);}
if(instance[command]){instance[command].apply(instance,args);}}});return this;};$.fn.scrollbar.options=defaults;var updateScrollbars=(function(){var timer=0,timerCounter=0;return function(force){var i,container,options,scroll,wrapper,scrollx,scrolly;for(i=0;i<browser.scrolls.length;i++){scroll=browser.scrolls[i];container=scroll.container;options=scroll.options;wrapper=scroll.wrapper;scrollx=scroll.scrollx;scrolly=scroll.scrolly;if(force||(options.autoUpdate&&wrapper&&wrapper.is(':visible')&&(container.prop('scrollWidth')!==scrollx.size||container.prop('scrollHeight')!==scrolly.size||wrapper.width()!==scrollx.visible||wrapper.height()!==scrolly.visible))){scroll.init();if(options.debug){window.console&&console.log({scrollHeight:container.prop('scrollHeight')+':'+scroll.scrolly.size,scrollWidth:container.prop('scrollWidth')+':'+scroll.scrollx.size,visibleHeight:wrapper.height()+':'+scroll.scrolly.visible,visibleWidth:wrapper.width()+':'+scroll.scrollx.visible},true);timerCounter++;}}}
if(debug&&timerCounter>10){window.console&&console.log('Scroll updates exceed 10');updateScrollbars=function(){};}else{clearTimeout(timer);timer=setTimeout(updateScrollbars,300);}};})();function getBrowserScrollSize(actualSize){if(browser.webkit&&!actualSize){return{'height':0,'width':0};}
if(!browser.data.outer){var css={'border':'none','box-sizing':'content-box','height':'200px','margin':'0','padding':'0','width':'200px'};browser.data.inner=$('<div>').css($.extend({},css));browser.data.outer=$('<div>').css($.extend({'left':'-1000px','overflow':'scroll','position':'absolute','top':'-1000px'},css)).append(browser.data.inner).appendTo('body');}
browser.data.outer.scrollLeft(1000).scrollTop(1000);return{'height':Math.ceil((browser.data.outer.offset().top-browser.data.inner.offset().top)||0),'width':Math.ceil((browser.data.outer.offset().left-browser.data.inner.offset().left)||0)};}
function isScrollOverlaysContent(){var scrollSize=getBrowserScrollSize(true);return!(scrollSize.height||scrollSize.width);}
function isVerticalScroll(event){var e=event.originalEvent;return!(e.axis&&e.axis===e.HORIZONTAL_AXIS||e.wheelDeltaX);}}));
/*!
 * jQuery.selection - jQuery Plugin
 *
 * Copyright (c) 2010-2014 IWASAKI Koji (@madapaja).
 * http://blog.madapaja.net/
 * Under The MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function($,win,doc){var _getCaretInfo=function(element){var res={text:'',start:0,end:0};if(!element.value){return res;}
try{if(win.getSelection){res.start=element.selectionStart;res.end=element.selectionEnd;res.text=element.value.slice(res.start,res.end);}else if(doc.selection){element.focus();var range=doc.selection.createRange(),range2=doc.body.createTextRange();res.text=range.text;try{range2.moveToElementText(element);range2.setEndPoint('StartToStart',range);}catch(e){range2=element.createTextRange();range2.setEndPoint('StartToStart',range);}
res.start=element.value.length-range2.text.length;res.end=res.start+range.text.length;}}catch(e){}
return res;};var _CaretOperation={getPos:function(element){var tmp=_getCaretInfo(element);return{start:tmp.start,end:tmp.end};},setPos:function(element,toRange,caret){caret=this._caretMode(caret);if(caret==='start'){toRange.end=toRange.start;}else if(caret==='end'){toRange.start=toRange.end;}
element.focus();try{if(element.createTextRange){var range=element.createTextRange();if(win.navigator.userAgent.toLowerCase().indexOf("msie")>=0){toRange.start=element.value.substr(0,toRange.start).replace(/\r/g,'').length;toRange.end=element.value.substr(0,toRange.end).replace(/\r/g,'').length;}
range.collapse(true);range.moveStart('character',toRange.start);range.moveEnd('character',toRange.end-toRange.start);range.select();}else if(element.setSelectionRange){element.setSelectionRange(toRange.start,toRange.end);}}catch(e){}},getText:function(element){return _getCaretInfo(element).text;},_caretMode:function(caret){caret=caret||"keep";if(caret===false){caret='end';}
switch(caret){case'keep':case'start':case'end':break;default:caret='keep';}
return caret;},replace:function(element,text,caret){var tmp=_getCaretInfo(element),orig=element.value,pos=$(element).scrollTop(),range={start:tmp.start,end:tmp.start+text.length};element.value=orig.substr(0,tmp.start)+text+orig.substr(tmp.end);$(element).scrollTop(pos);this.setPos(element,range,caret);},insertBefore:function(element,text,caret){var tmp=_getCaretInfo(element),orig=element.value,pos=$(element).scrollTop(),range={start:tmp.start+text.length,end:tmp.end+text.length};element.value=orig.substr(0,tmp.start)+text+orig.substr(tmp.start);$(element).scrollTop(pos);this.setPos(element,range,caret);},insertAfter:function(element,text,caret){var tmp=_getCaretInfo(element),orig=element.value,pos=$(element).scrollTop(),range={start:tmp.start,end:tmp.end};element.value=orig.substr(0,tmp.end)+text+orig.substr(tmp.end);$(element).scrollTop(pos);this.setPos(element,range,caret);}};$.extend({selection:function(mode){var getText=((mode||'text').toLowerCase()==='text');try{if(win.getSelection){if(getText){return win.getSelection().toString();}else{var sel=win.getSelection(),range;if(sel.getRangeAt){range=sel.getRangeAt(0);}else{range=doc.createRange();range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);}
return $('<div></div>').append(range.cloneContents()).html();}}else if(doc.selection){if(getText){return doc.selection.createRange().text;}else{return doc.selection.createRange().htmlText;}}}catch(e){}
return'';}});$.fn.extend({selection:function(mode,opts){opts=opts||{};switch(mode){case'getPos':return _CaretOperation.getPos(this[0]);case'setPos':return this.each(function(){_CaretOperation.setPos(this,opts);});case'replace':return this.each(function(){_CaretOperation.replace(this,opts.text,opts.caret);});case'insert':return this.each(function(){if(opts.mode==='before'){_CaretOperation.insertBefore(this,opts.text,opts.caret);}else{_CaretOperation.insertAfter(this,opts.text,opts.caret);}});case'get':default:return _CaretOperation.getText(this[0]);}
return this;}});})(jQuery,window,window.document);(function(root,factory){if(typeof define==='function'&&define.amd){define(['jquery'],function($){return(root.returnExportsGlobal=factory($));});}else if(typeof exports==='object'){module.exports=factory(require('jquery'));}else{factory(jQuery);}}(this,function($){'use strict';var EditableCaret,InputCaret,Mirror,Utils,methods,oDocument,oFrame,oWindow,pluginName,setContextBy;pluginName='caret';EditableCaret=(function(){function EditableCaret($inputor){this.$inputor=$inputor;this.domInputor=this.$inputor[0];}
EditableCaret.prototype.setPos=function(pos){var fn,found,offset,sel;if(sel=oWindow.getSelection()){offset=0;found=false;(fn=function(pos,parent){var node,range,_i,_len,_ref,_results;_ref=parent.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];if(found){break;}
if(node.nodeType===3){if(offset+node.length>=pos){found=true;range=oDocument.createRange();range.setStart(node,pos-offset);sel.removeAllRanges();sel.addRange(range);break;}else{_results.push(offset+=node.length);}}else{_results.push(fn(pos,node));}}
return _results;})(pos,this.domInputor);}
return this.domInputor;};EditableCaret.prototype.getIEPosition=function(){return this.getPosition();};EditableCaret.prototype.getPosition=function(){var inputor_offset,offset;offset=this.getOffset();inputor_offset=this.$inputor.offset();offset.left-=inputor_offset.left;offset.top-=inputor_offset.top;return offset;};EditableCaret.prototype.getOldIEPos=function(){var preCaretTextRange,textRange;textRange=oDocument.selection.createRange();preCaretTextRange=oDocument.body.createTextRange();preCaretTextRange.moveToElementText(this.domInputor);preCaretTextRange.setEndPoint('EndToEnd',textRange);return preCaretTextRange.text.length;};EditableCaret.prototype.getPos=function(){var clonedRange,pos,range;if(range=this.range()){clonedRange=range.cloneRange();clonedRange.selectNodeContents(this.domInputor);clonedRange.setEnd(range.endContainer,range.endOffset);pos=clonedRange.toString().length;clonedRange.detach();return pos;}else if(oDocument.selection){return this.getOldIEPos();}};EditableCaret.prototype.getOldIEOffset=function(){var range,rect;range=oDocument.selection.createRange().duplicate();range.moveStart('character',-1);rect=range.getBoundingClientRect();return{height:rect.bottom-rect.top,left:rect.left,top:rect.top};};EditableCaret.prototype.getOffset=function(pos){var clonedRange,offset,range,rect,shadowCaret;if(oWindow.getSelection&&(range=this.range())){if(range.endOffset-1>0&&range.endContainer!==this.domInputor){clonedRange=range.cloneRange();clonedRange.setStart(range.endContainer,range.endOffset-1);clonedRange.setEnd(range.endContainer,range.endOffset);rect=clonedRange.getBoundingClientRect();offset={height:rect.height,left:rect.left+rect.width,top:rect.top};clonedRange.detach();}
if(!offset||(offset!=null?offset.height:void 0)===0){clonedRange=range.cloneRange();shadowCaret=$(oDocument.createTextNode('|'));clonedRange.insertNode(shadowCaret[0]);clonedRange.selectNode(shadowCaret[0]);rect=clonedRange.getBoundingClientRect();offset={height:rect.height,left:rect.left,top:rect.top};shadowCaret.remove();clonedRange.detach();}}else if(oDocument.selection){offset=this.getOldIEOffset();}
if(offset){offset.top+=$(oWindow).scrollTop();offset.left+=$(oWindow).scrollLeft();}
return offset;};EditableCaret.prototype.range=function(){var sel;if(!oWindow.getSelection){return;}
sel=oWindow.getSelection();if(sel.rangeCount>0){return sel.getRangeAt(0);}else{return null;}};return EditableCaret;})();InputCaret=(function(){function InputCaret($inputor){this.$inputor=$inputor;this.domInputor=this.$inputor[0];}
InputCaret.prototype.getIEPos=function(){var endRange,inputor,len,normalizedValue,pos,range,textInputRange;inputor=this.domInputor;range=oDocument.selection.createRange();pos=0;if(range&&range.parentElement()===inputor){normalizedValue=inputor.value.replace(/\r\n/g,'\n');len=normalizedValue.length;textInputRange=inputor.createTextRange();textInputRange.moveToBookmark(range.getBookmark());endRange=inputor.createTextRange();endRange.collapse(false);if(textInputRange.compareEndPoints('StartToEnd',endRange)>-1){pos=len;}else{pos=-textInputRange.moveStart('character',-len);}}
return pos;};InputCaret.prototype.getPos=function(){if(oDocument.selection){return this.getIEPos();}else{return this.domInputor.selectionStart;}};InputCaret.prototype.setPos=function(pos){var inputor,range;inputor=this.domInputor;if(oDocument.selection){range=inputor.createTextRange();range.move('character',pos);range.select();}else if(inputor.setSelectionRange){inputor.setSelectionRange(pos,pos);}
return inputor;};InputCaret.prototype.getIEOffset=function(pos){var h,textRange,x,y;textRange=this.domInputor.createTextRange();pos||(pos=this.getPos());textRange.move('character',pos);x=textRange.boundingLeft;y=textRange.boundingTop;h=textRange.boundingHeight;return{left:x,top:y,height:h};};InputCaret.prototype.getOffset=function(pos){var $inputor,offset,position;$inputor=this.$inputor;if(oDocument.selection){offset=this.getIEOffset(pos);offset.top+=$(oWindow).scrollTop()+$inputor.scrollTop();offset.left+=$(oWindow).scrollLeft()+$inputor.scrollLeft();return offset;}else{offset=$inputor.offset();position=this.getPosition(pos);return offset={left:offset.left+position.left-$inputor.scrollLeft(),top:offset.top+position.top-$inputor.scrollTop(),height:position.height};}};InputCaret.prototype.getPosition=function(pos){var $inputor,at_rect,end_range,format,html,mirror,start_range;$inputor=this.$inputor;format=function(value){value=value.replace(/<|>|`|"|&/g,'?').replace(/\r\n|\r|\n/g,'<br/>');if(/firefox/i.test(navigator.userAgent)){value=value.replace(/\s/g,'&nbsp;');}
return value;};if(pos===void 0){pos=this.getPos();}
start_range=$inputor.val().slice(0,pos);end_range=$inputor.val().slice(pos);html="<span style='position: relative; display: inline;'>"+format(start_range)+"</span>";html+="<span id='caret' style='position: relative; display: inline;'>|</span>";html+="<span style='position: relative; display: inline;'>"+format(end_range)+"</span>";mirror=new Mirror($inputor);return at_rect=mirror.create(html).rect();};InputCaret.prototype.getIEPosition=function(pos){var h,inputorOffset,offset,x,y;offset=this.getIEOffset(pos);inputorOffset=this.$inputor.offset();x=offset.left-inputorOffset.left;y=offset.top-inputorOffset.top;h=offset.height;return{left:x,top:y,height:h};};return InputCaret;})();Mirror=(function(){Mirror.prototype.css_attr=['borderBottomWidth','borderLeftWidth','borderRightWidth','borderTopStyle','borderRightStyle','borderBottomStyle','borderLeftStyle','borderTopWidth','boxSizing','fontFamily','fontSize','fontWeight','height','letterSpacing','lineHeight','marginBottom','marginLeft','marginRight','marginTop','outlineWidth','overflow','overflowX','overflowY','paddingBottom','paddingLeft','paddingRight','paddingTop','textAlign','textOverflow','textTransform','whiteSpace','wordBreak','wordWrap'];function Mirror($inputor){this.$inputor=$inputor;}
Mirror.prototype.mirrorCss=function(){var css,_this=this;css={position:'absolute',left:-9999,top:0,zIndex:-20000};if(this.$inputor.prop('tagName')==='TEXTAREA'){this.css_attr.push('width');}
$.each(this.css_attr,function(i,p){return css[p]=_this.$inputor.css(p);});return css;};Mirror.prototype.create=function(html){this.$mirror=$('<div></div>');this.$mirror.css(this.mirrorCss());this.$mirror.html(html);this.$inputor.after(this.$mirror);return this;};Mirror.prototype.rect=function(){var $flag,pos,rect;$flag=this.$mirror.find('#caret');pos=$flag.position();rect={left:pos.left,top:pos.top,height:$flag.height()};this.$mirror.remove();return rect;};return Mirror;})();Utils={contentEditable:function($inputor){return!!($inputor[0].contentEditable&&$inputor[0].contentEditable==='true');}};methods={pos:function(pos){if(pos||pos===0){return this.setPos(pos);}else{return this.getPos();}},position:function(pos){if(oDocument.selection){return this.getIEPosition(pos);}else{return this.getPosition(pos);}},offset:function(pos){var offset;offset=this.getOffset(pos);return offset;}};oDocument=null;oWindow=null;oFrame=null;setContextBy=function(settings){var iframe;if(iframe=settings!=null?settings.iframe:void 0){oFrame=iframe;oWindow=iframe.contentWindow;return oDocument=iframe.contentDocument||oWindow.document;}else{oFrame=void 0;oWindow=window;return oDocument=document;}};$.fn.caret=function(method,value,settings){var caret;if(methods[method]){if($.isPlainObject(value)){setContextBy(value);value=void 0;}else{setContextBy(settings);}
caret=Utils.contentEditable(this)?new EditableCaret(this):new InputCaret(this);return methods[method].apply(caret,[value]);}else{return $.error('Method '+method+' does not exist on jQuery.caret');}};$.fn.caret.EditableCaret=EditableCaret;$.fn.caret.InputCaret=InputCaret;$.fn.caret.Utils=Utils;$.fn.caret.apis=methods;}));(function($){$.fn.selectToUl=function(options){var jSelect=$(this);jSelect.hide();var jUl=options.targetUl;var jLiTemplate=jUl.find('li').remove();var addNewOption=function(option){var jOption=$(option);var jLi=jLiTemplate.clone();jLi.data('value',jOption.val());jLi.find('[data-webim-field="department-name"]').text(jOption.text());if(jOption.data('webimSelectToUl')){if(jOption.data('webimSelectToUl')['class']){jLi.attr('class',jOption.data('webimSelectToUl')['class']);}
if(jOption.data('webimSelectToUl')['logo']){jLi.find('[data-webim-field="department-logo"]').attr('src',jOption.data('webimSelectToUl')['logo']);}}
jLi.click(function(e){e.preventDefault();jSelect.val($(e.target).closest('li').data('value')).trigger('change');});jUl.append(jLi);};var fullFillUl=function(){jSelect.children('option').each(function(i){addNewOption(this);});}.webimBind(this);fullFillUl();jSelect.bind('afterAdd',function(e,item){addNewOption(item);});jSelect.change(function(e){e.preventDefault();jUl.empty();fullFillUl();});};}(jQuery));
/*!
 * modernizr v3.5.0
 * Build https://modernizr.com/download?-audio-contenteditable-cssgradients-websockets-hasevent-mq-setclasses-dontmin
 *
 * Copyright (c)
 *  Faruk Ates
 *  Paul Irish
 *  Alex Sexton
 *  Ryan Seddon
 *  Patrick Kettner
 *  Stu Cox
 *  Richard Herrera

 * MIT License
 */
;(function(window,document,undefined){var classes=[];var tests=[];var ModernizrProto={_version:'3.5.0',_config:{'classPrefix':'','enableClasses':true,'enableJSClass':true,'usePrefixes':true},_q:[],on:function(test,cb){var self=this;setTimeout(function(){cb(self[test]);},0);},addTest:function(name,fn,options){tests.push({name:name,fn:fn,options:options});},addAsyncTest:function(fn){tests.push({name:null,fn:fn});}};var Modernizr=function(){};Modernizr.prototype=ModernizrProto;Modernizr=new Modernizr();
/*!
     {
     "name": "WebSockets Support",
     "property": "websockets",
     "authors": ["Phread [fearphage]", "Mike Sherov [mikesherov]", "Burak Yigit Kaya [BYK]"],
     "caniuse": "websockets",
     "tags": ["html5"],
     "warnings": [
     "This test will reject any old version of WebSockets even if it is not prefixed such as in Safari 5.1"
     ],
     "notes": [{
     "name": "CLOSING State and Spec",
     "href": "https://www.w3.org/TR/websockets/#the-websocket-interface"
     }],
     "polyfills": [
     "sockjs",
     "socketio",
     "kaazing-websocket-gateway",
     "websocketjs",
     "atmosphere",
     "graceful-websocket",
     "portal",
     "datachannel"
     ]
     }
     !*/
var supports=false;try{supports='WebSocket'in window&&window.WebSocket.CLOSING===2;}catch(e){}
Modernizr.addTest('websockets',supports);function is(obj,type){return typeof obj===type;};function testRunner(){var featureNames;var feature;var aliasIdx;var result;var nameIdx;var featureName;var featureNameSplit;for(var featureIdx in tests){if(tests.hasOwnProperty(featureIdx)){featureNames=[];feature=tests[featureIdx];if(feature.name){featureNames.push(feature.name.toLowerCase());if(feature.options&&feature.options.aliases&&feature.options.aliases.length){for(aliasIdx=0;aliasIdx<feature.options.aliases.length;aliasIdx++){featureNames.push(feature.options.aliases[aliasIdx].toLowerCase());}}}
result=is(feature.fn,'function')?feature.fn():feature.fn;for(nameIdx=0;nameIdx<featureNames.length;nameIdx++){featureName=featureNames[nameIdx];featureNameSplit=featureName.split('.');if(featureNameSplit.length===1){Modernizr[featureNameSplit[0]]=result;}else{if(Modernizr[featureNameSplit[0]]&&!(Modernizr[featureNameSplit[0]]instanceof Boolean)){Modernizr[featureNameSplit[0]]=new Boolean(Modernizr[featureNameSplit[0]]);}
Modernizr[featureNameSplit[0]][featureNameSplit[1]]=result;}
classes.push((result?'':'no-')+featureNameSplit.join('-'));}}}};var docElement=document.documentElement;var isSVG=docElement.nodeName.toLowerCase()==='svg';function setClasses(classes){var className=docElement.className;var classPrefix=Modernizr._config.classPrefix||'';if(isSVG){className=className.baseVal;}
if(Modernizr._config.enableJSClass){var reJS=new RegExp('(^|\\s)'+classPrefix+'no-js(\\s|$)');className=className.replace(reJS,'$1'+classPrefix+'js$2');}
if(Modernizr._config.enableClasses){className+=' '+classPrefix+classes.join(' '+classPrefix);if(isSVG){docElement.className.baseVal=className;}else{docElement.className=className;}}};function createElement(){if(typeof document.createElement!=='function'){return document.createElement(arguments[0]);}else if(isSVG){return document.createElementNS.call(document,'http://www.w3.org/2000/svg',arguments[0]);}else{return document.createElement.apply(document,arguments);}};var hasEvent=(function(){var needsFallback=!('onblur'in document.documentElement);function inner(eventName,element){var isSupported;if(!eventName){return false;}
if(!element||typeof element==='string'){element=createElement(element||'div');}
eventName='on'+eventName;isSupported=eventName in element;if(!isSupported&&needsFallback){if(!element.setAttribute){element=createElement('div');}
element.setAttribute(eventName,'');isSupported=typeof element[eventName]==='function';if(element[eventName]!==undefined){element[eventName]=undefined;}
element.removeAttribute(eventName);}
return isSupported;}
return inner;})();ModernizrProto.hasEvent=hasEvent;
/*!
     {
     "name" : "HTML5 Audio Element",
     "property": "audio",
     "tags" : ["html5", "audio", "media"]
     }
     !*/
Modernizr.addTest('audio',function(){var elem=createElement('audio');var bool=false;try{bool=!!elem.canPlayType
if(bool){bool=new Boolean(bool);bool.ogg=elem.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,'');bool.mp3=elem.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,'');bool.opus=elem.canPlayType('audio/ogg; codecs="opus"')||elem.canPlayType('audio/webm; codecs="opus"').replace(/^no$/,'');bool.wav=elem.canPlayType('audio/wav; codecs="1"').replace(/^no$/,'');bool.m4a=(elem.canPlayType('audio/x-m4a;')||elem.canPlayType('audio/aac;')).replace(/^no$/,'');}}catch(e){}
return bool;});var prefixes=(ModernizrProto._config.usePrefixes?' -webkit- -moz- -o- -ms- '.split(' '):['','']);ModernizrProto._prefixes=prefixes;
/*!
     {
     "name": "CSS Gradients",
     "caniuse": "css-gradients",
     "property": "cssgradients",
     "tags": ["css"],
     "knownBugs": ["False-positives on webOS (https://github.com/Modernizr/Modernizr/issues/202)"],
     "notes": [{
     "name": "Webkit Gradient Syntax",
     "href": "https://webkit.org/blog/175/introducing-css-gradients/"
     },{
     "name": "Linear Gradient Syntax",
     "href": "https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient"
     },{
     "name": "W3C Gradient Spec",
     "href": "https://drafts.csswg.org/css-images-3/#gradients"
     }]
     }
     !*/
Modernizr.addTest('cssgradients',function(){var str1='background-image:';var str2='gradient(linear,left top,right bottom,from(#9f9),to(white));';var css='';var angle;for(var i=0,len=prefixes.length-1;i<len;i++){angle=(i===0?'to ':'');css+=str1+prefixes[i]+'linear-gradient('+angle+'left top, #9f9, white);';}
if(Modernizr._config.usePrefixes){css+=str1+'-webkit-'+str2;}
var elem=createElement('a');var style=elem.style;style.cssText=css;return(''+style.backgroundImage).indexOf('gradient')>-1;});function getBody(){var body=document.body;if(!body){body=createElement(isSVG?'svg':'body');body.fake=true;}
return body;};function injectElementWithStyles(rule,callback,nodes,testnames){var mod='modernizr';var style;var ret;var node;var docOverflow;var div=createElement('div');var body=getBody();if(parseInt(nodes,10)){while(nodes--){node=createElement('div');node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node);}}
style=createElement('style');style.type='text/css';style.id='s'+mod;(!body.fake?div:body).appendChild(style);body.appendChild(div);if(style.styleSheet){style.styleSheet.cssText=rule;}else{style.appendChild(document.createTextNode(rule));}
div.id=mod;if(body.fake){body.style.background='';body.style.overflow='hidden';docOverflow=docElement.style.overflow;docElement.style.overflow='hidden';docElement.appendChild(body);}
ret=callback(div,rule);if(body.fake){body.parentNode.removeChild(body);docElement.style.overflow=docOverflow;docElement.offsetHeight;}else{div.parentNode.removeChild(div);}
return!!ret;};var mq=(function(){var matchMedia=window.matchMedia||window.msMatchMedia;if(matchMedia){return function(mq){var mql=matchMedia(mq);return mql&&mql.matches||false;};}
return function(mq){var bool=false;injectElementWithStyles('@media '+mq+' { #modernizr { position: absolute; } }',function(node){bool=(window.getComputedStyle?window.getComputedStyle(node,null):node.currentStyle).position=='absolute';});return bool;};})();ModernizrProto.mq=mq;
/*!
     {
     "name": "Content Editable",
     "property": "contenteditable",
     "caniuse": "contenteditable",
     "notes": [{
     "name": "WHATWG spec",
     "href": "https://html.spec.whatwg.org/multipage/interaction.html#contenteditable"
     }]
     }
     !*/
Modernizr.addTest('contenteditable',function(){if(!('contentEditable'in docElement)){return;}
var div=createElement('div');div.contentEditable=true;return div.contentEditable==='true';});testRunner();setClasses(classes);delete ModernizrProto.addTest;delete ModernizrProto.addAsyncTest;for(var i=0;i<Modernizr._q.length;i++){Modernizr._q[i]();}
window.Modernizr=Modernizr;;})(window,document);(function(a){function b(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function c(a,b){return function(c){return k(a.call(this,c),b)}}function d(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function e(){}function f(a){w(a),h(this,a)}function g(a){var b=q(a),c=b.year||0,d=b.month||0,e=b.week||0,f=b.day||0,g=b.hour||0,h=b.minute||0,i=b.second||0,j=b.millisecond||0;this._milliseconds=+j+1e3*i+6e4*h+36e5*g,this._days=+f+7*e,this._months=+d+12*c,this._data={},this._bubble()}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function i(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&qb.hasOwnProperty(b)&&(c[b]=a[b]);return c}function j(a){return 0>a?Math.ceil(a):Math.floor(a)}function k(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function l(a,b,c,d){var e,f,g=b._milliseconds,h=b._days,i=b._months;g&&a._d.setTime(+a._d+g*c),(h||i)&&(e=a.minute(),f=a.hour()),h&&a.date(a.date()+h*c),i&&a.month(a.month()+i*c),g&&!d&&db.updateOffset(a),(h||i)&&(a.minute(e),a.hour(f))}function m(a){return"[object Array]"===Object.prototype.toString.call(a)}function n(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function o(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&s(a[d])!==s(b[d]))&&g++;return g+f}function p(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=Tb[a]||Ub[b]||b}return a}function q(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=p(c),b&&(d[b]=a[c]));return d}function r(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}db[b]=function(e,f){var g,h,i=db.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=db().utc().set(d,a);return i.call(db.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function s(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function t(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function u(a){return v(a)?366:365}function v(a){return a%4===0&&a%100!==0||a%400===0}function w(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[jb]<0||a._a[jb]>11?jb:a._a[kb]<1||a._a[kb]>t(a._a[ib],a._a[jb])?kb:a._a[lb]<0||a._a[lb]>23?lb:a._a[mb]<0||a._a[mb]>59?mb:a._a[nb]<0||a._a[nb]>59?nb:a._a[ob]<0||a._a[ob]>999?ob:-1,a._pf._overflowDayOfYear&&(ib>b||b>kb)&&(b=kb),a._pf.overflow=b)}function x(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function y(a){return a?a.toLowerCase().replace("_","-"):a}function z(a,b){return b._isUTC?db(a).zone(b._offset||0):db(a).local()}function A(a,b){return b.abbr=a,pb[a]||(pb[a]=new e),pb[a].set(b),pb[a]}function B(a){delete pb[a]}function C(a){var b,c,d,e,f=0,g=function(a){if(!pb[a]&&rb)try{require("./lang/"+a)}catch(b){}return pb[a]};if(!a)return db.fn._lang;if(!m(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=y(a[f]).split("-"),b=e.length,d=y(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&o(e,d,!0)>=b-1)break;b--}f++}return db.fn._lang}function D(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function E(a){var b,c,d=a.match(vb);for(b=0,c=d.length;c>b;b++)d[b]=Yb[d[b]]?Yb[d[b]]:D(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function F(a,b){return a.isValid()?(b=G(b,a.lang()),Vb[b]||(Vb[b]=E(b)),Vb[b](a)):a.lang().invalidDate()}function G(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(wb.lastIndex=0;d>=0&&wb.test(a);)a=a.replace(wb,c),wb.lastIndex=0,d-=1;return a}function H(a,b){var c,d=b._strict;switch(a){case"DDDD":return Ib;case"YYYY":case"GGGG":case"gggg":return d?Jb:zb;case"Y":case"G":case"g":return Lb;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?Kb:Ab;case"S":if(d)return Gb;case"SS":if(d)return Hb;case"SSS":if(d)return Ib;case"DDD":return yb;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Cb;case"a":case"A":return C(b._l)._meridiemParse;case"X":return Fb;case"Z":case"ZZ":return Db;case"T":return Eb;case"SSSS":return Bb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?Hb:xb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return xb;default:return c=new RegExp(P(O(a.replace("\\","")),"i"))}}function I(a){a=a||"";var b=a.match(Db)||[],c=b[b.length-1]||[],d=(c+"").match(Qb)||["-",0,0],e=+(60*d[1])+s(d[2]);return"+"===d[0]?-e:e}function J(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":null!=b&&(e[jb]=s(b)-1);break;case"MMM":case"MMMM":d=C(c._l).monthsParse(b),null!=d?e[jb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[kb]=s(b));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=s(b));break;case"YY":e[ib]=s(b)+(s(b)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":e[ib]=s(b);break;case"a":case"A":c._isPm=C(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[lb]=s(b);break;case"m":case"mm":e[mb]=s(b);break;case"s":case"ss":e[nb]=s(b);break;case"S":case"SS":case"SSS":case"SSSS":e[ob]=s(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=I(b);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":a=a.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=b)}}function K(a){var b,c,d,e,f,g,h,i,j,k,l=[];if(!a._d){for(d=M(a),a._w&&null==a._a[kb]&&null==a._a[jb]&&(f=function(b){var c=parseInt(b,10);return b?b.length<3?c>68?1900+c:2e3+c:c:null==a._a[ib]?db().weekYear():a._a[ib]},g=a._w,null!=g.GG||null!=g.W||null!=g.E?h=Z(f(g.GG),g.W||1,g.E,4,1):(i=C(a._l),j=null!=g.d?V(g.d,i):null!=g.e?parseInt(g.e,10)+i._week.dow:0,k=parseInt(g.w,10)||1,null!=g.d&&j<i._week.dow&&k++,h=Z(f(g.gg),k,j,i._week.doy,i._week.dow)),a._a[ib]=h.year,a._dayOfYear=h.dayOfYear),a._dayOfYear&&(e=null==a._a[ib]?d[ib]:a._a[ib],a._dayOfYear>u(e)&&(a._pf._overflowDayOfYear=!0),c=U(e,0,a._dayOfYear),a._a[jb]=c.getUTCMonth(),a._a[kb]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=l[b]=d[b];for(;7>b;b++)a._a[b]=l[b]=null==a._a[b]?2===b?1:0:a._a[b];l[lb]+=s((a._tzm||0)/60),l[mb]+=s((a._tzm||0)%60),a._d=(a._useUTC?U:T).apply(null,l)}}function L(a){var b;a._d||(b=q(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],K(a))}function M(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function N(a){a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=C(a._l),h=""+a._i,i=h.length,j=0;for(d=G(a._f,g).match(vb)||[],b=0;b<d.length;b++)e=d[b],c=(h.match(H(e,a))||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),Yb[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),J(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[lb]<12&&(a._a[lb]+=12),a._isPm===!1&&12===a._a[lb]&&(a._a[lb]=0),K(a),w(a)}function O(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function P(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a){var c,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,a._d=new Date(0/0),void 0;for(f=0;f<a._f.length;f++)g=0,c=h({},a),c._pf=b(),c._f=a._f[f],N(c),x(c)&&(g+=c._pf.charsLeftOver,g+=10*c._pf.unusedTokens.length,c._pf.score=g,(null==e||e>g)&&(e=g,d=c));h(a,d||c)}function R(a){var b,c,d=a._i,e=Mb.exec(d);if(e){for(a._pf.iso=!0,b=0,c=Ob.length;c>b;b++)if(Ob[b][1].exec(d)){a._f=Ob[b][0]+(e[6]||" ");break}for(b=0,c=Pb.length;c>b;b++)if(Pb[b][1].exec(d)){a._f+=Pb[b][0];break}d.match(Db)&&(a._f+="Z"),N(a)}else a._d=new Date(d)}function S(b){var c=b._i,d=sb.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?R(b):m(c)?(b._a=c.slice(0),K(b)):n(c)?b._d=new Date(+c):"object"==typeof c?L(b):b._d=new Date(c)}function T(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function U(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function V(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function W(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function X(a,b,c){var d=hb(Math.abs(a)/1e3),e=hb(d/60),f=hb(e/60),g=hb(f/24),h=hb(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",hb(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,W.apply({},i)}function Y(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=db(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function Z(a,b,c,d,e){var f,g,h=U(a,0,1).getUTCDay();return c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:u(a-1)+g}}function $(a){var b=a._i,c=a._f;return null===b?db.invalid({nullInput:!0}):("string"==typeof b&&(a._i=b=C().preparse(b)),db.isMoment(b)?(a=i(b),a._d=new Date(+b._d)):c?m(c)?Q(a):N(a):S(a),new f(a))}function _(a,b){db.fn[a]=db.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),db.updateOffset(this),this):this._d["get"+c+b]()}}function ab(a){db.duration.fn[a]=function(){return this._data[a]}}function bb(a,b){db.duration.fn["as"+a]=function(){return+this/b}}function cb(a){var b=!1,c=db;"undefined"==typeof ender&&(a?(gb.moment=function(){return!b&&(typeof console!='undefined')&&(typeof console.warn!='undefined')&&(b=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),c.apply(null,arguments)},h(gb.moment,c)):gb.moment=db)}for(var db,eb,fb="2.5.1",gb=this,hb=Math.round,ib=0,jb=1,kb=2,lb=3,mb=4,nb=5,ob=6,pb={},qb={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},rb="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,sb=/^\/?Date\((\-?\d+)/i,tb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,ub=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,vb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,wb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,xb=/\d\d?/,yb=/\d{1,3}/,zb=/\d{1,4}/,Ab=/[+\-]?\d{1,6}/,Bb=/\d+/,Cb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Db=/Z|[\+\-]\d\d:?\d\d/gi,Eb=/T/i,Fb=/[\+\-]?\d+(\.\d{1,3})?/,Gb=/\d/,Hb=/\d\d/,Ib=/\d{3}/,Jb=/\d{4}/,Kb=/[+-]?\d{6}/,Lb=/[+-]?\d+/,Mb=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Nb="YYYY-MM-DDTHH:mm:ssZ",Ob=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Pb=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Qb=/([\+\-]|\d\d)/gi,Rb="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Sb={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Tb={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Ub={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Vb={},Wb="DDD w W M D d".split(" "),Xb="M D H h m s w W".split(" "),Yb={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return k(this.year()%100,2)},YYYY:function(){return k(this.year(),4)},YYYYY:function(){return k(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+k(Math.abs(a),6)},gg:function(){return k(this.weekYear()%100,2)},gggg:function(){return k(this.weekYear(),4)},ggggg:function(){return k(this.weekYear(),5)},GG:function(){return k(this.isoWeekYear()%100,2)},GGGG:function(){return k(this.isoWeekYear(),4)},GGGGG:function(){return k(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return s(this.milliseconds()/100)},SS:function(){return k(s(this.milliseconds()/10),2)},SSS:function(){return k(this.milliseconds(),3)},SSSS:function(){return k(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+":"+k(s(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+k(s(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Zb=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Wb.length;)eb=Wb.pop(),Yb[eb+"o"]=d(Yb[eb],eb);for(;Xb.length;)eb=Xb.pop(),Yb[eb+eb]=c(Yb[eb],2);for(Yb.DDDD=c(Yb.DDD,3),h(e.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=db.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=db([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return Y(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),db=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=c,g._f=d,g._l=e,g._strict=f,g._isUTC=!1,g._pf=b(),$(g)},db.utc=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=c,g._f=d,g._strict=f,g._pf=b(),$(g).utc()},db.unix=function(a){return db(1e3*a)},db.duration=function(a,b){var c,d,e,f=a,h=null;return db.isDuration(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(h=tb.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:s(h[kb])*c,h:s(h[lb])*c,m:s(h[mb])*c,s:s(h[nb])*c,ms:s(h[ob])*c}):(h=ub.exec(a))&&(c="-"===h[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},f={y:e(h[2]),M:e(h[3]),d:e(h[4]),h:e(h[5]),m:e(h[6]),s:e(h[7]),w:e(h[8])}),d=new g(f),db.isDuration(a)&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},db.version=fb,db.defaultFormat=Nb,db.updateOffset=function(){},db.lang=function(a,b){var c;return a?(b?A(y(a),b):null===b?(B(a),a="en"):pb[a]||C(a),c=db.duration.fn._lang=db.fn._lang=C(a),c._abbr):db.fn._lang._abbr},db.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),C(a)},db.isMoment=function(a){return a instanceof f||null!=a&&a.hasOwnProperty("_isAMomentObject")},db.isDuration=function(a){return a instanceof g},eb=Zb.length-1;eb>=0;--eb)r(Zb[eb]);for(db.normalizeUnits=function(a){return p(a)},db.invalid=function(a){var b=db.utc(0/0);return null!=a?h(b._pf,a):b._pf.userInvalidated=!0,b},db.parseZone=function(a){return db(a).parseZone()},h(db.fn=f.prototype,{clone:function(){return db(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=db(this).utc();return 0<a.year()&&a.year()<=9999?F(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):F(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return x(this)},isDSTShifted:function(){return this._a?this.isValid()&&o(this._a,(this._isUTC?db.utc(this._a):db(this._a)).toArray())>0:!1},parsingFlags:function(){return h({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=F(this,a||db.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,-1),this},diff:function(a,b,c){var d,e,f=z(a,this),g=6e4*(this.zone()-f.zone());return b=p(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-db(this).startOf("month")-(f-db(f).startOf("month")))/d,e-=6e4*(this.zone()-db(this).startOf("month").zone()-(f.zone()-db(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:j(e)},from:function(a,b){return db.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(db(),a)},calendar:function(){var a=z(db(),this).startOf("day"),b=this.diff(a,"days",!0),c=-6>b?"sameElse":-1>b?"lastWeek":0>b?"lastDay":1>b?"sameDay":2>b?"nextDay":7>b?"nextWeek":"sameElse";return this.format(this.lang().calendar(c,this))},isLeapYear:function(){return v(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=V(a,this.lang()),this.add({d:a-b})):b},month:function(a){var b,c=this._isUTC?"UTC":"";return null!=a?"string"==typeof a&&(a=this.lang().monthsParse(a),"number"!=typeof a)?this:(b=this.date(),this.date(1),this._d["set"+c+"Month"](a),this.date(Math.min(b,this.daysInMonth())),db.updateOffset(this),this):this._d["get"+c+"Month"]()},startOf:function(a){switch(a=p(a)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),this},endOf:function(a){return a=p(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+db(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+db(a).startOf(b)},isSame:function(a,b){return b=b||"ms",+this.clone().startOf(b)===+z(a,this).startOf(b)},min:function(a){return a=db.apply(null,arguments),this>a?this:a},max:function(a){return a=db.apply(null,arguments),a>this?this:a},zone:function(a){var b=this._offset||0;return null==a?this._isUTC?b:this._d.getTimezoneOffset():("string"==typeof a&&(a=I(a)),Math.abs(a)<16&&(a=60*a),this._offset=a,this._isUTC=!0,b!==a&&l(this,db.duration(b-a,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?db(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return t(this.year(),this.month())},dayOfYear:function(a){var b=hb((db(this).startOf("day")-db(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(a){var b=Y(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=Y(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=Y(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},get:function(a){return a=p(a),this[a]()},set:function(a,b){return a=p(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=C(b),this)}}),eb=0;eb<Rb.length;eb++)_(Rb[eb].toLowerCase().replace(/s$/,""),Rb[eb]);_("year","FullYear"),db.fn.days=db.fn.day,db.fn.months=db.fn.month,db.fn.weeks=db.fn.week,db.fn.isoWeeks=db.fn.isoWeek,db.fn.toJSON=db.fn.toISOString,h(db.duration.fn=g.prototype,{_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,h=this._data;h.milliseconds=e%1e3,a=j(e/1e3),h.seconds=a%60,b=j(a/60),h.minutes=b%60,c=j(b/60),h.hours=c%24,f+=j(c/24),h.days=f%30,g+=j(f/30),h.months=g%12,d=j(g/12),h.years=d},weeks:function(){return j(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*s(this._months/12)},humanize:function(a){var b=+this,c=X(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=db.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=db.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=p(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=p(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:db.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(eb in Sb)Sb.hasOwnProperty(eb)&&(bb(eb,Sb[eb]),ab(eb.toLowerCase()));bb("Weeks",6048e5),db.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},db.lang("en",{ordinal:function(a){var b=a%10,c=1===s(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),function(a){a(db)}(function(a){return a.lang("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(db)}(function(a){return a.lang("ar",{months:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),monthsShort:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(db)}(function(a){return a.lang("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(a){var b=a%10,c=a%100;return 0===a?a+"-":0===c?a+"-":c>10&&20>c?a+"-":1===b?a+"-":2===b?a+"-":7===b||8===b?a+"-":a+"-"},week:{dow:1,doy:7}})}),function(a){a(db)}(function(b){function c(a,b,c){var d={mm:"munutenn",MM:"miz",dd:"devezh"};return a+" "+f(d[c],a)}function d(a){switch(e(a)){case 1:case 3:case 4:case 5:case 9:return a+" bloaz";default:return a+" vloaz"}}function e(a){return a>9?e(a%10):a}function f(a,b){return 2===b?g(a):a}function g(b){var c={m:"v",b:"v",d:"z"};return c[b.charAt(0)]===a?b:c[b.charAt(0)]+b.substring(1)}return b.lang("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",m:"ur vunutenn",mm:c,h:"un eur",hh:"%d eur",d:"un devezh",dd:c,M:"ur miz",MM:c,y:"ur bloaz",yy:d},ordinal:function(a){var b=1===a?"a":"vet";return a+b},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"jedna minuta":"jedne minute";case"mm":return d+=1===a?"minuta":2===a||3===a||4===a?"minute":"minuta";case"h":return b?"jedan sat":"jednog sata";case"hh":return d+=1===a?"sat":2===a||3===a||4===a?"sata":"sati";case"dd":return d+=1===a?"dan":"dana";case"MM":return d+=1===a?"mjesec":2===a||3===a||4===a?"mjeseca":"mjeseci";case"yy":return d+=1===a?"godina":2===a||3===a||4===a?"godine":"godina"}}return a.lang("bs",{months:"januar_februar_mart_april_maj_juni_juli_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:b,mm:b,h:b,hh:b,d:"dan",dd:b,M:"mjesec",MM:b,y:"godinu",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("ca",{months:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),monthsShort:"gen._febr._mar._abr._mai._jun._jul._ag._set._oct._nov._des.".split("_"),weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a){return a>1&&5>a&&1!==~~(a/10)}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"pr vtein":"pr vteinami";case"m":return c?"minuta":e?"minutu":"minutou";case"mm":return c||e?f+(b(a)?"minuty":"minut"):f+"minutami";break;case"h":return c?"hodina":e?"hodinu":"hodinou";case"hh":return c||e?f+(b(a)?"hodiny":"hodin"):f+"hodinami";break;case"d":return c||e?"den":"dnem";case"dd":return c||e?f+(b(a)?"dny":"dn"):f+"dny";break;case"M":return c||e?"msc":"mscem";case"MM":return c||e?f+(b(a)?"msce":"msc"):f+"msci";break;case"y":return c||e?"rok":"rokem";case"yy":return c||e?f+(b(a)?"roky":"let"):f+"lety"}}var d="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),e="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_");return a.lang("cs",{months:d,monthsShort:e,monthsParse:function(a,b){var c,d=[];for(c=0;12>c;c++)d[c]=new RegExp("^"+a[c]+"$|^"+b[c]+"$","i");return d}(d,e),weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:c,m:c,mm:c,h:c,hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], LT",LLLL:"dddd, YYYY [] MMMM [] D[-], LT"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(a){var b=/$/i.exec(a)?"":/$/i.exec(a)?"":"";return a+b},past:"%s ",s:"- ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:"%d-",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinal:function(a){var b=a,c="",d=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];return b>20?c=40===b||50===b||60===b||80===b||100===b?"fed":"ain":b>0&&(c=d[b]),a+c},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c){var d={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[a+" Tage",a+" Tagen"],M:["ein Monat","einem Monat"],MM:[a+" Monate",a+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[a+" Jahre",a+" Jahren"]};return b?d[c][0]:d[c][1]}return a.lang("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:b,mm:"%d Minuten",h:b,hh:"%d Stunden",d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(a,b){return/D/.test(b.substring(0,b.indexOf("MMMM")))?this._monthsGenitiveEl[a.month()]:this._monthsNominativeEl[a.month()]},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(a,b,c){return a>11?c?"":"":c?"":""},longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:"[ ] dddd [{}] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendarEl[a],d=b&&b.hours();return c.replace("{}",d%12===1?"":"")},relativeTime:{future:" %s",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(a){return a+""},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}})}),function(a){a(db)}(function(a){return a.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_a_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiem:function(a,b,c){return a>11?c?"p.t.m.":"P.T.M.":c?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"anta %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinal:"%da",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:"ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c,d){var e={s:["mne sekundi","mni sekund","paar sekundit"],m:["he minuti","ks minut"],mm:[a+" minuti",a+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[a+" tunni",a+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[a+" kuu",a+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[a+" aasta",a+" aastat"]};return b?e[c][2]?e[c][2]:e[c][1]:d?e[c][0]:e[c][1]}return a.lang("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:"%d peva",M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiem:function(a){return 12>a?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[-]/g,function(a){return c[a]}).replace(//g,",")},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]}).replace(/,/g,"")},ordinal:"%d",week:{dow:6,doy:12}})}),function(a){a(db)}(function(a){function b(a,b,d,e){var f="";switch(d){case"s":return e?"muutaman sekunnin":"muutama sekunti";case"m":return e?"minuutin":"minuutti";case"mm":f=e?"minuutin":"minuuttia";break;case"h":return e?"tunnin":"tunti";case"hh":f=e?"tunnin":"tuntia";break;case"d":return e?"pivn":"piv";case"dd":f=e?"pivn":"piv";break;case"M":return e?"kuukauden":"kuukausi";case"MM":f=e?"kuukauden":"kuukautta";break;case"y":return e?"vuoden":"vuosi";case"yy":f=e?"vuoden":"vuotta"}return f=c(a,e)+" "+f}function c(a,b){return 10>a?b?e[a]:d[a]:a}var d="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),e=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",d[7],d[8],d[9]];return a.lang("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnai",MM:"%d mnair",y:"eitt r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(a){return a+(1===a?"er":"")}})}),function(a){a(db)}(function(a){return a.lang("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(a){return a+(1===a?"er":"")},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_M_Xo_Ve_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(a){return"uns segundos"===a?"nuns segundos":"en "+a},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY LT",LLLL:"dddd, D []MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:function(a){return 2===a?"":a+" "},d:"",dd:function(a){return 2===a?"":a+" "},M:"",MM:function(a){return 2===a?"":a+" "},y:"",yy:function(a){return 2===a?"":a+" "}}})}),function(a){a(db)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 4>a?"":10>a?"":17>a?"":20>a?"":""},week:{dow:0,doy:6}})}),function(a){a(db)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"jedna minuta":"jedne minute";case"mm":return d+=1===a?"minuta":2===a||3===a||4===a?"minute":"minuta";case"h":return b?"jedan sat":"jednog sata";case"hh":return d+=1===a?"sat":2===a||3===a||4===a?"sata":"sati";case"dd":return d+=1===a?"dan":"dana";case"MM":return d+=1===a?"mjesec":2===a||3===a||4===a?"mjeseca":"mjeseci";case"yy":return d+=1===a?"godina":2===a||3===a||4===a?"godine":"godina"}}return a.lang("hr",{months:"sjeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sje._vel._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:b,mm:b,h:b,hh:b,d:"dan",dd:b,M:"mjesec",MM:b,y:"godinu",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a,b,c,d){var e=a;switch(c){case"s":return d||b?"nhny msodperc":"nhny msodperce";case"m":return"egy"+(d||b?" perc":" perce");case"mm":return e+(d||b?" perc":" perce");case"h":return"egy"+(d||b?" ra":" rja");case"hh":return e+(d||b?" ra":" rja");case"d":return"egy"+(d||b?" nap":" napja");case"dd":return e+(d||b?" nap":" napja");case"M":return"egy"+(d||b?" hnap":" hnapja");case"MM":return e+(d||b?" hnap":" hnapja");case"y":return"egy"+(d||b?" v":" ve");case"yy":return e+(d||b?" v":" ve")}return""}function c(a){return(a?"":"[mlt] ")+"["+d[this.day()]+"] LT[-kor]"}var d="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");return a.lang("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return c.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return c.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function c(a){var b="___________".split("_");return b[a.month()]}function d(a){var b="______".split("_");return b[a.day()]}return a.lang("hy-am",{months:b,monthsShort:c,weekdays:d,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiem:function(a){return 4>a?"":12>a?"":17>a?"":""},ordinal:function(a,b){switch(b){case"DDD":case"w":case"W":case"DDDo":return 1===a?a+"-":a+"-";default:return a}},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(a){return 11>a?"pagi":15>a?"siang":19>a?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a){return a%100===11?!0:a%10===1?!1:!0}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"nokkrar sekndur":"nokkrum sekndum";case"m":return c?"mnta":"mntu";case"mm":return b(a)?f+(c||e?"mntur":"mntum"):c?f+"mnta":f+"mntu";case"hh":return b(a)?f+(c||e?"klukkustundir":"klukkustundum"):f+"klukkustund";case"d":return c?"dagur":e?"dag":"degi";case"dd":return b(a)?c?f+"dagar":f+(e?"daga":"dgum"):c?f+"dagur":f+(e?"dag":"degi");case"M":return c?"mnuur":e?"mnu":"mnui";case"MM":return b(a)?c?f+"mnuir":f+(e?"mnui":"mnuum"):c?f+"mnuur":f+(e?"mnu":"mnui");case"y":return c||e?"r":"ri";case"yy":return b(a)?f+(c||e?"r":"rum"):f+(c||e?"r":"ri")}}return a.lang("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:c,m:c,mm:c,h:"klukkustund",hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("it",{months:"Gennaio_Febbraio_Marzo_Aprile_Maggio_Giugno_Luglio_Agosto_Settembre_Ottobre_Novembre_Dicembre".split("_"),monthsShort:"Gen_Feb_Mar_Apr_Mag_Giu_Lug_Ago_Set_Ott_Nov_Dic".split("_"),weekdays:"Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:"[lo scorso] dddd [alle] LT",sameElse:"L"},relativeTime:{future:function(a){return(/^[0-9].+$/.test(a)?"tra":"in")+" "+a},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("ja",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahm",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDLT",LLLL:"YYYYMDLT dddd"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}),function(a){a(db)}(function(a){function b(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD] *MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function c(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_")},d=/(|)/.test(b)?"accusative":"nominative";return c[d][a.day()]}return a.lang("ka",{months:b,monthsShort:"___________".split("_"),weekdays:c,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(a){return/(|||)/.test(a)?a.replace(/$/,""):a+""},past:function(a){return/(||||)/.test(a)?a.replace(/(|)$/," ")://.test(a)?a.replace(/$/," "):void 0},s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(a){return 0===a?a:1===a?a+"-":20>a||100>=a&&a%20===0||a%100===0?"-"+a:a+"-"},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h mm",L:"YYYY.MM.DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D LT",LLLL:"YYYY MMMM D dddd LT"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"},ordinal:"%d",meridiemParse:/(|)/,isPM:function(a){return""===a}})}),function(a){a(db)}(function(a){function b(a,b,c){var d={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],dd:[a+" Deeg",a+" Deeg"],M:["ee Mount","engem Mount"],MM:[a+" Mint",a+" Mint"],y:["ee Joer","engem Joer"],yy:[a+" Joer",a+" Joer"]};return b?d[c][0]:d[c][1]}function c(a){var b=a.substr(0,a.indexOf(" "));return g(b)?"a "+a:"an "+a}function d(a){var b=a.substr(0,a.indexOf(" "));return g(b)?"viru "+a:"virun "+a}function e(){var a=this.format("d");return f(a)?"[Leschte] dddd [um] LT":"[Leschten] dddd [um] LT"}function f(a){switch(a=parseInt(a,10)){case 0:case 1:case 3:case 5:case 6:return!0;default:return!1}}function g(a){if(a=parseInt(a,10),isNaN(a))return!1;if(0>a)return!0;if(10>a)return a>=4&&7>=a?!0:!1;if(100>a){var b=a%10,c=a/10;return 0===b?g(c):g(b)}if(1e4>a){for(;a>=10;)a/=10;return g(a)}return a/=1e3,g(a)}return a.lang("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:e},relativeTime:{future:c,past:d,s:"e puer Sekonnen",m:b,mm:"%d Minutten",h:b,hh:"%d Stonnen",d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c,d){return b?"kelios sekunds":d?"keli sekundi":"kelias sekundes"}function c(a,b,c,d){return b?e(c)[0]:d?e(c)[1]:e(c)[2]}function d(a){return a%10===0||a>10&&20>a}function e(a){return h[a].split("_")}function f(a,b,f,g){var h=a+" ";return 1===a?h+c(a,b,f[0],g):b?h+(d(a)?e(f)[1]:e(f)[0]):g?h+e(f)[1]:h+(d(a)?e(f)[1]:e(f)[2])}function g(a,b){var c=-1===b.indexOf("dddd LT"),d=i[a.weekday()];return c?d:d.substring(0,d.length-2)+""}var h={m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"},i="pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis_sekmadienis".split("_");return a.lang("lt",{months:"sausio_vasario_kovo_balandio_gegus_birlio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:g,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:b,m:c,mm:f,h:c,hh:f,d:c,dd:f,M:c,MM:f,y:c,yy:f},ordinal:function(a){return a+"-oji"},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c){var d=a.split("_");return c?b%10===1&&11!==b?d[2]:d[3]:b%10===1&&11!==b?d[0]:d[1]}function c(a,c,e){return a+" "+b(d[e],a,c)}var d={mm:"minti_mintes_minte_mintes",hh:"stundu_stundas_stunda_stundas",dd:"dienu_dienas_diena_dienas",MM:"mnesi_mneus_mnesis_mnei",yy:"gadu_gadus_gads_gadi"};return a.lang("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"%s vlk",past:"%s agrk",s:"daas sekundes",m:"minti",mm:c,h:"stundu",hh:c,d:"dienu",dd:c,M:"mnesi",MM:c,y:"gadu",yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(a){var b=a%10,c=a%100;return 0===a?a+"-":0===c?a+"-":c>10&&20>c?a+"-":1===b?a+"-":2===b?a+"-":7===b||8===b?a+"-":a+"-"},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiem:function(a){return 4>a?"":12>a?"":17>a?" ":20>a?"":""}})}),function(a){a(db)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 4>a?"":10>a?"":17>a?"":20>a?"":""},week:{dow:0,doy:6}})}),function(a){a(db)}(function(a){return a.lang("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(a){return 11>a?"pagi":15>a?"tengahari":19>a?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"H.mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._.__._._._.".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 3>a?"":10>a?"":15>a?"":18>a?"":20>a?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){var b="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),c="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_");return a.lang("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(a,d){return/-MMM-/.test(d)?c[a.month()]:b[a.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinal:function(a){return a+(1===a||8===a||a>=20?"ste":"de")},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregende] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekund",m:"ett minutt",mm:"%d minutt",h:"en time",hh:"%d timar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a){return 5>a%10&&a%10>1&&~~(a/10)%10!==1}function c(a,c,d){var e=a+" ";switch(d){case"m":return c?"minuta":"minut";case"mm":return e+(b(a)?"minuty":"minut");case"h":return c?"godzina":"godzin";case"hh":return e+(b(a)?"godziny":"godzin");case"MM":return e+(b(a)?"miesice":"miesicy");case"yy":return e+(b(a)?"lata":"lat")}}var d="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),e="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");return a.lang("pl",{months:function(a,b){return/D MMMM/.test(b)?e[a.month()]:d[a.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"nie_pon_wt_r_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:c,mm:c,h:c,hh:c,d:"1 dzie",dd:"%d dni",M:"miesic",MM:c,y:"rok",yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("pt-br",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d"})}),function(a){a(db)}(function(a){return a.lang("pt",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c){var d={mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"},e=" ";return(a%100>=20||a>=100&&a%100===0)&&(e=" de "),a+e+d[c]}return a.lang("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian_feb_mar_apr_mai_iun_iul_aug_sep_oct_noi_dec".split("_"),weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",m:"un minut",mm:b,h:"o or",hh:b,d:"o zi",dd:b,M:"o lun",MM:b,y:"un an",yy:b},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"jedna minuta":"jedne minute";case"mm":return d+=1===a?"minuta":2===a||3===a||4===a?"minute":"minuta";case"h":return b?"jedan sat":"jednog sata";case"hh":return d+=1===a?"sat":2===a||3===a||4===a?"sata":"sati";case"dd":return d+=1===a?"dan":"dana";case"MM":return d+=1===a?"mesec":2===a||3===a||4===a?"meseca":"meseci";case"yy":return d+=1===a?"godina":2===a||3===a||4===a?"godine":"godina"}}return a.lang("rs",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljak_utorak_sreda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"par sekundi",m:b,mm:b,h:b,hh:b,d:"dan",dd:b,M:"mesec",MM:b,y:"godinu",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a,b){var c=a.split("_");return b%10===1&&b%100!==11?c[0]:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?c[1]:c[2]}function c(a,c,d){var e={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===d?c?"":"":a+" "+b(e[d],+a)}function d(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function e(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function f(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_")},d=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(b)?"accusative":"nominative";return c[d][a.day()]}return a.lang("ru",{months:d,monthsShort:e,weekdays:f,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:c,mm:c,h:"",hh:c,d:"",dd:c,M:"",MM:c,y:"",yy:c},meridiem:function(a){return 4>a?"":12>a?"":17>a?"":""},ordinal:function(a,b){switch(b){case"M":case"d":case"DDD":return a+"-";case"D":return a+"-";case"w":case"W":return a+"-";default:return a}},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){function b(a){return a>1&&5>a}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"pr seknd":"pr sekundami";case"m":return c?"minta":e?"mintu":"mintou";case"mm":return c||e?f+(b(a)?"minty":"mint"):f+"mintami";break;case"h":return c?"hodina":e?"hodinu":"hodinou";case"hh":return c||e?f+(b(a)?"hodiny":"hodn"):f+"hodinami";break;case"d":return c||e?"de":"dom";case"dd":return c||e?f+(b(a)?"dni":"dn"):f+"dami";break;case"M":return c||e?"mesiac":"mesiacom";case"MM":return c||e?f+(b(a)?"mesiace":"mesiacov"):f+"mesiacmi";break;case"y":return c||e?"rok":"rokom";case"yy":return c||e?f+(b(a)?"roky":"rokov"):f+"rokmi"}}var d="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),e="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");return a.lang("sk",{months:d,monthsShort:e,monthsParse:function(a,b){var c,d=[];for(c=0;12>c;c++)d[c]=new RegExp("^"+a[c]+"$|^"+b[c]+"$","i");return d}(d,e),weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:c,m:c,mm:c,h:c,hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"ena minuta":"eno minuto";case"mm":return d+=1===a?"minuta":2===a?"minuti":3===a||4===a?"minute":"minut";case"h":return b?"ena ura":"eno uro";case"hh":return d+=1===a?"ura":2===a?"uri":3===a||4===a?"ure":"ur";case"dd":return d+=1===a?"dan":"dni";case"MM":return d+=1===a?"mesec":2===a?"meseca":3===a||4===a?"mesece":"mesecev";case"yy":return d+=1===a?"leto":2===a?"leti":3===a||4===a?"leta":"let"}}return a.lang("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[prejnja] dddd [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"%s nazaj",s:"nekaj sekund",m:b,mm:b,h:b,hh:b,d:"en dan",dd:b,M:"en mesec",MM:b,y:"eno leto",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Marte_E Mrkure_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Neser n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s me par",s:"disa sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"dddd LT",lastWeek:"[Frra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"e":1===b?"a":2===b?"a":3===b?"e":"e";return a+c},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(a){return a+""},meridiem:function(a){return a>=6&&10>=a?" ":a>=10&&14>=a?" ":a>=14&&18>=a?" ":a>=18&&20>=a?" ":a>=20&&24>=a?" ":a>=0&&6>=a?" ":void 0},week:{dow:0,doy:6}})}),function(a){a(db)}(function(a){return a.lang("th",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),longDateFormat:{LT:"H  m ",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  LT",LLLL:"dddd D MMMM YYYY  LT"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}),function(a){a(db)}(function(a){return a.lang("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinal:function(a){return a},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){var b={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};return a.lang("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(a){if(0===a)return a+"'nc";var c=a%10,d=a%100-c,e=a>=100?100:null;return a+(b[c]||b[d]||b[e])},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("tzm-la",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}),function(a){a(db)}(function(a){return a.lang("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(db)}(function(a){function b(a,b){var c=a.split("_");return b%10===1&&b%100!==11?c[0]:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?c[1]:c[2]}function c(a,c,d){var e={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===d?c?"":"":"h"===d?c?"":"":a+" "+b(e[d],+a)}function d(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]? *MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function e(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},d=/(\[[]\]) ?dddd/.test(b)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(b)?"genitive":"nominative";return c[d][a.day()]}function f(a){return function(){return a+""+(11===this.hours()?"":"")+"] LT"}}return a.lang("uk",{months:d,monthsShort:"___________".split("_"),weekdays:e,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:f("[ "),nextDay:f("[ "),lastDay:f("[ "),nextWeek:f("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return f("[] dddd [").call(this);case 1:case 2:case 4:return f("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:c,mm:c,h:"",hh:c,d:"",dd:c,M:"",MM:c,y:"",yy:c},meridiem:function(a){return 4>a?"":12>a?"":17>a?"":""},ordinal:function(a,b){switch(b){case"M":case"d":case"DDD":case"w":case"W":return a+"-";case"D":return a+"-";default:return a}},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(a){a(db)}(function(a){return a.lang("vn",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY LT",LLLL:"dddd, D MMMM [nm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},ordinal:function(a){return a},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYY-MM-DD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYY-MM-DD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(a,b){var c=100*a+b;return 600>c?"":900>c?"":1130>c?"":1230>c?"":1800>c?"":""},calendar:{sameDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},lastDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[]":"[]",0===this.minutes()?c+"dddAh":c+"dddAhmm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[]":"[]",0===this.minutes()?c+"dddAh":c+"dddAhmm"},sameElse:"LL"},ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"";case"M":return a+"";case"w":case"W":return a+"";default:return a}},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"},week:{dow:1,doy:4}})}),function(a){a(db)}(function(a){return a.lang("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(a,b){var c=100*a+b;return 900>c?"":1130>c?"":1230>c?"":1800>c?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"";case"M":return a+"";case"w":case"W":return a+"";default:return a}},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"}})}),db.lang("en"),rb?(module.exports=db,cb(!0)):"function"==typeof define&&define.amd?define("moment",function(b,c,d){return d.config&&d.config()&&d.config().noGlobal!==!0&&cb(d.config().noGlobal===a),db}):cb()}).call(this);(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var
push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.8.3';var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value);};case 2:return function(value,other){return func.call(context,value,other);};case 3:return function(value,index,collection){return func.call(context,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection);};}
return function(){return func.apply(context,arguments);};};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value);};_.iteratee=function(value,context){return cb(value,context,Infinity);};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key];}}
return obj;};};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result;};var property=function(key){return function(obj){return obj==null?void 0:obj[key];};};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property('length');var isArrayLike=function(collection){var length=getLength(collection);return typeof length=='number'&&length>=0&&length<=MAX_ARRAY_INDEX;};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj);}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj);}}
return obj;};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj);}
return results;};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj);}
return memo;}
return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir;}
return iterator(obj,iteratee,memo,keys,index,length);};}
_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context);}else{key=_.findKey(obj,predicate,context);}
if(key!==void 0&&key!==-1)return obj[key];};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value);});return results;};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context);};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false;}
return true;};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true;}
return false;};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!='number'||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0;};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,_.property(key));};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs));};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs));};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value;}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed;}});}
return result;};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value;}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed;}});}
return result;};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index];}
return shuffled;};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)];}
return _.shuffle(obj).slice(0,Math.max(0,n));};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index-right.index;}),'value');};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key);});return result;};};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value];});_.indexBy=group(function(result,value,key){result[key]=value;});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1;});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length;};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value);});return[pass,fail];};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n);};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)));};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n));};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++];}}else if(!strict){output[idx++]=value;}}
return output;};_.flatten=function(array,shallow){return flatten(array,shallow,false);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false;}
if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed;}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value);}}else if(!_.contains(result,value)){result.push(value);}}
return result;};_.union=function(){return _.uniq(flatten(arguments,true,true));};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break;}
if(j===argsLength)result.push(item);}
return result;};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(){return _.unzip(arguments);};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index);}
return result;};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index;}
return-1;};}
_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid;}
return low;};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=='number'){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i);}else{length=idx>=0?Math.min(idx+1,length):idx+length+1;}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1;}
if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1;}
for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx;}
return-1;};}
_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0;}
step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start;}
return range;};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self;};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError('Bind must be called on a function');var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)));};return bound;};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];}
while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args);};return bound;};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error('bindAll must be passed function names');for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj);}
return obj;};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=''+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address];};memoize.cache={};return memoize;};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null;};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null;}
previous=now;result=func.apply(context,args);if(!timeout)context=args=null;}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null;}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null;}
return result;};};_.wrap=function(func,wrapper){return _.partial(wrapper,func);};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments);};};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result;};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments);}
if(times<=1)func=null;return memo;};};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable('toString');var nonEnumerableProps=['valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=(_.isFunction(constructor)&&constructor.prototype)||ObjProto;var prop='constructor';if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop);}}}
_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys;};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys;};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]];}
return values;};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj);}
return results;};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]];}
return pairs;};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key;}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context);}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj;};obj=Object(obj);}
for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value;}
return result;};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee);}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key);};}
return _.pick(obj,iteratee,context);};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false;}
return true;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case'[object RegExp]':case'[object String]':return''+a===''+b;case'[object Number]':if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case'[object Date]':case'[object Boolean]':return+a===+b;}
var areArrays=className==='[object Array]';if(!areArrays){if(typeof a!='object'||typeof b!='object')return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&('constructor'in a&&'constructor'in b)){return false;}}
aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b;}
aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false;}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false;}}
aStack.pop();bStack.pop();return true;};_.isEqual=function(a,b){return eq(a,b);};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]';};_.isObject=function(obj){var type=typeof obj;return type==='function'||type==='object'&&!!obj;};_.each(['Arguments','Function','String','Number','Date','RegExp','Error'],function(name){_['is'+name]=function(obj){return toString.call(obj)==='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,'callee');};}
if(typeof /./!='function'&&typeof Int8Array!='object'){_.isFunction=function(obj){return typeof obj=='function'||false;};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.constant=function(value){return function(){return value;};};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key];};};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs);};};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};_.now=Date.now||function(){return new Date().getTime();};var escapeMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match];};var source='(?:'+_.keys(map).join('|')+')';var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,'g');return function(string){string=string==null?'':''+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string;};};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback;}
return _.isFunction(value)?value.call(object):value;};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return'\\'+escapes[match];};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}else if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+'return __p;\n';try{var render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
var template=function(data){return render.call(this,data,_);};var argument=settings.variable||'obj';template.source='function('+argument+'){\n'+source+'}';return template;};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance;};var result=function(instance,obj){return instance._chain?_(obj).chain():obj;};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args));};});};_.mixin(_);_.each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==='shift'||name==='splice')&&obj.length===0)delete obj[0];return result(this,obj);};});_.each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments));};});_.prototype.value=function(){return this._wrapped;};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return''+this._wrapped;};if(typeof define==='function'&&define.amd){define('underscore',[],function(){return _;});}}.call(this));(function(){this._.mixin({capitalize:function(string){return string.charAt(0).toUpperCase()+string.substring(1);},replaceMarkdown:function(type,text,regex){if(type=='hyperlink'){text=text.replace(regex,function(match,p1,p2){return'<a href="'+p2+'" target="_blank" rel="nofollow noopener">'+p1+'</a>';});}
return text;},prepareForHtml:function(text){text=text||'';var urlRegExp=new RegExp('((href="|)(ht|f)tp[s]?):\/\/([a-zA-Z-0-9-_]+)+([.][a-zA-Z-0-9-_]+)+([a-z-0-9-.,@?!*)(^=%&;:_\/~+#]*[a-z-0-9-@?!*^=%&;\/~+#])?','gi');var markdownRegExps={hyperlink:/\[(.*?)\]\((.*?)\)/g};var preparedText=this.escape(text);for(var markdownType in markdownRegExps)if(markdownRegExps.hasOwnProperty(markdownType)){preparedText=this.replaceMarkdown(markdownType,preparedText,markdownRegExps[markdownType]);}
if(text.indexOf('<script')<0){preparedText=preparedText.replace(urlRegExp,function(url){if(url.indexOf("href=")==0){return url;}
var decodedUrl=decodeURI(url);var linkContent=decodedUrl.length>30?decodedUrl.substr(0,27)+'...':decodedUrl;return'<a href="'+url+'" target="_blank" rel="nofollow noopener">'+linkContent+'</a>';}.bind(this));}
return preparedText.replace(/\b([0-9a-z][\-0-9a-z_]*\.)*([0-9a-z][\-0-9a-z_]*)@(([0-9a-z][\-0-9a-z]*\.)+[a-z]{2,6}|([0-9-][\-0-9-]*\.)+)(?=[^-a-z0-9]|$)/gi,'<a href="mailto:$&">$&</a>').replace(/(?:\r\n|\r|\n)/g,'<br />');}});}.call(this));Function.prototype.webimBind=function(_object){var __method=this;var aArgs=Array.prototype.slice.call(arguments,1);return function(){try{return __method.apply(_object,aArgs.concat(Array.prototype.slice.call(arguments)));}catch(e){tools&&tools.handleException(e);}}};if(webim.accountName=='youmagiccom001'&&window.getElementsByClassName){Element.prototype.getElementsByClassName=document.getElementsByClassName=window.getElementsByClassName;}
var $=window.$;var _=window._;var Modernizr=window.Modernizr;var classes={};var core={};var system,env;var registeredHooks={};function registerHook(hookName,handler){registeredHooks[hookName]=handler;}
function execHook(hookName,arg){if(registeredHooks[hookName]){switch(arguments.length){case 1:registeredHooks[hookName]();break;case 2:registeredHooks[hookName](arguments[1]);break;case 3:registeredHooks[hookName](arguments[1],arguments[2]);break;case 4:registeredHooks[hookName](arguments[1],arguments[2],arguments[3]);break;case 5:registeredHooks[hookName](arguments[1],arguments[2],arguments[3],arguments[4]);break;}}}
var builder={build:function(rootWrapper,radio){if(!rootWrapper.data('webimContainer')){rootWrapper.attr('data-webim-container','Base');}
this.addCustomMethods(rootWrapper);var rootContainer=this.makeContainer(rootWrapper,radio);this.makeContainerTree(rootContainer,radio);this.addWidgets(rootContainer,radio);this.addComponents(rootContainer,radio);return rootContainer;},makeContainerTree:function(rootContainer,radio){rootContainer.getWrapper().find('[data-webim-container]').not(rootContainer.getWrapper().find('[data-webim-container] [data-webim-container], [data-webim-template] [data-webim-container]')).each(function(index,elem){var container=this.makeContainer($(elem),radio);rootContainer.addChild(container);container.setParent(rootContainer);this.makeContainerTree(container,radio);}.webimBind(this));},addWidgets:function(rootContainer,radio){rootContainer.getWrapper().find('[data-webim-widget]').not(rootContainer.getWrapper().find('[data-webim-template] [data-webim-widget], [data-webim-template][data-webim-widget]')).add(rootContainer.getWrapper().filter('[data-webim-widget]')).each(function(index,elem){var widgetContainer=rootContainer.findClosestDescendant($(elem));_.each($(elem).data('webimWidget').split(/\s+/),function(widgetName){var widgetClass=classes.ui.widgets[widgetName];var widget=new widgetClass($(elem),radio,widgetContainer);widgetContainer.addWidget(widget);});}.webimBind(this));},addComponents:function(rootContainer,radio){rootContainer.getWrapper().find('[data-webim-component]').add(rootContainer.getWrapper().filter('[data-webim-component]')).each(function(index,elem){new classes.ui[$(elem).data('webimComponent')]($(elem),radio);})},makeWidget:function(wrapper,radio,container){return},makeContainer:function(wrapper,radio){return new classes.ui.Container(wrapper,radio);},addCustomMethods:function(wrapper){wrapper.find('textarea,[contenteditable]').each(function(){this.webimInsert=function(html){$(this).selection('replace',{'text':html});}.webimBind(this);this.webimCaretPosition=function(){return $(this).caret('position');}.webimBind(this);});}};var decors={addErrorMessageToFormControl:function(control,message){var wrapper=$(control);var errorWrp=$('<span>').addClass('webim-error-message webim-js-error-message').text(message);wrapper.closest('.webim-form-control').addClass('webim-error').append(errorWrp);},removeErrorMessagesFromFormControl:function(control){$(control).closest('.webim-form-control').removeClass('webim-error').find('.webim-js-error-message').remove();},removeAllErrorMessages:function(wrapper){$('.webim-error.webim-form-control',wrapper).removeClass('webim-error').find('.webim-js-error-message').remove();}};classes.EmojiList=function(){};classes.EmojiList.prototype={constructor:classes.EmojiList,each:function(callback){_.each(this.emojis,callback);},eachEmoticons:function(callback){_.each(this.getEmoticonsWithImage(),callback);},getEmoticonsWithImage:function(){return _.filter(this.emojis,function(unicode){return unicode.length===2;});},emojis:['\ud83d\ude00','\ud83d\ude01','\ud83d\ude02','\ud83d\ude03','\ud83d\ude04','\ud83d\ude05','\ud83d\ude06','\ud83d\ude07','\ud83d\ude08','\ud83d\ude09','\ud83d\ude0a','\ud83d\ude0b','\ud83d\ude0c','\ud83d\ude0d','\ud83d\ude0e','\ud83d\ude0f','\ud83d\ude10','\ud83d\ude11','\ud83d\ude12','\ud83d\ude13','\ud83d\ude14','\ud83d\ude15','\ud83d\ude16','\ud83d\ude17','\ud83d\ude18','\ud83d\ude19','\ud83d\ude1a','\ud83d\ude1b','\ud83d\ude1c','\ud83d\ude1d','\ud83d\ude1f','\ud83d\ude20','\ud83d\ude21','\ud83d\ude22','\ud83d\ude23','\ud83d\ude24','\ud83d\ude25','\ud83d\ude26','\ud83d\ude27','\ud83d\ude28','\ud83d\ude29','\ud83d\ude2a','\ud83d\ude2b','\ud83d\ude2c','\ud83d\ude2d','\ud83d\ude2e','\ud83d\ude2f','\ud83d\ude30','\ud83d\ude31','\ud83d\ude32','\ud83d\ude33','\ud83d\ude34','\ud83d\ude35','\ud83d\ude36','\ud83d\ude37','\ud83d\ude38','\ud83d\ude39','\ud83d\ude3a','\ud83d\ude3b','\ud83d\ude3c','\ud83d\ude3d','\ud83d\ude3e','\ud83d\ude3f','\ud83d\ude40','\ud83d\ude41','\ud83d\ude45','\ud83d\ude46','\ud83d\ude47','\ud83d\ude48','\ud83d\ude49','\ud83d\ude4a','\ud83d\ude4b','\ud83d\ude4c','\ud83d\ude4d','\ud83d\ude4e','\ud83d\ude4f','\ud83d\udc66','\ud83d\udc67','\ud83d\udc68','\ud83d\udc69','\ud83d\udc6a','\ud83d\udc6b','\ud83d\udc6c','\ud83d\udc6d','\ud83d\udc6e','\ud83d\udc6f','\ud83d\udc70','\ud83d\udc71','\ud83d\udc72','\ud83d\udc73','\ud83d\udc74','\ud83d\udc75','\ud83d\udc76','\ud83d\udc77','\ud83d\udc78','\ud83d\udc79','\ud83d\udc7a','\ud83d\udc7b','\ud83d\udc7c','\ud83d\udc7d','\ud83d\udc7e','\ud83d\udc7f','\ud83d\udc80','\ud83d\udc81','\ud83d\udc82','\ud83d\udc84','\ud83d\udc85','\ud83d\udc86','\ud83d\udc87','\ud83d\udc88','\ud83d\udc89','\ud83d\udc8a','\ud83d\udc8b','\ud83d\udc8c','\ud83d\udc8d','\ud83d\udc8e','\ud83d\udc8f','\ud83d\udc90','\ud83d\udc91','\ud83d\udc92','\ud83d\udc93','\ud83d\udc94','\ud83d\udc95','\ud83d\udc96','\ud83d\udc97','\ud83d\udc98','\ud83d\udc99','\ud83d\udc9a','\ud83d\udc9b','\ud83d\udc9c','\ud83d\udc9d','\ud83d\udc9e','\ud83d\udc9f','\ud83d\udc00','\ud83d\udc01','\ud83d\udc02','\ud83d\udc03','\ud83d\udc04','\ud83d\udc05','\ud83d\udc06','\ud83d\udc07','\ud83d\udc08','\ud83d\udc09','\ud83d\udc0a','\ud83d\udc0b','\ud83d\udc0c','\ud83d\udc0d','\ud83d\udc0e','\ud83d\udc0f','\ud83d\udc10','\ud83d\udc11','\ud83d\udc12','\ud83d\udc13','\ud83d\udc14','\ud83d\udc15','\ud83d\udc16','\ud83d\udc17','\ud83d\udc18','\ud83d\udc19','\ud83d\udc1a','\ud83d\udc1b','\ud83d\udc1c','\ud83d\udc1d','\ud83d\udc1e','\ud83d\udc1f','\ud83d\udc20','\ud83d\udc21','\ud83d\udc22','\ud83d\udc23','\ud83d\udc24','\ud83d\udc25','\ud83d\udc26','\ud83d\udc27','\ud83d\udc28','\ud83d\udc29','\ud83d\udc2a','\ud83d\udc2b','\ud83d\udc2c','\ud83d\udc2d','\ud83d\udc2e','\ud83d\udc2f','\ud83d\udc30','\ud83d\udc31','\ud83d\udc32','\ud83d\udc33','\ud83d\udc34','\ud83d\udc35','\ud83d\udc36','\ud83d\udc37','\ud83d\udc38','\ud83d\udc39','\ud83d\udc3a','\ud83d\udc3b','\ud83d\udc3c','\ud83d\udc3d','\u203c','\u2049','\u2122','\u2139','\u2194','\u2195','\u2196','\u2197','\u2198','\u2199','\u21a9','\u21aa','\u231a','\u231b','\u23e9','\u23ea','\u23eb','\u23ec','\u23f0','\u23f3','\u24c2','\u25aa','\u25ab','\u25b6','\u25c0','\u25fb','\u25fc','\u25fd','\u25fe','\u2600','\u2601','\u260e','\u2611','\u2614','\u2615','\u261d','\u263a','\u2648','\u2649','\u264a','\u264b','\u264c','\u264d','\u264e','\u264f','\u2650','\u2651','\u2652','\u2653','\u2660','\u2663','\u2665','\u2666','\u2668','\u267b','\u267f','\u2693','\u26a0','\u26aa','\u26ab','\u26bd','\u26be','\u26c4','\u26c5','\u26ce','\u26d4','\u26ea','\u26f2','\u26f3','\u26f5','\u26fa','\u26fd','\u2702','\u2705','\u2708','\u2709','\u270a','\u270b','\u270c','\u270f','\u2712','\u2714','\u2716','\u2728','\u2733','\u2734','\u2744','\u2747','\u274c','\u274e','\u2753','\u2754','\u2755','\u2757','\u2764','\u2795','\u2796','\u2797','\u27a1','\u27b0','\u27bf','\u2934','\u2935','\u2b05','\u2b06','\u2b07','\u2b1b','\u2b1c','\u2b50','\u2b55','\u3030','\u303d','\u3297','\u3299','\ud83c\udc04','\ud83c\udccf','\ud83c\udd70','\ud83c\udd71','\ud83c\udd7e','\ud83c\udd7f','\ud83c\udd8e','\ud83c\udd91','\ud83c\udd92','\ud83c\udd93','\ud83c\udd94','\ud83c\udd95','\ud83c\udd96','\ud83c\udd97','\ud83c\udd98','\ud83c\udd99','\ud83c\udd9a','\ud83c\ude01','\ud83c\ude02','\ud83c\ude1a','\ud83c\ude2f','\ud83c\ude32','\ud83c\ude33','\ud83c\ude34','\ud83c\ude35','\ud83c\ude36','\ud83c\ude37','\ud83c\ude38','\ud83c\ude39','\ud83c\ude3a','\ud83c\ude50','\ud83c\ude51','\ud83c\udf00','\ud83c\udf01','\ud83c\udf02','\ud83c\udf03','\ud83c\udf04','\ud83c\udf05','\ud83c\udf06','\ud83c\udf07','\ud83c\udf08','\ud83c\udf09','\ud83c\udf0a','\ud83c\udf0b','\ud83c\udf0c','\ud83c\udf0d','\ud83c\udf0e','\ud83c\udf0f','\ud83c\udf10','\ud83c\udf11','\ud83c\udf12','\ud83c\udf13','\ud83c\udf14','\ud83c\udf15','\ud83c\udf16','\ud83c\udf17','\ud83c\udf18','\ud83c\udf19','\ud83c\udf1a','\ud83c\udf1b','\ud83c\udf1c','\ud83c\udf1d','\ud83c\udf1e','\ud83c\udf1f','\ud83c\udf20','\ud83c\udf30','\ud83c\udf31','\ud83c\udf32','\ud83c\udf33','\ud83c\udf34','\ud83c\udf35','\ud83c\udf37','\ud83c\udf38','\ud83c\udf39','\ud83c\udf3a','\ud83c\udf3b','\ud83c\udf3c','\ud83c\udf3d','\ud83c\udf3e','\ud83c\udf3f','\ud83c\udf40','\ud83c\udf41','\ud83c\udf42','\ud83c\udf43','\ud83c\udf44','\ud83c\udf45','\ud83c\udf46','\ud83c\udf47','\ud83c\udf48','\ud83c\udf49','\ud83c\udf4a','\ud83c\udf4b','\ud83c\udf4c','\ud83c\udf4d','\ud83c\udf4e','\ud83c\udf4f','\ud83c\udf50','\ud83c\udf51','\ud83c\udf52','\ud83c\udf53','\ud83c\udf54','\ud83c\udf55','\ud83c\udf56','\ud83c\udf57','\ud83c\udf58','\ud83c\udf59','\ud83c\udf5a','\ud83c\udf5b','\ud83c\udf5c','\ud83c\udf5d','\ud83c\udf5e','\ud83c\udf5f','\ud83c\udf60','\ud83c\udf61','\ud83c\udf62','\ud83c\udf63','\ud83c\udf64','\ud83c\udf65','\ud83c\udf66','\ud83c\udf67','\ud83c\udf68','\ud83c\udf69','\ud83c\udf6a','\ud83c\udf6b','\ud83c\udf6c','\ud83c\udf6d','\ud83c\udf6e','\ud83c\udf6f','\ud83c\udf70','\ud83c\udf71','\ud83c\udf72','\ud83c\udf73','\ud83c\udf74','\ud83c\udf75','\ud83c\udf76','\ud83c\udf77','\ud83c\udf78','\ud83c\udf79','\ud83c\udf7a','\ud83c\udf7b','\ud83c\udf7c','\ud83c\udf80','\ud83c\udf81','\ud83c\udf82','\ud83c\udf83','\ud83c\udf84','\ud83c\udf85','\ud83c\udf86','\ud83c\udf87','\ud83c\udf88','\ud83c\udf89','\ud83c\udf8a','\ud83c\udf8b','\ud83c\udf8c','\ud83c\udf8d','\ud83c\udf8e','\ud83c\udf8f','\ud83c\udf90','\ud83c\udf91','\ud83c\udf92','\ud83c\udf93','\ud83c\udfa0','\ud83c\udfa1','\ud83c\udfa2','\ud83c\udfa3','\ud83c\udfa4','\ud83c\udfa5','\ud83c\udfa6','\ud83c\udfa7','\ud83c\udfa8','\ud83c\udfa9','\ud83c\udfaa','\ud83c\udfab','\ud83c\udfac','\ud83c\udfad','\ud83c\udfae','\ud83c\udfaf','\ud83c\udfb0','\ud83c\udfb1','\ud83c\udfb2','\ud83c\udfb3','\ud83c\udfb4','\ud83c\udfb5','\ud83c\udfb6','\ud83c\udfb7','\ud83c\udfb8','\ud83c\udfb9','\ud83c\udfba','\ud83c\udfbb','\ud83c\udfbc','\ud83c\udfbd','\ud83c\udfbe','\ud83c\udfbf','\ud83c\udfc0','\ud83c\udfc1','\ud83c\udfc2','\ud83c\udfc3','\ud83c\udfc4','\ud83c\udfc6','\ud83c\udfc7','\ud83c\udfc8','\ud83c\udfc9','\ud83c\udfca','\ud83c\udfe0','\ud83c\udfe1','\ud83c\udfe2','\ud83c\udfe3','\ud83c\udfe4','\ud83c\udfe5','\ud83c\udfe6','\ud83c\udfe7','\ud83c\udfe8','\ud83c\udfe9','\ud83c\udfea','\ud83c\udfeb','\ud83c\udfec','\ud83c\udfed','\ud83c\udfee','\ud83c\udfef','\ud83c\udff0','\ud83d\udc3e','\ud83d\udc40','\ud83d\udc42','\ud83d\udc43','\ud83d\udc44','\ud83d\udc45','\ud83d\udc46','\ud83d\udc47','\ud83d\udc48','\ud83d\udc49','\ud83d\udc4a','\ud83d\udc4b','\ud83d\udc4c','\ud83d\udc4d','\ud83d\udc4e','\ud83d\udc4f','\ud83d\udc50','\ud83d\udc51','\ud83d\udc52','\ud83d\udc53','\ud83d\udc54','\ud83d\udc55','\ud83d\udc56','\ud83d\udc57','\ud83d\udc58','\ud83d\udc59','\ud83d\udc5a','\ud83d\udc5b','\ud83d\udc5c','\ud83d\udc5d','\ud83d\udc5e','\ud83d\udc5f','\ud83d\udc60','\ud83d\udc61','\ud83d\udc62','\ud83d\udc63','\ud83d\udc64','\ud83d\udc65','\ud83d\udca0','\ud83d\udca1','\ud83d\udca2','\ud83d\udca3','\ud83d\udca4','\ud83d\udca5','\ud83d\udca6','\ud83d\udca7','\ud83d\udca8','\ud83d\udca9','\ud83d\udcaa','\ud83d\udcab','\ud83d\udcac','\ud83d\udcad','\ud83d\udcae','\ud83d\udcb0','\ud83d\udcb1','\ud83d\udcb2','\ud83d\udcb3','\ud83d\udcb4','\ud83d\udcb5','\ud83d\udcb6','\ud83d\udcb7','\ud83d\udcb8','\ud83d\udcb9','\ud83d\udcba','\ud83d\udcbb','\ud83d\udcbc','\ud83d\udcbd','\ud83d\udcbe','\ud83d\udcbf','\ud83d\udcc0','\ud83d\udcc1','\ud83d\udcc2','\ud83d\udcc3','\ud83d\udcc4','\ud83d\udcc5','\ud83d\udcc6','\ud83d\udcc7','\ud83d\udcc8','\ud83d\udcc9','\ud83d\udcca','\ud83d\udccb','\ud83d\udccc','\ud83d\udccd','\ud83d\udcce','\ud83d\udccf','\ud83d\udcd0','\ud83d\udcd1','\ud83d\udcd2','\ud83d\udcd3','\ud83d\udcd4','\ud83d\udcd5','\ud83d\udcd6','\ud83d\udcd7','\ud83d\udcd8','\ud83d\udcd9','\ud83d\udcda','\ud83d\udcdb','\ud83d\udcdc','\ud83d\udcdd','\ud83d\udcde','\ud83d\udcdf','\ud83d\udce0','\ud83d\udce1','\ud83d\udce2','\ud83d\udce3','\ud83d\udce4','\ud83d\udce5','\ud83d\udce6','\ud83d\udce7','\ud83d\udce8','\ud83d\udce9','\ud83d\udcea','\ud83d\udceb','\ud83d\udcec','\ud83d\udced','\ud83d\udcee','\ud83d\udcef','\ud83d\udcf0','\ud83d\udcf1','\ud83d\udcf2','\ud83d\udcf3','\ud83d\udcf4','\ud83d\udcf5','\ud83d\udcf6','\ud83d\udcf7','\ud83d\udcf9','\ud83d\udcfa','\ud83d\udcfb','\ud83d\udcfc','\ud83d\udd00','\ud83d\udd01','\ud83d\udd02','\ud83d\udd03','\ud83d\udd04','\ud83d\udd05','\ud83d\udd06','\ud83d\udd07','\ud83d\udd08','\ud83d\udd09','\ud83d\udd0a','\ud83d\udd0b','\ud83d\udd0c','\ud83d\udd0d','\ud83d\udd0e','\ud83d\udd0f','\ud83d\udd10','\ud83d\udd11','\ud83d\udd12','\ud83d\udd13','\ud83d\udd14','\ud83d\udd15','\ud83d\udd16','\ud83d\udd17','\ud83d\udd18','\ud83d\udd19','\ud83d\udd1a','\ud83d\udd1b','\ud83d\udd1c','\ud83d\udd1d','\ud83d\udd1e','\ud83d\udd1f','\ud83d\udd20','\ud83d\udd21','\ud83d\udd23','\ud83d\udd24','\ud83d\udd25','\ud83d\udd26','\ud83d\udd27','\ud83d\udd28','\ud83d\udd29','\ud83d\udd2a','\ud83d\udd2b','\ud83d\udd2c','\ud83d\udd2d','\ud83d\udd2e','\ud83d\udd2f','\ud83d\udd30','\ud83d\udd31','\ud83d\udd32','\ud83d\udd33','\ud83d\udd34','\ud83d\udd35','\ud83d\udd36','\ud83d\udd37','\ud83d\udd38','\ud83d\udd39','\ud83d\udd3a','\ud83d\udd3b','\ud83d\udd3c','\ud83d\udd3d','\ud83d\udd50','\ud83d\udd51','\ud83d\udd52','\ud83d\udd53','\ud83d\udd54','\ud83d\udd55','\ud83d\udd56','\ud83d\udd57','\ud83d\udd58','\ud83d\udd59','\ud83d\udd5a','\ud83d\udd5b','\ud83d\udd5c','\ud83d\udd5d','\ud83d\udd5e','\ud83d\udd5f','\ud83d\udd60','\ud83d\udd61','\ud83d\udd62','\ud83d\udd63','\ud83d\udd64','\ud83d\udd65','\ud83d\udd66','\ud83d\udd67','\ud83d\uddfb','\ud83d\uddfc','\ud83d\uddfd','\ud83d\uddfe','\ud83d\uddff','\ud83d\ude80','\ud83d\ude81','\ud83d\ude82','\ud83d\ude83','\ud83d\ude84','\ud83d\ude85','\ud83d\ude86','\ud83d\ude87','\ud83d\ude88','\ud83d\ude89','\ud83d\ude8a','\ud83d\ude8b','\ud83d\ude8c','\ud83d\ude8d','\ud83d\ude8e','\ud83d\ude8f','\ud83d\ude90','\ud83d\ude91','\ud83d\ude92','\ud83d\ude93','\ud83d\ude94','\ud83d\ude95','\ud83d\ude96','\ud83d\ude97','\ud83d\ude98','\ud83d\ude99','\ud83d\ude9a','\ud83d\ude9b','\ud83d\ude9c','\ud83d\ude9d','\ud83d\ude9e','\ud83d\ude9f','\ud83d\udea0','\ud83d\udea1','\ud83d\udea2','\ud83d\udea3','\ud83d\udea4','\ud83d\udea5','\ud83d\udea6','\ud83d\udea7','\ud83d\udea8','\ud83d\udea9','\ud83d\udeaa','\ud83d\udeab','\ud83d\udeac','\ud83d\udead','\ud83d\udeae','\ud83d\udeaf','\ud83d\udeb0','\ud83d\udeb1','\ud83d\udeb2','\ud83d\udeb3','\ud83d\udeb4','\ud83d\udeb5','\ud83d\udeb6','\ud83d\udeb7','\ud83d\udeb8','\ud83d\udeb9','\ud83d\udeba','\ud83d\udebb','\ud83d\udebc','\ud83d\udebd','\ud83d\udebe','\ud83d\udebf','\ud83d\udec0','\ud83d\udec1','\ud83d\udec2','\ud83d\udec3','\ud83d\udec4','\ud83d\udec5','\ufe0f','\ud83d\udc83']};var sha256={HMAC_SHA256_key:null,SHA256_H:null,SHA256_buf:null,SHA256_len:0,string_to_array:function(str){var len=str.length;var res=new Array(len);for(var i=0;i<len;i++)
res[i]=str.charCodeAt(i);return res;},array_to_hex_string:function(ary){var res="";for(var i=0;i<ary.length;i++)
res+=this.SHA256_hexchars[ary[i]>>4]+this.SHA256_hexchars[ary[i]&0x0f];return res;},SHA256_init:function(){this.SHA256_H=[0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19];this.SHA256_buf=[];this.SHA256_len=0;},SHA256_write:function(msg){if(typeof(msg)=="string")
this.SHA256_buf=this.SHA256_buf.concat(this.string_to_array(msg));else
this.SHA256_buf=this.SHA256_buf.concat(msg);for(var i=0;i+64<=this.SHA256_buf.length;i+=64)
this.SHA256_Hash_Byte_Block(this.SHA256_H,this.SHA256_buf.slice(i,i+64));this.SHA256_buf=this.SHA256_buf.slice(i);this.SHA256_len+=msg.length;},SHA256_finalize:function(){this.SHA256_buf[this.SHA256_buf.length]=0x80;if(this.SHA256_buf.length>64-8){for(var i=this.SHA256_buf.length;i<64;i++){this.SHA256_buf[i]=0;}
this.SHA256_Hash_Byte_Block(this.SHA256_H,this.SHA256_buf);this.SHA256_buf.length=0;}
for(var i=this.SHA256_buf.length;i<64-5;i++){this.SHA256_buf[i]=0;}
this.SHA256_buf[59]=(this.SHA256_len>>>29)&0xff;this.SHA256_buf[60]=(this.SHA256_len>>>21)&0xff;this.SHA256_buf[61]=(this.SHA256_len>>>13)&0xff;this.SHA256_buf[62]=(this.SHA256_len>>>5)&0xff;this.SHA256_buf[63]=(this.SHA256_len<<3)&0xff;this.SHA256_Hash_Byte_Block(this.SHA256_H,this.SHA256_buf);var res=new Array(32);for(var i=0;i<8;i++){res[4*i]=this.SHA256_H[i]>>>24;res[4*i+1]=(this.SHA256_H[i]>>16)&0xff;res[4*i+2]=(this.SHA256_H[i]>>8)&0xff;res[4*i+3]=this.SHA256_H[i]&0xff;}
delete this.SHA256_H;delete this.SHA256_buf;delete this.SHA256_len;return res;},SHA256_hash:function(msg){var res;this.SHA256_init();this.SHA256_write(msg);res=this.SHA256_finalize();return this.array_to_hex_string(res);},HMAC_SHA256_init:function(key){if(typeof(key)=="string")
this.HMAC_SHA256_key=this.string_to_array(key);else
this.HMAC_SHA256_key=new Array().concat(key);if(this.HMAC_SHA256_key.length>64){this.SHA256_init();this.SHA256_write(this.HMAC_SHA256_key);this.HMAC_SHA256_key=this.SHA256_finalize();}
for(var i=this.HMAC_SHA256_key.length;i<64;i++){this.HMAC_SHA256_key[i]=0;}
for(var i=0;i<64;i++){this.HMAC_SHA256_key[i]^=0x36;}
this.SHA256_init();this.SHA256_write(this.HMAC_SHA256_key);},HMAC_SHA256_write:function(msg){this.SHA256_write(msg);},HMAC_SHA256_finalize:function(){var md=this.SHA256_finalize();for(var i=0;i<64;i++){this.HMAC_SHA256_key[i]^=0x36^0x5c;}
this.SHA256_init();this.SHA256_write(this.HMAC_SHA256_key);this.SHA256_write(md);for(var i=0;i<64;i++){this.HMAC_SHA256_key[i]=0;}
delete this.HMAC_SHA256_key;return this.SHA256_finalize();},HMAC_SHA256_MAC:function(key,msg){var res;this.HMAC_SHA256_init(key);this.HMAC_SHA256_write(msg);res=this.HMAC_SHA256_finalize();return this.array_to_hex_string(res);},SHA256_hexchars:['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'],SHA256_K:[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],SHA256_sigma0:function(x){return((x>>>7)|(x<<25))^((x>>>18)|(x<<14))^(x>>>3);},SHA256_sigma1:function(x){return((x>>>17)|(x<<15))^((x>>>19)|(x<<13))^(x>>>10);},SHA256_Sigma0:function(x){return((x>>>2)|(x<<30))^((x>>>13)|(x<<19))^((x>>>22)|(x<<10));},SHA256_Sigma1:function(x){return((x>>>6)|(x<<26))^((x>>>11)|(x<<21))^((x>>>25)|(x<<7));},SHA256_Ch:function(x,y,z){return z^(x&(y^z));},SHA256_Maj:function(x,y,z){return(x&y)^(z&(x^y));},SHA256_Hash_Word_Block:function(H,W){for(var i=16;i<64;i++)
W[i]=(this.SHA256_sigma1(W[i-2])+W[i-7]+
this.SHA256_sigma0(W[i-15])+W[i-16])&0xffffffff;var state=new Array().concat(H);for(var i=0;i<64;i++){var T1=state[7]+this.SHA256_Sigma1(state[4])+
this.SHA256_Ch(state[4],state[5],state[6])+this.SHA256_K[i]+W[i];var T2=this.SHA256_Sigma0(state[0])+this.SHA256_Maj(state[0],state[1],state[2]);state.pop();state.unshift((T1+T2)&0xffffffff);state[4]=(state[4]+T1)&0xffffffff;}
for(var i=0;i<8;i++)
H[i]=(H[i]+state[i])&0xffffffff;},SHA256_Hash_Byte_Block:function(H,w){var W=new Array(16);for(var i=0;i<16;i++)
W[i]=w[4*i]<<24|w[4*i+1]<<16|w[4*i+2]<<8|w[4*i+3];this.SHA256_Hash_Word_Block(H,W);}}
var tools={hexHashSha256:function(value,key){if(key){sha256.HMAC_SHA256_init(key);sha256.HMAC_SHA256_write(value);var mac=sha256.HMAC_SHA256_finalize();return sha256.array_to_hex_string(mac)}else{sha256.SHA256_init();sha256.SHA256_write(value);return sha256.array_to_hex_string(sha256.SHA256_finalize());}},addScriptElement:function(src,scriptId){var s=document.createElement('script');s.type='text/javascript';s.src=src;s.charset='utf-8';if(scriptId){s.id=scriptId;}
document.getElementsByTagName('head')[0].appendChild(s);return s;},addLinkElement:function(type,href,rel){var s=document.createElement('link');s.type=type;s.href=href;s.rel=rel;document.getElementsByTagName('head')[0].appendChild(s);},crossDomainRequest:function(url,onSuccess,callbackName,onTimeout,timeout){callbackName=callbackName===undefined||callbackName===null?'webimRequestCallback'+Math.floor(Math.random()*100000000000000000):callbackName;window[callbackName]=function(responseData,responseData2){window[callbackName]=null;var script=document.getElementById('webim_'+callbackName);document.getElementsByTagName('head')[0].removeChild(script);onSuccess&&onSuccess(responseData);};if(typeof onTimeout==='function'){setTimeout(function(){if(window[callbackName]!==null){window[callbackName]=null;var script=document.getElementById('webim_'+callbackName);document.getElementsByTagName('head')[0].removeChild(script);onTimeout(null);}},timeout);}
this.addScriptElement(url+(url.indexOf('?')>0?'&':'?')+'callback='+callbackName,'webim_'+callbackName);},getUrlParam:function(paramName){var search=document.location.search;var idx=search.indexOf('&'+paramName+'=');if(idx<0){idx=search.indexOf('?'+paramName+'=');}
if(idx<0){return null;}
idx+=paramName.length+2;var endIdx=search.indexOf('&',idx);if(endIdx<0){endIdx=search.length;}
return decodeURIComponent(search.substring(idx,endIdx));},fixFlashWmode:function(){var wrp;$('object>param[name="wmode"]').each(function(idx,element){wrp=$(element);wrp.attr('value','opaque');var parentWrp=wrp.parent('object');var display=parentWrp.css('display');parentWrp.css('display','none').css('display',display);});wrp=$('embed');wrp.attr('wmode','opaque');wrp.hide();setTimeout(function(){wrp.show();},0);if(_.contains(['localhost002','comitaru','webplusru001','jobdistancecom'],env.accountName)){$('object').each(function(idx,element){var wrp=$(element);wrp.append($('<param name="wmode" value="opaque"/>'));var parentWrp=wrp.parent('object');var display=parentWrp.css('display');parentWrp.css('display','none').css('display',display);});}
$('iframe').each(function(idx,element){var wrp=$(element);var src=wrp.attr('src');if(src.indexOf('youtube.com/embed')>=0){wrp.attr('src',src+(src.indexOf('?')>=0?'&':'?')+'wmode=opaque');}});},isCrossDomainFrame:function(){if(!window.parent){return false;}
try{var x=window.parent.location.host;return false;}catch(e){return true;}},createUiObject:function(basePrototype,extProps){_.each(['ui','events','widgetEvents','parentEvents','childrenEvents','bindings','modelEvents','containerEvents','subEvents'],function(extendingField){if(_.isObject(basePrototype[extendingField])&&_.isObject(extProps[extendingField])){_.defaults(extProps[extendingField]||{},basePrototype[extendingField]||{});}});return _.create(basePrototype,extProps);},hash:function(value){var source=JSON.stringify(value);var seed=0x811c9dc5;for(var i=0;i<source.length;i++){seed+=(seed<<1)+(seed<<4)+(seed<<7)+(seed<<8)+(seed<<24);seed^=source.charCodeAt(i);}
return(seed>>>0).toString(16);},formatTime:function(dateObj){return this.lpad(dateObj.getHours(),2)+':'+this.lpad(dateObj.getMinutes(),2);},formatDate:function(dateObj,formatString,lang){formatString=formatString||'DD.MM';lang=lang||window.navigator.language;var formattedDate=moment(dateObj);formattedDate.lang(lang);return formattedDate.format(formatString);},formatSize:function(size){if(size===undefined||/\D/.test(size)){return'N/A';}
function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision);}
var boundary=Math.pow(1024,4);if(size>boundary){return round(size/boundary,1)+' tb';}
if(size>(boundary/=1024)){return round(size/boundary,1)+' gb';}
if(size>(boundary/=1024)){return round(size/boundary,1)+' mb';}
if(size>1024){return Math.round(size/1024)+' kb';}
return size+" b";},lpad:function(val,len){val=String(val);len=len||1;while(val.length<len)val='0'+val;return val;},handleException:function(exception){try{var error=''+exception+'\n'+this.getStackTrace(exception);this.crossDomainRequest(env.getBaseUrl()+'/l/v/js-error.php?error='+encodeURIComponent(error.length>1000?error.substr(0,1000)+'...':error));core.logger&&core.logger.log(error);}catch(e){core.logger&&core.logger.log(e);}},getStackTrace:function(e){if(e.stack){return e.stack;}else if(window.opera&&e.message){return e.message;}else{var result='';var currentFunction=arguments.callee.caller;while(currentFunction){var fn=currentFunction.toString();var fname=fn.substring(fn.indexOf('function')+8,fn.indexOf(''))||'anonymous';result+='\n'+fname;currentFunction=currentFunction.caller;}
return result;}},parseUrl:function(url){var result={baseUrl:url,params:{}};var idx=url.indexOf('?');if(idx===-1){return result;}
result.baseUrl=url.substring(0,idx);var paramStrs=url.substring(idx+1).split('&');for(var i in paramStrs)if(paramStrs.hasOwnProperty(i)){var nameValuePair=paramStrs[i].split('=');result.params[nameValuePair[0]]=decodeURIComponent(nameValuePair[1]);}
return result;},formatUrl:function(urlObject){var paramStrs=[];for(var name in urlObject.params)if(urlObject.params.hasOwnProperty(name)){paramStrs.push(name+'='+encodeURIComponent(urlObject.params[name]));}
var search=paramStrs.join('&');return urlObject.baseUrl+(search?'?'+search:'');},setUrlParam:function(url,paramName,value){var urlObject=this.parseUrl(url);urlObject.params[paramName]=value;return this.formatUrl(urlObject);},guid:function(){return'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);});},eventMethodsToEventCallbacks:function(eventMethods,object){var eventsObj={};if(eventMethods){_.each(eventMethods,function(methodNames,event){_.each(methodNames.split(/\s+/),function(methodName){!eventsObj[event]&&(eventsObj[event]=[]);eventsObj[event].push(object[methodName].webimBind(object));});});}
return eventsObj;},emojiToHexCode:function(unicode){return((unicode.charCodeAt(0)-0xD800)*0x400+(unicode.charCodeAt(1)-0xDC00)+0x10000).toString(16);},makeBase:function(mixins,baseProto){if(!_.isArray(mixins)){baseProto=mixins;mixins=undefined;}
var baseConstructor=_.has(baseProto,'constructor')?baseProto.constructor:function(){};var Surrogate=function(){this.constructor=baseConstructor;};Surrogate.prototype=baseProto;baseConstructor.prototype=new Surrogate;_.extend(baseConstructor,classes.libs.Extendable);return mixins?baseConstructor.mix(mixins):baseConstructor;}};var validator={emailRegExp:/^([0-9a-z][\-0-9a-z_]*\.)*([0-9a-z][\-0-9a-z_]*)@(([0-9a-z][\-0-9a-z]*\.)+[a-z]{2,6}|([0-9-][\-0-9-]*\.)+)$/i,urlRegExp:/((ht|f)tp[s]?):\/\/([a-zA-Z-0-9-_]+)+([.][a-zA-Z-0-9-_]+)+([a-z-0-9-.,@?!*)(^=%&;:_\/~+#]*[a-z-0-9-@?!*^=%&;\/~+#])?/i,validate:function(value,rules){var rulesArr=_.isString(rules)?[rules]:rules;var result=true;_.each(rules,function(conf,index){var ruleName=_.isString(index)?index:conf;if(this[this.ruleToMethodName(ruleName)](value,conf)!==true){result=ruleName;return false;}}.webimBind(this));return result;},isNotEmpty:function(value){return Boolean(value)&&!_.isEmpty(value);},isEmail:function(value){return!Boolean(value)||this.emailRegExp.test(value);},isLongerThan:function(value,minSize){return _.isString(value)&&(value.length>minSize);},isShorterThan:function(value,maxSize){return _.isString(value)&&(value.length<maxSize);},isMatchesMask:function(value,mask){var phoneRegExp=this.getPhoneRegexMask(mask);return!Boolean(value)||!phoneRegExp||phoneRegExp.test(value);},isPhoneNumberSymbols:function(value){var phoneNumberSymbolsReg=/^[\sx)(0-9+-]+$/;return!Boolean(value)||phoneNumberSymbolsReg.test(value);},isRussianPhone:function(value){var phoneReg=/^( +)?((\+?7|8) ?)?((\([0-58-9]\d{2}\))|([0-58-9]\d{2}))?( )?(\d{3}[\- ]?\d{2}[\- ]?\d{2})( +)?$/;return!Boolean(value)||phoneReg.test(value);},ruleToErrorMessage:function(ruleName,conf){switch(ruleName){case'not_empty':return core.resources.get('chat.error_message.fill_field');case'email':return core.resources.get('chat.error_message.email_incorrect');case'shorter_than':return core.resources.get('chat.error_message.value_too_long',{'max_size':conf});case'longer_than':return core.resources.get('chat.error_message.value_too_short',{'min_size':conf});case'matches_mask':return core.resources.get('chat.error_message.phone_incorrect');case'phone_number_symbols':return core.resources.get('chat.error_message.phone_number_symbols_only');case'russian_phone':return core.resources.get('chat.error_message.russian_phone_incorrect');default:return core.resources.get('chat.error_message.undescribed_validate_error');}},ruleToMethodName:function(ruleName){var methodName='is';var ruleNameParts=ruleName.split('_');$.each(ruleNameParts,function(index,namePart){methodName+=namePart[0].toUpperCase()+namePart.slice(1);});return methodName;},getPhoneRegexMask:function(mask){if(!mask){return}
var maskChunks=[],pattern,optional,recursive,oRecursive,r;var translation={'X':{pattern:/\d/},'x':{pattern:/\d/,optional:true},'#':{pattern:/\d/,recursive:true},'A':{pattern:/[a-zA-Z0-9]/},'S':{pattern:/[a-zA-Z]/}};for(var i=0;i<mask.length;i++){var substitute=translation[mask.charAt(i)];if(substitute){pattern=substitute.pattern.toString().replace(/.{1}$|^.{1}/g,'');optional=substitute.optional;recursive=substitute.recursive;if(recursive){maskChunks.push(mask.charAt(i));oRecursive={digit:mask.charAt(i),pattern:pattern};}else{maskChunks.push(!optional&&!recursive?pattern:(pattern+'?'));}}else{maskChunks.push(mask.charAt(i).replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'));}}
r=maskChunks.join('');if(oRecursive){r=r.replace(new RegExp('('+oRecursive.digit+'(.*'+oRecursive.digit+')?)'),'($1)?').replace(new RegExp(oRecursive.digit,'g'),oRecursive.pattern);}
return new RegExp('^'+r+'$');}};classes.libs={};classes.libs.Extendable={extend:function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps){_.extend(child.prototype,protoProps);}
child.__super__=parent.prototype;return child;},mix:function(mixins){var target=this;if(!_.isArray(mixins)){mixins=[mixins];}
var newMixinsWithDependencies=_.chain(this.getAllMixinsDependencies(mixins)).unique().difference(target._mixed||[]).value();var mixedProto=_.reduce(newMixinsWithDependencies,function(mixedProto,mixin){return _.extend(mixedProto,mixin.getMixProps());},{});var mixinCallbacks={};_.each(newMixinsWithDependencies,function(mixin){_.each(mixin.getCallbacks(),function(callback,methodName){!_.has(mixinCallbacks,methodName)&&(mixinCallbacks[methodName]={after:[],before:[]});callback['after']&&mixinCallbacks[methodName]['after'].push(callback['after']);callback['before']&&mixinCallbacks[methodName]['before'].push(callback['before']);});});mixedProto.constructor=function(){_.each(mixinCallbacks,function(callbacks,methodName){this[methodName]=_.wrap(this[methodName],function(origMethod){_.invoke(callbacks['before'],'call',this);origMethod&&origMethod.apply(this,arguments);_.invoke(callbacks['after'],'call',this);});}.webimBind(this));target.apply(this,arguments);};var mixed=target.extend(mixedProto);mixed._mixed=target._mixed?target._mixed.slice():[];mixed._mixed.concat(newMixinsWithDependencies);return mixed;},getAllMixinsDependencies:function(mixins){var depends=[];_.each(mixins,function(mixin){depends=depends.concat(this.getAllMixinsDependencies(mixin.getDependencies()),mixin);}.webimBind(this));return depends;}};classes.libs.Event=function(type,source,args){this.type=type;this.source=this.source=source;this.args=args||[];};classes.libs.Event.makeFrom=function(event,from){var copy=_.clone(event);copy.from=from;return copy;};_.extend(classes.libs.Event.prototype,{type:'',source:null,from:null,args:null,stopped:false,getType:function(){return this.type;},getSource:function(){return this.source;},getFrom:function(){return this.from;},getData:function(){return this.args;},isStopped:function(){return this.stopped;},stopPropagation:function(){this.stopped=true;}});(function(){var Events=classes.libs.Events={};var eventSplitter=/\s+/;var eventsApi=function(iteratee,memo,name,callback,opts){var i=0,names;if(name&&typeof name==='object'){if(callback!==void 0&&'context'in opts&&opts.context===void 0)opts.context=callback;for(names=_.keys(name);i<names.length;i++){memo=iteratee(memo,names[i],name[names[i]],opts);}}else if(name&&eventSplitter.test(name)){for(names=name.split(eventSplitter);i<names.length;i++){memo=iteratee(memo,names[i],callback,opts);}}else{memo=iteratee(memo,name,callback,opts);}
return memo;};Events.on=function(name,callback,context){return internalOn(this,name,callback,context);};var internalOn=function(obj,name,callback,context,listening){obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening});if(listening){var listeners=obj._listeners||(obj._listeners={});listeners[listening.id]=listening;}
return obj;};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId('l'));var listeningTo=this._listeningTo||(this._listeningTo={});var listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_.uniqueId('l'));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0};}
internalOn(obj,name,callback,this,listening);return this;};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]);var context=options.context,ctx=options.ctx,listening=options.listening;if(listening)listening.count++;handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening});}
return events;};Events.off=function(name,callback,context){if(!this._events)return this;this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners});return this;};Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var ids=obj?[obj._listenId]:_.keys(listeningTo);for(var i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this);}
if(_.isEmpty(listeningTo))this._listeningTo=void 0;return this;};var offApi=function(events,name,callback,options){if(!events)return;var i=0,listening;var context=options.context,listeners=options.listeners;if(!name&&!callback&&!context){var ids=_.keys(listeners);for(;i<ids.length;i++){listening=listeners[ids[i]];delete listeners[listening.id];delete listening.listeningTo[listening.objId];}
return;}
var names=name?[name]:_.keys(events);for(;i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;var remaining=[];for(var j=0;j<handlers.length;j++){var handler=handlers[j];if(callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context){remaining.push(handler);}else{listening=handler.listening;if(listening&&--listening.count===0){delete listeners[listening.id];delete listening.listeningTo[listening.objId];}}}
if(remaining.length){events[name]=remaining;}else{delete events[name];}}
if(_.size(events))return events;};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));return this.on(events,void 0,context);};Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events);};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once);callback.apply(this,arguments);});once._callback=callback;}
return map;};Events.trigger=function(name){if(!this._events)return this;var length=Math.max(0,arguments.length-1);var args=Array(length);for(var i=0;i<length;i++)args[i]=arguments[i+1];eventsApi(triggerApi,this._events,name,void 0,args);return this;};var triggerApi=function(objEvents,name,cb,args){if(objEvents){var events=objEvents[name];var allEvents=objEvents.all;if(events&&allEvents)allEvents=allEvents.slice();if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,[name].concat(args));}
return objEvents;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return;}};}());classes.libs.Mixin=function(dependenciesOrMixProps,mixProps,callbacks){this.dependencies=[];if(_.isArray(dependenciesOrMixProps)){this.dependencies=dependenciesOrMixProps;}else{callbacks=mixProps||{};mixProps=dependenciesOrMixProps;}
this.callbacks={};_.each(callbacks,function(callback,methodWrapName){var methodParts=methodWrapName.split(':');var methodName=methodParts[1],callbackPlace=methodParts[0];!_.has(this.callbacks,methodName)&&(this.callbacks[methodName]={after:null,before:null});this.callbacks[methodName][callbackPlace]=callback;}.webimBind(this));this.mixProps=_.clone(mixProps);};classes.libs.Mixin.prototype={constructor:classes.libs.Mixin,dependencies:null,callbacks:null,mixProps:null,getCallbacks:function(){return this.callbacks;},getMixProps:function(){return this.mixProps||{};},getDependencies:function(){return this.dependencies||[];}};classes.libs.Region=function(container,wrapper){this.wrapper=wrapper;this.container=container;};_.extend(classes.libs.Region.prototype,classes.libs.Events,{wrapper:null,container:null,view:null,showView:function(view){this.view&&this.view.destroy();this.view=view;this.container.addChild(view.getContainer());view.getContainer().setParent(this.container);this.wrapper.html(view.getWrapper());view.show();},destroy:function(){this.wrapper=this.container=this.view=null;}});classes.mixins={};classes.mixins.Bindings={bindings:null,initBindings:function(wrapper,model){_.each(this.bindings||{},function(fieldRule,selector){var parsedSelector=this.replaceUiSugar(selector);var fieldWrapper=wrapper.find(parsedSelector).addBack(parsedSelector);if(_.isString(fieldRule)){this.listenTo(model,fieldRule+':afterUpdate',function(text){fieldWrapper.text(text);}.webimBind(this));fieldWrapper.text(model.get(fieldRule));}else{if(fieldRule.selectOptions){var itemTemplate=fieldWrapper.children().first().remove();var addOptionToWrapper=function(model){var newOption=fieldRule.selectOptions.customizeOption(itemTemplate.clone(),model);fieldWrapper.trigger('afterAdd',newOption);fieldWrapper.append(newOption);};this.listenTo(fieldRule.selectOptions.collection,{afterAdd:addOptionToWrapper.webimBind(this)});}else{this.listenTo(model,fieldRule['name']+':afterUpdate',function(value){fieldRule['get'].call(this,value,fieldWrapper,model);}.webimBind(this));fieldRule['get'].call(this,model.get(fieldRule['name']),fieldWrapper,model);_.each(fieldRule.classes||[],function(classConfig,className){if(_.isObject(classConfig)){var observed=classConfig.name;var updateClass=function(){var val=classConfig.get(model.get(observed));fieldWrapper.toggleClass(className,!!val);}.webimBind(this);}else{observed=classConfig;updateClass=function(){var val=model.get(observed);fieldWrapper.toggleClass(className,!!val);}.webimBind(this);}
this.listenTo(model,observed+':afterUpdate',function(){updateClass();}.webimBind(this));updateClass();}.webimBind(this));}}}.webimBind(this));},destroyBindings:function(){this.bindings=null;}};classes.mixins.OneClickSelect={defaults:{oneClickSelect:false},options:null,initOneClickSelect:function(){var options=this.wrapper.data('webimWidgetSelectDepartment');this.options=_.defaults(options||{},this.defaults);if(this.options.oneClickSelect){this.ui.departments.on('change',function(e){e.preventDefault();if($(e.target).val()){this.send();}}.webimBind(this));}},destroyOneClickSelect:function(){this.options=this.defaults=null;}};classes.mixins.Events=new classes.libs.Mixin(classes.libs.Events,{'after:destroy':function(){this.stopListening();this.off();}});classes.mixins.Node=new classes.libs.Mixin([classes.mixins.Events],{parent:null,children:null,addChild:function(node){this.children.push(node);node.setParent(this);},setParent:function(node){this.parent=node;},getChildren:function(){return this.children;},startEvent:function(type,param){var event=new classes.libs.Event(type,this,Array.prototype.slice.call(arguments,1));if(this.canProcessEvent(event)){this.trigger('self:'+event.getType(),event);this.pushEventUpIfNeed(classes.libs.Event.makeFrom(event,this));this.sendEventToChildren(event);}},canProcessEvent:function(event){return true;},processSiblingEvent:function(event){if(this.canProcessEvent(event)){this.trigger('sibling:'+event.getType(),event);}},pushEventUp:function(event){if(this.canProcessEvent(event)){this.trigger('child:'+event.getType(),event);this.pushEventUpIfNeed(classes.libs.Event.makeFrom(event,this));}},pushEventUpIfNeed:function(event){if(!event.isStopped()){this.processEventOnSiblings(event);}
if(!event.isStopped()){this.sendEventToParent(event);}},pushEventDown:function(event){if(this.canProcessEvent(event)){this.trigger('parent:'+event.getType(),event);if(!event.isStopped()){this.sendEventToChildren(event);}}},sendEventToParent:function(event){this.parent&&this.parent.pushEventUp(event);},sendEventToChildren:function(event){_.each(this.children,function(node){node.pushEventDown(classes.libs.Event.makeFrom(event,this));}.webimBind(this));},processEventOnSiblings:function(event){if(this.parent){var siblings=_.without(this.parent.getChildren(),this);_.find(siblings,function(node){node.processSiblingEvent(event);return event.isStopped();});}}},{'before:initialize':function(){this.children=[];},'after:destroy':function(){_.invoke(this.children,'setParent',null);this.children=null;}});(function(_,Events,mixinsRoot,libsRoot){var Radio={};Radio.DEBUG=false;Radio._debugText=function(warning,eventName,channelName){return warning+(channelName?' on the '+channelName+' channel':'')+': "'+eventName+'"';};Radio.debugLog=function(warning,eventName,channelName){if(Radio.DEBUG&&console&&console.warn){console.warn(Radio._debugText(warning,eventName,channelName));}};var eventSplitter=/\s+/;Radio._eventsApi=function(obj,action,name,rest){if(!name){return false;}
var results={};if(typeof name==='object'){for(var key in name){var result=obj[action].apply(obj,[key,name[key]].concat(rest));eventSplitter.test(key)?_.extend(results,result):results[key]=result;}
return results;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){results[names[i]]=obj[action].apply(obj,[names[i]].concat(rest));}
return results;}
return false;};Radio._callHandler=function(callback,context,args){var a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:return callback.call(context);case 1:return callback.call(context,a1);case 2:return callback.call(context,a1,a2);case 3:return callback.call(context,a1,a2,a3);default:return callback.apply(context,args);}};function removeHandler(store,name,callback,context){var event=store[name];if((!callback||(callback===event.callback||callback===event.callback._callback))&&(!context||(context===event.context))){delete store[name];return true;}}
function removeHandlers(store,name,callback,context){store||(store={});var names=name?[name]:_.keys(store);var matched=false;for(var i=0,length=names.length;i<length;i++){name=names[i];if(!store[name]){continue;}
if(removeHandler(store,name,callback,context)){matched=true;}}
return matched;}
var _logs={};function _partial(channelName){return _logs[channelName]||(_logs[channelName]=_.partial(Radio.log,channelName));}
_.extend(Radio,{log:function(channelName,eventName){var args=_.rest(arguments,2);console.log('['+channelName+'] "'+eventName+'"',args);},tuneIn:function(channelName){var channel=Radio.channel(channelName);channel._tunedIn=true;channel.on('all',_partial(channelName));return this;},tuneOut:function(channelName){var channel=Radio.channel(channelName);channel._tunedIn=false;channel.off('all',_partial(channelName));delete _logs[channelName];return this;}});function makeCallback(callback){return _.isFunction(callback)?callback:function(){return callback;};}
Radio.Requests={request:function(name){var args=_.rest(arguments);var results=Radio._eventsApi(this,'request',name,args);if(results){return results;}
var channelName=this.channelName;var requests=this._requests;if(channelName&&this._tunedIn){Radio.log.apply(this,[channelName,name].concat(args));}
if(requests&&(requests[name]||requests['default'])){var handler=requests[name]||requests['default'];args=requests[name]?args:arguments;return Radio._callHandler(handler.callback,handler.context,args);}else{Radio.debugLog('An unhandled request was fired',name,channelName);}},reply:function(name,callback,context){if(Radio._eventsApi(this,'reply',name,[callback,context])){return this;}
this._requests||(this._requests={});if(this._requests[name]){Radio.debugLog('A request was overwritten',name,this.channelName);}
this._requests[name]={callback:makeCallback(callback),context:context||this};return this;},replyOnce:function(name,callback,context){if(Radio._eventsApi(this,'replyOnce',name,[callback,context])){return this;}
var self=this;var once=_.once(function(){self.stopReplying(name);return makeCallback(callback).apply(this,arguments);});return this.reply(name,once,context);},stopReplying:function(name,callback,context){if(Radio._eventsApi(this,'stopReplying',name)){return this;}
if(!name&&!callback&&!context){delete this._requests;}else if(!removeHandlers(this._requests,name,callback,context)){Radio.debugLog('Attempted to remove the unregistered request',name,this.channelName);}
return this;}};Radio._channels={};Radio.channel=function(channelName){if(!channelName){throw new Error('You must provide a name for the channel.');}
if(Radio._channels[channelName]){return Radio._channels[channelName];}else{return(Radio._channels[channelName]=new Radio.Channel(channelName));}};Radio.Channel=function(channelName){this.channelName=channelName;};_.extend(Radio.Channel.prototype,Events,Radio.Requests,{reset:function(){this.off();this.stopListening();this.stopReplying();return this;}});Radio.reset=function(channelName){var channels=!channelName?this._channels:[this._channels[channelName]];_.invoke(channels,'reset');};libsRoot.Radio=Radio;mixinsRoot.Requests=Radio.Requests;}(_,classes.libs.Events,classes.mixins,classes));classes.mixins.MixRequests=new classes.libs.Mixin(classes.mixins.Requests,{'after:destroy':function(){this.stopReplying();}});classes.mixins.UiObject=new classes.libs.Mixin({wrapper:null,radio:null,getWrapper:function(){return this.wrapper;},getRadio:function(){if(!this.radio){this.radio=classes.Radio.channel(_.uniqueId('webim_radio_'));}
return this.radio;}});classes.mixins.UiEvents={ui:null,events:null,ownFilters:null,_eventSets:null,_uiEnabled:false,_uiSugar:null,_sugarEscape:/[-\/\\^$*+?.()|[\]{}]/g,initUiEvents:function(wrapper){this._uiSugar={};if(_.isObject(this.ui)&&!_.isEmpty(this.ui)){this.ui=_.clone(this.ui);_.each(this.ui,function(selector,key){this._uiSugar['@ui.'+key]=selector;this.ui[key]=this.findOwned(wrapper,selector);}.webimBind(this));}
this._eventSets=[];var guid=_.uniqueId('webim_ui_events_');if(_.isObject(this.events)&&!_.isEmpty(this.events)){_.each(this.events,function(methodNames,sugarSelector){var eventSelectorArr=sugarSelector.split(/\s+/);var event=eventSelectorArr.shift();var parsedSelector=this.replaceUiSugar(eventSelectorArr.join(' '));var eventSet={event:event+'.webimUI.'+guid,elements:this.findOwned(wrapper,parsedSelector),functions:[]};_.each(methodNames.split(' '),function(methodName){eventSet.functions.push(this[methodName].webimBind(this));}.webimBind(this));this._eventSets.push(eventSet);}.webimBind(this));}},enableEvents:function(){if(!this._uiEnabled){_.each(this._eventSets,function(eventSet){_.each(eventSet['functions'],function(func){eventSet['elements'].on(eventSet['event'],func);}.webimBind(this));}.webimBind(this));this._uiEnabled=true;}},disableEvents:function(){if(this._uiEnabled){_.each(this._eventSets,function(eventSet){eventSet['elements'].off(eventSet['event']);}.webimBind(this));this._uiEnabled=false;}},findOwned:function(wrapper,selector){var notFilters=['[data-webim-template]'].concat(this.ownFilters||[]);var notSelectors=_.map(selector.split(','),function(selector){return _.map(notFilters,function(notFilter){return notFilter+' '+selector;}).join(',');});return wrapper.filter(selector).add(wrapper.find(selector).not(wrapper.find(notSelectors.join(','))));},replaceUiSugar:function(selector){var parsedSelector=selector;_.each(this._uiSugar,function(selector,sugar){var escapedSugar=sugar.replace(this._sugarEscape,'\\$&');parsedSelector=parsedSelector.replace(new RegExp(escapedSugar+'(?=\\W|$)','g'),selector);}.webimBind(this));return parsedSelector;},destroyUiEvents:function(){this.disableEvents();this._uiSugar=this._eventSets=null;}};classes.mixins.MixUiEvents=new classes.libs.Mixin([classes.mixins.UiObject],classes.mixins.UiEvents,{'before:initialize':function(){this.initUiEvents(this.getWrapper());},'after:destroy':function(){this.destroyUiEvents();}});classes.mixins.Regions={regions:null,initRegions:function(rootContainer){this.regions=_.mapObject(this.regions||{},function(selector){var wrapper=rootContainer.getWrapper().filter(selector).add(rootContainer.getWrapper().find(selector).not('[data-webim-template]'+selector));return new classes.libs.Region(rootContainer.findClosestDescendant(wrapper),wrapper);});},destroyRegions:function(){_.invoke(this.regions,'destroy');}};classes.connections={};classes.connections.Base=tools.makeBase([classes.mixins.Events],{trackTimeout:30*1000,currentDialogue:null,currentSession:null,currentVisitor:null,revision:0,connect:function(session,visitor){throw new Error('Method must be implemented by subclass!');},disconnect:function(){throw new Error('Method must be implemented by subclass!');},reconnect:function(){if(!this.connectDeferred||this.connectDeferred.state()!=='pending'){this.disconnect();return this.connect(this.currentSession,this.currentVisitor);}else{return this.connectDeferred.promise();}},track:function(event,data){throw new Error('Method must be implemented by subclass!');},processResponse:function(responseData){if(!_.isUndefined(responseData['revision'])){this.revision=responseData['revision'];}
this.trigger('response',responseData);},setCurrentDialogue:function(dialogue){this.currentDialogue=dialogue;},getInitQueryString:function(){var title=String(window.webim_start_page&&window.webim_start_page.title?window.webim_start_page.title:document.title);title=title.length>50?title.substring(0,50)+'...':title;var url=window.webim_start_page&&window.webim_start_page.url?window.webim_start_page.url:document.location.href;var queryString='?event=init'
+'&visit-session-id='+(this.currentSession.get('id')||'')
+'&url='+encodeURIComponent(url)
+'&referer='+encodeURIComponent(document.referrer)
+(title?'&title='+encodeURIComponent(title):'')
+'&version='+env.version
+'&since='+this.revision;if(this.currentVisitor){queryString+='&visitor='+encodeURIComponent($.toJSON(this.currentVisitor.getAll()));}
if(window.webim_visitor){queryString+='&visitor-ext='+encodeURIComponent($.toJSON(window.webim_visitor));}
if(window.webim_auth_token){queryString+='&provided_auth_token='+encodeURIComponent(window.webim_auth_token);}
if(env.getLocation()!=='default'){queryString+='&location='+encodeURIComponent(env.getLocation());}
return queryString;},destroy:function(){this.disconnect();}});classes.connections.LongPolling=classes.connections.Base.extend({connectDeferred:null,pollingPeriod:10*1000,pollTimeoutId:null,requestTokenStartPeriod:500,numberOfRequestTries:0,providedAuthTokenNotFoundCounter:0,tryToConnect:function(){var connectDeferred=new $.Deferred();var initTracking=function(){this.revision=0;var url=env.getBaseUrl()+'/l/v/track.php'
+this.getInitQueryString()
+(this.numberOfRequestTries?'&n-tries='+this.numberOfRequestTries:'');tools.crossDomainRequest(url,function(responseData){this.numberOfRequestTries=0;if(responseData.error){connectDeferred.reject(responseData.error);}else{this.processResponse(responseData);this.startPolling();connectDeferred.resolve();}}.webimBind(this),null,function(){this.numberOfRequestTries++;initTracking();}.webimBind(this),this.trackTimeout);}.webimBind(this)();return connectDeferred.promise();},connect:function(session,visitor){if(!this.connectDeferred){this.currentSession=session;this.currentVisitor=visitor;this.connectDeferred=new $.Deferred();}
this.tryToConnect().done(function(){this.connectDeferred.resolve();}.webimBind(this)).fail(function(error){if(error==='provided-auth-token-not-found'){core.tracking.trigger('provided-auth-token-not-found');setTimeout(this.connect.webimBind(this),this.requestTokenStartPeriod*++this.providedAuthTokenNotFoundCounter);}else{this.connectDeferred.reject(error);}}.webimBind(this));return this.connectDeferred.promise();},disconnect:function(){this.stopPolling();this.connectDeferred&&this.connectDeferred.reject('disconnect');this.connectDeferred=null;},track:function(event,additionalParams){var requestDeferred=new $.Deferred();if(this.connectDeferred){var url=this.getTrackUrl(event);if(additionalParams){_.each(additionalParams,function(value,name){url+='&'+name+'='+encodeURIComponent(_.isObject(value)?$.toJSON(value):value);});}
this.connectDeferred.done(this.doTrackRequest.webimBind(this,url,event,requestDeferred)).fail(requestDeferred.reject.webimBind(this));}else{requestDeferred.reject('connection-not-init');}
return requestDeferred.promise();},getTrackUrl:function(event){return tools.formatUrl({baseUrl:env.getBaseUrl()+'/l/v/track.php',params:{'event':event,'visit-session-id':this.currentSession.get('id')||'','page-id':this.currentSession.get('pageId'),'since':this.revision,'auth-token':this.currentSession.get('authToken')}});},doTrackRequest:function(url,event,requestDeferred){tools.crossDomainRequest(url+(this.numberOfRequestTries?'&n-tries='+this.numberOfRequestTries:''),function(responseData){this.numberOfRequestTries=0;if(responseData['error']){if(responseData['error']=='reinit-required'){this.reconnect().done(function(){this.doTrackRequest(this.getTrackUrl(event),event,requestDeferred);}.webimBind(this));return;}else{requestDeferred.reject(responseData['error']);}}
this.processResponse(responseData);if(!responseData['error']){requestDeferred.resolve();}}.webimBind(this),null,function(){if(event=='poll'){this.numberOfRequestTries++;this.doTrackRequest(url,event,requestDeferred);}else{requestDeferred.reject('timeout');}}.webimBind(this),this.trackTimeout);},processResponse:function(responseData){var pollingPeriod=null;if(responseData['fullUpdate']){pollingPeriod=responseData['fullUpdate']['pollingPeriod']||null;}else if(responseData['deltaList']){_.each(responseData['deltaList'],function(delta){if(delta['objectType']=='POLLING_PERIOD'&&delta['event']=='upd'){pollingPeriod=delta['data'];}});}
pollingPeriod&&this.updatePollingPeriod(pollingPeriod);classes.connections.Base.prototype.processResponse.call(this,responseData);},startPolling:function(){this.pollTimeoutId=setTimeout(this.poll.webimBind(this),this.pollingPeriod);},stopPolling:function(){if(this.pollTimeoutId){clearTimeout(this.pollTimeoutId);}},prevMessageDraft:null,poll:function(){var params={};if(this.currentDialogue){var messageDraft=this.currentDialogue.get('messageDraft');if(messageDraft!==this.prevMessageDraft){this.prevMessageDraft=messageDraft;if(messageDraft){params['message-draft']=messageDraft;}else{params['del-message-draft']='true';}}}
this.track('poll',params).done(this.setPollTimeout.webimBind(this));},updatePollingPeriod:function(value){this.stopPolling();this.pollingPeriod=value*1000;this.startPolling();},setPollTimeout:function(){if(this.pollTimeoutId){clearTimeout(this.pollTimeoutId);}
this.pollTimeoutId=setTimeout(this.poll.webimBind(this),this.pollingPeriod);}});(function(){classes.connections.WebSockets=classes.connections.Base.extend({constructor:function(){classes.connections.Base.call(this);this.pendingRequests={};},connectDeferred:null,socket:null,pendingRequests:null,draftUpdateTimeoutId:null,onClosePeriod:3*1000,state:'closed',connect:function(session,visitor){if(!this.connectDeferred){this.currentSession=session;this.currentVisitor=visitor;this.connectDeferred=new $.Deferred();this.socket=new WebimWebSocket(function(){return env.getBaseUrl(true)+'/ws/v/action'+this.getInitQueryString();}.webimBind(this),this.onClosePeriod);this.socket.on({'connection-lost':this.onConnectionLost.webimBind(this),'connection-resumed':this.onConnectionResumed.webimBind(this),'connection-established':this.onConnectionEstablished.webimBind(this),'receive-message':this.onMessageHandler.webimBind(this)});this.socket.createSocket();}
return this.connectDeferred.promise();},disconnect:function(){this.connectDeferred&&this.connectDeferred.reject('disconnect');this.connectDeferred=null;if(this.socket){this.socket.destroy();}
this.socket=null;},track:function(event,params){var requestDeferred=new $.Deferred();if(this.connectDeferred){var requestId=tools.guid();this.pendingRequests[requestId]={event:event,params:params,deferred:requestDeferred};requestDeferred.always(function(){delete this.pendingRequests[requestId];}.webimBind(this));if(this.state=='connected'){this.sendPendingRequest(requestId);}
this.connectDeferred.fail(requestDeferred.reject.webimBind(this));}else{requestDeferred.reject('connection-not-init');}
return requestDeferred.promise();},sendPendingRequest:function(requestId){var request=this.pendingRequests[requestId];request['timeoutId']=setTimeout(function(){request['deferred'].reject('timeout');}.webimBind(this),this.trackTimeout);this.sendMessage('event',_.defaults({event:request['event']},request['params']),requestId);},onConnectionEstablished:function(){this.onConnectionResumed();this.connectDeferred.resolve();},onConnectionResumed:function(){this.draftUpdateTimeoutId=setInterval(this.updateVisitorMessageDraft.webimBind(this),2000);this.syncPendingRequests();this.state='connected';},onConnectionLost:function(){if(this.draftUpdateTimeoutId){clearInterval(this.draftUpdateTimeoutId);this.draftUpdateTimeoutId=null;}
this.stopPendingRequestTimeouts();this.state='closed';},onMessageHandler:function(msg){if(!_.isUndefined(msg['error'])){if(msg['error']=='reinit-required'){this.reconnect();}}
if(!_.isUndefined(msg['revision'])){this.processResponse(msg);}else{_.each(msg,this.processResponseForRequest.webimBind(this));}},stopPendingRequestTimeouts:function(){_.each(this.pendingRequests,function(request){if(request['timeoutId']){clearTimeout(request['timeoutId']);request['timeoutId']=null;}});},syncPendingRequests:function(){if(!_.isEmpty(this.pendingRequests)){var messageData=_.mapObject(this.pendingRequests,function(request,id){if(!request['timeoutId']){request['timeoutId']=setTimeout(function(){request['deferred'].reject('timeout');}.webimBind(this),this.trackTimeout);}
return{reqAction:'event',reqParams:_.defaults({event:request['event']},request['params']),reqId:id};}.webimBind(this));this.sendMessage('getPendingResponses',messageData);}},sendMessage:function(action,data,requestId){var msg={reqAction:action,reqParams:data};requestId&&(msg['reqId']=requestId);this.socket.sendMessage(msg);},processResponseForRequest:function(response){if(response['reqId']&&_.has(this.pendingRequests,response['reqId'])){var result=response['reqResult'];var request=this.pendingRequests[response['reqId']];if(!_.isUndefined(result['error'])){if(result['error']=='reinit-required'){this.reconnect();}else{request['deferred'].reject(result['error']);}}else{this.processResponse(result);request['deferred'].resolve();}
clearTimeout(request['timeoutId']);}},prevMessageDraft:null,updateVisitorMessageDraft:function(){if(this.socket&&this.currentDialogue){var data={};var messageDraft=this.currentDialogue.get('messageDraft');if(messageDraft!==this.prevMessageDraft){this.prevMessageDraft=messageDraft;if(messageDraft){data['message-draft']=messageDraft;}else{data['del-message-draft']=true;}
this.sendMessage('draftUpdate',data);}}}});var WebimWebSocket=function(urlCallback,onClosePeriod){_.extend(this,classes.libs.Events);this.urlCallback=urlCallback;this.onClosePeriod=onClosePeriod;this.establishDeferred=new $.Deferred();};WebimWebSocket.prototype={NORMAL_CLOSE:1000,constructor:WebimWebSocket,socket:null,urlCallback:null,state:'closed',connectionLost:false,establishDeferred:null,onClosePeriod:3*1000,socketTimeoutId:null,createSocket:function(){this.state='connecting';this.socket=new WebSocket(this.urlCallback());this.socket.onopen=this.onOpenHandler.webimBind(this);this.socket.onmessage=this.onMessageHandler.webimBind(this);this.socket.onclose=this.onCloseHandler.webimBind(this);},recreateSocket:function(){this.closeSocket();this.createSocket();},closeSocket:function(){var CLOSED_STATE=3;if(this.socket&&this.socket.readyState!=CLOSED_STATE){this.socket.close(this.NORMAL_CLOSE);}},sendMessage:function(msg){if(this.state!=='closed'){this.establishDeferred.done(function(){this.socket.send($.toJSON(msg));}.webimBind(this));}else{core.logger.log('Try to send message via closed socket',msg);}},onOpenHandler:function(){if(this.socketTimeoutId){clearTimeout(this.socketTimeoutId);this.socketTimeoutId=null;}},onMessageHandler:function(msg){var responseData=$.evalJSON(msg['data']);if(responseData['connected']=='ok'){this.state='connected';this.establishDeferred.resolve();if(this.connectionLost){this.trigger('connection-resumed');this.connectionLost=false;}else{this.trigger('connection-established');}}else if(this.state==='connected'){this.trigger('receive-message',responseData);}else if(responseData['error']==='provided-auth-token-not-found'){core.tracking.trigger('provided-auth-token-not-found');}},onCloseHandler:function(event){if(!event.wasClean){this.trigger('connection-lost');this.connectionLost=true;if(this.state!=='connecting'){this.establishDeferred=new $.Deferred();}
this.state='connecting';this.socketTimeoutId=setTimeout(this.recreateSocket.webimBind(this),this.onClosePeriod);}else{this.trigger('connection-closed');this.state='closed';}},destroy:function(){this.closeSocket();this.socket=null;this.off();this.stopListening();}};}());classes.core={};classes.core.Base=tools.makeBase([classes.mixins.Events],{constructor:function(options){this.readyDeferred=new $.Deferred();this.initialize(options);},readyDeferred:null,initialize:function(options){},ready:function(){return this.readyDeferred.promise();},destroy:function(){this.readyDeferred.reject('destroy');}});classes.core.Browser=classes.core.Base.extend({isMobile:_.memoize(function(){if(_.isBoolean(env.smallScreen)){return env.smallScreen;}
var matchMedia=window.matchMedia||window.msMatchMedia;var query=matchMedia?matchMedia('screen and (max-width: 1024px) and (orientation: landscape), screen and (max-width: 768px) and (orientation: portrait)'):false;return query&&query.matches;}),isNotSupported:function(){var ua=window.navigator.userAgent.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf('compatible')<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];var browser=match[1]||'';var version=match[2]||'0';version=parseInt(version.split('.').shift());return browser=='msie'&&version&&(parseInt(version)<8);},isIEQuirkMode:function(){if(/(msie) ([\w.]+)/.test(window.navigator.userAgent.toLowerCase())){var engineVersion=5;if(document.documentMode){engineVersion=document.documentMode;}
return engineVersion<=5;}
return false;},support:function(techName){return Modernizr[techName];},hasEvent:function(eventName){return Modernizr.hasEvent(eventName);}});classes.core.Loader=classes.core.Base.extend({forMobile:false,resourcesLoadedDeferred:null,serverSideConfigDeferred:null,configLoadedDeferred:null,resourcesPromise:null,loadedUrlToPromise:null,initialize:function(params){_.extend(this,_.pick(params,['forMobile']));this.configLoadedDeferred=new $.Deferred();this.resourcesLoadedDeferred=new $.Deferred();this.loadedUrlToPromise={};},loadUrl:function(url){if(!_.has(this.loadedUrlToPromise,url)){var urlDeferred=new $.Deferred();tools.crossDomainRequest(url,urlDeferred.resolve.webimBind(urlDeferred),null,urlDeferred.reject.webimBind(urlDeferred,'timeout'),10*1000);this.loadedUrlToPromise[url]=urlDeferred.promise();}
return this.loadedUrlToPromise[url].promise();},loadUIPromise:function(){if(!this.resourcesPromise){var resourcesDeferred=new $.Deferred();this.loadServerSideConfigPromise().done(function(systemConfig){var uiResourceUrl=env.getBaseUrl()
+'/v/ui-resources.php?location='+env.getLocation()
+(this.forMobile?'&mode=mobile':'')
+'&'+tools.hash({'settings':systemConfig,'version':env.version});tools.crossDomainRequest(uiResourceUrl,function(responseData){$('head').append('<style>'+responseData['css']+'</style>');this.resourcesLoadedDeferred.resolve();resourcesDeferred.resolve(responseData);}.webimBind(this),'getWebimUIResourcesCallback');}.webimBind(this));this.resourcesPromise=resourcesDeferred.promise();}
return this.resourcesPromise;},uiResourcesLoaded:function(){return this.resourcesLoadedDeferred.promise();},loadUI:function(type){var deferred=new $.Deferred();this.loadUIPromise().done(function(resources){deferred.resolve(resources[type]);}.webimBind(this));return deferred.promise();},loadInvitations:function(){return this.loadUI('invitations');},loadChat:function(){return this.loadUI('chat');},loadTemplates:function(){return this.loadUI('templates');},loadButton:function(){return this.loadUI('html_button');},loadResources:function(){return this.loadUI('resources');},loadSeparateBlocks:function(){return this.loadUI('separate_blocks');},loadServerSideConfigPromise:function(){if(!this.serverSideConfigDeferred){this.serverSideConfigDeferred=new $.Deferred();window['webimApplyServerSideSettings']=this.serverSideConfigLoadHandler.webimBind(this);tools.addScriptElement(env.getBaseUrl()+'/x/js/v/all-settings-'+env.getLocation()+'.js?'+env.version);}
return this.serverSideConfigDeferred.promise();},serverSideConfigLoaded:function(callback){return this.configLoadedDeferred.promise();},serverSideConfigLoadHandler:function(responseData){this.configLoadedDeferred.resolve();this.serverSideConfigDeferred.resolve(responseData);delete window['webimApplyServerSideSettings'];},loadServerSideConfig:function(type){var deferred=new $.Deferred();this.loadServerSideConfigPromise().done(function(config){deferred.resolve(config[type]);}.webimBind(this));return deferred.promise();},loadAccount:function(){var deferred=new $.Deferred();$.when(this.loadServerSideConfig('accountBlocked'),this.loadServerSideConfig('accountFields')).done(function(isBlocked,accountFields){deferred.resolve(_.extend({blocked:Boolean(isBlocked)},accountFields));});return deferred.promise();},loadLocation:function(){return this.loadServerSideConfig('locationSettings');},loadConfig:function(){return this.loadServerSideConfig('accountConfig');},loadAutoInvites:function(){return this.loadServerSideConfig('ainviteRules');},loadTariff:function(){return this.loadServerSideConfig('tariffOptions');},loadChannels:function(){return this.loadServerSideConfig('channels')},reset:function(){this.resourcesLoadedDeferred&&this.resourcesLoadedDeferred.reject();this.resourcesLoadedDeferred=new $.Deferred();this.serverSideConfigDeferred&&this.serverSideConfigDeferred.reject();this.serverSideConfigDeferred=null;this.configLoadedDeferred&&this.configLoadedDeferred.reject();this.configLoadedDeferred=new $.Deferred();this.resourcesPromise=null;}});(function(){classes.core.Logger=classes.core.Base.extend({enabled:false,messages:[],log:function(message,data){var logMessage=new LogMessage(message,data);this.messages.push(logMessage);if(this.enabled){this.outputMessage(logMessage);}},outputMessage:function(logMessage){if(console&&console.log){logMessage.outputToConsole();}},outputAll:function(){_.each(this.messages,this.outputMessage.webimBind(this));},enable:function(){this.enabled=true;this.outputAll();},disable:function(){this.enabled=false;}});var LogMessage=function(message,data){this.time=new Date();if(_.isString(message)){this.message=message;!_.isUndefined(data)&&(this.data=data);}else{this.data=message;}};LogMessage.prototype={constructor:LogMessage,time:null,message:'',outputToConsole:function(){if(console&&console.log){if(this.message){console.log(this.time.toLocaleString()+': '+this.message);}else{console.log(this.time.toLocaleString());}
if(this.hasOwnProperty('data')){console.log(this.data);}}}};})();classes.core.Repository=classes.core.Base.extend({data:null,initialize:function(){this.data={};_.each({visitor:new classes.models.Visitor(),dialogues:new classes.collections.Dialogues(),session:new classes.models.Session(),cobrowsing:new classes.models.Cobrowsing(),invitations:new classes.collections.Invitations(),chat:new classes.models.Chat(),departments:new classes.collections.Departments(),teleport:new classes.models.Teleport(),system:new classes.models.System()},function(value,key){this.set(key,value);}.webimBind(this));this.get('visitor').fetch();this.get('session').fetch();},get:function(name){return this.data[name];},set:function(name,value){var old=this.data[name];this.data[name]=value;this.trigger(name+':afterReplace',value,old);},changeVisitor:function(){this.set('visitor',new classes.models.Visitor());this.get('visitor').save();}});classes.core.Resources=classes.core.Base.extend({resources:null,locationResources:null,initialize:function(){this.resources={};this.locationResources={};},get:function(name,params){var resource=this.locationResources[name]||this.resources[name]||'';if(resource&&!_.isEmpty(params)){_.each(params,function(value,index){resource=resource.replace('{'+index+'}',value);});}
return resource;},setResources:function(resources){this.resources=resources['resources'];this.setLocationResources(resources['locationResources'],resources['visitorResources']);this.readyDeferred.resolve();},setLocationResources:function(locationResources,visitorResources){_.each(locationResources,function(label,key){key=key.replace(/-/g,'.');this.updateLocationResource(key,label);}.webimBind(this));_.each(visitorResources,function(label,fieldName){var key='visitor.contacts.'+fieldName;this.updateLocationResource(key,label);}.webimBind(this));},updateLocationResource:function(key,label){if(this.locationResources[key]!==label){this.locationResources[key]=label;this.trigger(key+':afterUpdate',label?label:this.get(key));}}});classes.core.Settings=classes.core.Base.extend({account:null,location:null,config:null,tariff:null,initialize:function(){_.each(['Account','Config','Location','Tariff'],function(settingsName){this[settingsName.toLowerCase()]=new classes.models[settingsName]();}.webimBind(this));},load:function(){return $.when(this.location.fetch(),this.account.fetch(),this.config.fetch(),this.tariff.fetch()).done(this.readyDeferred.resolve.webimBind(this.readyDeferred));}});(function(){classes.core.Storage=classes.core.Base.extend({mechanism:null,initialize:function(){this.mechanism=this.isLocalStorageAvailable()?new LocalStorage():new CookieStorage();},set:function(key,value,expires){this.mechanism.set(this.makeSafeKey(key),value,expires);},get:function(key,def){return this.mechanism.get(this.makeSafeKey(key),def);},makeSafeKey:function(key){if(!/^webim/i.test(key)){key='WEBIM_'+key;}
return key;},isLocalStorageAvailable:function(){try{var storage=window['localStorage'],x='__storage_test__';storage.setItem(x,x);storage.removeItem(x);return true;}
catch(e){return false;}}});var BaseStorage=function(){};BaseStorage.prototype={constructor:BaseStorage,get:function(key,def){},set:function(key,value,expires){},expiresInTS:function(expires){return expires?_.now()+expires*24*60*60*1000:null;}};var CookieStorage=function(){BaseStorage.call(this);};CookieStorage.prototype=_.create(BaseStorage.prototype,{get:function(key,def){var value=_.isUndefined(def)?null:def;var data=$.cookie(key);if(data){try{data=$.evalJSON(data);value=data;}catch(e){core.logger&&core.logger.log(e);}}
return value;},set:function(key,value,expires){$.cookie(key,$.toJSON(value),{expires:expires?new Date(this.expiresInTS(expires)):null,path:'/'});}});var LocalStorage=function(){BaseStorage.call(this);};LocalStorage.prototype=_.create(BaseStorage.prototype,{get:function(key,def){var value=_.isUndefined(def)?null:def;var data=window.localStorage.getItem(key);if(data){try{data=$.evalJSON(data);if(data['expires']&&_.now()>data['expires']){window.localStorage.removeItem(key);}else{value=data['value'];}}catch(e){core.logger&&core.logger.log(e);}}
return value;},set:function(key,value,expires){if(!_.isNull(value)){window.localStorage.setItem(key,$.toJSON({value:value,expires:this.expiresInTS(expires)}));}else{window.localStorage.removeItem(key);}
$.cookie(key,null,{path:'/'});}});})();classes.core.Tracking=classes.core.Base.extend({startingTrackingDeferred:null,onStartedTrackingDeferred:null,currentSession:null,currentVisitor:null,currentDialogue:null,useSockets:false,connection:null,initialize:function(params){params=params||{};this.currentSession=params['session'];this.currentVisitor=params['visitor']||null;this.onStartedTrackingDeferred=new $.Deferred();if(typeof(window.History)!=='undefined'&&typeof(window.History.Adapter)!=='undefined'){this.trackingStarted().done(function(){var History=window.History;History.Adapter.bind(window,'statechange',this.onUrlChange.webimBind(this));}.webimBind(this));}
this.trackingStarted().done(function(){$(window).unload(function(){this.track('left');}.webimBind(this));}.webimBind(this));},setSocketUsing:function(useSockets){this.useSockets=Boolean(useSockets);},startTracking:function(options){if(env.getMode()==='demo'){return false;}else if(env.getMode()==='preview'){var deferred=new $.Deferred();_.delay(deferred.resolve.webimBind(deferred),3*1000);return deferred.promise();}
options=_.defaults(options||{},{visitor:this.currentVisitor,session:this.currentSession});if(!this.startingTrackingDeferred){this.currentSession=options['session'];this.currentVisitor=options['visitor'];this.currentSession.set('pageId',null);if(!this.connection){this.connection=this.useSockets?new classes.connections.WebSockets():new classes.connections.LongPolling();this.connection.setCurrentDialogue(this.currentDialogue);this.listenTo(this.connection,'response',this.processTrackResponse.webimBind(this));}else{this.connection.disconnect();}
var connectPromise=this.connection.connect(this.currentSession,this.currentVisitor);this.startingTrackingDeferred=new $.Deferred();connectPromise.fail(this.startingTrackingDeferred.reject.webimBind(this.startingTrackingDeferred));this.startingTrackingDeferred.done(this.onStartedTrackingDeferred.resolve.webimBind(this.onStartedTrackingDeferred));}
return this.startingTrackingDeferred.promise();},restartTracking:function(options){if(!this.startingTrackingDeferred||this.startingTrackingDeferred.state()!=='pending'){this.stopTracking();if(this.onStartedTrackingDeferred.state()!=='pending'){this.onStartedTrackingDeferred=new $.Deferred();}
return this.startTracking(options);}else{return this.startingTrackingDeferred.promise();}},stopTracking:function(){if(this.isTrackingStarted()){this.connection&&this.connection.disconnect();this.startingTrackingDeferred=null;}},replaceTrackingVisitor:function(newVisitor){var replaceDeferred=new $.Deferred();if(this.isTrackingStarted()){this.track('left').always(function(){this.restartTracking({visitor:newVisitor}).always(replaceDeferred.resolve.webimBind(replaceDeferred));}.webimBind(this));}else{replaceDeferred.resolve();}
return replaceDeferred.promise();},updateOnlineStatus:function(session){this.currentSession=session;if(_.contains(['demo','preview'],env.getMode())){return;}
$(function(){var url=env.getBaseUrl()+'/l/v/get-online-status';if(env.getLocation()!=='default'){url+='?location='+env.getLocation();}
tools.crossDomainRequest(url,function(responseData){var isNewOnlineStatus=(responseData['onlineStatus']!=this.currentSession.get('onlineStatus'))?true:false;this.currentSession.set('onlineStatus',responseData['onlineStatus']);if(isNewOnlineStatus){this.trigger('online-operators:afterOnlineStatusChanged',responseData['onlineStatus'])}}.webimBind(this),'webimApplyOnlineStatusResponse');}.webimBind(this));},isTrackingStarted:function(){return Boolean(this.startingTrackingDeferred)&&this.startingTrackingDeferred.state()!=='rejected';},trackingStarted:function(){return this.onStartedTrackingDeferred.promise();},track:function(event,data){var requestDeferred=new $.Deferred();if(env.getMode()==='preview'){_.delay(requestDeferred.resolve.webimBind(requestDeferred),3*1000);}else{switch(event){case'inv.accept':case'chat.start':!this.isTrackingStarted()&&this.startTracking();default:if(this.isTrackingStarted()){this.trackingStarted().done(function(){this.connection.track(event,data).done(requestDeferred.resolve.webimBind(requestDeferred)).fail(requestDeferred.reject.webimBind(requestDeferred));}.webimBind(this)).fail(requestDeferred.reject.webimBind(requestDeferred,'tracking-init-failed'));}else{requestDeferred.reject('tracking-not-started');}}}
return requestDeferred.promise();},processTrackResponse:function(responseData){if(!_.isUndefined(responseData['teleportUrl'])){this.trigger('teleport-url',responseData['teleportUrl']);}
if(!_.isUndefined(responseData['fullUpdate'])){this.doFullUpdate(responseData['fullUpdate']);if(this.startingTrackingDeferred&&this.startingTrackingDeferred.state()==='pending'){this.startingTrackingDeferred.resolve();}}
if(!_.isUndefined(responseData['deltaList'])){this.processDelta(responseData['deltaList']);}
this.currentSession.save();},setCurrentDialogue:function(dialogue){this.currentDialogue=dialogue;this.connection&&this.connection.setCurrentDialogue(dialogue);},doFullUpdate:function(fullUpdate){this.trigger('full-update');this.currentSession.set({id:fullUpdate['visitSessionId'],state:fullUpdate['state'],onlineStatus:fullUpdate['onlineStatus'],authToken:fullUpdate['authToken'],pageId:fullUpdate['pageId'],timeDelta:_.now()-fullUpdate['currentTime']*1000});this.currentSession.save();this.trigger('has-previous-chats',fullUpdate['hasPreviousChats']);var visitorData=_.extend({},fullUpdate['visitor'],{'number':fullUpdate['visitorNumber']});this.trigger('visitor:update',visitorData);_.has(fullUpdate,'invitation')&&this.trigger('invitation',fullUpdate['invitation']);this.trigger('departments:replace',fullUpdate['departments']);fullUpdate['chat']&&this.trigger('dialogue:new',fullUpdate['chat']);this.trigger('cobrowsing:session:update',fullUpdate['cobrowsingSession']);},processDelta:function(deltaList){_.each(deltaList,function(delta){switch(delta['objectType']){case'VISIT_SESSION_STATE':if(delta['data']!=null){this.currentSession.set('state',delta['data']);this.currentSession.save();}
break;case'INVITATION':this.trigger('invitation',delta['data']);break;case'CHAT_MESSAGE':switch(delta['event']){case'add':this.trigger('dialogue:message:add',delta['data']);break;case'upd':this.trigger('dialogue:message:update',delta['data']);break;case'del':this.trigger('dialogue:message:delete',delta['id']);}
break;case'CHAT':switch(delta['event']){case'upd':if(_.isObject(delta['data'])&&!_.isEmpty(delta['data'])){this.trigger('dialogue:new',delta['data']);}
break;}
break;case'CHAT_STATE':switch(delta['event']){case'upd':this.trigger('dialogue:update',{state:delta['data']});break;}
break;case'CHAT_OPERATOR':switch(delta['event']){case'upd':this.trigger('dialogue:update',{operator:delta['data']});break;}
break;case'CHAT_OPERATOR_TYPING':switch(delta['event']){case'upd':this.trigger('dialogue:update',{operatorTyping:delta['data']});break;}
break;case'ONLINE_OPERATORS':switch(delta['event']){case'upd':this.currentSession.set('onlineStatus',delta['data']);break;}
break;case'DEPARTMENT_LIST':switch(delta['event']){case'upd':this.trigger('departments:replace',delta['data']);break;}
break;case'CHAT_READ_BY_VISITOR':switch(delta['event']){case'upd':this.trigger('dialogue:update',{readByVisitor:delta['data']});break;}
break;case'UNREAD_BY_VISITOR':switch(delta['event']){case'upd':this.trigger('dialogue:update',{unreadByVisitorMsgCnt:delta['data']['msgCnt']});break;}
break;case'VISIT_SESSION_NUMBER':switch(delta['event']){case'upd':this.trigger('visitor:update',{number:delta['data']});break;}
break;case'VISITOR':switch(delta['event']){case'upd':this.trigger('visitor:update',delta['data']);break;}
break;case'FORM_REQUEST':switch(delta['event']){case'upd':break;}
break;case'COBROWSING_SESSION':switch(delta['event']){case'upd':this.trigger('cobrowsing:session:update',delta['data']);break;}
break;case'COBROWSING_STATE':switch(delta['event']){case'upd':this.trigger('cobrowsing:session:update',delta['data']);break;}
break;case'OPERATOR_RATE':switch(delta['event']){case'upd':this.trigger('dialogue:operator:rate',delta['data']);break;}
break;}}.webimBind(this));},onUrlChange:function(){if(this.isTrackingStarted()){this.track('left').always(function(){this.restartTracking();}.webimBind(this));}},destroy:function(){this.stopTracking();this.connection&&this.connection.destroy();classes.core.Base.prototype.destroy.call(this);}});classes.models={};classes.models.Base=tools.makeBase([classes.mixins.Events],{constructor:function(data){this.cid=_.uniqueId('webim_model_');this.data={};if(data instanceof classes.models.Base){data=data.getAll();}else{data=_.clone(data||{});}
this.initialize(data);data=_.defaults({},data,_.mapObject(this.defaults,function(value){return _.isFunction(value)?value():value;}));this.set(data);this.initCalculatedFields();},cid:'',idField:null,defaults:null,data:null,calculatedConfigs:null,calculatedData:null,initialize:function(data){},getCID:function(){return this.cid;},getId:function(){return this.idField?this.get(this.idField):null;},set:function(keyOrData,value){var data=keyOrData,hasSet;if(_.isString(keyOrData)){data=this.pathAndValueToObject(keyOrData,value);}
hasSet=this.setObject(this.data,data);hasSet&&this.trigger('afterUpdate',this);return hasSet;},setObject:function(root,obj,keyPrefix){var triggerPairs=[];keyPrefix=keyPrefix||'';_.each(obj,function(value,key){value=_.isUndefined(value)?null:value;var path=keyPrefix?keyPrefix+'.'+key:key;var fieldSet=false;if(_.isObject(value)&&!(value instanceof classes.models.Base)&&Object.prototype.toString.call(value)==='[object Object]'){if(!_.isObject(root[key])){root[key]={};}
if(this.setObject(root[key],value,path)){fieldSet=true;}}else{if(root[key]!==value&&!_.isEqual(root[key],value)){root[key]=value;fieldSet=true;}}
fieldSet&&triggerPairs.push({key:path+':afterUpdate',value:root[key]});}.webimBind(this));_.each(triggerPairs,function(triggerPair){this.trigger(triggerPair['key'],triggerPair['value'],this);}.webimBind(this));return Boolean(triggerPairs.length);},get:function(fieldName){if(_.has(this.calculatedData,fieldName)){return this.calculatedData[fieldName];}
var pathParts=fieldName.split('.'),pathPart;var root=this.data;while(pathPart=pathParts.shift()){if(pathParts.length){if(_.isObject(root[pathPart])){root=root[pathPart];}else{return undefined;}}else{return root[pathPart];}}},has:function(fieldName){return!_.isUndefined(this.get(fieldName));},getAll:function(){return _.clone(this.data);},save:function(){var saveDeferred=new $.Deferred();saveDeferred.resolve();return saveDeferred.promise();},fetch:function(){var fetchDeferred=new $.Deferred();fetchDeferred.resolve();return fetchDeferred.promise();},initCalculatedFields:function(){this.calculatedData={};_.each(this.calculatedConfigs,function(config,fieldName){var events=_.map(config.related,function(fieldName){return fieldName+':afterUpdate';}).join(' ');this.on(events,function(){var value=this.getCalculated(config);if(value!==this.calculatedData[fieldName]){this.calculatedData[fieldName]=value;this.trigger(fieldName+':afterUpdate',value,this);}}.webimBind(this));this.calculatedData[fieldName]=this.getCalculated(config);}.webimBind(this));},getCalculated:function(conf){var params=_.map(conf.related,function(relatedField){return this.get(relatedField);}.webimBind(this));return conf.calc.apply(this,params);},pathAndValueToObject:function(path,value){var pathParts=path.split('.'),objValue={},pathPart;var root=objValue;while(pathPart=pathParts.shift()){if(pathParts.length){root[pathPart]={};root=root[pathPart];}else{root[pathPart]=value;}}
return objValue;},destroy:function(){this.trigger('afterDestroy');this.off();this.stopListening();}});classes.models.Account=classes.models.Base.extend({defaults:{name:function(){return env.accountName;},blocked:false},fetch:function(){return core.loader.loadAccount().done(function(accountData){this.set(accountData);}.webimBind(this));}});classes.models.Chat=classes.models.Base.extend({chatStates:['chat','chat-showing','offline-message','first-question','callback-hunter','department-selection','throbber'],dialogueStates:['chat','chat-showing','first-question','department-selection'],defaults:{state:null,manualSetSection:null,minimized:false,closed:true,inContactsRequest:false,soundEnabled:true,fontSize:2},calculatedConfigs:{chatState:{related:['state'],calc:function(sessionState,manualSetSection){var state=manualSetSection||sessionState;var value=null;if(_.contains(this.chatStates,state)){value=_.contains(this.dialogueStates,state)?'chat':state;}
return value;}},dialogueState:{related:['state'],calc:function(sessionState){return _.contains(this.dialogueStates,sessionState)?sessionState:null;}}},inChatState:function(){return _.contains(this.chatStates,this.get('state'));},fetch:function(){if(env.getMode()!=='preview'){this.set(_.pick({manualSetSection:core.storage.get('WEBIM_CHAT_MANUAL_STATE'),minimized:core.storage.get('WEBIM_CHAT_MINIMIZED'),soundEnabled:core.storage.get('WEBIM_SOUND_TURNED_ON'),fontSize:core.storage.get('webim.font-resize.size')},function(value){return!_.isNull(value);}));}
return classes.models.Base.prototype.fetch.call(this);},save:function(){if(env.getMode()!=='preview'){core.storage.set('WEBIM_CHAT_MINIMIZED',this.get('minimized'));core.storage.set('WEBIM_CHAT_MANUAL_STATE',this.get('manualSetSection'));core.storage.set('WEBIM_SOUND_TURNED_ON',this.get('soundEnabled'));core.storage.set('webim.font-resize.size',this.get('fontSize'));}
return classes.models.Base.prototype.save.call(this);}});classes.models.Button=classes.models.Base.extend({states:['online','offline','typing','message'],defaults:{dragged:'N',collapsed:true,position:{horizontal:100,vertical:100},state:'offline',isPreview:false,channels:[],isMobile:false,'border-color':'#FFF',"background-color":"#3CC",offlineEnabled:false,name:'html',kind:'html',startChatHandler:function(){}},fetch:function(){var modelReadyDeferred=new $.Deferred();if(!this.get('isPreview')){var oldData=core.storage.get('html-button');if(oldData){this.set(_.pick(oldData,'collapsed',(this.get('dragged')==='Y'?'position':undefined)))}}
modelReadyDeferred.resolve();return modelReadyDeferred.promise();},setDialogueHandlers:function(dialogue){dialogue.on('operatorTyping:afterUpdate',this.operatorTypingHandler.webimBind(this));dialogue.on('readByVisitor:afterUpdate',function(){this.set('state','online');}.webimBind);},operatorTypingHandler:function(state){if(state){this.set('state','typing');}else{this.set('state','online');}
console.log(state);},save:function(){if(this.get('isPreview')){return;}
core.storage.set('html-button',_.pick(this.getAll(),['position','collapsed']),365);return classes.models.Base.prototype.save.call(this);}});classes.models.ImageButton=classes.models.Base.extend({defaults:{kind:'empty',state:'offline',isPreview:false,offlineEnabled:false,imageUrl:'https://webim.webim.ru/button.php?location=webimru',startChatHandler:function(){}},fetch:function(){var fetchDeferred=new $.Deferred();fetchDeferred.resolve();return fetchDeferred.promise();},save:function(){return classes.models.Base.prototype.save.call(this);}});classes.models.Cobrowsing=classes.models.Base.extend({defaults:{id:null,state:null}});classes.models.Config=classes.models.Base.extend({hasOption:function(fieldName){return Boolean(this.get(fieldName));},fetch:function(){return core.loader.loadConfig().done(function(configData){this.set(configData);}.webimBind(this));}});classes.models.Department=classes.models.Base.extend({idField:'key',defaults:{key:null,localeToName:null,online:null}});classes.models.Dialogue=classes.models.Base.extend({visitorEndDialogueStates:['closed','deleted','closed_by_visitor'],idField:'clientSideId',defaults:{id:null,operator:null,readByVisitor:true,unreadByVisitorMsgCnt:0,operatorTyping:false,state:null,inContactsRequest:false,creationTs:function(){return _.now()/1000;},clientSideId:function(){return tools.guid();}},calculatedConfigs:{isActive:{related:['state'],calc:function(state){return state&&!_.contains(this.visitorEndDialogueStates,state);}}},messages:null,initialize:function(data){this.messages=new classes.collections.Messages();},addMessage:function(message){if(!(message instanceof classes.models.Message)){message=new classes.models.Message(message);}
if(message.isNew()&&!this.messages.has(message)){message.sync();}
if(message.get('kind')==='cont_req'){this.set('inContactsRequest',true);}else if(message.get('kind')==='contacts'){this.set('inContactsRequest',false);}
if(!this.messages.has(message)){var newMessage=true;}
this.messages.add(message,{merge:true});newMessage&&this.trigger('message:afterAdd',message);},updateMessage:function(messageData){var message=this.messages.get(messageData['clientSideId']);if(message){message.set(messageData);}},deleteMessage:function(id){var messages=this.messages.where({id:id});if(!_.isEmpty(messages)){_.each(messages,function(message){message.destroy();});}},setObject:function(root,object,path){if(!path){if(object['messages']){object['messages']instanceof classes.collections.Messages?this.messages=object['messages']:_.each(object['messages'],this.addMessage.webimBind(this));delete object['messages'];}
if(object['operator']&&!(object['operator']instanceof classes.models.Operator)){object['operator']=new classes.models.Operator(object['operator']);}
if(object['creationTs']){object['created']=new Date(object['creationTs']*1000+core.repository.get('session').get('timeDelta'));}}
classes.models.Base.prototype.setObject.call(this,root,object,path);},get:function(fieldName){return fieldName==='messages'?this.messages:classes.models.Base.prototype.get.call(this,fieldName);},getAll:function(){var data=classes.models.Base.prototype.getAll.call(this);return _.extend({},data,{messages:this.messages});}});classes.models.File=classes.models.Base.extend({defaults:{name:'',size:0,type:'',progress:0.0,errorCode:0,status:'pending',fileObject:null},idField:'id'});classes.models.Hint=classes.models.Base.extend({defaults:{text:''}});classes.models.Invitation=classes.models.Base.extend({defaults:{type:null,state:'inactive',message:'',visitorMessage:'',operatorAvatar:'',ainviteId:null,conditions:null,position:'',closedCount:0,lastClosedTime:null},accept:function(){this.set({'state':'accept','closedCount':this.get('closedCount')+1,'lastClosedTime':_.now()});},reject:function(){this.set({'state':'reject','closedCount':this.get('closedCount')+1,'lastClosedTime':_.now()});},timeout:function(){this.set({'state':'timeout','closedCount':this.get('closedCount')+1,'lastClosedTime':_.now()});},fetch:function(){if(this.get('ainviteId')){var aInviteStats=core.storage.get('WEBIM_AINVITE_STATS',{});var aInviteStat=aInviteStats[this.get('ainviteId')]||{};aInviteStat['closed_count']&&this.set('closedCount',aInviteStat['closed_count']);aInviteStat['last_closed_time']&&this.set('lastClosedTime',aInviteStat['last_closed_time']);}},save:function(){if(this.get('ainviteId')){var aInviteStats=core.storage.get('WEBIM_AINVITE_STATS',{});var aInviteStat=aInviteStats[this.get('ainviteId')]||{};aInviteStat['closed_count']=this.get('closedCount');aInviteStat['last_closed_time']=this.get('lastClosedTime');aInviteStats[this.get('ainviteId')]=aInviteStat;core.storage.set('WEBIM_AINVITE_STATS',aInviteStats,3/24);}}});classes.models.Location=classes.models.Base.extend({defaults:{name:function(){return env.getLocation();},chat:function(){return{};},invitation:null,button:null},initialize:function(data){_.extend(this.defaults,window.webimInit||{});},hasOption:function(fieldName){return Boolean(this.get(fieldName));},fetch:function(){return core.loader.loadLocation().done(function(locationData){locationData.chat['visitorFields']=this.visitorFieldsNormalization(locationData.chat['visitorFields']);this.set(locationData);this.set('styles',$.extend(true,{},this.getOldStyles(),this.get('styles')||{}));}.webimBind(this));},visitorFieldsNormalization:function(visitorFields){return _.mapObject(visitorFields,function(fields){return _.mapObject(fields,function(field){return _.mapObject(field,function(val,key){return key=='presence'&&!_.contains(['','none','mandatory','optional'],val)?'none':val;})})});},getOldStyles:function(){var chatSettings=this.get('chat');var oldStyles={'header':{},'body':{},'button':{},'invitation-body':{}};if(chatSettings['headerColor']){oldStyles['header']['background']=chatSettings['headerColor'];}
if(chatSettings['headerGradientColor']){oldStyles['header']['gradient']=chatSettings['headerGradientColor'];}
if(chatSettings['bgColor']){oldStyles['body']['background']=chatSettings['bgColor'];}
if(chatSettings['buttonColor']){oldStyles['button']['background']=chatSettings['buttonColor'];}
if(chatSettings['buttonGradientColor']){oldStyles['button']['gradient']=chatSettings['buttonGradientColor'];}
var invitationSettings=this.get('invitation');if(invitationSettings['bg']){oldStyles['invitation-body']['background']=invitationSettings['bg'];}
if(invitationSettings['fontSize']){oldStyles['invitation-body']['font-size']=invitationSettings['fontSize'];}
if(invitationSettings['fontColor']){oldStyles['invitation-body']['color']=invitationSettings['fontColor'];}
return oldStyles;}});classes.models.Message=classes.models.Base.extend({idField:'clientSideId',defaults:{id:null,name:'',date:null,time:null,text:'',avatar:'',kind:'',data:{},ts:function(){return _.now()/1000;},clientSideId:function(){return tools.guid();}},setObject:function(root,object,path){if(!path){if(object['ts']){object['created']=new Date(object['ts']*1000+core.repository.get('session').get('timeDelta'));}}
classes.models.Base.prototype.setObject.call(this,root,object,path);},isOperatorMessage:function(){return _.contains(['cont_req','operator','file_operator'],this.get('kind'));},isNew:function(){return!Boolean(this.data['id']);},sync:function(){if(this.isNew()){var messageChunks=this.get('text').match(/[\s\S]{1,1000}/g);if(messageChunks.length===1){core.tracking.track('chat.message',{message:this.get('text'),'client-side-id':this.get('clientSideId'),data:this.get('data')});}else{var sendChunks=function(chunks,clientSideId){var chunk=chunks.shift();if(chunks.length){core.tracking.track('chat.message-part',{message_part:chunk,'client-side-id':clientSideId,data:this.get('data')}).done(sendChunks.webimBind(this,chunks,clientSideId));}else{core.tracking.track('chat.message-part',{message_part:chunk,'client-side-id':clientSideId,last_part:true,data:this.get('data')});}}.webimBind(this);sendChunks(messageChunks,this.get('clientSideId'));}}}});classes.models.Notification=classes.models.Base.extend({defaults:{type:null,title:'',message:'',imageUrl:'',okButton:function(){return core.resources.get('chat.notifications.ok_button');},cancelButton:function(){return core.resources.get('chat.notifications.cancel_button');}}});classes.models.Operator=classes.models.Base.extend({defaults:{fullname:'',langToFullname:null,avatar:function(){return env.accountName==='ltcompanycom'?'/webim/images/x.gif':'';}}});classes.models.Session=classes.models.Base.extend({statusDeferred:null,defaults:{id:null,pageId:null,onlineStatus:null,state:null,timeDelta:0},initialize:function(data){this.statusDeferred=new $.Deferred();},setObject:function(root,object,path){classes.models.Base.prototype.setObject.call(this,root,object,path);if(!path){if(object['onlineStatus']){this.statusDeferred.resolve();}}},statusInitialized:function(){return this.statusDeferred.promise()},fetch:function(){var sessionId=core.storage.get('WEBIM_VISIT_SESSION_ID')||(Boolean(env.separateChatWindow)?tools.getUrlParam('visit-session-id')||null:null);this.set('id',sessionId);},save:function(){core.storage.set('WEBIM_VISIT_SESSION_ID',this.get('id'),1/24);}});classes.models.System=classes.models.Base.extend({defaults:{focus:function(){return _.isFunction(document.hasFocus)?document.hasFocus():true},manualFocus:false},calculatedConfigs:{inFocus:{related:['focus','manualFocus'],calc:function(focus,manualFocus){return focus||manualFocus;}}}});classes.models.Tariff=classes.models.Base.extend({hasOption:function(fieldName){return Boolean(this.get(fieldName));},fetch:function(){return core.loader.loadTariff().done(function(tariffData){this.set(tariffData);}.webimBind(this));}});classes.models.Teleport=classes.models.Base.extend({defaults:{url:''}});classes.models.Visitor=classes.models.Base.extend({defaultNames:{'en':'Visitor','he':'','ru':'','tr':'Ziyareti','ua':''},providedFields:null,initialize:function(data){if(_.isObject(window.webim_visitor)){this.providedFields=_.clone(window.webim_visitor['fields']||window.webim_visitor);if(this.providedFields.hasOwnProperty('display_name')){this.providedFields['name']=_.contains(this.defaultNames,this.providedFields['display_name'])?'':this.providedFields['display_name'];delete this.providedFields['display_name'];}
_.extend(data,{fields:this.providedFields});}},getProvidedFieldsOnly:function(){return this.providedFields?_.clone(this.providedFields):null;},setObject:function(root,object,path){if(path==='fields'){if(_.has(object,'display_name')){object['name']=object['display_name'];delete object['display_name'];}
_.each(object,function(fieldValue,fieldName){object[fieldName]=this.processThroughProvidedFields(fieldName,fieldValue);}.webimBind(this));}
return classes.models.Base.prototype.setObject.call(this,root,object,path);},isFixedField:function(fieldName){return this.data['hasProvidedFields']&&_.has(this.providedFields,fieldName);},processThroughProvidedFields:function(fieldName,value){if(this.isFixedField(fieldName)){value=this.providedFields[fieldName];}
if(fieldName==='name'&&_.contains(this.defaultNames,value)){value='';}
return value;},fetch:function(){var visitorData=core.storage.get('WEBIM_VISITOR');if(!_.has(visitorData,'fields')){var oldVisitorData=visitorData;visitorData={'fields':{}};_.each(oldVisitorData,function(value,fieldName){if(fieldName==='id'||fieldName==='icon'){visitorData[fieldName]=value;}else{visitorData['fields'][fieldName]=oldVisitorData[fieldName];}});}
visitorData&&this.set(visitorData);return classes.models.Base.prototype.fetch.call(this);},save:function(){core.storage.set('WEBIM_VISITOR',this.getAll(),365);return classes.models.Base.prototype.save.call(this);}});classes.collections={};classes.collections.Base=tools.makeBase([classes.mixins.Events],{constructor:function(models){this.models=[];this.initialize(models);models&&this.add(models);},modelConstructor:null,models:null,initialize:function(models){},add:function(modelOrModelsOrData,options){if(_.isArray(modelOrModelsOrData)){_.each(modelOrModelsOrData,function(model){this.add(model,options);}.webimBind(this));}else if(_.isObject(modelOrModelsOrData)&&!(modelOrModelsOrData instanceof this.modelConstructor)){this.add(new this.modelConstructor(modelOrModelsOrData),options);}else{options=_.defaults(options||{},{merge:false,prepend:false});if(!this.has(modelOrModelsOrData)){this.trigger('beforeAdd',modelOrModelsOrData);options['prepend']?this.models.unshift(modelOrModelsOrData):this.models.push(modelOrModelsOrData);this.listenToOnce(modelOrModelsOrData,'afterDestroy',this.remove.webimBind(this,modelOrModelsOrData));this.trigger('afterAdd',modelOrModelsOrData);this.trigger(options['prepend']?'afterPrepend':'afterAppend',modelOrModelsOrData);}else if(options['merge']){this.get(modelOrModelsOrData).set(modelOrModelsOrData.getAll());}}},prepend:function(modelOrModelsOrData,options){this.add(modelOrModelsOrData,_.extend(options||{},{'prepend':true}));},get:function(idOrCidOrModel){if(idOrCidOrModel){var keys=[];if(idOrCidOrModel instanceof this.modelConstructor){keys.push(idOrCidOrModel.getId());keys.push(idOrCidOrModel.getCID());}else{keys.push(idOrCidOrModel);}
keys=_.compact(keys);return _.find(this.models,function(model){return Boolean(_.intersection(_.compact([model.getCID(),model.getId()]),keys).length);});}else{return null;}},remove:function(idOrCidOrModel){var model=this.get(idOrCidOrModel);if(model){this.models=_.without(this.models,model);this.trigger('afterRemove',model);return model;}
return null;},has:function(model){return _.contains(this.models,model)||Boolean(this.get(model));},first:function(){return _.first(this.models);},last:function(){return _.last(this.models);},size:function(){return _.size(this.models);},where:function(filter){var result=[];_.each(this.models,function(model){if(_.every(filter,function(value,key){return model.get(key)===value;})){result.push(model);}});return result;},reset:function(){this.models=[];this.trigger('afterReset');},each:function(callback){_.each(this.models,callback);},getAll:function(){return this.models;},fetch:function(options){var fetchDeferred=new $.Deferred();fetchDeferred.resolve();return fetchDeferred.promise();}});classes.collections.Departments=classes.collections.Base.extend({modelConstructor:classes.models.Department});classes.collections.Dialogues=classes.collections.Base.extend({modelConstructor:classes.models.Dialogue,hasPreviousDialogues:false,loadDeferred:null,loadPrevious:function(){if(!this.loadDeferred){var loadDeferred=this.loadDeferred=new $.Deferred();loadDeferred.always(function(){this.loadDeferred=null;}.webimBind(this));if(this.hasPreviousDialogues){var url=env.getBaseUrl()+'/l/v/get-history'
+'?sessionid='+core.repository.get('session').get('id')
+'&chatid='+(this.size()>1?this.first().get('id'):'0');core.loader.loadUrl(url).done(function(response){if(response['result']&&response['result']==='ok'){this.setHasPrevious(response['data']['hasAnotherOne']);if(response['data']['chat']){var loadedDialogue=new this.modelConstructor(response['data']['chat']);this.prepend(loadedDialogue);loadDeferred.resolve(loadedDialogue);}else{loadDeferred.reject('has-not-previous-dialogue');}}else{loadDeferred.reject(response['error']);}}.webimBind(this)).fail(function(response){loadDeferred.reject(response);});}else{loadDeferred.reject('has-not-previous-dialogue');}
return loadDeferred.promise();}else{return this.loadDeferred.promise();}},hasPrevious:function(){return this.hasPreviousDialogues;},setHasPrevious:function(hasPrevious){if(this.hasPreviousDialogues!==Boolean(hasPrevious)){this.hasPreviousDialogues=Boolean(hasPrevious);this.trigger('hasPrevious:afterUpdate',this.hasPreviousDialogues);}},add:function(model,options){classes.collections.Base.prototype.add.call(this,model,options);if(!options||!options['prepend']){this.trigger('newCurrent',this.getCurrent());}},getCurrent:function(){return _.find(this.models,function(dialogue){return dialogue.get('isActive');})||this.last();},reset:function(){classes.collections.Base.prototype.reset.call(this);this.setHasPrevious(false);}});classes.collections.Files=classes.collections.Base.extend({modelConstructor:classes.models.File});classes.collections.Hints=classes.collections.Base.extend({modelConstructor:classes.models.Hint,sourceUrl:function(){return core.settings.config.get('visitor_hints_api_endpoint')+'/autocomplete'},fetch:function(fetchParams){return $.post(this.sourceUrl(),$.toJSON(fetchParams),null,'json').done(this.reset.webimBind(this)).done(function(data){if(data&&data['hints']){this.add(data['hints'])}}.webimBind(this)).done(this.trigger.webimBind(this,'afterSync'));}});classes.collections.Invitations=classes.collections.Base.extend({modelConstructor:classes.models.Invitation,getActive:function(){return this.where({state:'active'});}});classes.collections.Messages=classes.collections.Base.extend({modelConstructor:classes.models.Message});classes.services={};classes.services.Base=tools.makeBase([classes.mixins.Events],{constructor:function(options){this.radio=options['radio'];_.each(this.actions,function(handlerName,actionName){this.radio.reply('service:'+actionName,this[handlerName].webimBind(this));}.webimBind(this));this.initialize(options);},radio:null,actions:{},initialize:function(options){},destroy:function(){_.each(this.actions,function(handlerName,actionName){this.radio.stopReplying('service:'+actionName);}.webimBind(this));this.trigger('afterDestroy');}});classes.services.Button=classes.services.Base.extend({buttonWrapper:null,stdButtonWrapper:null,model:null,callButtonWrapper:null,buttonType:null,buttonReady:null,actions:{'button:start':'start','button:stop':'stop','button:hide':'stop'},initialize:function(params){this.params=_.defaults(params,{createButtonElement:false,buttonClass:'webim_button',callButtonClass:'webim_call_button'});if(env.getMode()==='preview'){this.params['createButtonElement']=true;}
this.buttonReady=new $.Deferred();this.buttonViewReady=new $.Deferred();$(function(){this.buttonWrapper=$('a[rel="webim"],'+'a[href*="webim.ru/webim/client.php"],'+'.webim_button,'+'.webim_button_online,'+'.webim_button_offline');this.callButtonWrapper=$('.webim_call_button');this.buttonWrapper.filter('.webim_button_online, .webim_button_offline').hide();core.settings.ready().done(function(){this.buttonType=core.settings.location.get('button.kind');this.buttonToReplace=this.buttonWrapper.filter('.webim_button:not(.webim_basic_button):has(img[src*="button.php"])');if(this.isNeedToCreateButton()){this.buttonToReplace.hide();this.createButtonModel(this.buttonType,this.params).done(function(model){this.model=model;this.createButtonView(model).done(function(buttonView){this.buttonView=buttonView;this.buttonViewReady.resolve();}.webimBind(this))}.webimBind(this));}
var startChatButton=this.buttonWrapper;this.stdButtonWrapper=this.buttonWrapper.filter(function(){return(!$(this).hasClass('webim_basic_button')&&$('img',this).length)});startChatButton.click(this.clickStartChatButtonEvent.webimBind(this)).filter('a[rel="webim"], a[href*="webim.ru/webim/client.php"], a.webim_button').attr('href','').end();core.repository.get('session').statusInitialized().done(function(){if(_.contains(['online','busy_online'],core.repository.get('session').get('onlineStatus'))){this.buttonWrapper.filter('.webim_button_online').show();this.buttonWrapper.filter('.webim_button_offline').hide();}else{this.buttonWrapper.filter('.webim_button_offline').show();this.buttonWrapper.filter('.webim_button_online').hide();}
core.repository.get('session').on('onlineStatus:afterUpdate',function(onlineStatus){this.addParamToButtonImgUrl('force-status',core.repository.get('session').get('state')!=='chat'||env.getMode()==='preview'?onlineStatus:'online');if(onlineStatus==='online'){this.stdButtonWrapper.show()}else if(!core.settings.tariff.get('offline_message')||core.settings.location.get('button.offlineEnabled')!=='Y'){this.stdButtonWrapper.hide()}}.webimBind(this),0);this.buttonWrapper.find('img').first().load(function(){this.buttonReady.resolve();}.webimBind(this));if(this.buttonWrapper.find('img').length){var img=this.buttonWrapper.find('img').get(0);if(img.complete||img.naturalWidth){this.buttonReady.resolve();}}}.webimBind(this));}.webimBind(this));}.webimBind(this));},createButtonModel:function(kind,params){var buttonCreated=new $.Deferred();var modelCreated=new $.Deferred();if(kind==='html'){var model={};core.loader.loadChannels().done(function(channels){model=new classes.models.Button(_.extend({},core.settings.location.get('button.html'),{name:'html',kind:'html',offlineEnabled:core.settings.tariff.get('offline_message')&&core.settings.location.get('button.offlineEnabled')==='Y',isPreview:env.getMode()==='preview',channels:_.extend({},{webim:{name:'Webim',type:'webim'}}),startChatHandler:this.clickStartChatButtonEvent,isMobile:core.browser.isMobile()}));if(core.repository.get('dialogues').getCurrent()){model.setDialogueHandlers(core.repository.get('dialogues').getCurrent())}else{core.repository.get('dialogues').on('newCurrent',function(dialogue){model.setDialogueHandlers(dialogue)});}
if(env.getMode()==='preview'){core.settings.location.on('button.html:afterUpdate',function(data){model.set(data);});core.settings.location.on('button.offlineEnabled:afterUpdate',function(data){model.set('offlineEnabled',data==='Y');});}
modelCreated.resolve();}.webimBind(this));}
else{var model=new classes.models.ImageButton(_.extend({},_.pick(core.settings.location.get('button'),['kind','name',kind]),{class:params['buttonClass'],isPreview:env.getMode()==='preview',offlineEnabled:core.settings.tariff.get('offline_message')&&core.settings.location.get('button.offlineEnabled')==='Y',imageUrl:env.getBaseUrl()+'/button.php?location='+env.getLocation(),startChatHandler:this.clickStartChatButtonEvent}));if(env.getMode()==='preview'){core.settings.location.on('button.offlineEnabled:afterUpdate',function(data){model.set('offlineEnabled',data==='Y');});}
modelCreated.resolve();}
modelCreated.done(function(){var setOnlineStatusDeferred=new $.Deferred();core.repository.get('session').statusInitialized().done(function(){model.set('state',core.repository.get('session').get('onlineStatus'));setOnlineStatusDeferred.resolve();}.webimBind(this));core.repository.get('session').on('onlineStatus:afterUpdate',function(onlineStatus){model.set('state',onlineStatus);}.webimBind(this));$.when(model.fetch(),setOnlineStatusDeferred).done(function(){buttonCreated.resolve(model)});});return buttonCreated.promise();},createButtonView:function(model){var viewCreated=new $.Deferred();switch(model.get('kind')){case'html':core.loader.loadButton().done(function(button){var buttonView=new classes.views.items.HtmlButton(button,this.radio,model);viewCreated.resolve(buttonView);}.webimBind(this));break;case'slider':var buttonView=new classes.views.items.SliderButton('',this.radio,model);buttonView.on('loadImage',function(){viewCreated.resolve(buttonView);});break;case'corner':var buttonView=new classes.views.items.CornerButton('',this.radio,model);buttonView.on('loadImage',function(){viewCreated.resolve(buttonView);});break;case'simple':var buttonView=new classes.views.items.ImageButton('',this.radio,model);buttonView.on('loadImage',function(){viewCreated.resolve(buttonView);});break;}
return viewCreated.promise();},clickStartChatButtonEvent:function(event){event.preventDefault();var wrapper=$(event.currentTarget);var params={};if(wrapper.attr('webim_department_key')){params['department-key']=wrapper.attr('webim_department_key');}
if(wrapper.data('webimMode')){params['mode']=wrapper.data('webimMode');}
if(core.settings.account.get('blocked')){this.radio.request('service:notifications:alert',{'title':'Error','message':'\u0418\u0437\u0432\u0438\u043D\u0438\u0442\u0435\u002C\u0020\u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0020\u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D'});}else{if(!_.has(params,'mode')&&core.settings.location.get('chat.showFirst')){var mode=core.settings.location.get('chat.showFirst');if(mode!=='callback-hunter'||core.repository.get('session').get('onlineStatus')==='online'||core.settings.location.get('chat.callbackHunterAvailableInOffline')==='Y'){params=params||{};params['mode']=mode;}}
this.radio.request('service:chat:start',params);}},isNeedToCreateButton:function(){return this.buttonToReplace.length||this.params['createButtonElement'];},start:function(){this.trackShowButtonAction();if(this.isNeedToCreateButton()){this.buttonViewReady.done(function(){if(env.getMode()==='preview'){core.settings.location.on('button:afterUpdate',function(settings){if(this.model.get('kind')!==core.settings.location.get('button.kind')){this.buttonView.destroy();this.model.destroy();this.createButtonModel(core.settings.location.get('button.kind'),this.params).done(function(model){this.model=model;this.createButtonView(model).done(function(buttonView){this.buttonView=buttonView;this.buttonView.getWrapper().appendTo(this.stdButtonWrapper);this.buttonView.prepareButton();}.webimBind(this))}.webimBind(this));}else{this.model.set(_.pick(settings,['kind','name',core.settings.location.get('button.kind')]));}}.webimBind(this));this.buttonView.getWrapper().appendTo(env.getRootWrapper());}else{this.buttonToReplace.length?this.buttonView.getWrapper().insertAfter(this.buttonToReplace):this.buttonView.getWrapper().appendTo(env.getRootWrapper());}
execHook('buttonElementReady',this.buttonView.getWrapper());this.buttonView.prepareButton();this.buttonToReplace.remove();this.buttonReady.resolve();}.webimBind(this));}},addParamToButtonImgUrl:function(paramName,paramValue,buttonWrp){var imgWrp;if(typeof buttonWrp!=='undefined'){imgWrp=$('img',buttonWrp);}else{imgWrp=this.buttonWrapper.children('img');}
imgWrp.each(function(i,e){var wrp=$(e);var src=wrp.attr('src');if(src&&src.indexOf('/button.php')!==-1){src=tools.setUrlParam(src,paramName,paramValue);wrp.attr('src',src).attr('width',null).attr('height',null);}});},stop:function(){if(this.buttonWrapper){this.buttonWrapper.hide();}
if(this.buttonView){this.buttonView.hide();}},initCallButton:function(){this.callButtonWrapper.click(function(event){event.preventDefault();this.radio.request('service:call:start');}.webimBind(this));},trackShowButtonAction:function(){$.when(core.tracking.trackingStarted(),this.buttonReady).done(function(){if(!this.params['createButtonElement']){var img=this.buttonWrapper.find('img').get(0);var width=0;if(img.naturalWidth){width=img.naturalWidth;}else if(img&&img.src){var imgObj=new Image();imgObj.src=img.src;width=imgObj.width;}
if(width){var trackAction='offline-button';if(core.repository.get('session').get('onlineStatus')==='online'){trackAction='online-button';}
this.radio.request('service:web-analytics:track-event',trackAction);}}
else{if(this.buttonType!=='html'){var img=this.buttonView.ui.image;var width=0;if(img.width()){width=img.width();}else if(img&&img.src){var imgObj=new Image();imgObj.src=img.src;width=imgObj.width;}
if(width){var trackAction='offline-button';if(core.repository.get('session').get('onlineStatus')==='online'){trackAction='online-button';}
this.radio.request('service:web-analytics:track-event',trackAction);}}else{if(this.buttonView.getWrapper().is(":visible")){var trackAction='offline-button';if(core.repository.get('session').get('onlineStatus')==='online'){trackAction='online-button';}
this.radio.request('service:web-analytics:track-event',trackAction);}}}}.webimBind(this));}});(function(){classes.services.Alarm=classes.services.Base.extend({titleBlinking:null,sound:null,actions:{'alarm:start':'start','alarm:stop':'stop'},initialize:function(options){this.titleBlinking=new TitleBlinking();this.sound=new Sound();this.chatModel=core.repository.get('chat');this.listenTo(this.chatModel,'soundEnabled:afterUpdate',this.onSoundEnabledUpdate.webimBind(this));this.onSoundEnabledUpdate(this.chatModel.get('soundEnabled'));},start:function(kind){this.titleBlinking.start();this.sound.start(kind);},stop:function(kind){this.sound.stop(kind);this.titleBlinking.stop();},onSoundEnabledUpdate:function(soundEnabled){soundEnabled?this.sound.enable():this.sound.disable();},destroy:function(){this.sound.stopAll();this.sound=null;this.titleBlinking.stop();this.titleBlinking=null;this.chatModel=null;classes.services.Base.prototype.destroy.call(this);}});function TitleBlinking(params){_.extend(this,_.pick(params||{},['injectingText','period']));}
TitleBlinking.prototype={constructor:TitleBlinking,injectingText:'* ',period:500,isTextInjected:false,blinkingIntervalId:null,start:function(){if(this.blinkingIntervalId){this.stop();}
this.blinkingIntervalId=setInterval(this.toggleTitle.webimBind(this),this.period);},stop:function(){if(!this.blinkingIntervalId){return;}
clearInterval(this.blinkingIntervalId);if(this.isTextInjected){this.toggleTitle();}},toggleTitle:function(){if(this.isTextInjected){document.title=document.title.substring(this.injectingText.length)}else{document.title=this.injectingText+document.title;}
this.isTextInjected=!this.isTextInjected;}};function Sound(){this.sounds={};this.configs={'new_message':{src:[{url:env.getBaseUrl()+'/cd2/sounds/new-message-visitor.ogg?'+env.version,mime:'audio/ogg'},{url:env.getBaseUrl()+'/cd2/sounds/new-message-visitor.mp3?'+env.version,mime:'audio/mpeg'},{url:env.getBaseUrl()+'/cd2/sounds/new-message-visitor.wav?'+env.version,mime:'audio/wav'}]}};this.loadedPromises={};if(!core.browser.support('audio')){this.disable();}}
Sound.prototype={constructor:Sound,enabled:null,sounds:null,configs:null,loadedPromises:null,loadPromise:function(soundType){if(!this.loadedPromises[soundType]){var soundDeferred=new $.Deferred();function SoundObject(settings){var audioWrp=$('<audio />');_.each(settings['src'],function(attr){var sourceWrp=$('<source>').attr('src',attr['url']).attr('type',attr['mime']);audioWrp.append(sourceWrp);});audioWrp.hide();$('body').append(audioWrp);this.audioElement=audioWrp.get(0);}
SoundObject.prototype={audioElement:null,playing:false,start:function(){this.stop();this.audioElement.play();this.playing=true;},stop:function(){if(this.playing){try{this.audioElement.pause();this.audioElement.currentTime=0;}catch(e){}
this.playing=false;}}};this.sounds[soundType]=new SoundObject(this.configs[soundType]);$(this.sounds[soundType].audioElement).on('canplay',function(){soundDeferred.resolve();});this.loadedPromises[soundType]=soundDeferred.promise();}
return this.loadedPromises[soundType];},start:function(soundType){if(this.enabled){this.loadPromise(soundType).done(function(){if(this.sounds[soundType]){this.sounds[soundType].start();}}.webimBind(this));}},stop:function(soundType){if(this.sounds[soundType]){this.sounds[soundType].stop();}},stopAll:function(){_.each(this.sounds,function(sound){sound.stop();});},enable:function(){if(core.browser.support('audio')){this.enabled=true;}},disable:function(){this.enabled=false;this.stopAll();}};})();classes.services.Call=classes.services.Base.extend({actions:{'call:start':'start'},start:function(){var url=null;if(core.settings.config.hasOption('v2chat_call_url')){url=core.settings.config.get('v2chat_call_url');}else if(core.settings.config.hasOption('v2chat_calls_enabled')){url='http://webrtc.v2chat.com/click2call/';}else{return;}
var callPopupWidth=320;var callPopupHeight=320;url+='?accountname='+encodeURIComponent(env.accountName);var params='';if(core.repository.get('operator')){params='&operatorid='+encodeURIComponent(core.repository.get('operator').get('id'));}
if(core.settings.config.hasOption('default_lang')){params+='&lang='+core.settings.location.get('chat.lang');}
url+=params;var w=window.open(url,'_blank','width='+callPopupWidth+',height='+callPopupHeight+',resizable=no,toolbar=no,menubar=no,location=no,status=no,scrollbar=no');w.opener=null;if(w){w.focus();}
setTimeout(function(){if(w){w.focus();}},1);}});classes.services.Chat=classes.services.Base.extend({chatPromise:null,preparedChatDeferred:null,openedSeparateChatWindow:null,started:false,params:null,chatView:null,currentDialogue:null,chatModel:null,chatIntervalId:null,actions:{'chat:start':'start','chat:close':'close'},initialize:function(options){this.preparedChatDeferred=new $.Deferred();this.chatModel=core.repository.get('chat');if(this.isSeparateWindow()){$(window).unload(function(){this.started&&core.tracking.track('chat.close');}.webimBind(this));this.radio.on('startSeparateChatWithPrehistory',function(prehistory){if(prehistory){this.params['prehistory']=prehistory;}
this.params=_.defaults(this.params,{'first-question':tools.getUrlParam('first_question_text_from_invitation')||undefined,'mode':tools.getUrlParam('mode')||undefined,'department-key':tools.getUrlParam('department_key')||undefined});this.startInAppropriateWindow();}.webimBind(this));}else{this.radio.on('sendPrehistoryToSeparate',function(){if(this.openedSeparateChatWindow){var message={'name':'prehistory_body'};message.data=this.params.prehistory;this.openedSeparateChatWindow.postMessage(JSON.stringify(message),'*');}}.webimBind(this));}
core.repository.get('invitations').each(this.onNewInvitation.webimBind(this));this.listenTo(core.repository.get('invitations'),'afterAdd',this.onNewInvitation.webimBind(this)).listenTo(core.repository.get('invitations'),'afterRemove',this.onRemoveInvitation.webimBind(this)).listenTo(core.repository.get('dialogues'),'afterReset',this.cleanDialogue.webimBind(this)).listenTo(core.repository.get('dialogues'),'newCurrent',this.resetDialogue.webimBind(this));this.resetDialogue(core.repository.get('dialogues').getCurrent());core.repository.get('session').on('state:afterUpdate',this.sessionStateUpdateHandler.webimBind(this));this.sessionStateUpdateHandler(core.repository.get('session').get('state'));if(!this.shouldBeInSeparateWindow()){this.prepareChatViewPromise();}},start:function(params){this.params=params||{};if(this.isSeparateWindow()){var parentToPost=window.opener||window.parent;if(parentToPost&&parentToPost!==window){var message={'name':'separate_chat_ready_to_start'};parentToPost.postMessage(JSON.stringify(message),"*");}}else{this.startInAppropriateWindow();}},startInAppropriateWindow:function(){if(this.shouldBeInSeparateWindow()){this.startInSeparateWindow();}else{this.startInCurrentWindow();}},onNewInvitation:function(invitation){this.listenToOnce(invitation,'state:afterUpdate',function(state){if(state==='accept'){this.start({'first-question':invitation.get('visitorMessage')||undefined,'withoutEvent':true});}}.webimBind(this));},onRemoveInvitation:function(invitation){this.stopListening(invitation);},prepareChatViewPromise:function(){if(!this.chatPromise){this.chatPromise=core.loader.loadChat().done(function(chatHtml){this.chatIntervalId=setInterval(function(){this.chatModel.fetch();}.webimBind(this),2000);this.chatModel.fetch();this.chatView=new classes.views.items.Chat(chatHtml,this.radio,this.chatModel);this.chatView.listenTo(this.chatModel,{'minimized:afterUpdate':this.minimizedUpdateHandler.webimBind(this),'closed:afterUpdate':this.closedUpdateHandler.webimBind(this)});this.chatView.getWrapper().appendTo(env.getRootWrapper());this.closedUpdateHandler(this.chatModel.get('closed'));this.minimizedUpdateHandler(this.chatModel.get('minimized'));this.preparedChatDeferred.resolve(this.chatView);}.webimBind(this));}
return this.chatPromise;},minimizedUpdateHandler:function(minimized){this.isShouldShows()&&this.chatView?this.chatView.show():this.chatView.hide();},closedUpdateHandler:function(closed){this.started=!closed;if(!this.shouldBeInSeparateWindow()){if(closed){this.chatView&&this.chatView.hide();}else{this.prepareChatViewPromise().done(function(){this.isShouldShows()&&this.chatView.show();}.webimBind(this));}}},isShouldShows:function(){return Boolean(env.separateChatWindow)&&!Boolean(env.chatInIframeMode)||this.started&&!this.chatModel.get('closed')&&!this.chatModel.get('minimized');},shouldBeInSeparateWindow:function(){return(core.browser.isMobile()||core.browser.isIEQuirkMode()||core.settings.location.get('chat.inSeparateWindow')==='Y'||env.chatInSeparateWindow)&&!this.isSeparateWindow();},startInSeparateWindow:function(){if(this.openedSeparateChatWindow){this.openedSeparateChatWindow.close();}
var visitSessionId=core.repository.get('session').get('id');var startPage=window.webim_start_page||{'title':document.title,'url':document.location.href};var baseClientPhpUrl=core.settings.config.get('client_php_url')||env.getBaseUrl()+'/client.php';var url=baseClientPhpUrl
+'?visit-session-id='+(visitSessionId?visitSessionId:'')
+(env.getLocation()!='default'?'&location='+env.getLocation():'')
+(this.params['first-question']?'&first_question_text_from_invitation='+this.params['first-question']:'')
+(this.params['department-key']?'&department_key='+this.params['department-key']:'')
+(this.params['mode']?'&mode='+this.params['mode']:'')
+'&start-page='+encodeURIComponent(webimJQuery.toJSON(startPage));if(window.webim_visitor){url+='&provided-visitor='+encodeURIComponent(JSON.stringify(window.webim_visitor));}
if(window.webim_auth_token){url+='&provided-auth-token='+encodeURIComponent(window.webim_auth_token);}
this.openedSeparateChatWindow=window.open(url,'webim_chat_'+env.accountName,'menubar=no,resizable=0,directories=no,location=no,toolbar=no,status=no,scrollbars=0,screenX=50,screenY=100,width=365,height=420');if(this.openedSeparateChatWindow){this.openedSeparateChatWindow.focus();setTimeout(this.openedSeparateChatWindow.focus.webimBind(this.openedSeparateChatWindow),1);}},startInCurrentWindow:function(){if(env.accountName!=='psboxru'){this.radio.request('service:web-analytics:track-event','chat');}
if(env.accountName==='rolfmitsubishiru'||env.accountName==='_mixey'){if(_.has(this.params,'department-key')&&_.has(this.params,'rolf-department')){this.radio.request('service:web-analytics:track-event',this.params['rolf-department'],true);this.radio.request('service:web-analytics:track-event',this.params['department-name'],true);this.radio.request('service:web-analytics:track-event',this.params['department-name']+' - '+this.params['rolf-department'],true);}}
this.prehistory=this.params['prehistory'];if(this.params['prehistory']){delete this.params['prehistory'];this.params['force-without-first-question']=true;}
if(!this.params['withoutEvent']){this.params['lang']=core.settings.location.get('chat.lang');this.params=_.omit(this.params,function(value){return _.isUndefined(value);});core.tracking.track('chat.start',this.params).fail(function(error){this.chatModel.set('closed',true);var errorToMessage={'visitor_banned':core.resources.get('chat.error_message.banned'),'chat_count_limit_exceeded':core.resources.get('chat.error_message.too_many_chats')};if(_.has(errorToMessage,error)){this.radio.request('service:notifications:alert',{'message':errorToMessage[error]});}}.webimBind(this));}
this.radio.request('service:invitations:pause-auto-invitation');this.chatModel.set('minimized',false);this.chatModel.set('closed',false);this.chatModel.save();},isSeparateWindow:function(){return Boolean(env.separateChatWindow)&&!Boolean(env.chatInIframeMode);},tryToSendPrehistory:function(){if(this.currentDialogue&&this.prehistory){this.currentDialogue.addMessage(new classes.models.Message({'text':this.prehistory,'ts':_.now()/1000,'kind':'visitor','data':{'subKind':'prehistory'}}));this.prehistory=null;}},close:function(){if(this.started){var closeEvent={stopClose:false};this.radio.trigger('service:chat:beforeClose',closeEvent);if(!closeEvent['stopClose']){core.tracking.track('chat.close').done(function(){if(this.isSeparateWindow()){window.open('','_self');window.close();}}.webimBind(this));this.chatModel.set('closed',true);this.chatModel.set('manualSetSection',null);this.chatModel.save();}}},sessionStateUpdateHandler:function(newState){this.chatModel.set('state',newState);if(newState==='chat'){webimJQuery('.webim-header').addClass('webim-section-chat-header');}else{webimJQuery('.webim-header').removeClass('webim-section-chat-header');}
if(!this.chatModel.inChatState()){_.delay(function(){if(this.chatModel.get('state')==='chat'){this.chatModel.set('closed',!this.currentDialogue.get('isActive'));}else{this.chatModel.set('closed',!this.chatModel.inChatState());}}.webimBind(this),2000);}else if(this.chatModel.get('state')!=='chat'){this.chatModel.set('closed',false);}},dialogueStateHandler:function(newState){switch(newState){case'closed_by_operator':var operatorId=this.currentDialogue.get('operator').get('id');var operatorIsRated=this.currentDialogue.get('operatorIdToRate').hasOwnProperty(operatorId);if(core.settings.location.get('chat.proposeToRateBeforeClose')==='Y'&&!operatorIsRated){this.radio.request('ui:overlay-rate:show');}
break;case'closed':case'closed_by_visitor':case'deleted':case null:if(this.chatModel.get('chatState')==='chat'){this.chatModel.set('closed',true);}
break;case'invitation':case'chatting':case'queue':this.chatModel.set('closed',false);}},cleanDialogue:function(){if(this.currentDialogue){this.stopListening(this.currentDialogue);this.currentDialogue=null;}},resetDialogue:function(dialogue){this.cleanDialogue();if(dialogue){this.currentDialogue=dialogue;this.listenTo(dialogue,{'message:afterAdd':this.onNewMessage.webimBind(this),'state:afterUpdate':this.dialogueStateHandler.webimBind(this)});this.preparedChatDeferred.done(function(chatView){chatView.listenTo(dialogue,'inContactsRequest:afterUpdate',chatView.contactsRequestHandler.webimBind(chatView));chatView.contactsRequestHandler(dialogue.get('inContactsRequest'));});this.dialogueStateHandler(dialogue.get('state'));this.tryToSendPrehistory();}},onNewMessage:function(message){if(!_.contains(['demo','preview'],env.getMode())){if(core.browser.isMobile()&&!Boolean(env.separateChatWindow)&&message.isOperatorMessage()&&!this.currentDialogue.get('readByVisitor')){var messageHideCallback=this.radio.request.webimBind(this.radio,'service:notifications:message:hide');this.radio.request('service:notifications:message',{imageUrl:env.getBaseUrl()+message.get('avatar'),message:message.get('text'),title:message.get('name')+':'},{close:function(){core.tracking.track('chat.read_by_visitor');this.currentDialogue.off('readByVisitor:afterUpdate',messageHideCallback);}.webimBind(this),click:this.start.webimBind(this)});this.currentDialogue.once('readByVisitor:afterUpdate',messageHideCallback);}else{var newMessageEvent={showChat:true};this.radio.trigger('beforeShowNewMessage',newMessageEvent);if(newMessageEvent['showChat']){this.chatModel.set('minimized',false);}
this.chatModel.save();}}},destroy:function(){this.chatIntervalId&&clearInterval(this.chatIntervalId);this.chatIntervalId=null;this.chatPromise=null;this.preparedChatDeferred&&this.preparedChatDeferred.reject();this.preparedChatDeferred=null;this.openedSeparateChatWindow=null;this.chatView&&this.chatView.destroy();this.chatView=null;this.currentDialogue=null;this.chatModel=null;classes.services.Base.prototype.destroy.call(this);}});classes.services.Cobrowsing=classes.services.Base.extend({role:null,readyDeferred:null,ws:null,mousePos:{x:0,y:0},scrollTop:0,scrollLeft:0,zooming:1,scrolling:false,clicking:false,screenSize:{w:null,h:null},state:null,cobrowsingId:null,actions:{'cobrowsing:start':'start','cobrowsing:stop':'stop'},eventHandlers:[{selector:window,event:'mousemove',handler:function(event){this.mousePos.x=event.pageX/this.zooming;this.mousePos.y=event.pageY/this.zooming;this.sendWebSocketMessage('cursor',this.mousePos);}},{selector:window,event:'scroll',handler:function(event){this.scrollTop=$(window).scrollTop()/this.zooming;this.scrollLeft=$(window).scrollLeft()/this.zooming;if(!this.scrolling){this.sendWebSocketMessage('scroll',{top:this.scrollTop,left:this.scrollLeft});}}},{selector:document,event:'click',handler:function(e){if(!this.clicking){this.sendWebSocketMessage('click',{});}}},{selector:'a, p, img, span, h1, h2, h3, input[type=text], input[type=password], select, li, ul, textarea, th, td',event:'click',handler:function(event){if(!this.clicking){this.sendWebSocketMessage('element_click',{path:this.getPathWithChildIndexes('',$(event.target))});}
if(this.role==='operator'){event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();}}},{selector:'input[type=checkbox], input[type=radio]',event:'click',handler:function(event){if(!this.clicking){this.sendWebSocketMessage('element_click',{path:this.getPathWithChildIndexes('',$(event.target))});}}},{selector:'select',event:'change',handler:function(event){_.defer(function(){this.sendWebSocketMessage('select',{path:this.getPathWithChildIndexes('',$(event.target)),val:$(event.target).val()});}.webimBind(this));}},{selector:'input[type=text], input[type=password], textarea',event:'keyup',handler:function(event){_.defer(function(){this.sendWebSocketMessage('input',{path:this.getPathWithChildIndexes('',$(event.target)),val:$(event.target).val()});}.webimBind(this));}}],initialize:function(params){_.extend(this,_.defaults(_.pick(params,['role']),{role:'visitor'}));if(this.role==='visitor'){core.repository.get('cobrowsing').on('id:afterUpdate state:afterUpdate',function(newId){this.cobrowsingId=core.repository.get('cobrowsing').get('id');this.updateState(core.repository.get('cobrowsing').get('state'));}.webimBind(this));}
if(this.role==='operator'){this.eventHandlers.push({selector:window,event:'resize',handler:this.rezoom});}
this.cursorWrapper=$('<img class="cobrowsing_cursor" style="position: absolute; left: 0; top: 0; overflow: hidden; z-index: 999999; border-radius: 10px;" src="'+env.getBaseUrl()+'/webim/images/cursor.png"/>');this.panelWrapper=$('\
        <div class="webim-root webim-cobrowsing-panel" style="display:none; position: fixed; top: 0; left: 30vw; width: 450px; height: 40px; background-color: rgba(255, 255, 255, 0.75); border: 2px solid gray; border-top: 0; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;">\
            <div style="display: inline; position: absolute; margin-top: 10px; left: 40px" class="webim-cobrowsing-status" data-webim-type="status">\
               <span class="webim-status-text" style="font-size: 15px" data-webim-type="status-text"></span>\
            </div>\
            <div style="display: inline; margin-top: 12px; position: absolute; right: 10px;" class="webim-cobrowsing-buttons">\
                <a href="#" style="font-size: 13px; font-weight: bold;text-decoration: none; color: white; background-color: #005ea5; padding: 5px 7px 5px 7px; border-radius: 5px;" data-webim-action="stop-cobrowsing"></a>\
            </div>\
        </div>');this.panelWrapper.find('[data-webim-action="stop-cobrowsing"]').text(core.resources.get('cobrowsing.visitor.disconnect_button')).click(function(e){core.tracking.track('cobrowsing.stop');}.webimBind(this));},enableEventHandlers:function(){_.each(this.eventHandlers,function(eventHandlerConf){$(eventHandlerConf['selector']).on(eventHandlerConf['event']+'.webim.cobrowsing',eventHandlerConf['handler'].webimBind(this));}.webimBind(this));},disableEventHandlers:function(){_.each(this.eventHandlers,function(eventHandlerConf){$(eventHandlerConf['selector']).off(eventHandlerConf['event']+'.webim.cobrowsing');}.webimBind(this));},start:function(cobrowsingId){if(!this.readyDeferred){this.readyDeferred=new $.Deferred();this.cobrowsingId=cobrowsingId;this.readyDeferred.done(function(){this.enableEventHandlers();$('body').append(this.cursorWrapper);}.webimBind(this));this.initWebSocketConnection();}},stop:function(){this.disableEventHandlers();this.cursorWrapper.remove();this.ws.close();this.cobrowsingId=null;this.zooming=1;if(this.readyDeferred&&this.readyDeferred.state()==='pending'){this.readyDeferred.reject();}
this.readyDeferred=null;},sendWebSocketMessage:function(type,data){var message={type:type,session_id:this.cobrowsingId,role:this.role};if(type==='init'&&this.role==='visitor'){message['url']=window.location.href;}
if(!_.isUndefined(data)){message['data']=data;}
this.ws.send($.toJSON(message));},sendFullUpdate:function(){var fu={type:'fullupdate',data:[{type:'cursor',data:this.mousePos},{type:'scroll',data:{top:this.scrollTop,left:this.scrollLeft}},{type:'screen',data:{width:$(window).width(),height:$(window).height()}}],session_id:this.cobrowsingId,role:this.role};$('input').each(function(i,e){var inputWrp=$(e);var m={type:'input',data:{path:this.getPathWithChildIndexes('',inputWrp),val:inputWrp.val()}};fu.data.push(m);}.webimBind(this));this.ws.send($.toJSON(fu));},initWebSocketConnection:function(){this.ws=new WebSocket('wss://'+env.getDomain()+'/ws/'+(this.role==='operator'?'o/':'v/')+'cobrowsing');this.ws.onopen=function(){core.logger.log('WebSocket connected to server');this.sendWebSocketMessage('init');}.webimBind(this);this.ws.onmessage=function(event){var message=$.evalJSON(event.data);if(message['type']==='ready'){if(this.role==='visitor'){this.sendFullUpdate();}
this.readyDeferred.resolve();}else if(message['type']==='fullupdate'){_.each(message['data'],function(message){this.parseMessage(message);}.webimBind(this));}else{this.parseMessage(message);}}.webimBind(this);},parseMessage:function(message){switch(message['type']){case'cursor':this.cursorWrapper.css('left',message['data']['x']);this.cursorWrapper.css('top',message['data']['y']);break;case'scroll':this.scrolling=true;$(window).scrollTop(message['data']['top']*this.zooming);$(window).scrollLeft(message['data']['left']*this.zooming);setTimeout(function(){this.scrolling=false;}.webimBind(this),100);break;case'input':$(message['data']['path']).val(message['data']['val']);break;case'select':$(message['data']['path']).val(message['data']['val']);break;case'click':this.highlightElement(this.cursorWrapper);break;case'stop':this.stop();break;case'element_click':var element=$(message['data']['path']);this.highlightElement(element);this.clicking=true;$(message['data']['path'])[0].click();setTimeout(function(){this.clicking=false;}.webimBind(this),100);break;case'screen':if(this.role==='operator'){this.screenSize.w=message['data']['width'];this.screenSize.h=message['data']['height'];this.rezoom();}}},rezoom:function(){var width_diff=$(window).width()/this.screenSize.w;var height_diff=$(window).height()/this.screenSize.h;this.zooming=width_diff>height_diff?width_diff:height_diff;$('body').css('zoom',this.zooming*100+'%');},highlightElement:function(element){element.animate({boxShadow:'0 0 7px 5px rgba(44,191,68,1)'},300);setTimeout(function(){element.animate({boxShadow:'0 0 0 0 rgba(44,191,68,1)'},300);}.webimBind(this),500);},getPathWithChildIndexes:function(path,elementWrp){if(elementWrp.is('body')){return'body'+path;}else{var cur=elementWrp.get(0).nodeName.toLowerCase();var id=elementWrp.attr('id');if(typeof id!=='undefined'){cur+='#'+id;return cur+path;}else{var parent=elementWrp.parent();var index=parent.children(cur).index(elementWrp);cur+=':eq('+index+')';return this.getPathWithChildIndexes(' > '+cur+path,elementWrp.parent());}}},updateState:function(state){if(state!=this.state){this.state=state;this.updateCobrowsingPanel();switch(this.state){case'waiting_for_visitor':this.prepareCobrowsing();break;case'connected':this.showCobrowsingPanel();this.startCobrowsingSession();break;case'disconnected':this.stopCobrowsing();break;}}},prepareCobrowsing:function(){if(core.browser.support('websockets')&&!core.browser.isMobile()){if(this.cobrowsingId){core.tracking.track('cobrowsing.accept');this.showCobrowsingPanel();}}else{core.tracking.track('cobrowsing.not_supported');}},startCobrowsingSession:function(){this.start(this.cobrowsingId);},stopCobrowsing:function(){this.stop();this.state=null;setTimeout(this.hideCobrowsingPanel.webimBind(this),1000);},hideCobrowsingPanel:function(){this.panelWrapper.slideUp();},showCobrowsingPanel:function(){!$.contains(document.body,this.panelWrapper.get(0))&&$('body').append(this.panelWrapper);this.updateCobrowsingPanel();this.panelWrapper.slideDown();},updateCobrowsingPanel:function(){this.panelWrapper.find('[data-webim-type="status-text"]').text(core.resources.get('cobrowsing.visitor.status.'+this.state));}});classes.services.Invitations=classes.services.Base.extend({templates:null,invitationView:null,visitedPageCount:1,currentPathname:'',currentUrl:'',autoInvitations:null,actions:{'invitations:get-current':'getCurrentInvitation','invitations:pause-auto-invitation':'pauseAutoInvitation'},initialize:function(options){this.autoInvitations=new classes.collections.Invitations();if(env.getMode()!=='preview'){core.repository.get('session').on('state:afterUpdate',this.sessionStateChangedHandler.webimBind(this));}
if(!core.settings.account.get('blocked')&&!core.settings.location.hasOption('invitation.dontShow')){!_.contains(['demo','preview'],env.getMode())&&this.autoInvitationInit();core.repository.get('invitations').each(this.newInvitationHandler.webimBind(this));core.repository.get('invitations').on('afterAdd',this.newInvitationHandler.webimBind(this));core.repository.get('invitations').on('afterReset',this.removeCurrentInvitation.webimBind(this));var message=tools.getUrlParam('webim-invitation-message');if(message!=null){var invByUrl=new classes.models.Invitation({type:'by-url-param',message:message});if(!_.contains(['demo','preview'],env.getMode())){core.repository.get('session').statusInitialized().done(this.addInvitation.webimBind(this,invByUrl));}else{this.addInvitation(invByUrl);}}}},addInvitation:function(model){if(core.tracking.isTrackingStarted()&&this.canShow()){core.tracking.track('inv.'+model.get('type'),{'inv_message':model.get('message'),'ainvite_id':model.get('ainviteId')});}else{core.repository.get('invitations').add(model);}},newInvitationHandler:function(invitation){if(this.canShow()){invitation.fetch();this.showInvitation(invitation);}else{core.repository.get('invitations').remove(invitation);}},showInvitation:function(model,type){type=type||'default';this.prepareInvitationsPromise().done(function(){if(_.has(this.templates,type)){this.removeCurrentInvitation();!model.get('operatorAvatar')&&model.set('operatorAvatar',core.settings.location.get('invitation.avatar'));!model.get('position')&&model.set('position',core.settings.location.get('invitation.position'));this.invitationView=new classes.views.items.Invitation(this.templates[type],this.radio,model);model.set('state','active');this.listenTo(model,'state:afterUpdate',this.invitationStateHandler.webimBind(this));this.invitationView.getWrapper().appendTo(env.getRootWrapper());this.invitationView.show();this.radio.request('service:web-analytics:track-event','invitation');}}.webimBind(this));},removeCurrentInvitation:function(){if(this.invitationView){this.stopListening(this.invitationView.getModel());this.invitationView.once('afterHide',this.invitationView.destroy.webimBind(this.invitationView));this.invitationView.hide();this.invitationView=null;}},prepareInvitationsPromise:function(){if(!this.invitationsPromise){this.invitationsPromise=core.loader.loadInvitations().done(function(invitationsResource){this.templates={};_.each(invitationsResource,function(html,type){this.templates[type]=html;}.webimBind(this));}.webimBind(this));}
return this.invitationsPromise;},canShow:function(){if(_.contains(['demo','preview'],env.getMode())){return true;}else if(env.accountName==='radugainternetru001'&&window.location.pathname==='/support'){return false;}else{return _.contains(['idle','showing','showing-auto','showing-by-url-param',null],core.repository.get('session').get('state'));}},canUseAutoInvitation:function(){return!core.storage.get('WEBIM_DONT_SHOW_AINVITE',false)&&!_.contains(['busy_online','busy_offline'],core.repository.get('session').get('onlineStatus'))&&!_.contains(['showing','showing-auto','showing-by-url-param',null],core.repository.get('session').get('state'));},pauseAutoInvitation:function(){core.storage.set('WEBIM_DONT_SHOW_AINVITE',true,3/24);},sessionStateChangedHandler:function(newState){if(!_.contains(['showing','showing-auto','showing-by-url-param'],newState)){this.removeCurrentInvitation();}},invitationStateHandler:function(state,invitation){if(state){invitation.save();var promise=core.tracking.track('inv.'+state,{message:invitation.get('visitorMessage'),inv_message:invitation.get('message')});if(state!=='accept'){promise.always(this.scheduleNext.webimBind(this));}
this.removeCurrentInvitation();}},getCurrentInvitation:function(){return this.invitationView?this.invitationView.getModel():null;},autoInvitationInit:function(){return core.loader.loadAutoInvites().done(function(autoInvites){_.each(autoInvites,function(autoInvite){this.autoInvitations.add(new classes.models.Invitation({type:'ainvite',ainviteId:autoInvite['id'],message:autoInvite['text'],conditions:autoInvite['conditions']}));}.webimBind(this));this.visitedPagesCnt=core.storage.get('WEBIM_VISITED_PAGES_CNT',0)+1;core.storage.set('WEBIM_VISITED_PAGES_CNT',this.visitedPagesCnt,3/24);var visitStartTs=core.storage.get('WEBIM_VISIT_START_TS',_.now());core.storage.set('WEBIM_VISIT_START_TS',visitStartTs,3/24);this.currentPathname=window.location.pathname.replace(/\/$/,'').replace(/^(www\.)/,'').replace(/^(https:\/\/www\.)/,'https://').replace(/^http:\/\/(www\.)/,'http://');this.currentUrl=window.location.href.replace(/^(https:\/\/www\.)/,'https://').replace(/^http:\/\/(www\.)/,'http://').replace(/^(www\.)/,'');core.repository.get('session').statusInitialized().done(function(){this.scheduleNext(false);}.webimBind(this));}.webimBind(this));},scheduleNext:function(fromRepeatsOnly){fromRepeatsOnly=_.isUndefined(fromRepeatsOnly)?true:Boolean(fromRepeatsOnly);var nextInvitation=null;var timeoutInSeconds=null;this.autoInvitations.each(function(invitation){if(fromRepeatsOnly&&(_.isUndefined(invitation.get('conditions.count_repeat'))||invitation.get('conditions.count_repeat')===1)){return;}
invitation.fetch();var aInviteTimeout=this.getAInviteTimeBeforeShow(invitation);if(aInviteTimeout!==null){if(timeoutInSeconds===null||timeoutInSeconds>aInviteTimeout){nextInvitation=invitation;timeoutInSeconds=aInviteTimeout;}}}.webimBind(this));nextInvitation&&this.scheduleAInvite(nextInvitation,timeoutInSeconds);},scheduleAInvite:function(invitation,timeoutInSeconds){invitation&&_.delay(function(){if(this.canUseAutoInvitation()){this.addInvitation(invitation);}}.webimBind(this),timeoutInSeconds*1000);},getAInviteTimeBeforeShow:function(autoInvitation){var aInviteConditions=_.extend({'visited_pages':null,'number_of_pages':null,'time_on_site':null,'count_repeat':null},autoInvitation.get('conditions')||{});if(aInviteConditions['count_repeat']===null){aInviteConditions['count_repeat']=1;}
if(aInviteConditions['count_repeat']>0&&aInviteConditions['count_repeat']<=autoInvitation.get('closedCount')){return null;}
if(!aInviteConditions['online_operators']){aInviteConditions['online_operators']='online';}
if(aInviteConditions['online_operators']!=='doesnt_matter'&&aInviteConditions['online_operators']!==core.repository.get('session').get('onlineStatus')){return null;}
var pageConditions=aInviteConditions['visited_pages']?aInviteConditions['visited_pages']['urls']:[];if(aInviteConditions['number_of_pages']&&aInviteConditions['number_of_pages']<=this.visitedPagesCnt){pageConditions.push({url:'*',time:0})}
if(aInviteConditions['time_on_site']||aInviteConditions['time_on_site']===0){var t=aInviteConditions['time_on_site']-this.getSecondsSinceLastClosed(autoInvitation.get('lastClosedTime'));pageConditions.push({url:'*',time:t>0?t:0})}
var minTime=null;_.each(pageConditions,function(pageCondition){if(minTime===null||pageCondition['time']<minTime){var url=pageCondition['url'].replace(/\/$/,'').replace(/^(www\.)/,'').replace(/^(https:\/\/www\.)/,'https://').replace(/^http:\/\/(www\.)/,'http://');if(url.match(/^https:\/\/|^http:\/\//)){if(url==this.currentUrl||url.match(/\*$/)&&this.currentUrl.indexOf(url.substr(0,url.length-1))==0){minTime=pageCondition['time'];}}else{if(url==this.currentUrl.replace(/^https:\/\/|^http:\/\//,'')||url.match(/\*$/)&&this.currentUrl.replace(/^https:\/\/|^http:\/\//,'').indexOf(url.substr(0,url.length-1))==0){minTime=pageCondition['time'];}}}}.webimBind(this));return minTime;},getSecondsSinceLastClosed:function(lastClosedTime){var now=_.now();lastClosedTime=lastClosedTime||core.storage.get('WEBIM_VISIT_START_TS',now);return(now-lastClosedTime)/1000;},destroy:function(){this.templates=null;this.invitationView&&this.invitationView.destroy();this.invitationView=null;this.autoInvitations&&this.autoInvitations.destroy();this.autoInvitations=null;classes.services.Base.prototype.destroy.call(this);}});classes.services.Notifications=classes.services.Base.extend({templates:null,notifications:null,notificationIdToContainerGuid:null,messageNotificationId:null,actions:{'notifications:message':'showNotificationMessage','notifications:message:hide':'hideNotificationMessage','notifications:hide':'hideNotification','notifications:alert':'showAlert','notifications:confirm':'showConfirm'},initialize:function(){this.notifications={};this.notificationIdToContainerGuid={};},showAlert:function(notificationData,callbacks){this.showNotification('alert',notificationData,callbacks)},showConfirm:function(notificationData,callbacks){this.showNotification('confirm',notificationData,callbacks)},showNotificationMessage:function(notificationData,callbacks){this.hideNotificationMessage();this.messageNotificationId=this.showNotification('message',notificationData,callbacks);return this.messageNotificationId;},hideNotificationMessage:function(){if(this.messageNotificationId){this.hideNotification(this.messageNotificationId);this.messageNotificationId=null;}},showNotification:function(type,notificationData,callbacks){var notificationId=_.uniqueId('notification_');this.prepareNotificationPromise().done(function(){if(_.has(this.templates,type)){notificationData['type']=type;var model=new classes.models.Notification(notificationData);var view=new classes.views.items.Notification(this.templates[type],this.radio,model,{callbacks:callbacks});view.getWrapper().appendTo('body');view.show();this.notifications[notificationId]=view;view.on('afterHide',function(){view.destroy();delete this.notifications[notificationId];}.webimBind(this));}}.webimBind(this));return notificationId;},hideNotification:function(notificationId){if(this.notifications[notificationId]){this.notifications[notificationId].hide();}},prepareNotificationPromise:function(){if(!this.notificationPromise){this.notificationPromise=core.loader.loadTemplates().done(function(templates){this.templates={};_.each(templates['notifications'],function(template,type){this.templates[type]=template;}.webimBind(this));}.webimBind(this));}
return this.notificationPromise;},destroy:function(){this.templates=null;this.notifications&&_.invoke(this.notifications,'destroy');this.notifications=null;this.notificationIdToContainerGuid=null;classes.services.Base.prototype.destroy.call(this);}});classes.services.SeparateBlocks=classes.services.Base.extend({blocksPromise:null,blocks:null,actions:{'separate-blocks:show':'showBlock','separate-blocks:hide':'hideBlock'},initialize:function(){this.blocks={};this.prepareBlocksPromise();},prepareBlocksPromise:function(){if(!this.blocksPromise){this.blocksPromise=core.loader.loadSeparateBlocks().done(function(separateBlocks){_.each(separateBlocks,function(blockHtml,blockName){var blockView=new classes.views.items.SeparateBlock(blockHtml,this.radio,new classes.models.Base({name:blockName}));this.blocks[blockName]=blockView;blockView.getWrapper().appendTo(env.getRootWrapper());}.webimBind(this));}.webimBind(this));}
return this.blocksPromise;},showBlock:function(name){this.prepareBlocksPromise().done(function(){this.blocks[name]&&this.blocks[name].show();}.webimBind(this));},hideBlock:function(name){this.blocks[name]&&this.blocks[name].hide();}});classes.services.Teleport=classes.services.Base.extend({teleportWrp:null,backupTeleportWrp:null,initialize:function(){this.teleportWrp=$('.webim_teleport').eq(0);if(this.teleportWrp.length>0){if(!this.teleportWrp.html()){this.teleportWrp.css({'cursor':'pointer','max-width':'110px','text-align':'center','background':'#234e78','color':'#fff','line-height':'30px','padding':'0 20px'}).text('\u041F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u043A\u043E\u0434');if(this.teleportWrp.css('display')==='inline'){this.teleportWrp.css('display','inline-block');}
execHook('service:teleport:prepare-wrapper',this.teleportWrp);}
this.teleportWrp.click(function(){core.tracking.startTracking().done(function(){if(core.settings.tariff.hasOption('push_url')&&core.settings.config.hasOption('teleport')){core.tracking.track('init_visitor_number');}}.webimBind(this));}.webimBind(this));this.backupTeleportWrp=this.teleportWrp.clone(true);}
this.listenTo(core.repository.get('visitor'),'number:afterUpdate',this.setVisitorNumber.webimBind(this));this.setVisitorNumber(core.repository.get('visitor').get('number'));this.listenTo(core.repository.get('teleport'),'url:afterUpdate',this.teleport.webimBind(this));this.teleport(core.repository.get('teleport').get('url'));},setVisitorNumber:function(number){if(this.backupTeleportWrp){if(number!==null){this.teleportWrp.empty();this.teleportWrp.append(number);}else{var newTeleportWrp=this.backupTeleportWrp.clone(true);this.teleportWrp.replaceWith(newTeleportWrp);this.teleportWrp=newTeleportWrp;}}},teleport:function(url){if(url&&!this.radio.request('system:request:beforeTeleport',url)){core.tracking.track('left');window.location.href=url;}}});classes.services.WebAnalytics=classes.services.Base.extend({actions:{'web-analytics:track-event':'trackEvent'},trackEvent:function(action,forceTrack){try{forceTrack?this.track(action,forceTrack):core.settings.ready().done(this.track.webimBind(this,action));}catch(e){}},track:function(action,forceTrack){if(typeof webimTrackAnalyticsEventHandler!=='undefined'&&typeof webimTrackAnalyticsEventHandler==='function'){webimTrackAnalyticsEventHandler(action);}else{if(core.settings.config.hasOption('google_analytics')||forceTrack){this.sendToGoogleAnalytics(action);}
if(core.settings.config.hasOption('yandex_metrika_counter_id')){this.sendToYaMetrika(action,core.settings.config.get('yandex_metrika_counter_id'));}else{for(var field in window){if(field&&field.indexOf('yaCounter')!==-1){var counterId=field.substring(9);this.sendToYaMetrika(action,counterId);}}}}},sendToGoogleAnalytics:function(action){if(typeof ga==='function'&&typeof ga.getByName==='function'){try{var tn=ga.getAll()[0].get('name');ga(tn+'.send','event','webim',action,null,null,{'nonInteraction':1});}catch(e){ga('send','event','webim',action,null,null,{'nonInteraction':1});}}else if(typeof _gaq!=='undefined'&&typeof _gaq.push!=='undefined'){_gaq.push(['_trackEvent','webim',action,'',,true]);}
if(typeof window.dataLayer==='object'){window.dataLayer.push({'event':'SomeWebimEvent'})}},sendToYaMetrika:function(action,counterId){var goal='WEBIM_'+action,counterName='yaCounter'+counterId;if(typeof window[counterName]==='object'&&typeof window[counterName].reachGoal==='function'){window[counterName].reachGoal(goal);}}});classes.ui={};classes.ui.Base=function(wrapper){_.extend(this,classes.libs.Events);this.wrapper=wrapper;this.guid=this.wrapper.data('webimGuid')||tools.guid();this.initUiEvents(this.wrapper);};_.extend(classes.ui.Base,classes.libs.Extendable);classes.ui.Base.prototype=_.extend({constructor:classes.ui.Base,guid:'',wrapper:null,getGuid:function(){return this.guid;},getWrapper:function(){return this.wrapper;},destroy:function(){this.disableEvents();this.destroyUiEvents();this.stopListening();this.off();this.wrapper=this.radio=null;}},classes.mixins.UiEvents);classes.ui.Container=tools.makeBase([classes.mixins.Events,classes.mixins.UiObject,classes.mixins.MixRequests],{constructor:function(wrapper,radio){this.cuid=wrapper.data('webimGuid')||_.uniqueId('webim_container_');this.wrapper=wrapper;this.radio=radio;this.children=[];this.widgets=[];this.activeParentEvents=tools.eventMethodsToEventCallbacks(this.parentEvents,this);var behaviorClasses={};_.each(this.standardBehaviors,function(behaviorName){behaviorClasses[behaviorName]=classes.ui.behaviors[behaviorName];});_.each(this.wrapper.data('webimBehaviors')?this.wrapper.data('webimBehaviors').split(/\s+/):[],function(behaviorName){var customBehaviorClass=classes.ui.behaviors[behaviorName];var replace=_.findKey(behaviorClasses,function(behaviorClass){return behaviorClass.prototype instanceof customBehaviorClass||customBehaviorClass.prototype instanceof behaviorClass||behaviorClass===customBehaviorClass;});if(replace){delete behaviorClasses[replace];}
behaviorClasses[behaviorName]=customBehaviorClass;});this.behaviors=[];_.each(behaviorClasses,function(behaviorClass,behaviorName){var behaviorOptions=this.wrapper.data('webimBehavior'+behaviorName)?this.wrapper.data('webimBehavior'+behaviorName):null;this.behaviors.push(new behaviorClass(this,behaviorOptions));}.webimBind(this));_.each(this.resendParentEvents,function(eventName){!this.activeParentEvents[eventName]&&(this.activeParentEvents[eventName]=[]);this.activeParentEvents[eventName].push(this.resendEvent.webimBind(this,eventName));}.webimBind(this));},cuid:'',standardBehaviors:['LocationStyle','OverLabels','Requests','Resources','Scrollbar','Closable'],behaviors:null,parent:null,parentEvents:{destroy:'destroy'},resendParentEvents:['beforeShow','afterShow','beforeHide','afterHide','afterResize','afterContentChange'],activeParentEvents:null,children:null,widgets:null,getGuid:function(){return this.cuid;},setParent:function(parent){this.disableParentEvents();this.parent=parent;this.enableParentEvents();},addChild:function(child){this.trigger('beforeAddChild',child);this.children.push(child);this.listenToOnce(child,'destroy',function(){this.children=_.without(this.children,child);}.webimBind(this));},addWidget:function(widget){this.widgets.push(widget);},getParent:function(){return this.parent;},getChildren:function(){return this.children;},getWidgets:function(){return this.widgets;},enableParentEvents:function(){if(this.parent){_.each(this.activeParentEvents,function(callbacks,event){for(var i=0;i<callbacks.length;i++){this.listenTo(this.parent,event,callbacks[i]);}}.webimBind(this));}},disableParentEvents:function(){if(this.parent){_.each(this.activeParentEvents,function(callbacks,event){this.stopListening(this.parent,event);}.webimBind(this));}},resendEvent:function(eventName){var isShown=this.request('is-shown');if(isShown||isShown===undefined){var args=[].slice.call(arguments);this.trigger.apply(this,args);}},isVisible:function(){return Boolean(this.wrapper.is(':visible'));},findClosestDescendant:function(wrapper){if(!this.getWrapper().has(wrapper).length){return null;}
var containers=this.getChildren();var result=null;for(var index in containers)if(containers.hasOwnProperty(index)){if(result=containers[index].findClosestDescendant(wrapper)){break;}}
return result||this;},destroy:function(){this.disableParentEvents();this.trigger('destroy');this.parent=this.children=this.activeParentEvents=null;}});classes.ui.component=tools.makeBase([classes.mixins.MixEvents,classes.mixins.UiObject,classes.mixins.MixRequests],{constructor:function(wrapper,radio){this.wrapper=wrapper;this.radio=radio;this.guid=wrapper.data('webimGuid')||_.uniqueId('webim_component_');var behaviorClasses={};_.each(wrapper.data('webimBehaviors')?wrapper.data('webimBehaviors').split(/\s/):[],function(behaviorName){behaviorClasses[behaviorName]=classes.ui.behaviors[behaviorName];});this.behaviors=[];_.each(behaviorClasses,function(behaviorClass,behaviorName){var behaviorOptions=wrapper.data('webimBehavior'+behaviorName)||null;this.behaviors.push(new behaviorClass(this,behaviorOptions));}.webimBind(this));},behaviors:null,guid:null,getContainer:function(){return this;},getGuid:function(){return this.guid;}});classes.ui.components={};classes.ui.components.Base=tools.makeBase([classes.mixins.Events,classes.mixins.Node],{cuid:'',wrapper:null,globalRadio:null,behaviors:null,behaviorsRadio:null,constructor:function(wrapper,globalRadio){this.cuid=wrapper.data('webimGuid')||wrapper.data('webimCuid')||_.uniqueId('webim_component_');this.wrapper=wrapper;this.globalRadio=globalRadio;this.behaviorsRadio=classes.libs.Radio.Channel(this.cuid);var behaviorClasses=_.uniq(['Requests'].concat((this.wrapper.data('webimBehaviors')||'').split(/\s+/)));this.behaviors=_.map(behaviorClasses,function(behaviorClass){var behaviorOptions=this.wrapper.data('webimBehavior'+behaviorClass);return new classes.behaviors[behaviorClass](this,behaviorOptions);}.webimBind(this));this.initialize();},initialize:function(){},getRadio:function(){return this.globalRadio;},getBehaviorRadio:function(){return this.behaviorsRadio;},canProcessEvent:function(event){return Boolean(this.behaviorsRadio.request('canProcess:'+event.getType(),event));},destroy:function(){this.wrapper=this.globalRadio=null;this.trigger('destroy');}});classes.ui.behaviors={};classes.ui.behaviors.Base=classes.ui.Base.extend({constructor:function(parent,options){classes.ui.Base.call(this,parent.getWrapper());this.options=_.defaults(options||{},this.defaults);this.parent=parent;this.container=this.getContainer();if(this.isSupported()){_.each(tools.eventMethodsToEventCallbacks(this.containerEvents,this),function(callbacks,eventName){for(var i=0;i<callbacks.length;i++){this.listenTo(this.container,eventName,callbacks[i]);}}.webimBind(this));_.each(this.requests,function(methodName,requestName){this.container.reply(requestName,this[methodName].webimBind(this));this.container.getRadio().reply('ui:'+this.container.getGuid()+':'+requestName,this[methodName].webimBind(this));}.webimBind(this));this.enableEvents();this.initialize();}else{core.logger.log('Behavior "'+this.constructor.name+'" doesn\'t supported, so has not enabled.')}},defaults:null,options:null,parent:null,container:null,containerEvents:{destroy:'destroy'},requests:null,ownFilters:['[data-webim-container]'],initialize:function(){},isSupported:function(){return true;},getContainer:function(){var container=null;if(!this.container){if(this.parent instanceof classes.ui.Container){container=this.parent;}else{container=this.parent.getContainer();}}
return container;},destroy:function(){this.stopListening(this.container);_.each(this.requests,function(methodName,requestName){this.container.stopReplying(requestName);this.container.getRadio().stopReplying('ui:'+this.container.getGuid()+':'+requestName);}.webimBind(this));this.requests=this.defaults=this.options=this.parent=this.container=null;classes.ui.Base.prototype.destroy.call(this);}});classes.ui.behaviors.AutoHeight=function(containerOrBehavior,options){this.changeHeight=_.debounce(this.changeHeight.webimBind(this),150);classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.AutoHeight.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.AutoHeight,ui:{autoHeightBlocks:'[data-webim-behavior-type~="auto-height"]'},events:{'input @ui.autoHeightBlocks':'changeHeight','change @ui.autoHeightBlocks':'changeHeight','blur @ui.autoHeightBlocks':'changeHeight'},changeHeight:function(event){var areaWrapper=$(event.target);var area=areaWrapper.get(0);if(area.scrollHeight>area.clientHeight){this.container.request('resizeBy',0,area.scrollHeight-area.clientHeight);}else if(areaWrapper.val().length===0&&areaWrapper.text().length===0){this.container.request('resizeToDefault');}
this.wrapper.trigger('afterResize.webim');}});classes.ui.behaviors.AddClassIfEmpty=function(component,options){classes.ui.behaviors.Base.call(this,component,options);this.listenTo(this.parent.radio,'ui:'+this.options.guid+':empty',this.tryToSetClass.webimBind(this,false));this.listenTo(this.parent.radio,'ui:'+this.options.guid+':notEmpty',this.tryToSetClass.webimBind(this,true));};classes.ui.behaviors.AddClassIfEmpty.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.AddClassIfEmpty,tryToSetClass:function(notEmpty){if(notEmpty){this.wrapper.removeClass(this.options.class);}else{this.wrapper.addClass(this.options.class);}}});classes.ui.behaviors.SayAmIEmpty=function(component,options){classes.ui.behaviors.Base.call(this,component,options);this.wrapper.on('input',this.checkTarget.webimBind(this));};classes.ui.behaviors.SayAmIEmpty.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.SayAmIEmpty,prevState:false,checkTarget:function(event){if(this.wrapper.val()&&this.prevState==false){this.parent.radio.trigger('ui:'+this.guid+':notEmpty');this.prevState=true;}else if(!this.wrapper.val()&&this.prevState==true){this.parent.radio.trigger('ui:'+this.guid+':empty');this.prevState=false;}}});classes.ui.behaviors.Carousel=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Carousel.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Carousel,defaults:{alwaysShown:false},ui:{navItems:'[data-webim-behavior-action="carousel-show-item"]'},events:{'click @ui.navItems':'clickNavItemEvent'},activeSub:null,containerEvents:{beforeAddChild:'onBeforeAddSub'},initialize:function(){_.each(this.container.getChildren(),this.onBeforeAddSub.webimBind(this));},clickNavItemEvent:function(event){event.preventDefault();this.showItem($(event.target).data('webimBehaviorTargetGuid'));},onChildBeforeShow:function(child){if(_.contains(this.container.getChildren(),child)){if(this.activeSub){this.stopListening(this.activeSub);this.activeSub.request('hide');this.listenToOnce(this.activeSub,'beforeShow',this.onChildBeforeShow.webimBind(this));}
this.activeSub=child;this.listenToOnce(child,'beforeHide',this.onChildBeforeHide.webimBind(this));}},onChildBeforeHide:function(child){if(_.contains(this.container.getChildren(),child)){this.activeSub=null;this.listenToOnce(child,'beforeShow',this.onChildBeforeShow.webimBind(this));if(this.options['alwaysShown']){this.container.getChildren()[0].request('show');}}},onBeforeAddSub:function(subContainer){if(!this.activeSub&&this.options['alwaysShown']){this.activeSub=subContainer;subContainer.request('show');this.listenToOnce(subContainer,'beforeHide',this.onChildBeforeHide.webimBind(this));}else{subContainer.request('hide-force');this.listenToOnce(subContainer,'beforeShow',this.onChildBeforeShow.webimBind(this));}}});classes.ui.behaviors.Closable=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Closable.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Closable,defaults:{onEsc:false,onDone:false,onOuterClick:false,onHoverDelayedHide:false},timerForCloseId:null,ui:{close:'[data-webim-behavior-action="close"]'},events:{'click @ui.close':'hideEvent'},containerEvents:{'beforeShow':'beforeShow','afterHide':'afterHide'},requests:{show:'show',hide:'hide',toggle:'toggle','hide-force':'hideForce','is-shown':'isShown'},visible:false,initialize:function(){this.visible=this.wrapper.css('display')!=='none';this.hoverable=_.isNumber(this.options.onHoverDelayedHide);},isShown:function(){return this.visible;},show:function(){if(!this.visible){this.container.trigger('beforeShow',this.container);this.container.getRadio().trigger('ui:'+this.container.getGuid()+':beforeShow');this.showAnimation(this.onAfterShow.webimBind(this));this.visible=true;}},beforeShow:function(){if(this.hoverable){this.wrapper.on('mouseenter.closable.'+this.guid,this.clearDelayedTimer.webimBind(this));this.wrapper.on('mouseleave.closable.'+this.guid,this.delayedHide.webimBind(this));}},afterHide:function(){if(this.hoverable){this.wrapper.off('mouseenter.closable.'+this.guid);this.wrapper.off('mouseleave.closable.'+this.guid);}},showAnimation:function(completeCallback){this.wrapper.show();completeCallback&&completeCallback();},hideEvent:function(event){this.hide();},delayedHide:function(){this.timerForCloseId=setTimeout(this.hide.webimBind(this),parseInt(this.options.onHoverDelayedHide));},clearDelayedTimer:function(){this.timerForCloseId&&clearTimeout(this.timerForCloseId);this.timerForCloseId=null;},hide:function(withoutAnimation){withoutAnimation=withoutAnimation||false;if(this.visible){this.options['onEsc']&&$(document).off('keyup.webim.closable.'+this.getGuid());this.options['onDone']&&_.each(this.container.getWidgets(),function(child){this.stopListening(child,'done');}.webimBind(this));this.options['onOuterClick']&&$(document).off('click.webim.closable.'+this.getGuid());this.container.trigger('beforeHide',this.container);this.container.getRadio().trigger('ui:'+this.container.getGuid()+':beforeHide');withoutAnimation?this.wrapper.hide()&&this.onAfterHide():this.hideAnimation(this.onAfterHide.webimBind(this));this.visible=false;}},toggle:function(){this.isShown()?this.hide():this.show();},hideForce:function(){this.hide(true);},hideAnimation:function(completeCallback){this.wrapper.hide();completeCallback&&completeCallback();},onAfterShow:function(){this.options['onEsc']&&$(document).on('keyup.webim.closable.'+this.getGuid(),this.globalKeyUpHandler.webimBind(this));this.options['onDone']&&_.each(this.container.getWidgets(),function(child){this.listenTo(child,'done',this.hide.webimBind(this));}.webimBind(this));this.options['onOuterClick']&&$(document).on('click.webim.closable.'+this.getGuid(),this.globalClickHandler.webimBind(this));this.options['onChatClose']&&system.getRadio().on('service:chat:beforeClose',this.hide.webimBind(this));this.container.isVisible()&&this.container.trigger('afterShow',this.container);this.container.getParent()&&this.container.getParent().trigger('afterContentChange');this.wrapper.trigger('afterResize.webim');},onAfterHide:function(){this.container.trigger('afterHide',this.container);this.container.getParent()&&this.container.getParent().trigger('afterContentChange');this.wrapper.trigger('afterResize.webim');},globalKeyUpHandler:function(event){if(event.keyCode===27){this.hide();}},globalClickHandler:function(event){if(!$(event.target).closest(this.wrapper).length){this.hide();}},destroy:function(){this.options['onEsc']&&$(document).off('keyup.webim.closable.'+this.getGuid());classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.ClosableBottom=function(containerOrBehavior,options){classes.ui.behaviors.Closable.call(this,containerOrBehavior,options);};classes.ui.behaviors.ClosableBottom.prototype=tools.createUiObject(classes.ui.behaviors.Closable.prototype,{constructor:classes.ui.behaviors.ClosableBottom,showAnimation:function(completeCallback){this.wrapper.css('bottom',-this.wrapper.outerHeight()).show().fixedAnimate({bottom:0},completeCallback);},hideAnimation:function(completeCallback){this.wrapper.fixedAnimate({bottom:-this.wrapper.outerHeight()},function(){this.wrapper.hide();completeCallback&&completeCallback();}.webimBind(this));}});classes.ui.behaviors.ClosableFade=function(containerOrBehavior,options){classes.ui.behaviors.Closable.call(this,containerOrBehavior,options);};classes.ui.behaviors.ClosableFade.prototype=tools.createUiObject(classes.ui.behaviors.Closable.prototype,{constructor:classes.ui.behaviors.ClosableFade,showAnimation:function(completeCallback){this.wrapper.fadeIn(completeCallback);},hideAnimation:function(completeCallback){this.wrapper.fadeOut(completeCallback);}});classes.ui.behaviors.ClosableSlideUp=function(containerOrBehavior,options){classes.ui.behaviors.Closable.call(this,containerOrBehavior,options);};classes.ui.behaviors.ClosableSlideUp.prototype=tools.createUiObject(classes.ui.behaviors.Closable.prototype,{constructor:classes.ui.behaviors.ClosableSlideUp,showAnimation:function(completeCallback){this.wrapper.slideDown({'step':this.onStepHandler.webimBind(this),'complete':completeCallback});},hideAnimation:function(completeCallback){this.wrapper.slideUp({'step':this.onStepHandler.webimBind(this),'complete':completeCallback});},onStepHandler:function(){this.wrapper.trigger('afterResize.webim');}});classes.ui.behaviors.Draggable=function(containerOrBehavior,options){this.defaults={storagePrefix:null,pluginOptions:{refreshPositions:true,zIndex:2700,stop:this.onStopDrag.webimBind(this)}};classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Draggable.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Draggable,enabled:false,ui:{draggableZone:'[data-webim-behavior-type="draggable-zone"]'},containerEvents:{afterResize:'onContainerAfterResize',afterShow:'enable',beforeHide:'disable'},enable:function(){if(!this.enabled){var options=_.clone(this.options['pluginOptions']);if(this.ui.draggableZone.length){options['handle']=this.ui.draggableZone;}
this.wrapper.draggable(options);var storedPosition=this.getStoredPosition();if(storedPosition){this.wrapper.css(_.defaults(storedPosition,{left:'',top:'',right:'',bottom:''}));}
this.wrapper.css('position','fixed');this.wrapper.setFixedPosition();$(window).on('resize.webim.draggable.'+this.getGuid(),this.onWindowResize.webimBind(this));this.wrapper.one('dragstart',this.onStartDrag.webimBind(this));this.enabled=true;}},disable:function(){if(this.enabled){this.wrapper.draggable('destroy');this.wrapper.css('position','');$(window).off('resize.webim.draggable.'+this.getGuid());this.enabled=false;}},onStartDrag:function(e,ui){this.wrapper.css({right:'',bottom:''});},onStopDrag:function(e,ui){this.wrapper.css('position','fixed');this.wrapper.setFixedPosition();this.correctPosition();this.storePosition()},onWindowResize:function(event){if(event.target===window||event.target===document){this.onContainerAfterResize();}},onContainerAfterResize:function(){if(this.enabled&&this.wrapper.is(':visible')){this.correctPosition();this.storePosition();}},correctPosition:function(){var windowWrp=$(window);var left=Math.max(3,Math.min(windowWrp.width()-this.wrapper.width()-7,this.wrapper.position().left));var top=Math.max(3,Math.min(windowWrp.height()-this.wrapper.height()-7,this.wrapper.position().top));this.wrapper.css({left:left,top:top,right:'',bottom:''});},getStoredPosition:function(){if(this.options['storagePrefix']){return core.storage.get(this.options['storagePrefix']+'POSITION');}
return null;},storePosition:function(){if(this.options['storagePrefix']){core.storage.set(this.options['storagePrefix']+'POSITION',{'top':this.wrapper.css('top'),'left':this.wrapper.css('left')},365);}},isSupported:function(){return!Boolean(env.separateChatWindow||env.getMode()==='preview');},destroy:function(){this.disable();classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.DraggableChat=function(containerOrBehavior,options){classes.ui.behaviors.Draggable.call(this,containerOrBehavior,_.defaults({storagePrefix:'CHAT_'},options));};classes.ui.behaviors.DraggableChat.prototype=tools.createUiObject(classes.ui.behaviors.Draggable.prototype,{constructor:classes.ui.behaviors.Draggable,getStoredPosition:function(){return classes.ui.behaviors.Draggable.prototype.getStoredPosition.call(this)||core.settings.location.get('chat.defaultLayout.position');}});classes.ui.behaviors.HeightBySiblings=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.HeightBySiblings.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.HeightBySiblings,ui:{autoHeightBlocks:'[data-webim-behavior-type="auto-height-by-siblings"]'},containerEvents:{afterShow:'resizeAll',afterResize:'resizeAll'},initialize:function(){this.ui.autoHeightBlocks.each(function(index,elem){var blockWrapper=$(elem);blockWrapper.siblings().on('afterResize.webim',function(event){event.stopPropagation();this.resizeBlock(blockWrapper);this.container.trigger('afterContentChange');}.webimBind(this));}.webimBind(this));$(window).on('resize.webim.heightBySiblings.'+this.getGuid(),this.resizeAll.webimBind(this));},resizeBlock:function(blockWrapper){var newBlockHeight=blockWrapper.parent().innerHeight();blockWrapper.siblings(':visible').each(function(index,elem){newBlockHeight-=$(elem).outerHeight();});blockWrapper.height(newBlockHeight);},resizeAll:function(){this.ui.autoHeightBlocks.each(function(index,elem){this.resizeBlock($(elem));}.webimBind(this));this.container.trigger('afterContentChange');},destroy:function(){this.ui.autoHeightBlocks.each(function(index,elem){var blockWrapper=$(elem);blockWrapper.siblings().off('afterResize.webim');}.webimBind(this));$(window).off('resize.webim.heightBySiblings.'+this.getGuid());classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.SelectToUl=function(containerOrBehavior,options){this.defaults={innerTemplate:null};classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.SelectToUl.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.SelectToUl,ui:{select:'[data-webim-behavior-type="departments-list"]',ul:'[data-webim-behavior-type="departments-list-target-ul"]'},initialize:function(){this.ui.select.selectToUl({'targetUl':this.ui.ul,'addClassOnSelectChange':'selected'});}});classes.ui.behaviors.LocationStyle=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.LocationStyle.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.LocationStyle,ui:{modeMenu:'[data-webim-block="mode-selector"]',logo:'[data-webim-style="logo"]',poweredLink:'[data-webim-style="powered-by"]',customStyleBlocks:'[data-webim-custom-style]',sectionSelectButtons:'[data-webim-chat-action="select-section"]',menuButton:'[data-webim-request="ui:chat-actions:show"]',adaptFontBlocks:'[data-webim-behavior-type~="adapt-font"]'},paramToMethod:{'chat.showSelectModeMenu':'onShowSelectModeMenu','chat.logo':'onLogoChange','styles':'onStylesChange','chat.callbackHunterAvailableInOffline':'onCBHAvailableInOffline'},initialize:function(){if(core.settings.tariff.hasOption('hide_poweredby_link')){this.ui.poweredLink.hide();}
if(!core.settings.tariff.hasOption('chat_colors')){delete this.paramToMethod['styles'];}
if(core.settings.location.get('chat.hideMenu')==='Y'){this.ui.menuButton.hide();}
if(core.settings.location.get('chat.callbackHunterAvailableInOffline')==='Y'){this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="callback-hunter"]').removeClass('webim-on-online');}
this.listenTo(core.settings.location,'chat.callbackHunterAvailableInOffline:afterUpdate',function(isAvailable){isAvailable==='Y'?this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="callback-hunter"]').removeClass('webim-on-online'):this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="callback-hunter"]').addClass('webim-on-online');}.webimBind(this));_.each(this.paramToMethod,function(methodName,paramName){this[methodName](core.settings.location.get(paramName));this.listenTo(core.settings.location,paramName+':afterUpdate',this[methodName].webimBind(this));}.webimBind(this));},onShowSelectModeMenu:function(value){value==='Y'?this.ui.modeMenu.show():this.ui.modeMenu.hide();},onLogoChange:function(value){if(value){this.ui.logo.attr('src',env.getBaseUrl()+value);}},onCBHAvailableInOffline:function(value){value==='Y'?this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="callback-hunter"]').removeClass('webim-on-online'):this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="callback-hunter"]').addClass('webim-on-online');},onStylesChange:function(styles){if(styles['button']&&styles['button']['background']){styles['button']['border-color']=styles['button']['background'];}
_.each(styles,function(styleObj,key){if(styleObj){var customWrapper=this.ui.customStyleBlocks.filter('[data-webim-custom-style="'+key+'"]');this.applyStyleObj(customWrapper,styleObj);this.adaptFontColor(customWrapper);}}.webimBind(this));},adaptFontColor:function(wrapper){if(this.ui.adaptFontBlocks.length&&wrapper.css('background-color')){var rgb=wrapper.css('background-color').match(/(\d+)+/g);if(rgb&&rgb.length){if(rgb.length<4||rgb[3]!=0){var fontColor=0.213*rgb[0]/255+0.715*rgb[1]/255+0.072*rgb[2]/255<0.5?'#FFF':'#000';wrapper.find(this.ui.adaptFontBlocks).addBack().css('color',fontColor);}else{wrapper.find(this.ui.adaptFontBlocks).addBack().css('color','');}}}},applyStyleObj:function(wrapper,styleObj){styleObj=_.clone(styleObj);if(styleObj['gradient']&&core.browser.support('cssgradients')){wrapper.css('background','-moz-linear-gradient(top, '+styleObj['background']+', '+styleObj['gradient']+')').css('background','-webkit-gradient(linear, left top, left bottom, from('+styleObj['background']+'), to('+styleObj['gradient']+'))').css('background-color',styleObj['background']);delete styleObj['background'];}
delete styleObj['gradient'];wrapper.css(styleObj);}});classes.ui.behaviors.OnceShowsOnChatClose=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);this.listenToOnce(this.container.getRadio(),'service:chat:beforeClose',this.tryToCloseFirst.webimBind(this));};classes.ui.behaviors.OnceShowsOnChatClose.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.OnceShowsOnChatClose,tryToCloseFirst:function(closeEvent){if(this.mustShownForRate()){this.triedToClose=true;closeEvent.stopClose=true;this.listenToOnce(this.container,'afterHide',this.closeChat.webimBind(this));this.listenToOnce(this.container.getRadio(),'service:chat:beforeClose',this.tryToCloseSecond.webimBind(this));this.container.request('show');}},tryToCloseSecond:function(){this.stopListening(this.container);this.triedToClose=false;this.listenToOnce(this.container.getRadio(),'service:chat:beforeClose',this.tryToCloseFirst.webimBind(this));this.container.request('hide');},closeChat:function(){this.triedToClose=false;this.stopListening(this.container.getRadio());this.container.getRadio().request('service:chat:close');this.listenToOnce(this.container.getRadio(),'service:chat:beforeClose',this.tryToCloseFirst.webimBind(this));},mustShownForRate:function(){var currentOperator=core.repository.get('dialogues').getCurrent()&&core.repository.get('dialogues').getCurrent().get('operator');var operatorIsRated=currentOperator?core.repository.get('dialogues').getCurrent().get('operatorIdToRate').hasOwnProperty(currentOperator.get('id')):false;return core.settings.location.get('chat.proposeToRateBeforeClose')==='Y'&&!this.triedToClose&&currentOperator&&!operatorIsRated}});classes.ui.behaviors.OverLabels=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.OverLabels.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.OverLabels,ui:{customLabels:'.webim-js-overlabel'},initialize:function(){this.enable();},enable:function(){this.ui.customLabels.each(function(i,e){var inputWrp=$('input, textarea',e);var spanWrp=$('.webim-js-label',e);inputWrp.attr('title',spanWrp.text());spanWrp.css('display',inputWrp.val()==''?'block':'none');inputWrp.on('keyup.webim.overlabel blur.webim.overlabel change.webim.overlabel',function(){if(inputWrp.val()==''){spanWrp.show();}else{spanWrp.hide();}}).on('focus.webim.overlabel',function(){if(inputWrp.val()==''&&!inputWrp.data('webimMask')){spanWrp.show();}else{spanWrp.hide();}});});},disable:function(){this.ui.customLabels.each(function(i,e){var inputWrp=$('input, textarea',e);var spanWrp=$('.webim-js-label',e);spanWrp.css('display','');inputWrp.off('keyup.webim.overlabel blur.webim.overlabel change.webim.overlabel focus..webim.overlabel');});},destroy:function(){this.disable();classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.Requests=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Requests.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Requests,ui:{items:'[data-webim-request]'},events:{'click @ui.items':'requestEvent'},requestEvent:function(event){event.preventDefault();var reqElement=$(event.currentTarget);var requests=reqElement.data('webimRequest').split(/\s+/);_.each(requests,function(request){this.container.radio.request(request,reqElement.data('webimArg'));}.bind(this));}});classes.ui.behaviors.Resizable=function(containerOrBehavior,options){var minSize=this.getMinSize();this.defaults={storagePrefix:null,pluginOptions:{minWidth:parseInt(containerOrBehavior.wrapper.css('min-width'))||minSize['width'],minHeight:parseInt(containerOrBehavior.wrapper.css('min-height'))||minSize['height'],stop:this.onStopResize.webimBind(this),resize:this.onResize.webimBind(this)}};classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Resizable.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Resizable,ui:{resizableZone:'[data-webim-behavior-type="resizable"]',resizableHandler:'[data-webim-behavior-type="resizable-handler"]'},containerEvents:{afterContentChange:'onAfterContentChange',afterShow:'enable',beforeHide:'disable'},requests:{resizeBy:'resizeBy',resizeToDefault:'resizeToDefault'},enabled:false,resizableWrapper:null,initialize:function(){if(this.ui.resizableZone.length){this.resizableWrapper=this.ui.resizableZone;}else{this.resizableWrapper=this.wrapper;}
var options=_.clone(this.options['pluginOptions']);options['minWidth']=parseInt(options['minWidth'])-(this.wrapper.outerWidth()-this.resizableWrapper.outerWidth());options['minHeight']=parseInt(options['minHeight'])-(this.wrapper.outerHeight()-this.resizableWrapper.outerHeight());if(this.ui.resizableHandler.length){var handles={};this.ui.resizableHandler.each(function(){var $handler=$(this);handles[$handler.data('webimBehaviorResizableDirection')]=$handler;});options['handles']=handles;}
this.resizableWrapper.resizable(options);var storedSize=this.getStoredSize();if(storedSize){this.resize(storedSize['width'],storedSize['height']);}},enable:function(){if(!this.enabled){this.resizableWrapper.resizable('enable');$(window).on('resize.webim.resizable.'+this.getGuid(),this.onWindowResize.webimBind(this));this.enabled=true;}},disable:function(){if(this.enabled){this.resizableWrapper.resizable('disable');$(window).off('resize.webim.resizable.'+this.getGuid());this.enabled=false;}},resizeBy:function(diffWidth,diffHeight){if(diffWidth){this.resizableWrapper.width(this.resizableWrapper.width()+diffWidth);}
if(diffHeight){this.resizableWrapper.height(this.resizableWrapper.height()+diffHeight);}
this.correctSize();this.storeSize();},resizeToDefault:function(){this.resizableWrapper.css({height:this.resizableWrapper.css('min-height'),width:this.resizableWrapper.css('min-width')});this.correctSize();this.storeSize();},onStopResize:function(e,ui){this.correctSize();this.storeSize();},onResize:function(){this.wrapper.trigger('afterResize.webim');},onAfterContentChange:function(){if(this.enabled){this.resizableWrapper.height(this.resizableWrapper.get(0).scrollHeight).width(this.resizableWrapper.get(0).scrollWidth);this.correctSize();this.storeSize();}},onWindowResize:function(event){if(event.target===window||event.target===document){this.correctSize();this.storeSize();}},correctSize:function(){var rootWrp=env.getMode()==='preview'?env.getRootWrapper():$(window);var width=Math.max(20,Math.min(rootWrp.width()-10,this.wrapper.width()));var height=Math.max(20,Math.min(rootWrp.height()-10,this.wrapper.height()));this.resize(width,height);},resize:function(width,height){this.resizableWrapper.css({height:height-(this.wrapper.height()-this.resizableWrapper.height()),width:width-(this.wrapper.width()-this.resizableWrapper.width())});this.wrapper.trigger('afterResize.webim');this.container.trigger('afterResize');this.container.getParent()&&this.container.getParent().trigger('afterContentChange');},getStoredSize:function(){if(this.options['storagePrefix']){return core.storage.get(this.options['storagePrefix']+'SIZE');}
return null;},getMinSize:function(){return{width:100,height:100};},storeSize:function(){if(this.options['storagePrefix']){core.storage.set(this.options['storagePrefix']+'SIZE',{'width':this.wrapper.width(),'height':this.wrapper.height()},365);}},destroy:function(){this.disable();this.resizableWrapper.resizable('destroy');this.resizableWrapper=null;classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.ResizableChat=function(containerOrBehavior,options){classes.ui.behaviors.Resizable.call(this,containerOrBehavior,_.defaults({storagePrefix:'CHAT_'},options));};classes.ui.behaviors.ResizableChat.prototype=tools.createUiObject(classes.ui.behaviors.Resizable.prototype,{constructor:classes.ui.behaviors.Resizable,getStoredSize:function(){return env.getMode()!=='preview'?classes.ui.behaviors.Resizable.prototype.getStoredSize.call(this)||core.settings.location.get('chat.defaultLayout.size'):core.settings.location.get('chat.defaultLayout.size');},getMinSize:function(){return core.settings.location.get('chat.defaultLayout.size');},isSupported:function(){return!Boolean(env.separateChatWindow);}});classes.ui.behaviors.Resources=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Resources.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Resources,ui:{resourceBlocks:'[data-webim-resource]'},initialize:function(){this.ui.resourceBlocks.each(function(index,elem){var wrapper=$(elem);wrapper.html(_.prepareForHtml(core.resources.get(wrapper.data('webimResource'))));this.listenTo(core.resources,wrapper.data('webimResource')+':afterUpdate',function(newLabel){wrapper.html(_.prepareForHtml(newLabel));});}.webimBind(this));}});classes.ui.behaviors.Scrollbar=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Scrollbar.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Scrollbar,ui:{scrollbarBlocks:'[data-webim-style~="custom-scroll"]'},containerEvents:{afterShow:'refreshScrollbar',afterContentChange:'refreshScrollbar',afterResize:'refreshScrollbar'},refreshScrollbar:function(){this.ui.scrollbarBlocks.filter(':visible').each(function(){if($(this).css('opacity')!==0){$(this).scrollbar('init',{'autoUpdate':false})}else{$(this).scrollbar('destroy');}});},destroy:function(){this.ui.scrollbarBlocks.scrollbar('destroy');classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.ScrollbarTopBottomClasses=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.ScrollbarTopBottomClasses.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.ScrollbarTopBottomClasses,ui:{scrollable:'[data-webim-behaviour-type~="top-bottom-scroll-classes"]'},events:{'scroll @ui.scrollable':'tryToAddClasses'},tryToAddClasses:function(e){var borderTop=parseInt(this.ui.scrollable.css('border-top-width'));var borderBottom=parseInt(this.ui.scrollable.css('border-bottom-width'));this.ui.scrollable.scrollTop()==0?this.ui.scrollable.addClass('webim-scroll-top'):this.ui.scrollable.removeClass('webim-scroll-top');Math.abs(this.ui.scrollable.scrollTop()+this.ui.scrollable.outerHeight()-this.ui.scrollable.prop('scrollHeight')-borderTop-borderBottom)<1?this.ui.scrollable.addClass('webim-scroll-bottom'):this.ui.scrollable.removeClass('webim-scroll-bottom');}});classes.ui.behaviors.Sliding=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.Sliding.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.Sliding,defaults:{singleStepTime:100,singleStepDistance:5},ui:{'inputs':'input, textarea, button'},events:{'focus @ui.inputs':'addFocusBlockerEvent','blur @ui.inputs':'removeFocusBlockerEvent'},containerEvents:{afterShow:'startSliding',beforeHide:'stopSliding'},sliding:false,slideBlockers:null,slideIntervalId:null,direction:'left-to-right',initialize:function(){this.slideBlockers=[];this.wrapper.on('mouseenter.webim.sliding.'+this.getGuid(),this.addHoverBlockerEvent.webimBind(this));this.wrapper.on('mouseleave.webim.sliding.'+this.getGuid(),this.removeHoverBlockerEvent.webimBind(this));},startSliding:function(){if(!this.sliding){this.sliding=true;this.resumeSliding();}},resumeSliding:function(){if(!this.slideIntervalId&&this.sliding&&_.isEmpty(this.slideBlockers)){this.slideIntervalId=setInterval(this.slide.webimBind(this),this.options['singleStepTime']);}},pauseSliding:function(){if(this.slideIntervalId&&this.sliding){clearInterval(this.slideIntervalId);this.slideIntervalId=null;}},stopSliding:function(){if(this.sliding){this.pauseSliding();this.sliding=false;}},slide:function(){this.updateDirection();var elemRectPosition=this.wrapper.get(0).getBoundingClientRect();var newPosition={};switch(this.direction){case'left-to-right':newPosition['left']=elemRectPosition.left+this.options['singleStepDistance'];break;case'right-to-left':newPosition['left']=elemRectPosition.left-this.options['singleStepDistance'];break;}
this.slideAnimation(newPosition);},slideAnimation:function(newPosition,completeCallback){this.wrapper.setFixedPosition(newPosition);completeCallback&&completeCallback();},updateDirection:function(){var elemRectPosition=this.wrapper.get(0).getBoundingClientRect();var viewPortWidth=$(window).width();switch(this.direction){case'left-to-right':if(viewPortWidth-elemRectPosition.right<20){this.direction='right-to-left'}
break;case'right-to-left':if(elemRectPosition.left<20){this.direction='left-to-right'}
break;}},addFocusBlockerEvent:function(event){this.addBlocker('focus');},removeFocusBlockerEvent:function(event){this.removeBlocker('focus');},addHoverBlockerEvent:function(event){this.addBlocker('hover');},removeHoverBlockerEvent:function(event){this.removeBlocker('hover');},addBlocker:function(blocker){if(!_.contains(this.slideBlockers,blocker)){this.slideBlockers.push(blocker);this.pauseSliding();}},removeBlocker:function(blocker){this.slideBlockers=_.without(this.slideBlockers,blocker);if(_.isEmpty(this.slideBlockers)){this.resumeSliding();}},destroy:function(){this.stopSliding();this.slideBlockers=null;this.wrapper.off('mouseenter.webim.sliding.'+this.getGuid());this.wrapper.off('mouseleave.webim.sliding.'+this.getGuid());classes.ui.behaviors.Base.prototype.destroy.call(this);}});classes.ui.behaviors.TextareaExt=function(containerOrBehavior,options){this.replacesDivToTextarea=this.replacesDivToTextarea.slice(0);this.emojis=new classes.EmojiList();this.replacesDivToTextarea.unshift({'textarea':'$1','div':'<img[^>]*data-webim-emoji="([^"]+)"[^>]*>'});this.replacesTextareaToDiv=this.replacesTextareaToDiv.slice(0);this.replacesTextareaToDiv.push({'textarea':'('+this.emojis.getEmoticonsWithImage().join('|')+')','div':function(match,unicode){return'<img draggable="false" class="webim-emoji webim-emoji-'+tools.emojiToHexCode(unicode)+'" data-webim-emoji="'+unicode+'" alt="'+unicode+'" src="data:image/png;base64,R0lGODlhFAAUAIAAAP///wAAACH5BAEAAAAALAAAAAAUABQAAAIRhI+py+0Po5y02ouz3rz7rxUAOw==">'}});classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.TextareaExt.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.TextareaExt,ui:{'textarea':'textarea[data-webim-behavior-type~="textarea-ext-src"]','ext':'[data-webim-behavior-type~="textarea-ext"]'},events:{'focus @ui.textarea':'onTextareaFocus','paste @ui.ext':'onExtPaste','keypress @ui.ext':'onExtKeypress','keyup @ui.ext':'storeSelection','input @ui.ext':'storeSelection','click @ui.ext':'storeSelection','focus @ui.ext':'caretToSelectionRange'},onExtPaste:function(event){var clipboardData=event.clipboardData||event.originalEvent.clipboardData;if(!clipboardData.items||_.find(clipboardData.items,function(item){return item.kind==='string'&&item.type.match('^text/html')})){var text=clipboardData.getData('text/plain');if(text.length>0){event.preventDefault();event.stopPropagation();document.execCommand('insertText',false,text);}}},onExtKeypress:function(event){if(event.keyCode===13&&event.shiftKey){var selection;if(window.getSelection){selection=window.getSelection();}else{selection=document.selection.createRange();}
event.preventDefault();if(selection.focusNode.nodeType==Node.TEXT_NODE){if(selection.focusNode.textContent.length==selection.focusOffset){document.execCommand('insertHTML',false,'<br><br>');}else{document.execCommand('insertHTML',false,'<br>');}}else{document.execCommand('insertHTML',false,'<br><br>');}}},selectionRange:null,emojis:null,initialize:function(){this.ui.textarea.css({'position':'absolute','width':0,'height':0,'opacity':0});Object.defineProperty(this.ui.textarea.get(0),'value',{get:function(){return this.parseTextForTextarea(this.ui.ext.html());}.webimBind(this),set:function(text){this.ui.ext.html(this.parseTextFromTextarea(text));}.webimBind(this)});this.ui.textarea.get(0).webimInsert=function(html){html=this.parseTextFromTextarea(html);var selectionRange=this.getSelectionRange();if(selectionRange){if(window.getSelection){selectionRange.deleteContents();var node=$(html).get(0);selectionRange.insertNode(node);selectionRange.setStartAfter(node);selectionRange.collapse(true);}else if(window.document.selection&&window.document.selection.createRange){selectionRange.pasteHTML(html);selectionRange.collapse(true);}}else{this.ui.ext.append(html);}}.webimBind(this);this.ui.textarea.get(0).webimCaretPosition=function(){return this.ui.ext.caret('position');}.webimBind(this);this.ui.ext.on('click input paste drop keypress keyup keydown change',function(event){this.ui.textarea.trigger(event);}.webimBind(this));this.ui.ext.show();this.wrapper.trigger('afterResize.webim');},isSupported:function(){return core.browser.hasEvent('input')&&core.browser.support('contenteditable');},parseTextForTextarea:function(text){if(text){_.each(this.replacesDivToTextarea,function(rule){var search=new RegExp(rule['div'],'gi');text=text.replace(search,rule['textarea']);});}
return text;},parseTextFromTextarea:function(text){if(text){_.each(this.replacesTextareaToDiv,function(rule){var search=new RegExp(rule['textarea'],'gi');text=text.replace(search,rule['div']);});}
return text;},storeSelection:function(event){if(event.target===this.ui.ext.get(0)){if(window.getSelection){this.selectionRange=window.getSelection().getRangeAt(0);}else if(document.selection&&document.selection.createRange){this.selectionRange=document.selection.createRange();}}},caretToSelectionRange:function(){if(this.selectionRange){var sel=window.getSelection();sel.removeAllRanges();sel.addRange(this.selectionRange);}},getSelectionRange:function(){if(!this.selectionRange){if(window.document.createRange&&window.getSelection){this.selectionRange=document.createRange();this.selectionRange.selectNodeContents(this.ui.ext.get(0));this.selectionRange.collapse(false);}else{this.selectionRange=document.body.createTextRange();this.selectionRange.moveToElementText(this.ui.ext.get(0));this.selectionRange.collapse(false);}}
return this.selectionRange;},onTextareaFocus:function(){this.ui.ext.trigger('focus');},replacesDivToTextarea:[{'textarea':'','div':'<br>$'},{'textarea':'\n','div':'<\/?(br)>'},{'textarea':'','div':'(<([^>]+)>)'},{'textarea':'\u003C','div':'&lt;'},{'textarea':'\u003E','div':'&gt;'},{'textarea':'\u00A0','div':'&nbsp;'}],replacesTextareaToDiv:[{'textarea':'\u003C','div':'&lt;'},{'textarea':'\u003E','div':'&gt;'},{'textarea':'(\r)?\n(\r)?','div':'</br>'},{'textarea':'\u00A0','div':'&nbsp;'}]});classes.ui.behaviors.VisibleWithSub=function(containerOrBehavior,options){classes.ui.behaviors.Base.call(this,containerOrBehavior,options);};classes.ui.behaviors.VisibleWithSub.prototype=tools.createUiObject(classes.ui.behaviors.Base.prototype,{constructor:classes.ui.behaviors.VisibleWithSub,containerEvents:{beforeAddChild:'onBeforeAddSub'},initialize:function(){_.each(this.container.getChildren(),this.onBeforeAddSub.webimBind(this));_.some(this.container.getChildren(),function(child){return child.isVisible();})?this.container.request('show'):this.container.request('hide-force');},onChildBeforeShow:function(child){if(_.contains(this.container.getChildren(),child)){this.container.request('show');}},onChildAfterHide:function(child){if(_.contains(this.container.getChildren(),child)){!_.some(this.container.getChildren(),function(child){return child.isVisible();})&&this.container.request('hide');}},onBeforeAddSub:function(subContainer){this.listenTo(subContainer,{'beforeShow':this.onChildBeforeShow.webimBind(this),'afterHide':this.onChildAfterHide.webimBind(this)});}});classes.ui.extensions={};classes.ui.extensions.Base=classes.ui.Base.extend({constructor:function(widget,options){classes.ui.Base.call(this,widget.getWrapper());this.options=_.defaults(options||{},this.defaults);this.widget=widget;_.each(tools.eventMethodsToEventCallbacks(this.widgetEvents,this),function(callbacks,eventName){for(var i=0;i<callbacks.length;i++){this.listenTo(this.widget,eventName,callbacks[i]);}}.webimBind(this));this.initRegions(widget.getContainer());this.initialize();},defaults:null,options:null,widget:null,widgetEvents:{destroy:'destroy'},initialize:function(){},destroy:function(){this.stopListening(this.widget);this.destroyRegions();this.defaults=this.options=this.widget=null;classes.ui.Base.prototype.destroy.call(this);}});_.extend(classes.ui.extensions.Base.prototype,classes.mixins.Regions);classes.ui.extensions.Captcha=function(parent,options){classes.ui.extensions.Base.call(this,parent,options);if(!this.ui.captcha.attr('id')){this.ui.captcha.attr('id',_.uniqueId('webim_captcha_'));}};classes.ui.extensions.Captcha.prototype=tools.createUiObject(classes.ui.extensions.Base.prototype,{constructor:classes.ui.extensions.Captcha,ui:{captcha:'[data-webim-widget-type="captcha"]'},widgetEvents:{beforeShow:'destroyCaptcha'},captchaCreated:false,createCaptcha:function(){var create=function(){var publicKey='6Lc04-oSAAAAAG0347ye4dmu39DS4ZvhUoOMt51z';var captchaBlockId=this.ui.captcha.attr('id');Recaptcha.create(publicKey,captchaBlockId,{theme:'custom',custom_theme_widget:captchaBlockId,callback:function(){Recaptcha.focus_response_field();this.ui.captcha.trigger('afterResize.webim');}.webimBind(this),lang:core.settings.location.get('chat.lang')});this.captchaCreated=true;_.delay(this.widget.trigger.webimBind(this.widget,'afterContentChange'),100);}.webimBind(this);var scriptId='webimRecaptchaScript'
if(!$('#'+scriptId).length){tools.addScriptElement('https://www.google.com/recaptcha/api/js/recaptcha_ajax.js',scriptId);var tryIt=function(){if(typeof Recaptcha==='undefined'){setTimeout(tryIt,300);return;}
create();}.webimBind(this);tryIt();}else{create();}},destroyCaptcha:function(){if(typeof Recaptcha!='undefined'&&this.captchaCreated){Recaptcha.destroy();this.captchaCreated=false;}},errorCaptcha:function(){if(typeof Recaptcha!='undefined'&&this.captchaCreated){Recaptcha.reload();decors.removeErrorMessagesFromFormControl($('.webim-js-recaptcha-field',this.wrapper));decors.addErrorMessageToFormControl($('.webim-js-recaptcha-field',this.wrapper),core.resources.get('chat.error_message.wrong_captcha'));Recaptcha.focus_response_field();}},getCaptchaData:function(){return typeof Recaptcha!='undefined'&&this.captchaCreated?{'challenge':Recaptcha.get_challenge(),'response':Recaptcha.get_response()}:null;},hasCreated:function(){return this.captchaCreated;}});classes.ui.extensions.CustomFields=function(parent,options){classes.ui.extensions.Base.call(this,parent,options);};classes.ui.extensions.CustomFields.prototype=tools.createUiObject(classes.ui.extensions.Base.prototype,{constructor:classes.ui.extensions.CustomFields,ui:{customFields:'.webim-js-custom-field'},getCustomData:function(){var result={};this.ui.customFields.filter(':visible').each(function(index,elem){var field=$(elem);var fieldName=field.attr('name');result[fieldName]=field.val();});return!_.isEmpty(result)?result:null;}});classes.ui.extensions.FileUpload=function(parent,options){classes.ui.extensions.Base.call(this,parent,options);this.files=new classes.collections.Files();this.filesView=new classes.views.collections.Files($('<p/>').append(this.ui.fileList.children().first()).html(),this.widget.getRadio(),this.files);this.regions.filesList.showView(this.filesView);this.filesView.hide();};classes.ui.extensions.FileUpload.prototype=tools.createUiObject(classes.ui.extensions.Base.prototype,{constructor:classes.ui.extensions.FileUpload,uploader:null,files:null,filesView:null,dragCounter:0,chatDragCounter:0,mode:'online',ui:{fileList:'[data-webim-region="files"]',fileSelect:'[data-webim-widget-action~="select-file"]',uploadArea:'[data-webim-widget-type~="upload-area"]',root:'[data-webim-widget="Dialogue"]'},events:{'dragenter @ui.root':'chatDragEnter','dragleave @ui.root':'chatDragLeave','dragend @ui.root':'chatDragEnd','drop @ui.root':'chatDragEnd'},widgetEvents:{'beforeHide':'removeDragListeners'},removeDragListeners:function(){$(window).off('dragenter.webim.'+this.getGuid());$(window).off('dragleave.webim.'+this.getGuid());$(window).off('dragend.webim.'+this.getGuid());$(window).off('drop.webim.'+this.getGuid());$(window).off('dragover.webim.'+this.getGuid());},attachWindowDragListeners:function(){$(window).on('dragover.webim.'+this.getGuid(),function(e){e.preventDefault();});$(window).on('dragenter.webim.'+this.getGuid(),this.dragEnter.webimBind(this));$(window).on('dragleave.webim.'+this.getGuid(),this.dragLeave.webimBind(this));$(window).on('dragend.webim.'+this.getGuid(),this.dragEnd.webimBind(this));$(window).on('drop.webim.'+this.getGuid(),this.dragEnd.webimBind(this))},dragEnter:function(){if(this.dragCounter++===0){this.widget.getRadio().request('ui:dragOverlay:show');}},dragLeave:function(){if(--this.dragCounter===0){this.widget.getRadio().request('ui:dragOverlay:hide');}},dragEnd:function(e){e.preventDefault();if(this.dragCounter!==0){this.dragCounter=0;this.widget.getRadio().request('ui:dragOverlay:hide');}},chatDragEnter:function(){if(this.chatDragCounter++===0){$(this.ui.uploadArea).addClass('webim-overlay-faded');}},chatDragLeave:function(){if(--this.chatDragCounter===0){$(this.ui.uploadArea).removeClass('webim-overlay-faded');}},chatDragEnd:function(){if(this.chatDragCounter!==0){this.chatDragCounter=0;$(this.ui.uploadArea).removeClass('webim-overlay-faded');}},regions:{filesList:'[data-webim-region="files"]'},initialize:function(){this.uploader=this.ui.fileSelect.fileupload({url:'/',acceptFileTypes:this.getAcceptFileTypes('RegExp'),dataType:'json',dropZone:this.ui.uploadArea.get(),paramName:'webim_upload_file',maxFileSize:this.getMaxFileSize()}).on('fileuploadprocessalways',function(e,data){if(data.files.error){data.abort();}else{data.submit();}}).on('fileuploadprogress',this.uploadProgressHandler.webimBind(this)).on('fileuploadadd',this.filesAddedHandler.webimBind(this)).on('fileuploadsend',this.beforeUploadHandler.webimBind(this)).on('fileuploadfail',this.fileErrorHandler.webimBind(this)).on('fileuploaddone',this.fileUploadedHandler.webimBind(this));this.attachWindowDragListeners();},enable:function(){this.uploader.fileupload('enable');},disable:function(){if(this.uploader){this.uploader.fileupload('disable');}},filesAddedHandler:function(up,data){data.files[0].id=tools.hash(data.files[0].name);this.files.add({id:data.files[0].id,name:data.files[0].name,size:data.files[0].size});},beforeUploadHandler:function(up,data){data.url=this.getUploadURL();this.files.get(data.files[0].id).set('status','process');},uploadProgressHandler:function(up,data){this.files.get(data.files[0].id).set('progress',parseInt(data.loaded/data.total*100,10)/100);},fileUploadedHandler:function(up,data){if(data.result.error){data.abort();return this.fileErrorHandler(up,data);}
this.files.get(data.files[0].id).set('status','success');},fileErrorHandler:function(up,data){if(data.files[0]){if(this.files.get(data.files[0].id)){this.files.get(data.files[0].id).set({status:'error',error:data});}else{this.files.add({id:data.files[0].id,name:data.files[0].name,size:data.files[0].size,status:'error',error:data});}}},getUploadURL:function(){return tools.formatUrl({baseUrl:env.getBaseUrl()+'/l/v/upload',params:{'visit-session-id':core.repository.get('session').get('id')||'','page-id':core.repository.get('session').get('pageId'),'auth-token':core.repository.get('session').get('authToken'),'chat-mode':this.mode}});},getMaxFileSize:function(){return core.settings.config.hasOption('max_visitor_upload_file_size')?parseInt(core.settings.config.get('max_visitor_upload_file_size'))*1024*1024:10*1024*1024;},getAcceptFileTypes:function(type){if(type=='RegExp'){return new RegExp('(\.|\/)('+core.settings.config.get('allowed_upload_file_types').replace(/\s{0,}(\w+?)\,/gi,'$1|')+')$','i');}else if(type=='string'){return core.settings.config.get('allowed_upload_file_types').replace(/(\w+?)\,/gi,'.$1,');}},destroy:function(){if(this.uploader){this.uploader.fileupload('destroy');this.uploader=null;}
classes.ui.extensions.Base.prototype.destroy.call(this);}});classes.ui.extensions.FileUploadOffline=function(parent,options){classes.ui.extensions.FileUpload.call(this,parent,options);this.uploadedFileDescriptors=[];};classes.ui.extensions.FileUploadOffline.prototype=tools.createUiObject(classes.ui.extensions.FileUpload.prototype,{uploadedFileDescriptors:null,mode:'offline',fileUploadedHandler:function(event,data){if(data['result']['result']==='ok'){this.uploadedFileDescriptors.push(data['result']['data']);this.files.get(data.files[0].id).set('status','success');}}});classes.ui.extensions.VisitorFields=function(widget,options){classes.ui.extensions.Base.call(this,widget,options);this.optionalPostfix=$('<span class="webim-optional-postfix"></span>').text(core.resources.get('visitor_field_postfix.optional'));this.ui.visitorFields.each(function(index,elem){var wrapper=$(elem);var fieldName=wrapper.find('input').attr('name');this.processField(wrapper,fieldName);this.listenTo(core.settings.location,'chat.visitorFields.'+this.options['type']+'.'+fieldName+':afterUpdate',this.processField.webimBind(this,wrapper,fieldName));}.webimBind(this));this.resetVisitor(core.repository.get('visitor'));this.listenTo(core.repository,'visitor:afterReplace',this.resetVisitor.webimBind(this));if(core.settings.location.get('chat.hideProcessingPersonalDataCheckbox')=='Y'){this.enableButtonAndHideBlock();}};classes.ui.extensions.VisitorFields.prototype=tools.createUiObject(classes.ui.extensions.Base.prototype,{constructor:classes.ui.extensions.VisitorFields,optionalPostfix:null,currentVisitor:null,defaults:{type:'offlineMode'},ui:{visitorFields:'[data-webim-widget-type="visitor-fields"] > *',agreementBlock:'[class~=webim-processing-personal-data-block]',agreementCheckbox:'[name="processing-personal-data-checkbox"]'},events:{'change @ui.agreementCheckbox':'changeAgreementEvent'},changeAgreementEvent:function(event){this.wrapper.find(this.options['sendButtonSelector']).prop('disabled',!event.target.checked);},updateVisitorFields:function(){this.ui.visitorFields.each(function(index,elem){var field=$(elem).find('input');var fieldName=field.attr('name');var value=this.currentVisitor.get('fields.'+fieldName)||'';field.val(value||'').change().prop('disabled',this.currentVisitor.isFixedField(fieldName));}.webimBind(this));},getVisitorFieldValues:function(){var visitorData={};this.ui.visitorFields.filter(':visible').each(function(index,elem){var field=$(elem).find('input');var fieldName=field.attr('name');if(!this.currentVisitor.isFixedField(fieldName)){visitorData[fieldName]=field.val();}}.webimBind(this));return visitorData;},resetVisitor:function(visitor){this.cleanVisitor();if(visitor){this.currentVisitor=visitor;this.listenTo(this.currentVisitor,'afterUpdate',this.updateVisitorFields);this.updateVisitorFields();}},cleanVisitor:function(){if(this.currentVisitor){this.stopListening(this.currentVisitor);this.currentVisitor=null;}
this.ui.visitorFields.each(function(index,elem){$(elem).find('input').val('').change();});},processField:function(fieldWrapper,fieldName){var conf=null;var defaults=core.settings.location.get('chat.visitorFields.def.'+fieldName)||{};var specific=core.settings.location.get('chat.visitorFields.'+this.options['type']+'.'+fieldName)||{};if(_.isString(specific)){conf=specific;}else if(_.isString(defaults)&&_.isEmpty(specific)){conf=defaults;}else{conf=$.extend(true,{},defaults,specific);}
var presence='';if(_.isString(conf)){presence=conf;}else if(_.isString(conf['presence'])){presence=conf['presence']}
if(!presence){if(fieldName==='icq'||fieldName==='login'){presence='none';}else{presence='mandatory';}}
switch(presence){case'mandatory':fieldWrapper.find('label .webim-js-label .webim-optional-postfix').remove();fieldWrapper.show();break;case'optional':!fieldWrapper.find('label .webim-js-label .webim-optional-postfix').length&&fieldWrapper.find('label .webim-js-label').append(this.optionalPostfix.clone());fieldWrapper.show();break;case'none':default:fieldWrapper.hide();return;}
var rules={};if(!_.isEmpty(conf['validation'])){_.each(conf['validation'],function(ruleConf,ruleName){if(ruleConf===null){return;}
switch(ruleName){case'type':rules[ruleConf]=null;break;case'maxLength':rules['shorter_than']=ruleConf;break;case'mask':fieldWrapper.find('input').mask(ruleConf);rules['matches_mask']=ruleConf;break;default:rules[ruleName]=ruleConf;}});}
if(presence==='mandatory'){rules['not_empty']=null;}
if(!_.isEmpty(rules)){var ruleNames=[];_.each(rules,function(ruleConf,ruleName){ruleNames.push(ruleName);if(ruleConf!==null){fieldWrapper.find('input').data('webimValidate'+_.capitalize(ruleName)+'Options',$.toJSON(ruleConf));}});fieldWrapper.find('input').data('webimValidate',ruleNames.join(' '));}},enableButtonAndHideBlock:function(){this.wrapper.find(this.options['sendButtonSelector']).prop('disabled',false);this.ui.agreementBlock.hide();}});classes.ui.widgets={};classes.ui.widgets.Base=classes.ui.Base.extend({constructor:function(wrapper,radio,container){classes.ui.Base.call(this,wrapper);this.radio=radio;this.parentContainer=container;this.initRegions(container);this.activeContainerEvents=tools.eventMethodsToEventCallbacks(this.containerEvents,this);_.each(this.resendContainerEvents,function(eventName){!this.activeContainerEvents[eventName]&&(this.activeContainerEvents[eventName]=[]);this.activeContainerEvents[eventName].push(this.resendEvent.webimBind(this,eventName));}.webimBind(this));_.each(this.activeContainerEvents,function(callbacks,event){for(var i=0;i<callbacks.length;i++){this.listenTo(this.parentContainer,event,callbacks[i]);}}.webimBind(this));var extensionClasses=_.mapObject(this.extensions,function(options,componentName){return classes.ui.extensions[_.capitalize(componentName)];});_.each(this.wrapper.data('webimExtensions')?this.wrapper.data('webimExtensions').split(/\s+/):[],function(extensionName){var customExtensionClass=classes.ui.extensions[_.capitalize(extensionName)];var replace=_.findKey(extensionClasses,function(extensionClass){return extensionClass.prototype instanceof customExtensionClass||customExtensionClass.prototype instanceof extensionClass||extensionClass===customExtensionClass;});if(replace){delete extensionClasses[replace];extensionClasses[replace]=customExtensionClass;}else{extensionClasses[extensionName]=customExtensionClass;}});this.extensions=_.mapObject(extensionClasses,function(ExtensionClass,componentName){return new ExtensionClass(this,this.extensions[componentName]);}.webimBind(this));this.stateTo('disabled');},parentContainer:null,containerEvents:{afterShow:'toFocusFirstControl',destroy:'destroy'},resendContainerEvents:['beforeShow','afterShow','beforeHide','afterHide'],extensions:null,activeContainerEvents:null,radio:null,enabled:false,getContainer:function(){return this.parentContainer;},getRadio:function(){return this.radio;},switchOn:function(){if(!this.enabled){this.enableEvents();this.trigger('switchOn');this.stateTo('ready');this.enabled=true;}},switchOff:function(){if(this.enabled){this.disableEvents();this.trigger('switchOff');this.stateTo('disabled');this.enabled=false;}},stateTo:function(stateName){var addClasses=['webim-'+stateName];var removeClasses=[];switch(stateName){case'ready':removeClasses.push('webim-disabled');removeClasses.push('webim-process');removeClasses.push('webim-success');break;case'process':removeClasses.push('webim-disabled');removeClasses.push('webim-ready');removeClasses.push('webim-error');removeClasses.push('webim-success');break;case'error':removeClasses.push('webim-disabled');removeClasses.push('webim-process');removeClasses.push('webim-success');break;case'success':removeClasses.push('webim-disabled');removeClasses.push('webim-process');removeClasses.push('webim-error');break;case'disabled':removeClasses.push('webim-process');removeClasses.push('webim-ready');removeClasses.push('webim-error');removeClasses.push('webim-success');break;}
this.wrapper.addClass(addClasses.join(' ')).removeClass(removeClasses.join(' '));},resetErrorState:function(){this.wrapper.removeClass('webim-error');},validateInputs:function(){var isValid=true;this.wrapper.find('input, textarea').filter(':enabled').filter(':visible').each(function(){var fieldWrapper=$(this);decors.removeErrorMessagesFromFormControl(fieldWrapper);if(fieldWrapper.data('webimValidate')){var ruleNames=_.compact(fieldWrapper.data('webimValidate').split(/\s+/));var rules={};$.each(ruleNames,function(index,ruleName){var RuleName=ruleName[0].toUpperCase()+ruleName.substr(1);if(fieldWrapper.data('webimValidate'+RuleName+'Options')){rules[ruleName]=$.parseJSON(fieldWrapper.data('webimValidate'+RuleName+'Options'));}else{rules[ruleName]=ruleName;}});if(!_.isEmpty(rules)){var validateFieldResult=validator.validate(fieldWrapper.val(),rules);if(validateFieldResult!==true){decors.addErrorMessageToFormControl(fieldWrapper,validator.ruleToErrorMessage(validateFieldResult,rules[validateFieldResult]));isValid=false;}}}
if(fieldWrapper.data('webimMustBeChecked')&&!fieldWrapper.prop('checked')){decors.addErrorMessageToFormControl(fieldWrapper,core.resources.get('chat.error_message.check_checkbox'));isValid=false;}});return isValid;},toFocusFirstControl:function(){this.findOwned(this.wrapper,'input, textarea, select').filter(':visible:enabled').first().focus();},disableEvents:function(){_.invoke(this.extensions,'disableEvents');classes.ui.Base.prototype.disableEvents.call(this);},enableEvents:function(){_.invoke(this.extensions,'enableEvents');classes.ui.Base.prototype.enableEvents.call(this);},triggerOnContainer:function(eventName,arg){switch(arguments.length){case 1:_.invoke(this.parentContainer,'trigger',eventName);break;case 2:_.invoke(this.parentContainer,'trigger',eventName,arguments[1]);break;case 3:_.invoke(this.parentContainer,'trigger',eventName,arguments[1],arguments[2]);break;case 4:_.invoke(this.parentContainer,'trigger',eventName,arguments[1],arguments[2],arguments[3]);break;case 5:_.invoke(this.parentContainer,'trigger',eventName,arguments[1],arguments[2],arguments[3],arguments[4]);break;}},resendEvent:function(eventName){this.trigger(eventName);},destroy:function(){this.switchOff();this.destroyRegions();this.trigger('destroy');this.extensions=this.parentContainers=null;classes.ui.Base.prototype.destroy.call(this);}});_.extend(classes.ui.widgets.Base.prototype,classes.mixins.Regions);classes.ui.widgets.CallbackHunter=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);if(!this.ui.timer.data('webimTimerStartFrom')){this.ui.timer.data('webimTimerStartFrom',this.ui.timer.text());}
this.switchOn();};classes.ui.widgets.CallbackHunter.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.CallbackHunter,extensions:{visitorFields:{type:'callbackHunter'}},ui:{phone:'[name="phone"]',timer:'[data-webim-type="timer"]',startButton:'[data-webim-widget-action="start-callback"]'},events:{'click @ui.startButton':'startCallbackEvent'},containerEvents:{beforeShow:'beforeShowHandler'},startCallbackEvent:function(event){event.preventDefault();this.startCallback();},startCallback:function(){if(this.validateInputs()){this.stateTo('process');this.disableEvents();core.tracking.track('cbh.order',{'phone':this.ui.phone.val()}).done(this.successHandler.webimBind(this)).fail(this.errorHandler.webimBind(this));}},successHandler:function(){this.startCount();},errorHandler:function(errMessage){this.enableEvents();this.stateTo('error');this.radio.request('service:notifications:alert',{title:'Error',message:errMessage});},startCount:function(){var countToTime=new Date().getTime()+30*1000;this.ui.timer.countdown(countToTime,function(event){this.ui.timer.html(event.strftime('%H:%M:%S'));}.webimBind(this)).one('finish.countdown',function(){this.ui.timer.text(this.ui.timer.data('webimTimerStartFrom'));this.stateTo('ready');this.enableEvents();}.webimBind(this));},switchOn:function(){classes.ui.widgets.Base.prototype.switchOn.call(this);this.ui.timer.text(this.ui.timer.data('webimTimerStartFrom'));},beforeShowHandler:function(){if(!this.ui.phone.val()){var visitorPhone=core.repository.get('visitor').get('fields.phone');visitorPhone=_.isString(visitorPhone)?visitorPhone.replace(/\D/,''):'';this.ui.phone.val(visitorPhone);this.ui.phone.change();}}});classes.ui.widgets.Dialogue=function(wrapper,radio,container){if(!core.settings.config.hasOption('visitor_upload_file')){delete this.extensions['fileUpload'];}
classes.ui.widgets.Base.call(this,wrapper,radio,container);this.historyViews=[];this.dialogueTemplate=$('<p />').append(this.wrapper.find('[data-webim-widget-type="dialogue"]')).html();this.ui.messageArea.data('webimValidate',(this.ui.messageArea.data('webimValidate')||'')+' shorter_than').data('webimValidateShorter_thanOptions','32000');this.switchOn();execHook('dialogueWidgetReady',this);};classes.ui.widgets.Dialogue.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.Dialogue,extensions:{fileUpload:null},containerEvents:{afterShow:'afterShowHandler'},dialogueTemplate:null,dialogueModel:null,dialogueView:null,historyViews:null,typingTimeoutId:null,regions:{},ui:{messageArea:'textarea[name="message"]',sendButton:'[data-webim-widget-action="send"]',operatorTyping:'[data-webim-widget-type="operator-typing"]',dialogues:'[data-webim-widget-type~="dialogues"]',dialoguesBlock:'[data-webim-widget-type~="dialogues-block"]',loadPreviousButton:'[data-webim-widget-action="load-previous-dialogues"]',loadPreviousBlock:'[data-webim-widget-type="load-previous-block"]'},events:{'click @ui.sendButton':'sendMessageEvent','keypress @ui.messageArea':'keyPressMessageAreaEvent','input @ui.messageArea':'visitorTypingEvent changeMessageDraftEvent','change @ui.messageArea':'changeMessageDraftEvent','blur @ui.messageArea':'blurMessageAreaEvent','click @ui.loadPreviousButton':'loadPreviousDialogueEvent','scroll @ui.dialoguesBlock':'scrollDialoguesEvent'},sendMessageEvent:function(event){event.preventDefault();this.sendMessage();},keyPressMessageAreaEvent:function(event){if(event.keyCode===13&&!event.shiftKey){event.preventDefault();this.sendMessage();}},visitorTypingEvent:function(event){if(this.typingTimeoutId){clearTimeout(this.typingTimeoutId);}else{this.visitorStartTypingHandler();}
this.typingTimeoutId=setTimeout(this.visitorStopTypingHandler.webimBind(this),2000);},blurMessageAreaEvent:function(event){if(this.typingTimeoutId){clearTimeout(this.typingTimeoutId);this.visitorStopTypingHandler();}},sendMessage:function(){var messageAreaText=$.trim(this.ui.messageArea.val());if(messageAreaText.length&&this.validateInputs()){if(!this.dialogueModel){this.resetDialogue(new classes.models.Dialogue());}
this.dialogueModel.addMessage(new classes.models.Message({'text':messageAreaText,'ts':_.now()/1000,'kind':'visitor'}));this.ui.messageArea.val('').trigger('input').trigger('change');this.visitorStopTypingHandler();}},changeMessageDraftEvent:function(event){if(this.dialogueModel){this.dialogueModel.set('messageDraft',$.trim(this.ui.messageArea.val()));}},visitorStartTypingHandler:function(){core.tracking.track('chat.visitor_typing',{typing:true});},visitorStopTypingHandler:function(){core.tracking.track('chat.visitor_typing',{typing:false});this.typingTimeoutId=null;},resetDialogue:function(dialogue){this.cleanDialogue();if(dialogue){this.dialogueModel=dialogue;this.listenTo(this.dialogueModel,{'operatorTyping:afterUpdate':this.operatorTypingHandler.webimBind(this),'message:afterAdd':this.newMessageHandler.webimBind(this),'readByVisitor:afterUpdate':this.hasReadHandler.webimBind(this)});if(this.dialogueModel.get('messages').size()){this.newMessageHandler(this.dialogueModel.get('messages').last());}
this.dialogueView=new classes.views.items.Dialogue(this.dialogueTemplate,this.radio,this.dialogueModel);this.listenTo(this.dialogueView,'wrapper:afterInserted',this.scrollTo.webimBind(this));this.ui.dialogues.append(this.dialogueView.getWrapper());this.dialogueView.show();this.scrollToEnd();}},operatorTypingHandler:function(isTyping){if(isTyping){var isNeedToScroll=this.ui.dialoguesBlock.outerHeight()+this.ui.dialoguesBlock.scrollTop()>=this.ui.dialoguesBlock.prop('scrollHeight')-10;this.ui.operatorTyping.show();isNeedToScroll&&this.scrollToEnd();}else{this.ui.operatorTyping.hide();}},newMessageHandler:function(message){if(message.isOperatorMessage()&&!this.dialogueModel.get('readByVisitor')&&!core.repository.get('system').get('inFocus')){this.radio.request('service:alarm:start','new_message');}
this.triggerOnContainer('afterContentChange');},focusHandler:function(inFocus){inFocus&&Boolean(this.wrapper.filter(':visible').length)&&this.stopNewMessageAlarm();},hasReadHandler:function(hasRead){hasRead&&this.stopNewMessageAlarm();},afterShowHandler:function(){core.repository.get('system').get('inFocus')&&this.stopNewMessageAlarm();this.fillDialoguesBlockByPreviousDialogues();this.scrollToEnd();},fillDialoguesBlockByPreviousDialogues:function(){if(this.ui.dialoguesBlock.get(0).scrollHeight<=this.ui.dialoguesBlock.height()&&core.repository.get('dialogues').hasPrevious()){this.loadPreviousDialogue().done(this.fillDialoguesBlockByPreviousDialogues.webimBind(this));}},stopNewMessageAlarm:function(){this.radio.request('service:alarm:stop','new_message');this.dialogueModel&&!this.dialogueModel.get('readByVisitor')&&core.tracking.track('chat.read_by_visitor');},cleanDialogue:function(){if(this.dialogueModel){this.stopListening(this.dialogueModel);this.stopListening(this.dialogueView);this.dialogueView.destroy();this.dialogueView=this.dialogueModel=null;}},cleanAll:function(){this.cleanDialogue();_.invoke(this.historyViews,'destroy');this.historyViews=[];},hasPreviousChatsHandler:function(hasPreviousChats){hasPreviousChats?this.ui.loadPreviousBlock.show():this.ui.loadPreviousBlock.hide();},loadPreviousDialogueEvent:function(event){event.preventDefault();this.loadPreviousDialogue();},scrollDialoguesEvent:function(event){if(this.ui.dialoguesBlock.scrollTop()===0&&core.repository.get('dialogues').hasPrevious()){this.loadPreviousDialogue();this.ui.dialoguesBlock.scrollTop(10);}},loadPreviousDialogue:function(){this.ui.loadPreviousBlock.removeClass('webim-ready').addClass('webim-process');return core.repository.get('dialogues').loadPrevious().always(function(){this.ui.loadPreviousBlock.removeClass('webim-process');if(core.repository.get('dialogues').hasPrevious()){this.ui.loadPreviousBlock.addClass('webim-ready');}}.webimBind(this));},addPreviousDialogue:function(dialogue){var dialogueView=new classes.views.items.Dialogue(this.dialogueTemplate,this.radio,dialogue);this.historyViews.push(dialogueView);this.ui.dialogues.prepend(dialogueView.getWrapper());var prevScrollPosition=this.ui.dialoguesBlock.scrollTop();var prevScrollHeight=this.ui.dialoguesBlock.get(0).scrollHeight;dialogueView.show();this.triggerOnContainer('afterContentChange');this.ui.dialoguesBlock.scrollTop(prevScrollPosition+this.ui.dialoguesBlock.get(0).scrollHeight-prevScrollHeight);},scrollTo:function(wrapper,animate){var scrollTop=wrapper.position()['top']+this.ui.dialoguesBlock.scrollTop()-this.ui.dialoguesBlock.height()/3;animate||_.isUndefined(animate)?this.ui.dialoguesBlock.stop().animate({'scrollTop':scrollTop},'slow'):this.ui.dialoguesBlock.prop('scrollTop',scrollTop);},scrollToEnd:function(){this.ui.dialoguesBlock.prop('scrollTop',this.ui.dialoguesBlock.prop('scrollHeight'));},switchOn:function(){classes.ui.widgets.Base.prototype.switchOn.call(this);core.settings.config.hasOption('visitor_upload_file')&&this.extensions.fileUpload.enable();this.resetDialogue(core.repository.get('dialogues').getCurrent());this.listenTo(core.repository.get('dialogues'),{newCurrent:this.resetDialogue.webimBind(this),afterPrepend:this.addPreviousDialogue.webimBind(this),afterReset:this.cleanAll.webimBind(this),'hasPrevious:afterUpdate':this.hasPreviousChatsHandler.webimBind(this)});this.listenTo(core.repository.get('system'),'inFocus:afterUpdate',this.focusHandler.webimBind(this));this.hasPreviousChatsHandler(core.repository.get('dialogues').hasPrevious());},switchOff:function(){classes.ui.widgets.Base.prototype.switchOff.call(this);core.settings.config.hasOption('visitor_upload_file')&&this.extensions.fileUpload.disable();this.cleanDialogue();this.stopListening();}});classes.ui.widgets.Emoji=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.emojis=new classes.EmojiList();this.emojis.eachEmoticons(this.addEmojiInBlock.webimBind(this));this.switchOn();};classes.ui.widgets.Emoji.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.Emoji,emojis:null,ui:{'emojiBlock':'[data-webim-widget-type~="emojis"]','emojiTarget':'textarea[data-webim-widget-type~="emoji-target"]','emojiRootDiv':'[data-webim-guid=emoji]'},addEmojiInBlock:function(unicode){var emojiWrapper=$('<span />',{'class':'webim-emoji webim-emoji-'+tools.emojiToHexCode(unicode),'data-webim-widget-emoji':unicode});emojiWrapper.click(this.emojiClickEvent.webimBind(this));emojiWrapper.on('dragstart',function(e){e.preventDefault();});this.ui.emojiBlock.append(emojiWrapper);},emojiClickEvent:function(event){event.preventDefault();this.insertEmoji($(event.target).data('webimWidgetEmoji'),this.ui.emojiTarget);this.ui.emojiTarget.focus();},insertEmoji:function(emoji,target){target.get(0).webimInsert(emoji);}});classes.ui.widgets.FirstQuestion=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.switchOn();};classes.ui.widgets.FirstQuestion.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.FirstQuestion,extensions:{visitorFields:{type:'firstQuestion',sendButtonSelector:'[data-webim-widget-action="send-message"]'},customFields:null},ui:{sendButton:'[data-webim-widget-action="send-message"]',message:'[name="message"]'},events:{'click @ui.sendButton':'sendEvent','keypress input, textarea':'keyPressEvent'},containerEvents:{afterHide:'afterHideHandler'},sendEvent:function(event){event.preventDefault();this.send();},keyPressEvent:function(event){if(event.keyCode==13&&!event.shiftKey){event.preventDefault();this.send();}},send:function(){if(this.validateInputs()){this.stateTo('success');var message=this.ui.message.val();var visitor=this.extensions.visitorFields.getVisitorFieldValues();core.repository.get('visitor').set({fields:visitor});var params={'visitor-fields':visitor,'first-question':message?message:'-'};var customFieldValues=this.extensions.customFields.getCustomData();if(customFieldValues){params['custom_fields']=customFieldValues;}
this.radio.request('service:chat:start',params);this.trigger('done');this.ui.message.val('');}},afterHideHandler:function(){this.stateTo('ready');}});classes.ui.widgets.FontResize=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.chatModel=core.repository.get('chat');this.listenTo(this.chatModel,'fontSize:afterUpdate',this.updateSize.webimBind(this));this.updateSize(this.chatModel.get('fontSize'));this.switchOn();};classes.ui.widgets.FontResize.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.FontResize,chatModel:null,ui:{'sizeButtons':'[data-webim-widget-action="set-size"]'},events:{'click @ui.sizeButtons':'onSetSize'},updateSize:function(size){this.ui.sizeButtons.removeClass('webim-current-font-size');if(size){this.ui.sizeButtons.filter('[data-webim-widget-size="'+size+'"]').addClass('webim-current-font-size');}},onSetSize:function(event){var size=$(event.target).data('webimWidgetSize');if(size){this.chatModel.set('fontSize',size);this.chatModel.save();}}});classes.ui.widgets.Hints=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);if(core.settings.config.hasOption('visitor_hints_api_endpoint')){this.hints=new classes.collections.Hints();this.listenTo(this.hints,{'afterReset':this.onHintsReset.webimBind(this),'afterAdd':this.onHintAdd.webimBind(this),'afterSync':this.onHintsLoad});this.hintViews=[];this.hintTemplate=$('<p />').append(this.wrapper.find('[data-webim-widget-type="hint"]').removeAttr('data-webim-template')).html();this.loadHints=_.debounce(this.loadHints,200);this.switchOn();}};classes.ui.widgets.Hints.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.Hints,ui:{srcTextarea:'[data-webim-widget-type~="hints-source"]',hintsContainer:'[data-webim-widget-type~="hints-container"]',hintsList:'[data-webim-widget-type~="hints-list"]',tempDisableButton:'[data-webim-widget-action~="temporally-disable"]'},events:{'input @ui.srcTextarea':'onMessageInput','click @ui.tempDisableButton':'switchOff'},hints:null,hintViews:null,hintTemplate:'',currentDialogue:null,selectedItemWrapper:null,onMessageInput:function(){if(this.ui.srcTextarea.val()){this.loadHints(this.ui.srcTextarea.val());}else{this.hideHintsContainer();}},loadHints:function(message){this.hints.fetch(this.getFetchParams(message));},getFetchParams:function(message){return{message:message};},onHintsReset:function(){this.hideHintsContainer();_.invoke(this.hintViews,'destroy');this.triggerOnContainer('afterContentChange');this.hintViews=[];},onHintAdd:function(hintModel){var hintView=new classes.views.items.Hint(this.hintTemplate,this.radio,hintModel);this.hintViews.push(hintView);this.ui.hintsList.append(hintView.getWrapper());hintView.getWrapper().on('click',this.onHintClick.webimBind(this,hintModel));hintView.show();this.triggerOnContainer('afterContentChange');},onHintsLoad:function(){this.hints.size()&&this.showHintsContainer();},switchOn:function(){classes.ui.widgets.Base.prototype.switchOn.call(this);this.currentDialogue=core.repository.get('dialogues').getCurrent();this.listenTo(core.repository.get('dialogues'),{newCurrent:function(dialogue){this.currentDialogue=dialogue;}.webimBind(this)});},onHintClick:function(hintModel){this.sendHint(hintModel);},onKeyDownEvent:function(event){var lineHeightAdd=4;var fontSize=parseInt(window.getComputedStyle(this.ui.srcTextarea[0],null).fontSize);if(this.ui.hintsList.children().length){switch(event.which){case 38:if(this.ui.srcTextarea[0].webimCaretPosition().top+lineHeightAdd<=fontSize){if(this.selectedItemWrapper){if(this.selectedItemWrapper.prev().length){this.selectedItemWrapper.removeClass('webim-hover');this.selectedItemWrapper=this.selectedItemWrapper.prev();this.selectedItemWrapper.addClass('webim-hover');}}else{this.selectedItemWrapper=this.ui.hintsList.children().last();this.selectedItemWrapper.addClass('webim-hover');}
event.preventDefault();}
break;case 40:if(this.selectedItemWrapper){this.selectedItemWrapper.removeClass('webim-hover');if(this.selectedItemWrapper.next().length){this.selectedItemWrapper=this.selectedItemWrapper.next();this.selectedItemWrapper.addClass('webim-hover');}else{this.selectedItemWrapper=null;}
event.preventDefault();}
break;case 37:if(this.selectedItemWrapper){this.selectedItemWrapper.removeClass('webim-hover');this.selectedItemWrapper=null;event.preventDefault();}
break;case 13:if(this.selectedItemWrapper){this.selectedItemWrapper.click();event.preventDefault();}
break;}}},sendHint:function(hintModel){if(!this.currentDialogue){this.currentDialogue=new classes.models.Dialogue();}
this.currentDialogue.addMessage(new classes.models.Message({'text':hintModel.get('text'),'ts':_.now()/1000,'kind':'visitor'}));this.ui.srcTextarea.val('').change();this.hideHintsContainer();},hideHintsContainer:function(){this.radio.request('ui:'+this.ui.hintsContainer.data('webimGuid')+':hide');this.ui.srcTextarea.off('keydown.webim.hints.'+this.getGuid());if(this.selectedItemWrapper){this.selectedItemWrapper.removeClass('webim-wrapper');this.selectedItemWrapper=null;}},showHintsContainer:function(){this.radio.request('ui:'+this.ui.hintsContainer.data('webimGuid')+':show');this.ui.srcTextarea.on('keydown.webim.hints.'+this.getGuid(),this.onKeyDownEvent.webimBind(this));},switchOff:function(){this.hideHintsContainer();classes.ui.widgets.Base.prototype.switchOff.call(this);$(document).off('keydown.webim.hints.'+this.getGuid());this.stopListening();}});classes.ui.widgets.OfflineMessage=function(wrapper,radio,container){if(!core.settings.config.hasOption('visitor_upload_file')){delete this.extensions['fileUploadOffline'];}
classes.ui.widgets.Base.call(this,wrapper,radio,container);this.isSending=false;this.switchOn();};classes.ui.widgets.OfflineMessage.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.OfflineMessage,ui:{sendButton:'[data-webim-widget-action="send-message"]',message:'[name="message"]'},events:{'click @ui.sendButton':'sendEvent','keypress input, textarea':'keyPressEvent'},extensions:{captcha:null,customFields:null,fileUploadOffline:null,visitorFields:{type:'offlineMode',sendButtonSelector:'[data-webim-widget-action="send-message"]'}},containerEvents:{afterHide:'afterHideHandler'},sendEvent:function(event){event.preventDefault();this.send();},keyPressEvent:function(event){if(event.keyCode==13&&!event.shiftKey){event.preventDefault();this.send();}},send:function(){if(!this.isSending&&this.validateInputs()){var message=this.ui.message.val();if(!this.extensions.captcha.hasCreated()&&validator.urlRegExp.test(message)){this.extensions.captcha.createCaptcha();return;}
var visitor=this.extensions.visitorFields.getVisitorFieldValues();core.repository.get('visitor').set({fields:visitor});this.isSending=true;this.stateTo('process');this.disableEvents();var params={'text':message,'visitor-fields':visitor};var customFieldValues=this.extensions.customFields.getCustomData();if(customFieldValues){params['custom_fields']=customFieldValues;}
params['file-descs']=(this.extensions.fileUploadOffline&&this.extensions.fileUploadOffline.uploadedFileDescriptors)?this.extensions.fileUploadOffline.uploadedFileDescriptors:[];if(this.extensions.captcha.hasCreated()){params['captcha_fields']=this.extensions.captcha.getCaptchaData();}
core.tracking.track('chat.offline_message',params).done(this.successHandler.webimBind(this)).fail(this.errorHandler.webimBind(this)).always(this.enableEvents.webimBind(this));}},successHandler:function(){this.extensions.captcha.destroyCaptcha();this.radio.trigger('system:event:offline-message:afterSend');if(core.settings.config.hasOption('visitor_upload_file')){this.extensions.fileUploadOffline.uploadedFileDescriptors=[];this.once('done',this.extensions.fileUploadOffline.cleanFileList,this.extensions.fileUploadOffline);}
this.stateTo('success');_.delay(this.trigger.webimBind(this,'done'),2000);},errorHandler:function(errorType){this.isSending=false;this.stateTo('error');if(errorType=='ban'){this.extensions.captcha.destroyCaptcha();this.radio.request('service:notifications:alert',{title:core.resources.get('chat.notifications.failure_title'),message:core.resources.get('chat.error_message.visitor_banned')});}else if(errorType=='wrong captcha'){this.extensions.captcha.errorCaptcha();}},afterHideHandler:function(){this.ui.message.val('');this.isSending=false;this.stateTo('ready');},switchOn:function(){classes.ui.widgets.Base.prototype.switchOn.call(this);core.settings.config.hasOption('visitor_upload_file')&&this.extensions.fileUploadOffline.enable();},switchOff:function(){classes.ui.widgets.Base.prototype.switchOff.call(this);core.settings.config.hasOption('visitor_upload_file')&&this.extensions.fileUploadOffline.disable();}});classes.ui.widgets.Operator=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.cleanOperator();this.switchOn();};classes.ui.widgets.Operator.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.Operator,currentDialogue:null,ui:{avatar:'[data-webim-model-field="avatar"]',position:'[data-webim-model-field="position"]',operatorBlock:'[data-webim-widget-type="operator-block"]'},cleanOperator:function(){this.ui.operatorBlock.hide();this.ui.avatar.empty();this.wrapper.find('[data-webim-model-field]').text('');},setOperator:function(operator){this.ui.operatorBlock.show();this.ui.avatar.show();_.each(operator.getAll(),function(value,fieldName){switch(fieldName){case'avatar':operator.get('avatar')?this.ui.avatar.html($('<img/>').attr('src',env.getBaseUrl()+operator.get('avatar'))).show():this.ui.avatar.empty();break;case'fullname':this.wrapper.find('[data-webim-model-field="fullname"]').text(operator.get('langToFullname.'+core.settings.location.get('chat.lang'))||operator.get('fullname'));break;case'position':this.ui.position.text(operator.get('position')||core.resources.get('chat.operator.default_title'));break;default:this.wrapper.find('[data-webim-model-field="'+fieldName+'"]').text(value);}}.webimBind(this));},resetOperator:function(operator){this.cleanOperator();operator&&this.setOperator(operator);},onChangeDialogue:function(dialogue){if(this.currentDialogue){this.stopListening(this.currentDialogue);this.cleanOperator();this.currentDialogue=null;}
if(dialogue){this.currentDialogue=dialogue;this.listenTo(this.currentDialogue,'operator:afterUpdate',this.resetOperator.webimBind(this));this.resetOperator(this.currentDialogue.get('operator'));}},switchOn:function(){classes.ui.widgets.Base.prototype.switchOn.call(this);this.listenTo(core.repository.get('dialogues'),'afterReset newCurrent',this.onChangeDialogue.webimBind(this));this.onChangeDialogue(core.repository.get('dialogues').getCurrent());},switchOff:function(){classes.ui.widgets.Base.prototype.switchOff.call(this);this.onChangeDialogue(null);this.stopListening(core.repository.get('dialogues'));}});classes.ui.widgets.Rate=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);};classes.ui.widgets.Rate.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.Rate,operatorId:null,ui:{sendButton:'[data-webim-widget-action="send-rate"]',error:'[data-webim-widget-type="error"]',operatorRatingsBlock:'[data-webim-widget-type="operator-ratings-block"]',operatorSendingRatingsBlock:'[data-webim-widget-type="operator-sending-ratings-block"]',resultBlock:'[data-webim-widget-type="rating-result-block"]'},events:{'click @ui.sendButton':'sendRatingEvent','click @ui.operatorRatingsBlock > *':'setRatingEvent','click @ui.operatorSendingRatingsBlock > *':'setAndSendRatingEvent'},containerEvents:{afterHide:'afterHideHandler',beforeShow:'beforeShowHandler'},setRating:function(rate){if(_.isNumber(rate)){this.ui.sendButton.prop('disabled',rate<-2);this.ui.operatorRatingsBlock.children().removeClass('webim-ticked-rate webim-js-rating webim-selected-rate').filter(':lt('+(rate+3)+')').addClass('webim-ticked-rate webim-js-rating').end().eq(rate+2).addClass('webim-selected-rate');this.ui.operatorSendingRatingsBlock.children().removeClass('webim-ticked-rate webim-js-rating webim-selected-rate').filter(':lt('+(rate+3)+')').addClass('webim-ticked-rate webim-js-rating').end().eq(rate+2).addClass('webim-selected-rate');}},getRating:function(){var rate=$('.webim-overlay-body .webim-js-rating',this.wrapper).size();switch(rate){case 1:return-2;case 2:return 0;case 3:return 2;}
return null;},sendRatingEvent:function(event){event.preventDefault();this.sendRating();},setRatingEvent:function(event){event.preventDefault();this.setRating($(event.currentTarget).prevAll().andSelf().length-3);},sendRating:function(){var rate={'rate':this.getRating()};if(this.operatorId){rate['operator_id']=this.operatorId;}
this.disableEvents();this.stateTo('process');core.tracking.track('chat.operator_rate_select',rate).done(this.successHandler.webimBind(this)).fail(this.errorHandler.webimBind(this)).always(this.enableEvents.webimBind(this));},setAndSendRatingEvent:function(event){this.setRatingEvent(event);this.sendRating();},successHandler:function(){this.stateTo('success');this.ui.resultBlock.children().removeClass('webim-selected-rate').eq($('.webim-overlay-body .webim-js-rating',this.wrapper).size()-1).addClass('webim-selected-rate');_.delay(this.trigger.webimBind(this,'done'),2000);},errorHandler:function(errorType){var message=core.resources.get('chat.error_message.rate_unknown');this.ui.error.removeClass('webim-no-current-operator-error');switch(errorType){case'timeout':message=core.resources.get('chat.error_message.rate_timeout');break;case'operator-not-in-chat':message=core.resources.get('chat.error_message.rate_operator_not_in_chat');break;case'no-chat':case'no-current-operator':message=core.resources.get('chat.error_message.no_current_operator');this.ui.error.addClass('webim-no-current-operator-error');break;}
this.ui.error.html(message);this.stateTo('error');},afterHideHandler:function(){this.resetErrorState();this.stateTo('ready');},beforeShowHandler:function(){if(this.wrapper.data('webimOptionOperatorId')){this.operatorId=this.wrapper.data('webimOptionOperatorId');}else{var currentOperator=core.repository.get('dialogues').getCurrent()&&core.repository.get('dialogues').getCurrent().get('operator');if(currentOperator){this.operatorId=currentOperator.get('id');}else{this.errorHandler('no-current-operator');this.switchOff();return;}}
if(_.isNumber(this.wrapper.data('webimOptionRating'))){this.setRating(this.wrapper.data('webimOptionRating'));}else if(core.repository.get('dialogues').getCurrent()){this.setRating(core.repository.get('dialogues').getCurrent().get('operatorIdToRate.'+this.operatorId+'.rating'));}
this.switchOn();}});classes.ui.widgets.SelectDepartment=function(wrapper,radio,container,options){_.defaults(this,classes.mixins.Bindings);_.defaults(this,classes.mixins.OneClickSelect);classes.ui.widgets.Base.call(this,wrapper,radio,container);this.switchOn();this.initOneClickSelect();this.initBindings(this.wrapper,this.model);};classes.ui.widgets.SelectDepartment.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.SelectDepartment,bindings:{'@ui.departments':{name:'whyINeedObserveAnyModelField',selectOptions:{customizeOption:function(itemWrapper,model){itemWrapper.text(model.get('name'));itemWrapper.val(model.get('key'));itemWrapper.data('webimSelectToUl',{'logo':model.get('logo')?env.getBaseUrl()+model.get('logo'):null,'class':model.get('online')});return itemWrapper;}}}},ui:{sendButton:'[data-webim-widget-action="select-department"]',departments:'[data-webim-widget-type="departments"]'},events:{'click @ui.sendButton':'sendEvent','keypress select':'keyPressEvent'},sendEvent:function(event){event.preventDefault();this.send();},keyPressEvent:function(event){if(event.keyCode===13&&!event.shiftKey){event.preventDefault();this.send();}},send:function(){var departmentKey=this.ui.departments.find('select, input:checked').addBack('select').val();var params={'department-key':departmentKey};if(departmentKey===''){params['force-without-department']=true}
this.radio.request('service:chat:start',params);},cleanDepartments:function(){this.ui.departments.empty().trigger('change');},switchOn:function(){this.bindings['@ui.departments'].selectOptions.collection=core.repository.get('departments');classes.ui.widgets.Base.prototype.switchOn.call(this);this.listenTo(core.repository.get('departments'),{afterReset:this.cleanDepartments.webimBind(this)});},switchOff:function(){this.stopListening(core.repository.get('departments'));this.cleanDepartments();classes.ui.widgets.Base.prototype.switchOff.call(this);this.destroyBindings();this.destroyOneClickSelect();}});classes.ui.widgets.SendContacts=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.switchOn();};classes.ui.widgets.SendContacts.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.SendContacts,extensions:{visitorFields:{type:'contactsRequest',sendButtonSelector:'[data-webim-widget-action="send-contacts"]'}},ui:{sendButton:'[data-webim-widget-action="send-contacts"]'},events:{'click @ui.sendButton':'sendEvent','keypress input':'keyPressEvent'},widgetEvents:{afterHide:'afterHideHandler'},sendEvent:function(event){event.preventDefault();this.send();},keyPressEvent:function(event){if(event.keyCode==13&&!event.shiftKey){event.preventDefault();this.send();}},send:function(){if(this.validateInputs()){this.stateTo('process');this.disableEvents();var visitor=this.extensions.visitorFields.getVisitorFieldValues();core.repository.get('visitor').set({fields:visitor});core.tracking.track('chat.cont_resp',{'visitor-fields':visitor}).done(this.successHandler.webimBind(this)).fail(this.errorHandler.webimBind(this)).always(this.enableEvents.webimBind(this));}},successHandler:function(){this.stateTo('success');_.delay(this.trigger.webimBind(this,'done'),500);},errorHandler:function(errorType){this.stateTo('error');},afterHideHandler:function(){this.stateTo('ready');}});classes.ui.widgets.SendHistory=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.switchOn();};classes.ui.widgets.SendHistory.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.SendHistory,ui:{'sendButton':'[data-webim-widget-action="send-to-email"]','email':'[name="email"]','errorMsg':'[data-webim-widget-type="error"]','mailto':'[class~="webim-email-report"] a'},events:{'click @ui.sendButton':'sendEvent','keypress @ui.email':'keyPressEvent'},containerEvents:{afterHide:'afterHideHandler',beforeShow:'beforeShowHandler'},sendEvent:function(event){event.preventDefault();this.send();},keyPressEvent:function(event){if(event.keyCode==13&&!event.shiftKey){event.preventDefault();this.send();}},send:function(){if(this.validateInputs()){this.stateTo('process');this.disableEvents();core.tracking.track('chat.send_chat_history',{email:this.ui.email.val()}).done(this.successHandler.webimBind(this)).fail(this.errorHandler.webimBind(this)).always(this.enableEvents.webimBind(this));}},successHandler:function(){this.stateTo('success');this.ui.mailto[0].text=this.ui.email.val();this.ui.mailto[0].href="mailto:"+this.ui.email.val();_.delay(this.trigger.webimBind(this,'done'),2000);},errorHandler:function(errorType){var message='';switch(errorType){case'timeout':message=core.resources.get('chat.error_message.send_history_timeout');break;default:message=core.resources.get('chat.error_message.send_history_unknown');}
this.ui.errorMsg.html(message);this.stateTo('error');},beforeShowHandler:function(){if(!this.ui.email.val()){this.ui.email.val(core.repository.get('visitor').get('fields.email')||'');}},afterHideHandler:function(){this.stateTo('ready');}});classes.ui.widgets.SoundControl=function(wrapper,radio,container){classes.ui.widgets.Base.call(this,wrapper,radio,container);this.chatModel=core.repository.get('chat');this.listenTo(this.chatModel,'soundEnabled:afterUpdate',this.updateState.webimBind(this));this.updateState();if(core.browser.support('audio')){this.switchOn();}else{this.wrapper.hide();}};classes.ui.widgets.SoundControl.prototype=tools.createUiObject(classes.ui.widgets.Base.prototype,{constructor:classes.ui.widgets.SoundControl,chatModel:null,ui:{'controlButton':'[data-webim-widget-action="sound-toggle"]','controlTitle':'[data-webim-widget-type="control-title"]'},events:{'click @ui.controlButton':'toggleSound'},toggleSound:function(){this.chatModel.set('soundEnabled',!this.chatModel.get('soundEnabled'));this.chatModel.save();},updateState:function(){if(this.chatModel.get('soundEnabled')){this.wrapper.removeClass('webim-sound-disabled').addClass('webim-sound-enabled');this.ui.controlTitle.text(core.resources.get('chat.actions.switch_off_sound'));}else{this.wrapper.addClass('webim-sound-disabled').removeClass('webim-sound-enabled');this.ui.controlTitle.text(core.resources.get('chat.actions.switch_on_sound'));}}});classes.views={};classes.views.Base=function(html,radio){_.extend(this,classes.libs.Events);this.radio=radio;this.wrapper=this.makeWrapper(html);this.wrapper.removeAttr('data-webim-template');this.container=builder.build(this.wrapper,this.radio);this.container.request('hide-force');this.initUiEvents(this.wrapper);this.initRegions(this.container);this.enableEvents();};classes.views.Base.prototype=_.extend({constructor:classes.views.Base,radio:null,container:null,regions:null,initialize:function(){},show:function(){this.container.request('show');},hide:function(){this.container.request('hide');},makeWrapper:function(html){return $(_.template(html)());},getContainer:function(){return this.container;},getWrapper:function(){return this.wrapper;},destroy:function(){this.trigger('beforeDestroy');this.disableEvents();this.destroyUiEvents();this.destroyRegions();this.stopListening();this.off();this.wrapper.hide();this.container.trigger('afterContentChange');this.wrapper.trigger('afterResize.webim');this.container.destroy();this.wrapper.remove();this.radio=this.container=null;}},classes.mixins.UiEvents,classes.mixins.Regions);classes.views.items={};classes.views.items.Base=function(html,radio,model){this.model=model;classes.views.Base.call(this,html,radio);_.each(this.modelEvents,function(methodNames,modelEvents){_.each(methodNames.split(/\s+/),function(methodName){this.listenTo(this.model,modelEvents,this[methodName].webimBind(this));}.webimBind(this));}.webimBind(this));_.each(this.bindings,function(fieldRule,selector){var parsedSelector=this.replaceUiSugar(selector);var fieldWrapper=this.wrapper.find(parsedSelector).addBack(parsedSelector);if(_.isString(fieldRule)){this.listenTo(this.model,fieldRule+':afterUpdate',function(text){fieldWrapper.text(text);}.webimBind(this));fieldWrapper.text(this.model.get(fieldRule));}else{this.listenTo(this.model,fieldRule['name']+':afterUpdate',function(value){fieldRule['get'].call(this,value,fieldWrapper,this.model);this.wrapper.trigger('afterResize.webim');}.webimBind(this));fieldRule['get'].call(this,this.model.get(fieldRule['name']),fieldWrapper,this.model);this.wrapper.trigger('afterResize.webim');}}.webimBind(this));this.initialize();};classes.views.items.Base.prototype=tools.createUiObject(classes.views.Base.prototype,{constructor:classes.views.items.Base,modelEvents:{afterDestroy:'destroy'},model:null,bindings:{},makeWrapper:function(html){var template=_.template(html);return $(template(this.model.getAll()));},getModel:function(){return this.model;},destroy:function(){this.bindings=this.model=this.modelEvents=null;classes.views.Base.prototype.destroy.call(this);}});classes.views.items.BaseButton=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);};classes.views.items.BaseButton.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.BaseButton});classes.views.items.HtmlButton=function(html,radio,model){classes.views.items.BaseButton.call(this,html,radio,model);var channels=this.model.get('channels');if(_.size(channels)>1){for(var index in channels){var channelButton=$('<div></div>',{class:'webim-dropdown-element webim-shadow-dropdown webim-dropdown-'+channels[index].type});var channelLabel=$('<div></div>',{class:'webim-dropdown-element-label',html:channels[index].name});channelLabel.appendTo(channelButton);this.ui.content.append(channelButton);this.ui.content.hide();}}
else{var channel=_.values(channels)[0];this.ui.content.remove();this.ui.dropdown.addClass('webim-dropdown-element').addClass('webim-dropdown-'+channel.type);}
this.ui['startChatButton']=this.wrapper.find('.webim-dropdown-webim');this.ui['dropdownElement']=this.wrapper.find('.webim-dropdown-element');};classes.views.items.HtmlButton.prototype=tools.createUiObject(classes.views.items.BaseButton.prototype,{constructor:classes.views.items.HtmlButton,ui:{dropdown:'[data-type="dropdown-toggle"]',dropdownElement:'.webim-dropdown-element',content:'.webim-dropdown-content',startChatButton:'.webim-dropdown-webim'},modelEvents:{'state:afterUpdate':'changeStatusHandler'},prepareButton:function(){if(this.model.get('isPreview')){this.model.on('dragged:afterUpdate',function(state){if(state==='N'&&this.wrapper.is('.ui-draggable')){this.wrapper.draggable("destroy");}else if(state==='Y'&&!this.wrapper.is('.ui-draggable')){this.setDraggable();}
this.updatePosition();}.webimBind(this));this.model.on('offlineEnabled:afterUpdate',this.updateOnlineState.webimBind(this));this.model.on('background-color:afterUpdate',this.updateColors.webimBind(this));this.model.on('border-color:afterUpdate',this.updateColors.webimBind(this));this.model.on('position:afterUpdate',this.updatePosition.webimBind(this));this.wrapper.css('position','absolute');}else{$(window).resize(this.updatePosition.webimBind(this));}
if(this.model.get('isMobile')){this.ui.dropdown.addClass('webim-dropdown-mobile');this.ui.dropdownElement.addClass('webim-dropdown-mobile');this.wrapper.find('.webim-dropdown-element-label').remove();}
if(this.model.get('dragged')==='Y'){this.setDraggable();}
this.ui.startChatButton.addClass('webim_button');this.startClickHandlers();this.updatePosition();this.updateOnlineState();this.expand(this.model.get('collapsed'));},setDraggable:function(){this.wrapper.draggable({handle:this.ui.dropdown,containment:this.model.get('isPreview')?'parent':'document',distance:15,drag:function(){if(!this.model.get('collapsed'))
this.ui.content.css({top:this.getDropdownTop()});}.webimBind(this),stop:this.stopDrag.webimBind(this),start:function(){this.ui.dropdown.off('click');}.webimBind(this)});},startClickHandlers:function(){this.ui.dropdown.click(this.switchDropdown.webimBind(this));this.ui.startChatButton.click(this.model.get('startChatHandler').webimBind(this));},updatePosition:function(){var wrapperSize=this.model.get('isPreview')?{height:this.wrapper.parent().innerHeight(),width:this.wrapper.parent().innerWidth()}:{height:window.innerHeight,width:window.innerWidth};var maxLeft=wrapperSize.width-this.wrapper.outerWidth(true);var maxTop=wrapperSize.height-this.wrapper.outerHeight(true);var left=this.model.get('position.horizontal')/100*maxLeft;var top=this.model.get('position.vertical')/100*maxTop;this.wrapper.css({left:left,top:top});},updateOnlineState:function(){if(this.model.get('state')==='online'){this.expand(this.model.get('collapsed'));this.updateColors();this.wrapper.show();}else if(this.model.get('state')==='busy_online'||this.model.get('state')==='busy_offline'){this.wrapper.hide();}else{if(this.model.get('offlineEnabled')){this.updateColors();this.wrapper.show();}
else{this.wrapper.hide();}}},changeStatusHandler:function(status){switch(status){case'online':case'busy_online':case'offline':this.updateOnlineState();break;case'typing':this.changeInnerPicture('...');break;case'message':this.changeInnerPicture('!');break;}},updateColors:function(){if(this.model.get('state')!=='offline'){var newBgColor=this.model.get('background-color');}else{var newBgColor='rgba(127,127,127,1)';}
this.ui.dropdown.css({'border-color':this.model.get('border-color'),'background-color':newBgColor});this.ui.startChatButton.css({'border-color':this.model.get('border-color'),'background-color':newBgColor});},changeInnerPicture:function(label){switch(label){case'!':this.ui.dropdown.css('background-image','url("'+env.getBaseUrl()+'/v/images/new_message_icon.svg")');break;case'W':case'w':this.ui.dropdown.css('background-image','url("'+env.getBaseUrl()+'/v/images/message_icon.svg")');break;case'X':case'x':this.ui.dropdown.css('background-image','url("'+env.getBaseUrl()+'/v/images/close-icon.svg")');break;case'...':this.ui.dropdown.css('background-image','url("'+env.getBaseUrl()+'/v/images/ellipsis.svg")');break;}},validatePosition:function(oldPos){var minLeft=0;var minTop=0;var globalWrapper=this.model.get('isPreview')?this.wrapper.parent():$(window);var maxLeft=globalWrapper.innerWidth()-this.wrapper.outerWidth(true);var maxTop=globalWrapper.innerHeight()-this.wrapper.outerHeight(true);var left=Math.min(Math.max(oldPos.left,minLeft),maxLeft);var top=Math.min(Math.max(oldPos.top,minTop),maxTop);return{left:left,top:top};},savePosition:function(){if(this.model.get('isPreview'))
return;var wrapper=$(window);var globalWidth=wrapper.innerWidth();var globalHeight=wrapper.innerHeight();var horizontal=this.wrapper.position().left/(globalWidth-this.wrapper.outerWidth(true))*100;var vertical=this.wrapper.position().top/(globalHeight-this.wrapper.outerHeight(true))*100;this.model.set('position',{horizontal:horizontal,vertical:vertical});this.model.save();},stopDrag:function(event){this.ui.content.css({top:this.getDropdownTop()});this.wrapper.css(this.validatePosition(this.wrapper.position()));this.savePosition();setTimeout(function(){this.startClickHandlers();}.webimBind(this));},getDropdownTop:function(){var dropDownContainerHeight=this.ui.content.height();if(parseInt(this.wrapper.position().top||this.wrapper.css('top')||this.model.get('position.top'))<dropDownContainerHeight){return this.wrapper.height();}
else
return-dropDownContainerHeight;},expand:function(collapsed){collapsed?this.hideDropdown():this.showDropdown();},switchDropdown:function(){if(_.size(this.model.get('channels'))>1){this.expand(!this.model.get('collapsed'));}},showDropdown:function(){this.ui.content.show();this.ui.content.css('top',this.getDropdownTop());this.changeInnerPicture('X');this.model.set('collapsed',false);this.model.save();},hideDropdown:function(){this.ui.content.hide();this.changeInnerPicture('W');this.model.set('collapsed',true);this.model.save();},});classes.views.items.ImageButton=function(html,radio,model){classes.views.items.BaseButton.call(this,html||'<a></a>',radio,model);var startPage=window.webim_start_page||{'title':document.title,'url':document.location.href};var baseClientPhpUrl=core.settings.config.get('client_php_url')||env.getBaseUrl()+'/client.php';var url=baseClientPhpUrl+'?start-page='+encodeURIComponent($.toJSON(startPage))+(env.getLocation()!=='default'?'&location='+env.getLocation():'');this.wrapper.attr({class:this.model.get('buttonClass'),href:url,rel:'webim',border:0});this.updateImage();};classes.views.items.ImageButton.prototype=tools.createUiObject(classes.views.items.BaseButton.prototype,{constructor:classes.views.items.ImageButton,ui:{image:'img'},modelEvents:{'state:afterUpdate':'updateImage','name:afterUpdate':'prepareButton'},prepareButton:function(){if(this.model.get('isPreview')){this.model.on('offlineEnabled:afterUpdate',this.updateImage.webimBind(this));this.model.on('name:afterUpdate',this.updateImage.webimBind(this));}
this.wrapper.addClass('webim_button').show();this.wrapper.click(this.model.get('startChatHandler').webimBind(this));},updateImage:function(){if(this.ui.image.length){this.ui.image.remove();}
if(!this.model.get('offlineEnabled')&&this.model.get('state')==='offline'||this.model.get('state')==='busy_online'||this.model.get('state')==='busy_offline')
return;var shortState=(this.model.get('state')==='online')?'on':'off';var imgUrl=this.model.get('imageUrl')+'&button-name='+this.model.get('name')+'&force-status='+shortState;var img=$('<img />',{border:0,src:imgUrl});img.appendTo(this.wrapper);this.ui['image']=this.wrapper.find('img');img.load(function(){this.trigger('loadImage');}.webimBind(this));},});classes.views.items.CornerButton=function(html,radio,model){classes.views.items.ImageButton.call(this,html,radio,model);this.superclass=classes.views.items.ImageButton.prototype;};classes.views.items.CornerButton.prototype=tools.createUiObject(classes.views.items.ImageButton.prototype,{superclass:null,constructor:classes.views.items.CornerButton,ui:{image:'img'},modelEvents:{'name:afterUpdate':'prepareButton'},prepareButton:function(){this.superclass.prepareButton.call(this);if(this.model.get('isPreview')){this.wrapper.removeAttr('style').stop();this.wrapper.css('position','absolute');}
this.animationButtonFromCorner({x:-100,y:-100},{x:0,y:0});this.wrapper.addClass('webim-button-corner');},animationButtonFromCorner:function(start,final){var positionPieces=this.model.get('corner.position').split('-');var verticalPosition=positionPieces[1];var horizontalPosition=positionPieces[0];var startPos={};startPos[verticalPosition]=start.y+'px';startPos[horizontalPosition]=start.x+'px';var finalPos={};finalPos[verticalPosition]=final.y+'px';finalPos[horizontalPosition]=final.x+'px';this.wrapper.setFixedPosition(startPos).fixedAnimate(finalPos,'slow');},});classes.views.items.SliderButton=function(html,radio,model){classes.views.items.ImageButton.call(this,html,radio,model);this.superclass=classes.views.items.ImageButton.prototype;};classes.views.items.SliderButton.prototype=tools.createUiObject(classes.views.items.ImageButton.prototype,{superclass:null,constructor:classes.views.items.SliderButton,ui:{image:'img'},modelEvents:{'state:afterUpdate':'updateImage','name:afterUpdate':'prepareButton',},prepareButton:function(){this.superclass.prepareButton.call(this);if(this.model.get('isPreview')){this.wrapper.removeAttr('style').stop();this.wrapper.off('hover');this.wrapper.css('position','absolute');}
var sliderSettings=this.model.get('slider');var positions={top:sliderSettings['top']};positions[sliderSettings['position']]=(-sliderSettings['width'])+'px';this.wrapper.css('width',sliderSettings['width']).addClass('webim-button-slider').setFixedPosition(positions);var prop={};prop[sliderSettings['position']]=sliderSettings['alwaysVisibleWidth']-sliderSettings['width'];this.wrapper.stop().fixedAnimate(prop,'slow');this.wrapper.hover(function(){var prop={};prop[sliderSettings['position']]=0;this.wrapper.stop().fixedAnimate(prop,'fast');}.webimBind(this),function(){var prop={};prop[sliderSettings['position']]=sliderSettings['alwaysVisibleWidth']-sliderSettings['width'];this.wrapper.stop().fixedAnimate(prop,'fast');}.webimBind(this));}});classes.views.items.Chat=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);this.wrapper.addClass('webim_a_'+env.accountName).addClass('webim_l_'+env.getLocation()).addClass('webim-'+(env.separateChatWindow?'separate':'desktop')+'-mode');if(core.browser.isMobile()){this.wrapper.addClass('webim-mobile-mode');}
this.chatSections=[];this.wrapper.find('[data-webim-guid="chat-sections"]').children().each(function(index,elem){this.chatSections.push($(elem).data('webimGuid'));}.webimBind(this));this.dialogueSections=[];this.wrapper.find('[data-webim-guid="dialogue-sections"]').children().each(function(index,elem){this.dialogueSections.push($(elem).data('webimGuid'));}.webimBind(this));this.listenTo(core.repository.get('session'),'onlineStatus:afterUpdate',this.changedOnlineStatusHandler);this.changedOnlineStatusHandler(core.repository.get('session').get('onlineStatus'));this.model.get('manualSetSection')?this.onManualSetSectionUpdate(this.model.get('manualSetSection')):this.onChatStateUpdate(this.model.get('chatState'));this.onDialogueStateUpdate(this.model.get('dialogueState'));this.onFontSizeUpdate(this.model.get('fontSize'));var jContactsBlock=this.wrapper.find('[data-webim-chat-type="contacts"]');if(!_.isUndefined(jContactsBlock.data('webimContainer'))){this.contactsBlockRequests={show:this.radio.request.webimBind(this.radio,'ui:'+jContactsBlock.data('webimGuid')+':show'),hide:this.radio.request.webimBind(this.radio,'ui:'+jContactsBlock.data('webimGuid')+':hide')};}else if(!_isUndefined(jContactsBlock.data('webimItemName'))){this.contactsBlockRequests={show:this.radio.request.webimBind(this.radio,'ui:'+jContactsBlock.closest('[data-webim-carousel]').data('webimGuid')+':show',jContactsBlock.data('webimItemName')),hide:this.radio.request.webimBind(this.radio,'ui:'+jContactsBlock.closest('[data-webim-carousel]').data('webimGuid')+':hide',jContactsBlock.data('webimItemName'))};}
this.contactsRequestHandler(this.model.get('inContactsRequest'));core.repository.get('dialogues').on('newCurrent',function(dialogue){dialogue.on('readByVisitor:afterUpdate',this.hasReadHandler.webimBind(this));}.webimBind(this));if(core.repository.get('dialogues').getCurrent()){core.repository.get('dialogues').getCurrent().on('readByVisitor:afterUpdate',this.hasReadHandler.webimBind(this));this.hasReadHandler(core.repository.get('dialogues').getCurrent().get('readByVisitor'));}};classes.views.items.Chat.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.Chat,ui:{minimizeButton:'[data-webim-chat-action="minimize"]',sectionSelectButtons:'[data-webim-chat-action="select-section"]'},events:{'click @ui.minimizeButton':'minimizeEvent','click @ui.sectionSelectButtons':'changeSectionEvent'},modelEvents:{'chatState:afterUpdate':'onChatStateUpdate','dialogueState:afterUpdate':'onDialogueStateUpdate','manualSetSection:afterUpdate':'onManualSetSectionUpdate','fontSize:afterUpdate':'onFontSizeUpdate'},visible:false,contactsBlockRequests:null,chatSections:null,dialogueSections:null,onDialogueStateUpdate:function(state){this.radio.request('ui:'+state+':show');},onChatStateUpdate:function(state){if(!this.model.get('manualSetSection')){var section=state==='chat'?'dialogue-sections':state;this.changeSection(section);}},onManualSetSectionUpdate:function(section){this.changeSection(section);},changeSection:function(toSection){if(toSection!==null&&this.currentSection!==toSection){this.currentSection=toSection;this.ui.sectionSelectButtons.removeClass('webim-active');this.radio.request('ui:'+this.currentSection+':show');this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="'+this.currentSection+'"]').addClass('webim-active');}},currentSize:null,onFontSizeUpdate:function(newSize){if(this.currentSize){this.wrapper.removeClass('webim-font-size-'+this.currentSize);}
this.wrapper.addClass('webim-font-size-'+newSize);this.currentSize=newSize;},show:function(){if(!this.visible){classes.views.items.Base.prototype.show.call(this);this.radio.trigger('system:event:chat:afterShow');this.visible=true;}},hide:function(){if(this.visible){if(!Boolean(env.separateChatWindow)&&!Boolean(env.chatInIframeMode)){classes.views.items.Base.prototype.hide.call(this);}
this.radio.trigger('system:event:chat:afterHide');this.visible=false;}},minimizeEvent:function(event){event.preventDefault();if(!Boolean(env.separateChatWindow)||Boolean(env.chatInIframeMode)){this.model.set('minimized',true);this.model.save();}},contactsRequestHandler:function(request){if(this.contactsBlockRequests){if(request){this.contactsBlockRequests['show']();this.radio.once('ui:chat-contacts:beforeHide',function(){core.repository.get('dialogues').getCurrent().set('inContactsRequest',false);}.webimBind(this));}else{this.contactsBlockRequests['hide']();}}},changedOnlineStatusHandler:function(newStatus){var stateToClass={'online':'webim-online','busy-online':'webim-busy-online','offline':'webim-offline','busy-offline':'webim-busy-offline'};this.wrapper.removeClass(_.values(stateToClass).join(' ')).addClass(_.has(stateToClass,newStatus)?stateToClass[newStatus]:'');},changeSectionEvent:function(event){event.preventDefault();var toSection=$(event.currentTarget).data('webimChatArg');this.model.set('manualSetSection',toSection);this.model.save();},hasNotReadIntervalId:null,hasReadHandler:function(hasRead){var chatSectionButton=this.ui.sectionSelectButtons.filter('[data-webim-chat-arg="chat"]');if(!hasRead&&this.currentSection!=='dialogue-sections'){this.hasNotReadIntervalId&&clearInterval(this.hasNotReadIntervalId);this.hasNotReadIntervalId=setInterval(function(){chatSectionButton.hasClass('webim-has-not-read-message')?chatSectionButton.removeClass('webim-has-not-read-message'):chatSectionButton.addClass('webim-has-not-read-message');}.webimBind(this),1000);}else if(hasRead){this.hasNotReadIntervalId&&clearInterval(this.hasNotReadIntervalId);chatSectionButton.removeClass('webim-has-not-read-message');this.hasNotReadIntervalId=null;}}});classes.views.items.Dialogue=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);this.rateTemplate=$('<p>').append(this.ui.messages.children('[data-webim-dialogue-message-type="embedded-rate"]')).html();this.messagesView=new classes.views.collections.Messages($('<p>').append(this.ui.messages).html(),this.radio,this.model.get('messages'));this.listenTo(this.messagesView,'afterAdd',this.onAddMessage.webimBind(this));_.each(this.messagesView.getChildren(),this.onAddMessage.webimBind(this));if(core.settings.config.hasOption('rate_operator')&&this.getModel()===core.repository.get('dialogues').getCurrent()){radio.reply('rate-operator',function(){this.showEmbeddedRate(this.lastOperatorId);}.webimBind(this));}
this.regions.messages.showView(this.messagesView);};classes.views.items.Dialogue.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.Dialogue,messagesView:null,rateTemplate:'',lastOperatorId:null,regions:{messages:'[data-webim-region="messages"]'},ui:{messages:'[data-webim-collection="messages"]'},bindings:{'[data-webim-dialogue-type="date"]':{name:'created',get:function(value,wrapper){value&&wrapper.text(tools.formatDate(value));}}},onAddMessage:function(messageView){var message=messageView.getModel();if(core.settings.config.hasOption('rate_operator')&&message.isOperatorMessage()){messageView.getWrapper().find('[data-webim-message-action="operator-rate"]').addClass('webim-action').click(function(){this.showEmbeddedRate(message.get('authorId'),messageView.getWrapper());}.webimBind(this));this.lastOperatorId=message.get('authorId');}else{messageView.getWrapper().find('[data-webim-message-action="operator-rate"]').removeAttr('data-webim-message-action');}
this.trigger('wrapper:afterInserted',messageView.getWrapper());},shownEmbeddedRate:null,showEmbeddedRate:function(operatorId,afterMessageWrapper){if(afterMessageWrapper&&afterMessageWrapper.next('[data-webim-widget-message-type="embedded-rate"]').length){return;}
if(this.shownEmbeddedRate){this.shownEmbeddedRate.hide();setTimeout(this.shownEmbeddedRate.destroy.webimBind(this.shownEmbeddedRate),1000);}
this.shownEmbeddedRate=new classes.views.Base(this.rateTemplate,this.radio);this.shownEmbeddedRate.getWrapper().find('[data-webim-widget="Rate"]').data('webimOptionOperatorId',operatorId).data('webimOptionRating',this.model.get('operatorIdToRate.'+operatorId+'.rating')||-3);afterMessageWrapper?afterMessageWrapper.after(this.shownEmbeddedRate.getWrapper()):this.shownEmbeddedRate.getWrapper().insertAfter(this.messagesView.last().getWrapper());this.shownEmbeddedRate.show();this.trigger('wrapper:afterInserted',this.shownEmbeddedRate.getWrapper());},subKindToViewClassName:function(subkind){return _.map(subkind.split('_'),_.capitalize).join('');},destroy:function(){this.messagesView.destroy();this.messagesView=null;classes.views.items.Base.prototype.destroy.call(this);}});classes.views.items.File=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);};classes.views.items.File.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.File,ui:{root:'[data-webim-widget-type="file-item"]',name:'[data-webim-model-field="name"]',size:'[data-webim-model-field="size"]',progressbar:'[data-webim-model-field="progressbar"]',errorMessage:'[data-webim-model-field="errorMessage"]'},bindings:{'@ui.name':{name:'name',get:function(value,wrapper){var filename=_.escape(value);if(filename.length>30){filename=filename.substr(0,22)+'...'+filename.substr(-8);}
wrapper.text(filename);}},'@ui.size':{name:'size',get:function(value,wrapper){wrapper.text(tools.formatSize(value));}},'@ui.progressbar':{name:'progress',get:function(value,wrapper){wrapper.css('width',(value*100)+'%');}},'@ui.errorMessage':{name:'error',get:function(data,wrapper){if(data){var message='Unknown';if(data.errorThrown=='abort'){switch(data.files[0].error){case data.i18n('acceptFileTypes'):message=this.getNotAllowedFileTypeErrorMessage();break;case data.i18n('maxFileSize'):message=core.resources.get('chat.error_message.file_uploading_wrong_size',[tools.formatSize(this.getMaxFileSize())]);break;case data.i18n('minFileSize'):case data.i18n('uploadedBytes'):case data.i18n('maxNumberOfFiles'):default:message=core.resources.get('chat.error_message.file_uploading_unknown');}}else{message=core.resources.get('chat.error_message.file_uploading_unknown');}
wrapper.text(message);}}},'@ui.root':{name:'status',get:function(value,wrapper){wrapper.removeClass('webim-ready webim-process webim-error').addClass('webim-'+value);if(value==='success'){_.delay(this.hide.webimBind(this),2000);}}}},destroy:function(){this.bindings=this.modelEvents=null;classes.views.Base.prototype.destroy.call(this);this.model.destroy();},getMaxFileSize:function(){return core.settings.config.hasOption('max_visitor_upload_file_size')?parseInt(core.settings.config.get('max_visitor_upload_file_size'))*1024*1024:10*1024*1024;},getNotAllowedFileTypeErrorMessage:function(){if(core.settings.config.hasOption('allowed_upload_file_types')){return core.resources.get('chat.error_message.file_uploading_wrong_type',{'allowed_types':core.settings.config.get('allowed_upload_file_types')});}else{return core.resources.get('chat.error_message.file_uploading_restricted_type')}}});classes.views.items.Invitation=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);$(window).on('focus.webim.invitation.'+this.container.getGuid(),this.resumeTimeoutCount.webimBind(this));$(window).on('blur.webim.invitation.'+this.container.getGuid(),this.pauseTimeoutCount.webimBind(this));this.wrapper.addClass('webim_invitediv'
+' webim_a_'+env.accountName
+' webim_l_'+env.getLocation());if(_.has(this.positionToClass,this.model.get('position'))){this.wrapper.addClass(this.positionToClass[this.model.get('position')]);}};classes.views.items.Invitation.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.Invitation,ui:{'message':'[name="message"]','startButton':'[data-webim-invitation-action="start"]','closeButton':'[data-webim-invitation-action="close"]'},events:{'click @ui.startButton':'startChatEvent','click @ui.closeButton':'rejectEvent','keypress input, textarea':'keyPressEvent','focus input, textarea':'pauseTimeoutCount','blur input, textarea':'resumeTimeoutCount'},positionToClass:{'top-left':'webim-position-top-left','top-right':'webim-position-top-right','bottom-right':'webim-position-bottom-right','bottom-left':'webim-position-bottom-left','center':'webim-position-center'},intervalId:null,leftTime:null,countTimeStep:1000,state:null,startTimeoutCount:function(){if(!this.intervalId){this.leftTime=core.settings.location.get('invitation.timeout');this.resumeTimeoutCount();}},stopTimeoutCount:function(){if(this.intervalId){clearInterval(this.intervalId);this.intervalId=null;}},pauseTimeoutCount:function(){this.stopTimeoutCount();},resumeTimeoutCount:function(){if(!this.intervalId&&!_.contains(['preview','demo'],env.getMode())){this.intervalId=setInterval(this.timeoutCount.webimBind(this),this.countTimeStep);}},timeoutCount:function(){this.leftTime-=this.countTimeStep;if(this.leftTime<=0){this.timeoutHandler();}},timeoutHandler:function(){this.processInvitationAction('timeout');},processInvitationAction:function(eventType){this.stopTimeoutCount();this.model.set('visitorMessage',this.ui.message.val());switch(eventType){case'accept':this.model.accept();break;case'reject':this.model.reject();break;case'timeout':this.model.timeout();break;}},rejectEvent:function(event){event.preventDefault();this.processInvitationAction('reject');},startChatEvent:function(event){event.preventDefault();this.processInvitationAction('accept');},keyPressEvent:function(event){if(event.keyCode==13&&!event.shiftKey){event.preventDefault();this.processInvitationAction('accept');}},show:function(){classes.views.items.Base.prototype.show.call(this);this.startTimeoutCount();},hide:function(){classes.views.items.Base.prototype.hide.call(this);this.stopTimeoutCount();},destroy:function(){$(window).off('focus.webim.invitation.'+this.container.getGuid());$(window).off('blur.webim.invitation.'+this.container.getGuid());this.stopTimeoutCount();classes.views.items.Base.prototype.destroy.call(this);}});classes.views.items.messages={};classes.views.items.messages.Base=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);this.wrapper.addClass('webim-'+this.model.get('kind')+'-message');if(this.model.get('data')&&this.model.get('data')['subKind']){this.wrapper.addClass('webim-'+this.model.get('data')['subKind']+'-message');}};classes.views.items.messages.Base.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.messages.Base});classes.views.items.messages.DialogueMessage=function(html,radio,model){this.emojis=new classes.EmojiList();classes.views.items.messages.Base.call(this,html,radio,model);if(this.model.isNew()){this.wrapper.addClass('webim-process');this.listenToOnce(this.model,'id:afterUpdate',function(){this.wrapper.removeClass('webim-process').addClass('webim-ready');}.webimBind(this));}};classes.views.items.messages.DialogueMessage.prototype=tools.createUiObject(classes.views.items.messages.Base.prototype,{constructor:classes.views.items.messages.DialogueMessage,ui:{avatarBlock:'[data-webim-model-field="avatar"]',name:'[data-webim-model-field="name"]',text:'[data-webim-model-field="text"]',date:'[data-webim-model-field="date"]',time:'[data-webim-model-field="time"]',size:'[data-webim-model-field="size"]',preview:'[data-webim-model-field="preview"]'},emojis:null,bindings:{'@ui.avatarBlock':{name:'avatar',get:function(value,wrapper){wrapper.html($('<img>').attr('src',env.getBaseUrl()+(value||'/v/images/visitor_avatar_default.png')));}},'@ui.name':{name:'name',get:function(value,wrapper){value?wrapper.text(value):wrapper.text('');}},'@ui.time':{name:'created',get:function(value,wrapper){value?wrapper.text(tools.formatTime(value)):wrapper.text('');}},'@ui.date':{name:'created',get:function(value,wrapper){var dateFormat=core.settings.location.get('chat.messageDateFormat');var lang=core.settings.location.get('chat.lang');value?wrapper.text(tools.formatDate(value,dateFormat,lang)):wrapper.text('');}},'@ui.text':{name:'text',get:function(value,wrapper,model){wrapper.html(this.prepareMessageText(model));}},'@ui.size':{name:'text',get:function(value,wrapper,model){if(_.contains(['file_operator','file_visitor'],model.get('kind'))){var fileData=$.evalJSON(value);wrapper.html(tools.formatSize(fileData['size']))}}},'@ui.preview':{name:'preview',get:function(value,wrapper,model){if(_.contains(['file_operator','file_visitor'],model.get('kind'))){var fileData=$.evalJSON(model.get('text'));if(fileData['filename'].match(/\.(png|jpg|jpeg|gif)$/i)){var fileUrl=this.createFileUrl(fileData);var img='<img src="'+fileUrl+'&thumb=web">';wrapper.attr('href',fileUrl);wrapper.html(img);}}}}},createFileUrl:function(fileData){var expires=Math.round((new Date()).getTime()/1000)+60*5;return tools.formatUrl({'baseUrl':env.getBaseUrl()+'/l/v/download/'+fileData['guid']+'/'+encodeURIComponent(fileData['filename']),'params':{'expires':expires,'hash':tools.hexHashSha256(fileData['guid']+expires,core.repository.get('session').get('authToken')),'page-id':core.repository.get('session').get('pageId')}});},prepareMessageText:function(message){var messageText='';switch(message.get('kind')){case'contacts':var visitorData=_.pick($.evalJSON(message.get('text')),function(value){return Boolean(value);});visitorData=_.mapObject(visitorData,function(value,fieldName){return core.resources.get('visitor.contacts.'+fieldName)+': '+_.escape(value);});messageText=core.resources.get('chat.message.contacts_posted')+' '+_.values(visitorData).join(', ');break;case'file_operator':case'file_visitor':var fileData=$.evalJSON(message.get('text'));var fileUrl=this.createFileUrl(fileData);var filename=_.escape(fileData['filename']);if(filename.length>30){filename=filename.substr(0,22)+'...'+filename.substr(-8);}
messageText='<a href="'+fileUrl+'" target="_blank" rel="nofollow noopener" title="'+_.escape(fileData['filename'])+'">'+filename+'</a>';break;default:messageText=_.prepareForHtml(message.get('text'));var emojiReg=new RegExp('('+this.emojis.getEmoticonsWithImage().join('|')+')','gi');messageText=messageText.replace(emojiReg,function(match,unicode){return'<img draggable="false" class="webim-emoji webim-emoji-'+tools.emojiToHexCode(unicode)+'" data-webim-emoji="'+unicode+'" alt="'+unicode+'" src="data:image/png;base64,R0lGODlhFAAUAIAAAP///wAAACH5BAEAAAAALAAAAAAUABQAAAIRhI+py+0Po5y02ouz3rz7rxUAOw==">'});}
return messageText;}});classes.views.items.messages.OperatorJoined=function(html,radio,model){classes.views.items.messages.Base.call(this,html,radio,model);};classes.views.items.messages.OperatorJoined.prototype=tools.createUiObject(classes.views.items.messages.Base.prototype,{constructor:classes.views.items.messages.OperatorJoined,ui:{avatarBlock:'[data-webim-model-field="avatar"]',name:'[data-webim-model-field="name"]',text:'[data-webim-model-field="text"]',date:'[data-webim-model-field="date"]',time:'[data-webim-model-field="time"]'},bindings:{'@ui.avatarBlock':{name:'data.operator.avatar',get:function(value,wrapper){wrapper.html($('<img>').attr('src',env.getBaseUrl()+(value||'/v/images/visitor_avatar_default.png')));}},'@ui.time':{name:'created',get:function(value,wrapper){value?wrapper.text(tools.formatTime(value)):wrapper.text('');}},'@ui.date':{name:'created',get:function(value,wrapper){value?wrapper.text(tools.formatDate(value)):wrapper.text('');}},'@ui.text':{name:'text',get:function(value,wrapper){wrapper.html(value);}},'@ui.name':'data.operator.fullname'}});classes.views.items.messages.Buttons=function(html,radio,model){classes.views.items.messages.Base.call(this,html,radio,model);this.ui.buttonTemplate.remove();$.each(model.data.data.params,function(key,value){this.ui[key+'Button']=this.ui.buttonTemplate.clone();this.ui[key+'Button'].data('webimActionRequestAction',key);this.ui[key+'Button'].html(core.resources.get(value['request']));this.ui[key+'Button'].click(function(e){e.preventDefault();this.clickAction(key);}.webimBind(this));this.ui.root.find('.webim-message-buttons-list').append(this.ui[key+'Button']);}.webimBind(this));};classes.views.items.messages.Buttons.prototype=tools.createUiObject(classes.views.items.messages.Base.prototype,{constructor:classes.views.items.messages.Buttons,ui:{text:'[data-webim-model-field="text"]',date:'[data-webim-model-field="date"]',time:'[data-webim-model-field="time"]',name:'[data-webim-model-field="name"]',buttonTemplate:'[data-webim-action-request-template]',root:'[data-webim-dialogue-message-type="buttons"]',result:'[data-webim-model-field="result"]'},bindings:{'@ui.time':{name:'created',get:function(value,wrapper){value?wrapper.text(tools.formatTime(value)):wrapper.text('');}},'@ui.date':{name:'created',get:function(value,wrapper){value?wrapper.text(tools.formatDate(value)):wrapper.text('');}},'@ui.text':{name:'text',get:function(value,wrapper){wrapper.html(value);}},'@ui.name':{name:'name',get:function(value,wrapper){wrapper.html(value+':');}},'@ui.result':{name:'data.result',get:function(value,wrapper){value?wrapper.text(core.resources.get('chat.custom_action_request.buttons.you_chose',[core.resources.get(this.model.data.data.params[value]['request'])])):wrapper.text('');}},'@ui.root':{name:'data.state',get:function(value,wrapper){if(value){wrapper.removeClass('webim-state-pending webim-state-completed webim-state-ignored').addClass('webim-state-'+value);}}}},clickAction:function(result){core.tracking.track('chat.custom_action_request.buttons',{'client-side-id':this.model.get('clientSideId'),'result':result})}});classes.views.items.Hint=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);};classes.views.items.Hint.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.Hint,ui:{text:'[data-webim-model-field="text"]'},bindings:{'@ui.text':{name:'text',get:function(value,wrapper){wrapper.html(_.prepareForHtml(value));}}}});classes.views.items.Notification=function(html,radio,model,options){classes.views.items.Base.call(this,html,radio,model);if(_.isObject(options['callbacks'])){_.each(options['callbacks'],function(handler,notificationAction){this.wrapper.find('[data-webim-notification-action~="'+notificationAction+'"]').click(handler)}.webimBind(this));}};classes.views.items.Notification.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.Notification,ui:{closeButton:'[data-webim-notification-action~="close"]'},events:{'click @ui.closeButton':'hide'}});classes.views.items.SeparateBlock=function(html,radio,model){classes.views.items.Base.call(this,html,radio,model);this.wrapper.addClass('webim_a_'+env.accountName).addClass('webim_l_'+env.getLocation());};classes.views.items.SeparateBlock.prototype=tools.createUiObject(classes.views.items.Base.prototype,{constructor:classes.views.items.SeparateBlock,ui:{closeButton:'[data-webim-separate-action~="close"]'},events:{'click @ui.closeButton':'hide'}});classes.views.collections={};classes.views.collections.Base=function(html,radio,collection){classes.views.Base.call(this,html,radio);this.collection=collection;this.children=[];_.each(this.collectionEvents,function(methodNames,collectionEvents){_.each(methodNames.split(/\s+/),function(methodName){this.listenTo(this.collection,collectionEvents,this[methodName].webimBind(this));}.webimBind(this));}.webimBind(this));this.itemsBlock=this.itemsBlockSelector?$(this.itemsBlockSelector,this.wrapper):this.wrapper;this.initialize();this.collection.each(this.onAddModel.webimBind(this));};classes.views.collections.Base.prototype=tools.createUiObject(classes.views.Base.prototype,{constructor:classes.views.collections.Base,collectionEvents:{afterDestroy:'destroy',afterAdd:'onAddModel',afterReset:'onAfterReset'},childEvents:null,collection:null,childView:null,childTemplate:null,itemsBlockSelector:null,itemsBlock:null,children:null,getCollection:function(){return this.collection;},getChildren:function(){return this.children;},last:function(){return _.last(this.children);},onAddModel:function(model){var childViewClass=this.childView.prototype instanceof classes.views.items.Base?this.childView:this.childView(model);var childTemplate=typeof this.childTemplate==='string'?this.childTemplate:this.childTemplate(model);var childView=new childViewClass(childTemplate,this.radio,model);_.each(this.childEvents,function(methodName,childEvent){this.listenTo(childView,childEvent,this[methodName].webimBind(this));}.webimBind(this));this.itemsBlock.append(childView.getWrapper());var blockContainer=this.container.findClosestDescendant(childView.getWrapper());childView.getContainer().setParent(blockContainer);blockContainer.addChild(childView.getContainer());childView.show();this.children.push(childView);this.listenToOnce(childView,'beforeDestroy',function(){this.children=_.without(this.children,childView);}.webimBind(this));blockContainer.trigger('afterContentChange');this.trigger('afterAdd',childView);this.wrapper.trigger('afterResize.webim');},onAfterReset:function(){if(this.children.length>0){var blockContainer=this.container.findClosestDescendant(this.children[0].getWrapper());_.each(this.children,function(child){this.trigger('afterRemove',child);child.destroy();}.webimBind(this));blockContainer.trigger('afterContentChange');this.children=[];}},destroy:function(){this.collection=this.collectionEvents=null;classes.views.Base.prototype.destroy.call(this);}});classes.views.collections.Files=function(html,radio,collection){classes.views.collections.Base.call(this,html,radio,collection);};classes.views.collections.Files.prototype=tools.createUiObject(classes.views.collections.Base.prototype,{constructor:classes.views.collections.Files,childView:classes.views.items.File,initialize:function(){this.childTemplate=$('<p>').append(this.itemsBlock.children().first()).html();this.listenToOnce(this.container,'afterShow',function(){if(!this.children.length){this.hide();}});this.on('afterAdd',function(child){this.show();this.listenToOnce(child.getContainer(),'afterHide',function(){_.defer(function(){child.destroy();if(!this.children.length){this.hide();}}.webimBind(this));}.webimBind(this));}.webimBind(this));}});classes.views.collections.Messages=function(html,radio,collection){this.templates={};classes.views.collections.Base.call(this,html,radio,collection);};classes.views.collections.Messages.prototype=tools.createUiObject(classes.views.collections.Base.prototype,{constructor:classes.views.collections.Messages,templates:null,initialize:function(){this.itemsBlock.children().each(function(index,template){var wrapper=$(template);wrapper.removeAttr('data-webim-template');this.templates[wrapper.data('webimDialogueMessageType')]=$('<p>').append(wrapper).html();}.webimBind(this));},childView:function(messageModel){return classes.views.items.messages[this.kindToViewClassName(messageModel.get('data.subKind'))]||classes.views.items.messages[this.kindToViewClassName(messageModel.get('kind'))]||classes.views.items.messages.DialogueMessage;},childTemplate:function(messageModel){return this.templates[messageModel.get('data.subKind')]||this.templates[messageModel.get('kind')]||this.templates['message'];},kindToViewClassName:function(kind){return kind?_.map(kind.split(/[-_]/),_.capitalize).join(''):'';}});classes.PreviewController=function(options){_.extend(this,_.pick(options,['radio']));};classes.PreviewController.prototype={radio:null,chatShow:function(operator){core.repository.get('session').set('state','chat');core.repository.get('chat').set({closed:false,minimized:false});if(!core.repository.get('dialogues').getCurrent()){$.when(core.resources.ready()).done(function(){core.repository.get('dialogues').add({operator:operator||{fullname:'John Smith',langToFullname:{'ru':' '}},messages:[{id:1,name:'Anonymous',text:core.resources.get('chat.dialogue.default_visitor_message'),kind:'visitor'},{id:2,name:'John Smith',text:core.resources.get('chat.dialogue.default_operator_message'),kind:'operator'}]});});}},chatHide:function(){core.repository.get('chat').set({minimized:true});},chatSetSection:function(section){core.repository.get('session').set('state',section);},invitationShow:function(){core.repository.get('invitations').add(new classes.models.Invitation({message:core.resources.get('chat.invitation.default_text')}))},invitationHide:function(){core.repository.get('invitations').reset()},switchToOnline:function(){core.repository.get('session').set('onlineStatus','online');},switchToOffline:function(){core.repository.get('session').set('onlineStatus','offline');},locationUpdate:function(data){core.settings.location.set(data);},locationChange:function(locationName){},restart:function(){}};classes.Environment=function(baseEnv){_.extend(this,_.omit(baseEnv,['domain','location','mode','baseUrl','mainUrl']));if(baseEnv.domain){this.domain=baseEnv['domain'];}else{var domainUrl=window['webimInit']&&window['webimInit']['mainUrl']?window['webimInit']['mainUrl']:$('a[rel="webim"], a[href*="webim.ru/webim/client.php"], a.webim_button').attr('href');var domainMatch=domainUrl.match(new RegExp('//([^/]+)/'));this.domain=domainMatch?domainMatch[0]:null;}
this.accountName=baseEnv['accountName']||this.domain.split('.').shift()||null;this.setLocation(baseEnv['location']);this.version=baseEnv['version']||'DEVELOP_'+tools.guid();if(window.location.hash&&window.location.hash.indexOf('webimcobrowsing')===1){this.mode='cobrowsing'}else if(!tools.isCrossDomainFrame()&&window.parent&&window!==window.parent&&window.parent.waitingVisitorsPageMarker){this.mode='off';}else{this.mode=tools.getUrlParam('webim-invitation-mode')||baseEnv['mode']||'standard';}
this.debug=this.debug||(window.location.hash&&window.location.hash.indexOf('webim_debug')>-1);};classes.Environment.prototype={constructor:classes.Environment,domain:null,accountName:null,location:null,mode:null,version:null,rootSelector:'body',getDomain:function(){return this.domain;},getLocation:function(){return this.location;},setLocation:function(locationName){this.location=locationName?locationName.replace(/\./g,''):'default';},getBaseUrl:function(forWebSockets){var secured=document.location.protocol==='https:';if(this.getDomain().indexOf('.webim2.ru')!==-1){secured=false;}else if(core.settings&&core.settings.config.hasOption('force_visitor_https')){secured=true;}
var protocol=forWebSockets?'ws':'http';secured&&(protocol+='s');return protocol+'://'+this.getDomain();},getMode:function(){return this.mode;},getRootWrapper:function(){return $(this.rootSelector||'body');}};classes.Webim=function(){this.radio=classes.Radio.channel('webim.general');new classes.services.Button({radio:this.radio,createButtonElement:env.createButtonElement});this.servicesStartedDeferred=new $.Deferred();};classes.Webim.prototype={constructor:classes.Webim,radio:null,initialized:false,servicesStartedDeferred:null,stdServices:['WebAnalytics','Invitations','Notifications','Alarm','Chat','Call','SeparateBlocks','Teleport','Cobrowsing'],separateWindowServices:['WebAnalytics','Notifications','Alarm','Chat','Call','Teleport'],services:null,init:function(){if(!this.initialized){this.initialized=true;if(this.shouldBeDisabled()){this.disable();return;}
if(env.getMode()==='cobrowsing'){new classes.services.Cobrowsing({radio:this.radio,role:'operator'});this.radio.request('service:cobrowsing:start',window.location.hash.substring(16));this.disable();return;}
$.when(core.settings.load()).done(this.settingsReadyHandler.webimBind(this));}},settingsReadyHandler:function(){var config=core.settings.config;var location=core.settings.location;if(!config.hasOption('multilang')){location.set('chat.lang',config.get('default_lang'));}
if(config.hasOption('force_visitor_disable')){this.disable();return;}
var enabled=core.storage.get('WEBIM_ENABLED');if(enabled==null){var rnd=Math.random()*100;enabled=rnd<(config.get('visitor_enabling_probability')||0);}
if(config.get('visitor_enabling_probability')){enabled=enabled||(document.referrer&&document.referrer.match(/http(s)?:\/\/(.*\.)?webim\.ru/));}
core.storage.set('WEBIM_ENABLED',enabled,1/24);enabled?this.startServices(location,config):this.disable();core.tracking.setSocketUsing(core.browser.support('websockets')&&config.hasOption('visitor_websockets'));},startServices:function(location,config){$.when(core.loader.loadResources()).done(function(resources){core.resources.setResources({resources:resources,locationResources:location.get('resources')||{},visitorResources:location.get('chat.visitorFieldLabels')||{}});});core.resources.listenTo(location,'resources:afterUpdate chat.visitorFieldLabels:afterUpdate',function(){this.setLocationResources(location.get('resources'),location.get('chat.visitorFieldLabels'));}.webimBind(core.resources));$.when(core.resources.ready()).done(function(){this.services=_.map(Boolean(env.separateChatWindow)?this.separateWindowServices:this.stdServices,function(serviceName){return new classes.services[serviceName]({radio:this.radio});}.webimBind(this));if(location.hasOption('button.button_delay')){_.delay(this.radio.request.webimBind(this.radio,'service:button:start'),location.get('button.button_delay')*1000);}else{this.radio.request('service:button:start');}
if(this.shouldInitTracking(config)){core.tracking.startTracking({session:core.repository.get('session'),visitor:core.repository.get('visitor')});}else{core.tracking.updateOnlineStatus(core.repository.get('session'));}
if(location.hasOption('misc.fixFlashWmode')){tools.fixFlashWmode();}
this.servicesStartedDeferred.resolve();}.webimBind(this));},servicesStarted:function(){return this.servicesStartedDeferred.promise();},shouldBeDisabled:function(){return(env.accountName==='ivarviwebasystnetshop'&&core.browser.isMobile())||core.browser.isNotSupported()||env.getMode()==='off';},disable:function(){this.radio.request('service:button:stop');},shouldInitTracking:function(config){if(core.repository.get('session').get('id')){return true;}
if(_.contains(['allsoftru','laredouteru','mediasaturncom001',env.accountName])){return false;}
if(!config.hasOption('visitor_tracking')){return false;}
if(env.accountName==='playbetboxcom'||env.accountName==='_mixey'){if(!window.webim_visitor&&env.getLocation()!=='landing'){return false;}}
return true;},getRadio:function(){return this.radio;},restart:function(){core.tracking.stopTracking();_.invoke(this.services,'destroy');core.loader.reset();this.initialized&&core.settings.load().done(this.settingsReadyHandler.webimBind(this));}};if(!window.webimInitialized){window.webimInitialized=true;env=new classes.Environment(window.webim||{});core.logger=new classes.core.Logger();env.debug&&core.logger.enable();core.storage=new classes.core.Storage();core.browser=new classes.core.Browser();core.loader=new classes.core.Loader({forMobile:core.browser.isMobile()});core.repository=new classes.core.Repository();core.tracking=new classes.core.Tracking({visitor:core.repository.get('visitor'),session:core.repository.get('session')});core.settings=new classes.core.Settings();var interval;core.tracking.listenTo(core.settings.config,'operator_check_status_online:afterUpdate',function(value){if(interval){clearInterval(interval);interval=null;}
if(value){interval=setInterval(function(){core.tracking.updateOnlineStatus(core.repository.get('session'));},value*1000);}});core.resources=new classes.core.Resources();core.settings.listenTo(core.tracking,'account:blocked',function(){this.getAccount().set('blocked',true);}.webimBind(core.settings));core.repository.listenTo(core.tracking,{'full-update':function(){this.get('dialogues').reset();this.get('departments').reset();}.webimBind(core.repository),'dialogue:new':function(dialogueData){this.get('dialogues').add(new classes.models.Dialogue(dialogueData));}.webimBind(core.repository),'dialogue:message:add':function(messageData){this.get('dialogues').last()&&this.get('dialogues').getCurrent().addMessage(messageData);}.webimBind(core.repository),'dialogue:message:update':function(messageData){this.get('dialogues').last()&&this.get('dialogues').getCurrent().updateMessage(messageData);}.webimBind(core.repository),'dialogue:message:delete':function(id){this.get('dialogues').last()&&this.get('dialogues').getCurrent().deleteMessage(id);}.webimBind(core.repository),'dialogue:update':function(data){this.get('dialogues').last()&&this.get('dialogues').getCurrent().set(data);}.webimBind(core.repository),'dialogue:operator:rate':function(rateData){this.get('dialogues').last()&&this.get('dialogues').getCurrent().set('operatorIdToRate.'+rateData['operatorId'],rateData);}.webimBind(core.repository),'visitor:update':function(visitorData){this.get('visitor').set(visitorData);this.get('visitor').save();}.webimBind(core.repository),'cobrowsing:session:update':function(cobrowsingData){cobrowsingData&&this.get('cobrowsing').set(cobrowsingData);}.webimBind(core.repository),'invitation':function(invitationData){this.get('invitations').add(new classes.models.Invitation(invitationData));}.webimBind(core.repository),'departments:replace':function(departments){this.get('departments').reset();this.get('departments').add(_.toArray(departments));}.webimBind(core.repository),'has-previous-chats':function(hasPreviousChats){this.get('dialogues').setHasPrevious(hasPreviousChats);}.webimBind(core.repository),'teleport-url':function(url){this.get('teleport').set('url',url);}.webimBind(core.repository),'online-operators:afterOnlineStatusChanged':function(status){if(status=='online'){window.webim.handlers.onOnlineOperatorsAppear();}else{window.webim.handlers.onOnlineOperatorsLeave();}}.webimBind(core.repository)});if(_.isFunction(window.webimOnOnlineStateCanged)){core.repository.get('session').on('statusOnline:afterUpdate',window.webimOnOnlineStateCanged);}
$(window).on('focus',function(){core.repository.get('system').set('focus',true);}).on('blur',function(){core.repository.get('system').set('focus',false);});core.tracking.listenTo(core.repository,'visitor:afterReplace',core.tracking.replaceTrackingVisitor.webimBind(core.tracking)).listenTo(core.repository.get('dialogues'),'newCurrent',core.tracking.setCurrentDialogue.webimBind(core.tracking)).listenTo(core.repository.get('dialogues'),'afterReset',core.tracking.setCurrentDialogue.webimBind(core.tracking,null));system=new classes.Webim();if(_.isFunction(window.webimClientSiteCustomInit)){system.servicesStarted().done(window.webimClientSiteCustomInit);}
_.defer(system.init.webimBind(system));_.extend(window.webim,{api:{chat:{isActive:function(){return core.repository.get('session').get('state')==='chat';},start:function(params){system.getRadio().request('service:chat:start',params);},close:function(){system.getRadio().request('service:chat:close');}},invitation:{start:function(text){core.repository.get('invitations').add(new classes.models.Invitation({message:text,type:'by-url-param'}));}},onProvidedVisitorChanged:function(){core.repository.changeVisitor();},onUrlChange:function(){core.tracking.onUrlChange();},setFocusState:function(inFocus){core.repository.get('system').set('manualFocus',inFocus);},changeLocation:function(locationName){env.setLocation(locationName);system.restart();}},handlers:{onInit:function(event){},onChatShownStateChanged:function(event){},onOnlineOperatorsAppear:function(){},onOnlineOperatorsLeave:function(){},onChatReadChanged:function(event){},onTeleport:function(event){return false;},onOfflineMessageSent:function(event){},onProvidedTokenNotFoundError:function(){}}});if(env.debug){_.defaults(window.webim,{core:core,system:system,env:env});}
if(window.webimHandlers){_.each(window.webim.handlers,function(handler,handlerName){window.webim.handlers[handlerName]=_.isFunction(handler)&&_.has(window.webimHandlers,handlerName)?window.webimHandlers[handlerName]:handler;});}
$(window).on('message',function(event){try{var data=JSON.parse(event.originalEvent.data);if(data.name==='separate_chat_ready_to_start'){system.getRadio().trigger('sendPrehistoryToSeparate');}
if(data.name==='prehistory_body'){system.getRadio().trigger('startSeparateChatWithPrehistory',data.data);}}catch(error){}});system.getRadio().on({'system:event:offline-message:afterSend':window.webim.handlers.onOfflineMessageSent,'system:event:chat:afterShow':function(){window.webim.handlers.onChatShownStateChanged({shown:true});},'system:event:chat:afterHide':function(){window.webim.handlers.onChatShownStateChanged({shown:false});}}).reply('system:request:beforeTeleport',window.webim.handlers.onTeleport);core.repository.get('dialogues').on('newCurrent',function(dialogue){dialogue.on('unreadByVisitorMsgCnt:afterUpdate',function(unreadMsg){window.webim.handlers.onChatReadChanged({read:!unreadMsg,unreadMsgCnt:unreadMsg});});});core.repository.get('session').statusInitialized().done(function(){webim.handlers.onInit({online:this.get('onlineStatus')==='online',status:this.get('onlineStatus')});}.webimBind(core.repository.get('session')));core.tracking.on('provided-auth-token-not-found',window.webim.handlers.onProvidedTokenNotFoundError);if(env.getMode()==='preview'){window.webim.previewController=new classes.PreviewController({radio:system.getRadio()});}
_.isFunction(window.webimOnLoad)&&_.defer(window.webimOnLoad);window.webimStartChatSimple=function(){return window.webim.api.chat.start();};}
jQuery.noConflict(true);_.noConflict();delete window.Modernizr;oldModernizr&&(window.Modernizr=oldModernizr);delete window.o;oldO&&(window.o=oldO);})(window);