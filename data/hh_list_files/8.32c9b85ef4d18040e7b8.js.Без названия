(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{533:function(e,t,i){"use strict";i.r(t);var s=i(1),n=i.n(s),l=i(3),o=i(17),h=i(91),r=i(535),a=i(78);t.default=new function(){this.allowToRestoreLastElement=!1,this.lastRemovedElement=null,this.lastRemovedElementIndex=null,this.initCollection=function(e){r.default.deferred.done(this.__initCollection.bind(this,e))},this.__initCollection=function(e){var t=this;this.element=e,this.$element=n()(e),this.$window=n()(window),this.initElements(),this.template=this._getTemplate(),this.$addButton=n()(this.element.querySelector(".HH-Form-Collection-Add")||"<div>"),this.$placeToAdd=n()(this.element.querySelector(".HH-Form-Collection-PlaceToAdd")||"<div>"),this.$fieldTitle=n()(this.element.querySelector(".HH-Form-Collection-FieldTitle")||"<div>"),this.$toggleWrapper=n()(this.element.querySelector(".HH-Form-Collection-ToggleWrapper")||"<div>"),this.$disableWrapper=n()(this.element.querySelector(".HH-Form-Collection-DisableWrapper")||this.element),this.$addButton.on("click",this.append.bind(this)),h.default.getUniqueId(this),this.field=r.default.add(this.getValues.bind(this),this.validateElements.bind(this),this),this.checkForAlone(),o.default.dispatch("HH-Form-New",this,this,1),this.$toggleWrapper.on("Bloko-Toggle-Switch",function(e){t.setDisabled(e.detail.isClosed)})},this.isValid=!1,this.initElements=function(){var e=this;this.elements=this.getElements().map(function(t){var i=e.createElement(t);return i.initValiditySetters(),i})},this.getConditions=function(){return r.default.getConditions(this.name)},this.getMessage=function(e){return r.default.getMessage(this.name,e)},this.getTemplate=function(){return null},this._getTemplate=function(){var e=this.getTemplate();return e?(n()(e).remove(),n()(e).removeClass("g-hidden"),e):null},this.remove=function(e){if(1!==this.elements.length||this.canRemoveLastElement){for(var t=0,i=this.elements.length;t<i;t++)if(h.default.getUniqueId(this.elements[t].element)===h.default.getUniqueId(e.element)){this.elements.splice(t,1),this.showRestoreNotification(e,t);break}var s;for(var l in e.parts)if(e.parts.hasOwnProperty(l)){s=n()(e.parts[l].form);break}e.element.parentNode.removeChild(e.element),this.checkForAlone(),0===this.elements.length&&(this.$toggleWrapper.trigger("Bloko-Toggle-Click.toggle","collapse"),this.append()),s.trigger("HH-Form-Collection-RemoveElement"),this.$window.trigger("possible-resize")}},this.getValues=function(){return this.elements.map(function(e){return e.getValue()}).filter(function(e){return""!==e}).join("&")},this.isEmpty=function(){return this.elements.every(function(e){return e.isEmpty()})},this.checkForAlone=function(){var e=1===this.elements.length;this.elements.forEach(function(t){t.toggleDeleteButton(e)})},this.append=function(){if(this.validateElements().isMaxCountReached){var e=n()(".HH-Form-Collection-MaxCountNotification",this.$element).clone();l.default.make(a.default,this.element,{content:e.get(0),autoClose:!0})}else{var t;this.elements.length?t=n()(this.elements[this.elements.length-1].element):(t=this.$placeToAdd,this.canRemoveLastElement||this.$fieldTitle.removeClass("g-hidden"));var i=n()(this.template).clone().insertAfter(t).trigger("HH-Form-Collection-AddElement").get(0);l.default.init(i);var s=this.createElement(i);s.initValiditySetters(),this.elements.push(s),this.disabled||this.hideRestoreNotification(),this.checkForAlone(),this.$window.trigger("possible-resize")}},this.restoreLastRemovedElement=function(){if(null!==this.lastRemovedElement&&null!==this.lastRemovedElementIndex){var e=n()(this.lastRemovedElement.element);this.disabled?(this.$toggleWrapper.trigger("Bloko-Toggle-Click.toggle","expand"),this.elements[0].element.parentNode.removeChild(this.elements[0].element),e.insertAfter(this.$placeToAdd),this.elements.splice(this.lastRemovedElementIndex,1,this.lastRemovedElement)):(this.lastRemovedElementIndex===this.elements.length?e.insertAfter(this.elements[this.elements.length-1].element):e.insertBefore(this.elements[this.lastRemovedElementIndex].element),this.elements.splice(this.lastRemovedElementIndex,0,this.lastRemovedElement)),e.trigger("HH-Form-Collection-AddElement"),this.hideRestoreNotification(),this.checkForAlone(),this.$window.trigger("possible-resize")}},this.getElementsStatuses=function(){return this.elements.map(function(e){return e.validate()})},this.validateElements=function(){if(this.disabled)return{};var e=this.getElementsStatuses();return this.processStatuses(e)},this.reset=function(){this.visited=!1,this.elements.forEach(function(e){e.visited={}})},this.processStatuses=function(e){var t=this.getConditions()||{},i=void 0!==t.mincount?t.mincount:1,s=void 0!==t.maxcount?t.maxcount:1/0,n=0,l=0;e.forEach(function(e){""===e?n+=1:"empty"===e&&(l+=1)});var o=i&&n<i,h=s&&n>s,r=n+l===e.length&&!o&&!h;return this.isValid=r,this.dispatchChangeEvent(),{name:this.name,validCount:n,succeed:r,isMaxCountReached:e.length>=s}},this.dispatchChangeEvent=function(){o.default.dispatch("HH-Form-Collection-Change",this,this,1)},this.setDisabled=function(e){this.disabled=e,e?(this.$disableWrapper.addClass("g-hidden"),this.isValid=!0,o.default.dispatch("HH-Form-Collection-Change",this,this,1)):(this.$disableWrapper.removeClass("g-hidden"),this.validateElements()),this.elements.forEach(function(t){for(var i in t.parts)t.parts.hasOwnProperty(i)&&n()(t.parts[i]).prop("disabled",e)},this);var t="".concat(this.name,".id");n()('input[name="'.concat(t,'"]'),this.element).toArray().forEach(function(t){t.disabled=e?"disabled":""},this)},this.focusFirstInvalidElement=function(){for(var e=0;e<this.elements.length;e++)if(this.elements[e].focusIfInvalid())return!0;return!1},this.beforeSubmit=function(){},this.resetRequiredConditions=function(){this.elements.forEach(function(e){e.resetRequiredConditions()})},this.showRestoreNotification=function(e,t){var i,s;if(this.allowToRestoreLastElement){this.lastRemovedElement=e,this.lastRemovedElementIndex=t;var o=n()(".HH-Form-Collection-RestoreNotification",this.$element).clone();n()(".HH-Form-Collection-Restore",o).on("click",this.restoreLastRemovedElement.bind(this)),null===(i=this.restoreNotification)||void 0===i||null===(s=i.close)||void 0===s||s.call(i),this.restoreNotification=l.default.make(a.default,this.element,{content:o.get(0),autoClose:!0})}},this.hideRestoreNotification=function(){var e,t;this.lastRemovedElement=null,this.lastRemovedElementIndex=null,null===(e=this.restoreNotification)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),this.restoreNotification=null}}}}]);
//# sourceMappingURL=8.32c9b85ef4d18040e7b8.js.map