(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{581:function(e,t,n){"use strict";n.r(t);var o=n(539),a=n(1324),r=n.n(a),c=n(1325),l=n.n(c),i=n(1326),s=n.n(i),u=n(1327),f=n.n(u),p=n(44),d=n(1408),g=n(28);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h={analyticsGoalOpenBalloon:"cian_ad_open_balloon",analyticsGoalCianLinkClick:"cian_ad_cian_link_click",analyticsGoalClusterClick:"cian_ad_cluster_click",placemarkIcon:"".concat(window.globalVars.staticHost,"/i/Components/VacancyMap/cian-placemark.svg"),clusterIcon:"".concat(window.globalVars.staticHost,"/i/Components/VacancyMap/cian-cluster.svg"),placemarkIconSize:[27,36],clusterIconSize:[27,27],mapZoom:16};t.default=function(e,t){var n=m({},h,{},t),a={iconLayout:"default#image",iconImageHref:n.placemarkIcon,iconImageSize:n.placemarkIconSize,zIndex:n.placemarkZIndex},c=Math.floor(e.offsetWidth*e.offsetHeight/(a.iconImageSize[0]*a.iconImageSize[1])),i="flatRent",u=1e5,y=O(),b=[15,-20],v=[-40,0];function O(){return"RUR"!==n.compensation.currencyCode?u:n.compensation.to?n.compensation.to:u}function I(e){return l.a.render({offers:e,trl:n.trl})}function k(e){switch(e){case 10:return n.trl.cianBodyBedPlace;case 9:return n.trl.cianBodyStudio;case 7:return n.trl.cianBodyFreeLayout;case 6:return n.trl.cianBodyManyRooms.replace("{}",e);default:return n.trl.cianBodyRooms.replace("{}",e)}}function C(e){e.originalRequestId=n.originalRequestId,d.a.get("/analytics",{params:e})}o.default.then(function(t){var o=new t.LoadingObjectManager("/vacancy/cian_placemarks?screen_area=".concat(c,"&priceMax=").concat(O(),"&bbox=%b"),{clusterize:!0,groupByCoordinates:!1,clusterHasHint:!1,clusterIcons:[{href:n.clusterIcon,size:n.clusterIconSize,offset:b}],clusterIconContentLayout:null,geoObjectOpenBalloonOnClick:!1,geoObjectIconLayout:a.iconLayout,geoObjectIconImageHref:a.iconImageHref,geoObjectIconImageSize:a.iconImageSize}),l=t.templateLayoutFactory.createClass(f.a.render(),{build:function(){var e=this;this.constructor.superclass.build.call(this),this._element=this.getParentElement().querySelector(".HH-CianPlacemarks-Balloon"),this._element.querySelector(".HH-CianPlacemarks-BalloonClose").addEventListener("click",function(t){t.preventDefault(),e.events.fire("userclose")}),this.applyElementOffset()},onSublayoutSizeChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];l.superclass.onSublayoutSizeChange.apply(this,t),this.applyElementOffset(),this.events.fire("shapechange")},applyElementOffset:function(){this._element.style.left=0,this._element.style.top=-this._element.offsetHeight/2},getShape:function(){var e,n,o=(null===(e=this._element)||void 0===e?void 0:e.offsetWidth)||0,a=(null===(n=this._element)||void 0===n?void 0:n.offsetHeight)||0,r={left:b[0]+v[0],top:-(a/2+b[1])+v[1]};return new t.shape.Rectangle(new t.geometry.pixel.Rectangle([[r.left,r.top],[r.left+o,r.top+a]]))}});o.objects.options.set({balloonLayout:l,balloonPanelMaxMapArea:0,hideIconOnBalloonOpen:!1,balloonOffset:b}),e.addEventListener("click",function(e){e.target.closest(".HH-CianPlacemarks-Link")&&C({goal:n.analyticsGoalCianLinkClick,target:e.target.href})}),o.objects.events.add("click",function(e){var t=e.get("objectId");if(function(e){return o.objects.getById(e).properties.balloonContent}(t))o.objects.balloon.open(t);else{var a=o.objects.getById(t);a.properties.balloonContent=s.a.render(),o.objects.balloon.open(t),function(e){return new Promise(function(t){d.a.post("/vacancy/cian_offers",{category:i,priceMax:y,boundedBy:{lowerCorner:{lat:e.lat-5e-5,lng:e.lng-5e-5},upperCorner:{lat:e.lat+5e-5,lng:e.lng+5e-5}}}).then(function(e){var t=e.data,o=void 0===t?{}:t;return"offerBlocks"in o?o.offerBlocks.map(function(e){var t=Object(g.a)(e.url),o=Object(g.a)();return o.search=n.utmSource,t.params=m({},t.params,{},o.params),{url:t.href,price:p.default.formatCost(e.price),offerType:k(e.room),floor:e.floor,floors:e.floors,photo:e.photo.length}}):[]}).then(function(e){var o;t({header:(o=e.length,r.a.render({header:o,headerTrl:n.trl.cianHeaderText})),body:I(e),offers:e})})})}({lat:a.geometry.coordinates[0],lng:a.geometry.coordinates[1]}).then(function(e){a.properties.balloonContentHeader=e.header,a.properties.balloonContentBody=e.body,o.objects.balloon.setData(a),C({goal:n.analyticsGoalOpenBalloon,offersSize:e.offers.length})})}}),o.clusters.overlays.events.add("click",function(e){var a=o.clusters.getById(e.get("objectId")).properties.geoObjects.map(function(e){return e.geometry.coordinates}),r=t.util.bounds.fromPoints(a),c=t.util.bounds.containsBounds(n.ymap.getBounds(),r),l=t.util.bounds.getCenter(r);C({goal:n.analyticsGoalClusterClick,needZoom:c}),c&&(n.ymap.setCenter(l,n.ymap.getZoom()+1),e.stopImmediatePropagation())},o,200),n.ymap.geoObjects.add(o)},console.error)}}}]);
//# sourceMappingURL=241.532937d032a41c05ab73.js.map